<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Yade-commits] r1329 - in trunk: core extra extra/clump extra/tetra	extra/usct gui/cmd lib/QGLViewer lib/serialization	pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/DeusExMachina pkg/common/Engine/MetaEngine	pkg/common/Engine/StandAloneEngine	pkg/dem/DataClass/PhysicalParameters	pkg/dem/Engine/DeusExMachina pkg/dem/Engine/StandAloneEngine	pkg/fem/Engine/StandAloneEngine pkg/lattice/Engine/StandAloneEngine	pkg/mass-spring/Engine/StandAloneEngine	pkg/realtime-rigidbody/Engine/StandAloneEngine
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/yade-commits/2008/index.html" >
   <LINK REL="made" HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1329%20-%20in%20trunk%3A%20core%20extra%20extra/clump%20extra/tetra%0A%09extra/usct%20gui/cmd%20lib/QGLViewer%20lib/serialization%0A%09pkg/common/DataClass/PhysicalParameters%0A%09pkg/common/Engine/DeusExMachina%20pkg/common/Engine/MetaEngine%0A%09pkg/common/Engine/StandAloneEngine%0A%09pkg/dem/DataClass/PhysicalParameters%0A%09pkg/dem/Engine/DeusExMachina%20pkg/dem/Engine/StandAloneEngine%0A%09pkg/fem/Engine/StandAloneEngine%20pkg/lattice/Engine/StandAloneEngine%0A%09pkg/mass-spring/Engine/StandAloneEngine%0A%09pkg/realtime-rigidbody/Engine/StandAloneEngine&In-Reply-To=%3C200804282152.m3SLqJUR024179%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000290.html">
   <LINK REL="Next"  HREF="000292.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Yade-commits] r1329 - in trunk: core extra extra/clump extra/tetra	extra/usct gui/cmd lib/QGLViewer lib/serialization	pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/DeusExMachina pkg/common/Engine/MetaEngine	pkg/common/Engine/StandAloneEngine	pkg/dem/DataClass/PhysicalParameters	pkg/dem/Engine/DeusExMachina pkg/dem/Engine/StandAloneEngine	pkg/fem/Engine/StandAloneEngine pkg/lattice/Engine/StandAloneEngine	pkg/mass-spring/Engine/StandAloneEngine	pkg/realtime-rigidbody/Engine/StandAloneEngine</H1>
    <B>eudoxos at BerliOS</B> 
    <A HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1329%20-%20in%20trunk%3A%20core%20extra%20extra/clump%20extra/tetra%0A%09extra/usct%20gui/cmd%20lib/QGLViewer%20lib/serialization%0A%09pkg/common/DataClass/PhysicalParameters%0A%09pkg/common/Engine/DeusExMachina%20pkg/common/Engine/MetaEngine%0A%09pkg/common/Engine/StandAloneEngine%0A%09pkg/dem/DataClass/PhysicalParameters%0A%09pkg/dem/Engine/DeusExMachina%20pkg/dem/Engine/StandAloneEngine%0A%09pkg/fem/Engine/StandAloneEngine%20pkg/lattice/Engine/StandAloneEngine%0A%09pkg/mass-spring/Engine/StandAloneEngine%0A%09pkg/realtime-rigidbody/Engine/StandAloneEngine&In-Reply-To=%3C200804282152.m3SLqJUR024179%40sheep.berlios.de%3E"
       TITLE="[Yade-commits] r1329 - in trunk: core extra extra/clump extra/tetra	extra/usct gui/cmd lib/QGLViewer lib/serialization	pkg/common/DataClass/PhysicalParameters	pkg/common/Engine/DeusExMachina pkg/common/Engine/MetaEngine	pkg/common/Engine/StandAloneEngine	pkg/dem/DataClass/PhysicalParameters	pkg/dem/Engine/DeusExMachina pkg/dem/Engine/StandAloneEngine	pkg/fem/Engine/StandAloneEngine pkg/lattice/Engine/StandAloneEngine	pkg/mass-spring/Engine/StandAloneEngine	pkg/realtime-rigidbody/Engine/StandAloneEngine">eudoxos at mail.berlios.de
       </A><BR>
    <I>Mon Apr 28 23:52:19 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000290.html">[Yade-commits] r1328 - in trunk/pkg/dem: .	DataClass/InteractionPhysics Engine/StandAloneEngine PreProcessor
</A></li>
        <LI>Next message: <A HREF="000292.html">[Yade-commits] r1330 - in trunk: . core gui gui/cmd gui/qt3 lib	lib/factory lib/serialization lib/serialization-bin	lib/serialization-xml scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#291">[ date ]</a>
              <a href="thread.html#291">[ thread ]</a>
              <a href="subject.html#291">[ subject ]</a>
              <a href="author.html#291">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: eudoxos
Date: 2008-04-28 23:52:11 +0200 (Mon, 28 Apr 2008)
New Revision: 1329

Modified:
   trunk/core/DeusExMachina.cpp
   trunk/core/DeusExMachina.hpp
   trunk/core/Engine.hpp
   trunk/core/InteractingGeometry.hpp
   trunk/core/MetaBody.cpp
   trunk/core/MetaBody.hpp
   trunk/core/TimeStepper.hpp
   trunk/extra/Brefcom.cpp
   trunk/extra/Brefcom.hpp
   trunk/extra/BrefcomTestGen.cpp
   trunk/extra/SConscript
   trunk/extra/clump/Clump.cpp
   trunk/extra/clump/Clump.hpp
   trunk/extra/clump/PythonRecorder.cpp
   trunk/extra/clump/PythonRecorder.hpp
   trunk/extra/clump/Shop.cpp
   trunk/extra/clump/Shop.hpp
   trunk/extra/tetra/Tetra.cpp
   trunk/extra/tetra/Tetra.hpp
   trunk/extra/usct/UniaxialStrainControlledTest.cpp
   trunk/extra/usct/UniaxialStrainControlledTest.hpp
   trunk/gui/cmd/attrUtils.cpp
   trunk/gui/cmd/yadeControl.cpp
   trunk/lib/QGLViewer/qglviewer.h
   trunk/lib/serialization/PointerHandler.tpp
   trunk/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters.cpp
   trunk/pkg/common/Engine/DeusExMachina/CentralGravityEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/CentralGravityEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/CinemCisEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/CinemCisEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/DisplacementEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/DisplacementEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/FixedOrientationEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/FixedOrientationEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/FixedPositionEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/FixedPositionEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/ForceEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/ForceEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/GravityEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/GravityEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/MomentEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/MomentEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/RotationEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/RotationEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/StaticAttractionEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/StaticAttractionEngine.hpp
   trunk/pkg/common/Engine/DeusExMachina/TranslationEngine.cpp
   trunk/pkg/common/Engine/DeusExMachina/TranslationEngine.hpp
   trunk/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp
   trunk/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.hpp
   trunk/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.cpp
   trunk/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.hpp
   trunk/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.cpp
   trunk/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.hpp
   trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp
   trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.hpp
   trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp
   trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.hpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.cpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.hpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.cpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.hpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.cpp
   trunk/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.hpp
   trunk/pkg/common/Engine/StandAloneEngine/DistantPersistentSAPCollider.cpp
   trunk/pkg/common/Engine/StandAloneEngine/DistantPersistentSAPCollider.hpp
   trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp
   trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.hpp
   trunk/pkg/common/Engine/StandAloneEngine/PersistentTriangulationCollider.cpp
   trunk/pkg/common/Engine/StandAloneEngine/PersistentTriangulationCollider.hpp
   trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp
   trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.hpp
   trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp
   trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.hpp
   trunk/pkg/common/Engine/StandAloneEngine/SAPCollider.cpp
   trunk/pkg/common/Engine/StandAloneEngine/SAPCollider.hpp
   trunk/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters.cpp
   trunk/pkg/dem/Engine/DeusExMachina/CapillaryPressureEngine.cpp
   trunk/pkg/dem/Engine/DeusExMachina/CapillaryPressureEngine.hpp
   trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.cpp
   trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.hpp
   trunk/pkg/dem/Engine/DeusExMachina/CapillaryStressRecorder.cpp
   trunk/pkg/dem/Engine/DeusExMachina/CapillaryStressRecorder.hpp
   trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.cpp
   trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.hpp
   trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.cpp
   trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.hpp
   trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp
   trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp
   trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.cpp
   trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.hpp
   trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.cpp
   trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.hpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.hpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp
   trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp
   trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.cpp
   trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/ForceSnapshot.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/ForceSnapshot.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/PositionRecorder.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/PositionRecorder.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/PositionSnapshot.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/PositionSnapshot.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.hpp
   trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp
   trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp
   trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.cpp
   trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.cpp
   trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp
   trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.cpp
   trunk/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.cpp
   trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.cpp
   trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.cpp
   trunk/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.hpp
   trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.cpp
   trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.hpp
   trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.cpp
   trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.hpp
   trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.cpp
   trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.hpp
Log:
1. PROTOTYPE?\194?\160CHANGE: Engine::action(Body*) changed to Engine::action(MetaBody*); all engines adapted
2. MetaBody::miscParams can be used to set static variables at deserialization (used for GLDrawBrefcomContact now)
3. allow serialization of shared_ptr&lt;Serializable&gt; (only pointers to derived classes were enabled until now)
4. big fixes inside brefcom
5. enhancements of python interface (Generic class, fixes)
6. added Shop::GLDrawLine, Shop::GLDrawArrow, Shop::GLDrawNum
7. fixed QGLViewer #defining DEBUG (qt3) by #undef'ing it after qt3 headers inclusion





Modified: trunk/core/DeusExMachina.cpp
===================================================================
--- trunk/core/DeusExMachina.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/core/DeusExMachina.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -8,21 +8,14 @@
 
 #include &quot;DeusExMachina.hpp&quot;
 
-DeusExMachina::DeusExMachina() : Engine()
-{
-	//startTime = -1;
-	//stopTime = -1;
-	time = 0;
+DeusExMachina::DeusExMachina() : Engine() {
 	subscribedBodies.resize(0);
 }
 
-void DeusExMachina::registerAttributes()
-{
+void DeusExMachina::registerAttributes() {
 	REGISTER_ATTRIBUTE(subscribedBodies);
 }
 
-
-void DeusExMachina::action(Body* b)
-{
+void DeusExMachina::action(MetaBody* b) {
 	this-&gt;applyCondition(b);
 }

Modified: trunk/core/DeusExMachina.hpp
===================================================================
--- trunk/core/DeusExMachina.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/core/DeusExMachina.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -11,12 +11,11 @@
 
 #include &lt;vector&gt;
 
-#include &quot;Engine.hpp&quot;
+#include&lt;yade/core/Engine.hpp&gt;
+#include&lt;yade/core/Body.hpp&gt;
 
-class Body;
+/*! \brief Abstract interface for all dii ex machina.
 
-/*! \brief Abstract interface for all deux ex machinas.
-
 	All kinematic engines must derived from this class. A kinematic engine is used to modify the state of an object
 	(position,veloity ...) according to a predefined law (mathematical function, stored data ...) and not according
 	to a dynamic law as dynamic engines do. A kinematic engine contains a list of bodies to act on, and bodies can
@@ -25,26 +24,14 @@
 
 class DeusExMachina : public Engine
 {
-/// Attributes
-	protected :
-		Real time;
-	//	Real startTime;
-	//	Real stopTime;
-
 	public :
 		std::vector&lt;int&gt; subscribedBodies; /// Lists of bodies whose state will be modified by deux ex machina
-
 		DeusExMachina ();
-
-		virtual void action(Body* b);
-		virtual void applyCondition(Body* ) { throw; };
-
+		virtual void action(MetaBody*);
+		virtual void applyCondition(MetaBody*) { throw; };
 	//	virtual bool isActivated();
-
 	protected :
 		void registerAttributes();
-	
-
 	REGISTER_CLASS_NAME(DeusExMachina);
 	REGISTER_BASE_CLASS_NAME(Engine);
 };

Modified: trunk/core/Engine.hpp
===================================================================
--- trunk/core/Engine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/core/Engine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -23,7 +23,7 @@
 		virtual ~Engine() {};
 	
 		virtual bool isActivated() { return true; };
-		virtual void action(Body*) { throw; };
+		virtual void action(MetaBody*) { throw; };
 
 	REGISTER_CLASS_NAME(Engine);
 	REGISTER_BASE_CLASS_NAME(Serializable);

Modified: trunk/core/InteractingGeometry.hpp
===================================================================
--- trunk/core/InteractingGeometry.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/core/InteractingGeometry.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -25,6 +25,7 @@
 class InteractingGeometry : public Serializable, public Indexable
 {
 	public :
+		InteractingGeometry(){diffuseColor=Vector3r(1,1,1);}
 		Vector3r diffuseColor;	// FIXME - why here? and then - why no
 					// bool wire; even though GeometricalModel has bool wire ?
 	

Modified: trunk/core/MetaBody.cpp
===================================================================
--- trunk/core/MetaBody.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/core/MetaBody.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -59,6 +59,7 @@
 	REGISTER_ATTRIBUTE(transientInteractions);
 	REGISTER_ATTRIBUTE(persistentInteractions);
 	REGISTER_ATTRIBUTE(physicalActions); // FIXME - needed or not ? - Olivier : yes it is needed if there is no default initialization into constructor
+	REGISTER_ATTRIBUTE(miscParams);
 	REGISTER_ATTRIBUTE(dt);
 
 	REGISTER_ATTRIBUTE(recover);

Modified: trunk/core/MetaBody.hpp
===================================================================
--- trunk/core/MetaBody.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/core/MetaBody.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -24,6 +24,7 @@
 		shared_ptr&lt;InteractionContainer&gt;	persistentInteractions; // disappear, reappear according to physical (or any other non-spatial) criterion
 		shared_ptr&lt;InteractionContainer&gt;	transientInteractions;	// disappear, reappear according to spatial criterion
 		shared_ptr&lt;PhysicalActionContainer&gt;	physicalActions;
+		vector&lt;shared_ptr&lt;Serializable&gt; &gt; miscParams; // will set static parameters during deserialization (primarily for GLDraw functors which otherwise have no attribute access)
 
 		MetaBody ();
 

Modified: trunk/core/TimeStepper.hpp
===================================================================
--- trunk/core/TimeStepper.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/core/TimeStepper.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -23,9 +23,9 @@
 		unsigned int timeStepUpdateInterval;
 
 		TimeStepper();
-		virtual void computeTimeStep(Body*  ) { throw; };
+		virtual void computeTimeStep(MetaBody* ) { throw; };
 		virtual bool isActivated();
-		virtual void action(Body* b) { computeTimeStep(b);} ;
+		virtual void action(MetaBody* b) { computeTimeStep(b);} ;
 		void setActive(bool a, int nb=-1);
 
 	protected :

Modified: trunk/extra/Brefcom.cpp
===================================================================
--- trunk/extra/Brefcom.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/Brefcom.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -3,6 +3,8 @@
 #include&lt;yade/core/MetaBody.hpp&gt;
 #include&lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
 #include&lt;yade/pkg-common/Sphere.hpp&gt;
+#include&lt;yade/lib-QGLViewer/qglviewer.h&gt;
+
 /*
 #include&lt;boost/foreach.hpp&gt;
 #include&lt;boost/range.hpp&gt;
@@ -19,7 +21,7 @@
 */
 
 
-YADE_PLUGIN(&quot;BrefcomMakeContact&quot;,&quot;BrefcomContact&quot;,&quot;BrefcomLaw&quot;,&quot;GLDrawBrefcomContact&quot;,&quot;BrefcomStiffnessCounter&quot;);
+YADE_PLUGIN(&quot;BrefcomMakeContact&quot;,&quot;BrefcomContact&quot;,&quot;BrefcomLaw&quot;,&quot;GLDrawBrefcomContact&quot;,&quot;BrefcomDamageColorizer&quot; /* ,&quot;BrefcomStiffnessCounter&quot;*/ );
 
 /********************** BrefcomMakeContact ****************************/
 CREATE_LOGGER(BrefcomMakeContact);
@@ -46,22 +48,23 @@
 		Real nu12=2*elast1-&gt;poisson*elast2-&gt;poisson/(elast1-&gt;poisson+elast2-&gt;poisson); // dtto for Poisson ratio 
 		Real S12=Mathr::PI*pow(min(contGeom-&gt;radius1,contGeom-&gt;radius2),2); // &quot;surface&quot; of interaction
 		//Real d0=contGeom-&gt;radius1 + contGeom-&gt;radius2; // equilibrium distace is &quot;just touching&quot;
-		Real d0=(elast1-&gt;se3.position-elast2-&gt;se3.position).Length(); // equilibrium distance is the current distance !!
-		Real Kn=(E12*S12/d0)*((1+alpha)/(beta*(1+nu12)+gamma*(1-alpha*nu12)));
+		Real d0=(elast1-&gt;se3.position-elast2-&gt;se3.position).Length(); // equilibrium distance is the initial contact distance
+		Real E=(E12 /* was here for Kn:  *S12/d0  */)*((1+alpha)/(beta*(1+nu12)+gamma*(1-alpha*nu12)));
 
 		/* recommend default values for parameters
 		 * propose ways to determine them exactly
 		 * */
 		shared_ptr&lt;BrefcomContact&gt; contPhys(new BrefcomContact(
-			/* Kn */ Kn,
-			/* Kt */ Kn*(1-alpha*nu12)/(1+nu12),
-			/* frictionAngle */ .5*(elast1-&gt;frictionAngle+elast2-&gt;frictionAngle),
+			/* E */ E,
+			/* G */ E*(1-alpha*nu12)/(1+nu12),
+			/* tanFrictionAngle */ tan(.5*(elast1-&gt;frictionAngle+elast2-&gt;frictionAngle)),
 			/* undamagedCohesion */ S12*sigmaT,
 			/* equilibriumDist */ d0,
 			/* crossSection */ S12,
 			/* epsCracking */ sigmaT/E12,
-			/* epsFracture */ 3*(sigmaT/E12), //calibratedEpsFracture,
-			/* expBending */ expBending
+			/* epsFracture */ 5*sigmaT/E12,
+			/* expBending */ expBending,
+			/* xiShear*/ 0
 			));
 		contPhys-&gt;prevNormal=contGeom-&gt;normal;
 		if(cohesiveThresholdIter&lt;0 || Omega::instance().getCurrentIteration()&lt;cohesiveThresholdIter) contPhys-&gt;isCohesive=true;
@@ -82,14 +85,7 @@
 /********************** BrefcomLaw ****************************/
 CREATE_LOGGER(BrefcomLaw);
 
-void BrefcomLaw::applyForce(const Vector3r force){
 
-	static_pointer_cast&lt;Force&gt;(rootBody-&gt;physicalActions-&gt;find(id1,ForceClassIndex))-&gt;force+=force;
-	static_pointer_cast&lt;Force&gt;(rootBody-&gt;physicalActions-&gt;find(id2,ForceClassIndex))-&gt;force-=force;
-	static_pointer_cast&lt;Momentum&gt;(rootBody-&gt;physicalActions-&gt;find(id1,MomentumClassIndex))-&gt;momentum+=(contGeom-&gt;contactPoint-rbp1-&gt;se3.position).Cross(force);
-	static_pointer_cast&lt;Momentum&gt;(rootBody-&gt;physicalActions-&gt;find(id2,MomentumClassIndex))-&gt;momentum-=(contGeom-&gt;contactPoint-rbp2-&gt;se3.position).Cross(force);
-}
-
 /*! Damage evolution law (static version: all parameters are explicitly passed).
  *
  * This function is zero for any eps&lt;=epsCrackOnset (no damage before the material starts cracking),
@@ -159,9 +155,15 @@
 	return epsMid;
 }
 
+void BrefcomLaw::applyForce(const Vector3r force){
+	static_pointer_cast&lt;Force&gt;(rootBody-&gt;physicalActions-&gt;find(id1,ForceClassIndex))-&gt;force+=force;
+	static_pointer_cast&lt;Force&gt;(rootBody-&gt;physicalActions-&gt;find(id2,ForceClassIndex))-&gt;force-=force;
+	static_pointer_cast&lt;Momentum&gt;(rootBody-&gt;physicalActions-&gt;find(id1,MomentumClassIndex))-&gt;momentum+=(contGeom-&gt;contactPoint-rbp1-&gt;se3.position).Cross(force);
+	static_pointer_cast&lt;Momentum&gt;(rootBody-&gt;physicalActions-&gt;find(id2,MomentumClassIndex))-&gt;momentum-=(contGeom-&gt;contactPoint-rbp2-&gt;se3.position).Cross(force);
+}
 
-void BrefcomLaw::action(Body* body){
-	rootBody=YADE_CAST&lt;MetaBody*&gt;(body);
+void BrefcomLaw::action(MetaBody* _rootBody){
+	rootBody=_rootBody;
 	
 	//BOOST_FOREACH(shared_ptr&lt;Interaction&gt; II,*(rootBody-&gt;transientInteractions)){}
 	
@@ -180,9 +182,6 @@
 		rbp1=YADE_PTR_CAST&lt;RigidBodyParameters&gt;(body1-&gt;physicalParameters);
 		rbp2=YADE_PTR_CAST&lt;RigidBodyParameters&gt;(body2-&gt;physicalParameters);
 		assert(BC); assert(contGeom); assert(rbp1); assert(rbp2);
-
-		// don't disregard links with omegaPl=1, they can still be compressed !!
-		// if(BC-&gt;omegaPl &gt;= 1) continue; // we want to keep broken links formally alive, for statistics of material damage
 		
 		#ifdef BREFCOM_REC
 			recValues.clear(); recLabels.clear();
@@ -199,17 +198,16 @@
 		#endif
 
 		// shorthands
-		Vector3r&amp; epsT(BC-&gt;epsT); Real&amp; kappaD(BC-&gt;kappaD); const Real&amp; equilibriumDist(BC-&gt;equilibriumDist); const Real&amp; xiShear(BC-&gt;xiShear); const Real&amp; Kn(BC-&gt;Kn); const Real&amp; undamagedCohesion(BC-&gt;undamagedCohesion); const Real&amp; frictionAngle(BC-&gt;frictionAngle); const Real&amp; Kt(BC-&gt;Kt); const Real&amp; crossSection(BC-&gt;crossSection); Real&amp; omega(BC-&gt;omega);
+		Real&amp; epsN(BC-&gt;epsN); Vector3r&amp; epsT(BC-&gt;epsT); Real&amp; kappaD(BC-&gt;kappaD); const Real&amp; equilibriumDist(BC-&gt;equilibriumDist); const Real&amp; xiShear(BC-&gt;xiShear); const Real&amp; E(BC-&gt;E); const Real&amp; undamagedCohesion(BC-&gt;undamagedCohesion); const Real&amp; tanFrictionAngle(BC-&gt;tanFrictionAngle); const Real&amp; G(BC-&gt;G); const Real&amp; crossSection(BC-&gt;crossSection); Real&amp; omega(BC-&gt;omega); Real&amp; sigmaN(BC-&gt;sigmaN); 
 
 		Real dist=(rbp1-&gt;se3.position-rbp2-&gt;se3.position).Length();
 
-		/* deleting interaction here would (maybe) break the iterator; do it once this loop is done */
 		/* FIXME dist&gt;0 doesn't take into account interaction radius!!! */
-		// /* TODO: recover this line: */
+		// /* TODO: recover non-cohesive contact deletion: */
 		if(!BC-&gt;isCohesive &amp;&amp; dist&gt;0){ /* delete this interaction later */ /* (*I)-&gt;isReal=false; */ continue; }
 
 		/* rotate epsT to the new contact plane */
-			Real dt=Omega::instance().getTimeStep();
+			const Real&amp; dt=Omega::instance().getTimeStep();
 			// rotation of the contact normal
 			epsT+=BC-&gt;epsT.Cross(BC-&gt;prevNormal.Cross(contGeom-&gt;normal));
 			// mutual rotation
@@ -217,30 +215,31 @@
 			epsT+=epsT.Cross(angle*contGeom-&gt;normal);
 
 		/* calculate tangential strain increment */
-		Vector3r relVelocity=
-			rbp2-&gt;velocity+rbp2-&gt;angularVelocity.Cross(contGeom-&gt;contactPoint-rbp2-&gt;se3.position)
-			-rbp1-&gt;velocity+rbp1-&gt;angularVelocity.Cross(contGeom-&gt;contactPoint-rbp1-&gt;se3.position);
-		Vector3r tangentialDisplacement=dt*(relVelocity-contGeom-&gt;normal.Dot(relVelocity)*contGeom-&gt;normal);
+			Vector3r relVelocity /* at the contact point */ = 
+				rbp1-&gt;velocity-rbp2-&gt;velocity
+				+rbp1-&gt;angularVelocity.Cross(contGeom-&gt;contactPoint-rbp1-&gt;se3.position)
+				-rbp2-&gt;angularVelocity.Cross(contGeom-&gt;contactPoint-rbp2-&gt;se3.position);
+			Vector3r tangentialDisplacement=dt*(relVelocity-contGeom-&gt;normal.Dot(relVelocity)*contGeom-&gt;normal);
 		epsT+=tangentialDisplacement/dist;
 		
 		/* normal strain */
-		Real epsN=(dist-equilibriumDist)/equilibriumDist;
+		epsN=(dist-equilibriumDist)/equilibriumDist;
 
-		Real sigmaN; Vector3r sigmaT;
+		Vector3r sigmaT;
 
 		#ifdef BREFCOM_MATERIAL_MODEL
 			BREFCOM_MATERIAL_MODEL
 		#else
-			sigmaN=Kn*epsN;
-			sigmaT=Kt*epsT;
+			sigmaN=E*epsN;
+			sigmaT=G*epsT;
 		#endif
 
+		//sigmaT=Vector3r::ZERO;
 		//if(BC-&gt;omega==1){TRVAR5(equilibriumDist,dist,epsN,kappaD,BC-&gt;epsFracture);}
 
-
 		// store Fn (and Fs?), for use with BrefcomStiffnessCounter
 		Fn=sigmaN*crossSection;
-		applyForce(crossSection*(contGeom-&gt;normal*sigmaN + sigmaT));
+		applyForce(crossSection*(contGeom-&gt;normal*sigmaN + sigmaT)); /* this is the force applied on the _first_ body */
 
 		#ifdef BREFCOM_REC
 			/*BREFREC(epsN); BREFREC(epsT[0]);BREFREC(epsT[1]);BREFREC(epsT[2]);*/
@@ -259,7 +258,16 @@
 
 #include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
 
-void GLDrawBrefcomContact::go(const shared_ptr&lt;InteractionPhysics&gt;&amp; ip, const shared_ptr&lt;Interaction&gt;&amp;, const shared_ptr&lt;Body&gt;&amp; b1, const shared_ptr&lt;Body&gt;&amp; b2, bool wireFrame){
+CREATE_LOGGER(GLDrawBrefcomContact);
+
+bool GLDrawBrefcomContact::contactLine=true;
+bool GLDrawBrefcomContact::dmgLabel=true;
+bool GLDrawBrefcomContact::epsT=false;
+bool GLDrawBrefcomContact::epsTAxes=false;
+bool GLDrawBrefcomContact::normal=false;
+
+
+void GLDrawBrefcomContact::go(const shared_ptr&lt;InteractionPhysics&gt;&amp; ip, const shared_ptr&lt;Interaction&gt;&amp; i, const shared_ptr&lt;Body&gt;&amp; b1, const shared_ptr&lt;Body&gt;&amp; b2, bool wireFrame){
 	const shared_ptr&lt;BrefcomContact&gt;&amp; BC=static_pointer_cast&lt;BrefcomContact&gt;(ip);
 
 	/* shared_ptr&lt;Sphere&gt; s1(dynamic_pointer_cast&lt;Sphere&gt;(b1-&gt;geometricalModel)), s2(dynamic_pointer_cast&lt;Sphere&gt;(b2-&gt;geometricalModel));
@@ -269,29 +277,29 @@
 		glutSolidCube(1);
 	} */
 
-	glColor3(BC-&gt;omega,1-BC-&gt;omega,0.0); /* damaged links red, undamaged green */
+	if(contactLine) Shop::GLDrawLine(b1-&gt;physicalParameters-&gt;se3.position,b2-&gt;physicalParameters-&gt;se3.position,Vector3r(BC-&gt;omega,1-BC-&gt;omega,0.0) /* damaged links red, undamaged green */ );
+	if(dmgLabel){ Shop::GLDrawNum(BC-&gt;omega,0.5*(b1-&gt;physicalParameters-&gt;se3.position+b2-&gt;physicalParameters-&gt;se3.position),Vector3r(BC-&gt;omega,1-BC-&gt;omega,0.)); }
+	const Vector3r&amp; cp=static_pointer_cast&lt;SpheresContactGeometry&gt;(i-&gt;interactionGeometry)-&gt;contactPoint;
+	if(epsT){
+		Real maxShear=(BC-&gt;undamagedCohesion-BC-&gt;sigmaN*BC-&gt;tanFrictionAngle)/BC-&gt;G;
+		Real relShear=BC-&gt;epsT.Length()/maxShear;
+		Real scale=.5*BC-&gt;equilibriumDist;
+		Vector3r dirShear=BC-&gt;epsT; dirShear.Normalize();
+		if(epsTAxes){
+			Shop::GLDrawLine(cp-Vector3r(scale,0,0),cp+Vector3r(scale,0,0));
+			Shop::GLDrawLine(cp-Vector3r(0,scale,0),cp+Vector3r(0,scale,0));
+			Shop::GLDrawLine(cp-Vector3r(0,0,scale),cp+Vector3r(0,0,scale));
+		}
+		Shop::GLDrawArrow(cp,cp+dirShear*relShear*scale,Vector3r(1.,0.,0.));
+		Shop::GLDrawLine(cp+dirShear*relShear*scale,cp+dirShear*scale,Vector3r(.3,.3,.3));
 
-	glBegin(GL_LINES);
-		glVertex3v(b1-&gt;physicalParameters-&gt;se3.position);
-		glVertex3v(b2-&gt;physicalParameters-&gt;se3.position);
-	glEnd();
-
-	/* show the damage parameter numerically; remove the #if 0 if wanted */
-	#if 0
-		Vector3r mid=0.5*(b1-&gt;physicalParameters-&gt;se3.position+b2-&gt;physicalParameters-&gt;se3.position);
-		glTranslatev(mid);
-		glPushMatrix();
-			glRasterPos2i(0,0);
-			ostringstream oss; oss&lt;&lt;setprecision(3)&lt;&lt; /* &quot;w=&quot;&lt;&lt; */ (float)BC-&gt;omega;
-			//std::string str=std::string(&quot;omegaPl=&quot;)+boost::lexical_cast&lt;std::string&gt;((float)(BC-&gt;omegaPl));
-			for(unsigned int i=0;i&lt;oss.str().length();i++) glutBitmapCharacter(GLUT_BITMAP_HELVETICA_12,oss.str()[i]);
-		glPopMatrix();
-	#endif
+		/* normal strain */ Shop::GLDrawArrow(cp,cp+BC-&gt;prevNormal*(BC-&gt;epsN/maxShear),Vector3r(0.,1.,0.));
+	}
+	//if(normal) Shop::GLDrawArrow(cp,cp+BC-&gt;prevNormal*.5*BC-&gt;equilibriumDist,Vector3r(0.,1.,0.));
 }
 
 /********************** BrefcomDamageColorizer ****************************/
-void BrefcomDamageColorizer::action(Body* b){
-	MetaBody* rootBody=static_cast&lt;MetaBody*&gt;(b);
+void BrefcomDamageColorizer::action(MetaBody* rootBody){
 	vector&lt;pair&lt;short,Real&gt; &gt; bodyDamage; /* number of cohesive interactions per body; cummulative damage of interactions */
 	bodyDamage.resize(rootBody-&gt;bodies-&gt;size(),pair&lt;short,Real&gt;(0,0));
 	InteractionContainer::iterator transientEnd=rootBody-&gt;transientInteractions-&gt;end();
@@ -310,8 +318,9 @@
 	}
 }
 
-void BrefcomStiffnessCounter::action(Body* body){
-	MetaBody *rootBody=static_cast&lt;MetaBody*&gt;(body);
+/* doesn't work correctly */
+#if 0
+void BrefcomStiffnessCounter::action(MetaBody* rootBody){
 	InteractionContainer::iterator Iend=rootBody-&gt;transientInteractions-&gt;end();
 	for(InteractionContainer::iterator I=rootBody-&gt;transientInteractions-&gt;begin(); I!=Iend; ++I){
 		const shared_ptr&lt;Interaction&gt;&amp; contact = *I;
@@ -327,3 +336,4 @@
 		s-&gt;stiffness+=diag_stiffness; s-&gt;Rstiffness+=diag_Rstiffness*pow(cGeom-&gt;radius2,2);
 	}
 }
+#endif 

Modified: trunk/extra/Brefcom.hpp
===================================================================
--- trunk/extra/Brefcom.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/Brefcom.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -19,16 +19,12 @@
  * Evolution of the contact is governed by BrefcomLaw:
  * that includes damage effects and chages of parameters inside BrefcomContact.
  *
- * @todo Ks is currently unused, but it is calculated from Kn in BrefcomMakeContact using nu12 and alpha;
- * 	if Kn changes due to damage, how do we adjust Ks? BrefcomMakeContact could do that at every iter? Messy?
- *
- * @todo frictionAngle is currently unused
  */
 class BrefcomContact: public InteractionPhysics {
 	private:
 	public:
 		/*! Fundamental parameters (constants) */
-		Real Kn, Kt, frictionAngle, undamagedCohesion, equilibriumDist, crossSection, epsCracking, epsFracture, expBending, xiShear;
+		Real E, G, tanFrictionAngle, undamagedCohesion, equilibriumDist, crossSection, epsCracking, epsFracture, expBending, xiShear;
 		/*! Up to now maximum normal strain */
 		Real kappaD;
 		/*! prevNormal is oriented A&#8594;B (as in SpheresContactGeometry); */
@@ -39,17 +35,17 @@
 		bool isCohesive;
 
 		/*! auxiliary variable for visualization and BrefcomStiffnessCounter, recalculated by BrefcomLaw at every iteration */
-		Real omega, Fn;
+		Real omega, Fn, sigmaN, epsN;
 
-		BrefcomContact(): InteractionPhysics(),Kn(0), Kt(0), frictionAngle(0), undamagedCohesion(0), equilibriumDist(0), crossSection(0), expBending(0), xiShear(0) { createIndex(); epsT=Vector3r::ZERO; kappaD=0; isCohesive=false; }
-		BrefcomContact(Real _Kn, Real _Ks, Real _frictionAngle, Real _undamagedCohesion, Real _equilibriumDist, Real _crossSection, Real _epsCracking, Real _epsFracture, Real _expBending, Real _xiShear=.3): InteractionPhysics(), Kn(_Kn), Kt(_Ks), frictionAngle(_frictionAngle), undamagedCohesion(_undamagedCohesion), equilibriumDist(_equilibriumDist), crossSection(_crossSection), epsCracking(_epsCracking), epsFracture(_epsFracture), expBending(_expBending), xiShear(_xiShear) { epsT=Vector3r::ZERO; kappaD=0; isCohesive=false; /*TRVAR5(epsCracking,epsFracture,Kn,crossSection,equilibriumDist); */ }
+		BrefcomContact(): InteractionPhysics(),E(0), G(0), tanFrictionAngle(0), undamagedCohesion(0), equilibriumDist(0), crossSection(0), expBending(0), xiShear(0) { createIndex(); epsT=Vector3r::ZERO; kappaD=0; isCohesive=false; }
+		BrefcomContact(Real _E, Real _G, Real _tanFrictionAngle, Real _undamagedCohesion, Real _equilibriumDist, Real _crossSection, Real _epsCracking, Real _epsFracture, Real _expBending, Real _xiShear=.3): InteractionPhysics(), E(_E), G(_G), tanFrictionAngle(_tanFrictionAngle), undamagedCohesion(_undamagedCohesion), equilibriumDist(_equilibriumDist), crossSection(_crossSection), epsCracking(_epsCracking), epsFracture(_epsFracture), expBending(_expBending), xiShear(_xiShear) { epsT=Vector3r::ZERO; kappaD=0; isCohesive=false; omega=0; Fn=0; /*TRVAR5(epsCracking,epsFracture,Kn,crossSection,equilibriumDist); */ }
 
 
 		void registerAttributes(){
 			InteractionPhysics::registerAttributes();
-			REGISTER_ATTRIBUTE(Kn);
-			REGISTER_ATTRIBUTE(Kt);
-			REGISTER_ATTRIBUTE(frictionAngle);
+			REGISTER_ATTRIBUTE(E);
+			REGISTER_ATTRIBUTE(G);
+			REGISTER_ATTRIBUTE(tanFrictionAngle);
 			REGISTER_ATTRIBUTE(undamagedCohesion);
 			REGISTER_ATTRIBUTE(equilibriumDist);
 			REGISTER_ATTRIBUTE(crossSection);
@@ -63,6 +59,9 @@
 			REGISTER_ATTRIBUTE(epsT);
 
 			REGISTER_ATTRIBUTE(isCohesive);
+
+			// auxiliary params, to make them accessible from python
+			REGISTER_ATTRIBUTE(omega); REGISTER_ATTRIBUTE(Fn);
 		};
 
 	REGISTER_CLASS_NAME(BrefcomContact);
@@ -77,21 +76,12 @@
 	private:
 		// cache class indices to avoid lookup at every iteration
 		int MomentumClassIndex, ForceClassIndex; // if possible make it &quot;const int&quot; and move init to initializers
-		//! apply effects of normal displacements
-		void calculateNormalForce();
-		//! apply effects of shearing
-		void calculateShearForce();
-		//! apply effects of mutual particle rotation
-		void rotationEffects();
-		//! adjust forces so that they are not outside resistance envelope and update damage parameter if necessary
-		void envelopeAndDamage();
-		//! plly calculated force on particles
+		//! aplly calculated force on both particles (applied in the inverse sense on B)
 		void applyForces();
 		/* storage variables, to avoid passing them around on the stack.
 		 *
-		 * The orientation is conventionally as forces should be applied on the SECOND element in the interaction.
-		 * That is, attractive force will be oriented as applied to the first element.
-		 * This is CONTRARY to ElasticCohesiveLaw !!! */
+		 * The orientation is conventionally as forces should be applied on the FIRST element in the interaction.
+		 */
 		Vector3r Fs; Real Fn;
 		/* temporaries initialized in the loop over interactions; above methods use these. */
 		body_id_t id1, id2;
@@ -124,7 +114,7 @@
 			MomentumClassIndex=shared_ptr&lt;PhysicalAction&gt;(new Momentum())-&gt;getClassIndex();
 			//TRVAR2(ForceClassIndex,MomentumClassIndex);
 		};
-		void action(Body* body);
+		void action(MetaBody*);
 	protected: 
 		void registerAttributes(){InteractionSolver::registerAttributes();};
 		void postProcessAttributes(bool deserializing){ if(deserializing)
@@ -156,7 +146,7 @@
 		 * which would define just those in addition to the elastic ones.
 		 * This might be done later, for now hardcode that here. */
 		/* uniaxial traction resistance, uniaxial compression resistance, fracture energy, strain at complete fracture (calibrated in the constructor), bending parameter of the damage evolution law */
-		Real sigmaT, sigmaC, /* Griffith's fracture energy */ Gf, calibratedEpsFracture, expBending;
+		Real sigmaT, sigmaC, /* Griffith's fracture energy */ Gf, expBending;
 		//! Should new contacts be cohesive? They will before this iter#, they will not be afterwards. If 0, they will never be. If negative, they will always be created as cohesive.
 		long cohesiveThresholdIter;
 
@@ -165,19 +155,21 @@
 			expBending=4; /* positive: concave function */
 			cohesiveThresholdIter=-1;
 			Gf=500; /* J/m^2&#160;*/
-			/* calibrate epsFracture; WARNING: this is based on the default E value from Shop
-			 * and therefore may not match the actual E !! */
-			Real E=Shop::getDefault&lt;double&gt;(&quot;phys_young&quot;);
-			Real epsCrackOnset=sigmaT/E;
-			try{
-				calibratedEpsFracture=BrefcomLaw::calibrateEpsFracture(Gf,E,expBending,epsCrackOnset);
-				LOG_DEBUG(&quot;calibratedEpsFracture=&quot;&lt;&lt;calibratedEpsFracture);
-				if(calibratedEpsFracture&gt;epsCrackOnset) LOG_WARN(&quot;calibratedEpsFracture=&quot;&lt;&lt;calibratedEpsFracture&lt;&lt;&quot; &lt; epsCrackOnset=&quot;&lt;&lt;epsCrackOnset&lt;&lt;&quot;, Gf=&quot;&lt;&lt;Gf&lt;&lt;&quot;, E=&quot;&lt;&lt;E&lt;&lt;&quot;, expBending=&quot;&lt;&lt;expBending);
-			} catch (std::runtime_error&amp; e){
-				LOG_ERROR(&quot;Caught exception from calibration: &quot;&lt;&lt;e.what());
-				calibratedEpsFracture=3*epsCrackOnset;
-				LOG_ERROR(&quot;Setting calibratedEpsFracture to &quot;&lt;&lt;calibratedEpsFracture);
-			}
+			#if 0
+				/* calibrate epsFracture; WARNING: this is based on the default E value from Shop
+				 * and therefore may not match the actual E !! */
+				Real E=Shop::getDefault&lt;double&gt;(&quot;phys_young&quot;);
+				Real epsCrackOnset=sigmaT/E;
+				try{
+					calibratedEpsFracture=BrefcomLaw::calibrateEpsFracture(Gf,E,expBending,epsCrackOnset);
+					LOG_DEBUG(&quot;calibratedEpsFracture=&quot;&lt;&lt;calibratedEpsFracture);
+					if(calibratedEpsFracture&gt;epsCrackOnset) LOG_WARN(&quot;calibratedEpsFracture=&quot;&lt;&lt;calibratedEpsFracture&lt;&lt;&quot; &lt; epsCrackOnset=&quot;&lt;&lt;epsCrackOnset&lt;&lt;&quot;, Gf=&quot;&lt;&lt;Gf&lt;&lt;&quot;, E=&quot;&lt;&lt;E&lt;&lt;&quot;, expBending=&quot;&lt;&lt;expBending);
+				} catch (std::runtime_error&amp; e){
+					LOG_ERROR(&quot;Caught exception from calibration: &quot;&lt;&lt;e.what());
+					calibratedEpsFracture=3*epsCrackOnset;
+					LOG_ERROR(&quot;Setting calibratedEpsFracture to &quot;&lt;&lt;calibratedEpsFracture);
+				}
+			#endif
 		}
 
 		virtual void go(const shared_ptr&lt;PhysicalParameters&gt;&amp; pp1, const shared_ptr&lt;PhysicalParameters&gt;&amp; pp2, const shared_ptr&lt;Interaction&gt;&amp; interaction);
@@ -187,7 +179,7 @@
 			REGISTER_ATTRIBUTE(beta);
 			REGISTER_ATTRIBUTE(gamma);
 			REGISTER_ATTRIBUTE(cohesiveThresholdIter);
-			REGISTER_ATTRIBUTE(calibratedEpsFracture);
+			//REGISTER_ATTRIBUTE(calibratedEpsFracture);
 			REGISTER_ATTRIBUTE(expBending);
 			/* REGISTER_ATTRIBUTE(sigmaT);
 			REGISTER_ATTRIBUTE(sigmaC);
@@ -204,9 +196,12 @@
 class GLDrawBrefcomContact: public GLDrawInteractionPhysicsFunctor {
 	public: virtual void go(const shared_ptr&lt;InteractionPhysics&gt;&amp;,const shared_ptr&lt;Interaction&gt;&amp;,const shared_ptr&lt;Body&gt;&amp;,const shared_ptr&lt;Body&gt;&amp;,bool wireFrame);
 	virtual ~GLDrawBrefcomContact() {};
+	virtual void registerAttributes(){ REGISTER_ATTRIBUTE(contactLine); REGISTER_ATTRIBUTE(dmgLabel); REGISTER_ATTRIBUTE(epsT); REGISTER_ATTRIBUTE(epsTAxes); REGISTER_ATTRIBUTE(normal); }
 	RENDERS(BrefcomContact);
 	REGISTER_CLASS_NAME(GLDrawBrefcomContact);
 	REGISTER_BASE_CLASS_NAME(GLDrawInteractionPhysicsFunctor);
+	DECLARE_LOGGER;
+	static bool contactLine,dmgLabel,epsT,epsTAxes,normal;
 };
 REGISTER_SERIALIZABLE(GLDrawBrefcomContact,false);
 
@@ -214,7 +209,7 @@
 	public :
 		int interval;
 		BrefcomDamageColorizer(){interval=100;}
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated(){return Omega::instance().getCurrentIteration()%interval==0;}
 	void registerAttributes(){REGISTER_ATTRIBUTE(interval);}
 	REGISTER_CLASS_NAME(BrefcomDamageColorizer);
@@ -224,13 +219,14 @@
 
 
 /***&#160;!!!&#160;BADLY&#160;BROKEN&#160;!!!&#160;Do not use !!! ***/
+#if 0
 class BrefcomStiffnessCounter : public InteractionSolver{
 	private :
 		int actionStiffnessIndex;
 	public:
 		unsigned int interval;
 		BrefcomStiffnessCounter() {interval=500; actionStiffnessIndex=shared_ptr&lt;PhysicalAction&gt;(new GlobalStiffness)-&gt;getClassIndex();}
-		void action(Body* body);
+		void action(MetaBody*);
 		virtual bool isActivated(){return (Omega::instance().getCurrentIteration()%interval)==0;}
 	protected :
 		void registerAttributes(){REGISTER_ATTRIBUTE(interval);}
@@ -239,7 +235,7 @@
 };
 
 REGISTER_SERIALIZABLE(BrefcomStiffnessCounter,false);
-
+#endif
  
 
 

Modified: trunk/extra/BrefcomTestGen.cpp
===================================================================
--- trunk/extra/BrefcomTestGen.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/BrefcomTestGen.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -99,7 +99,7 @@
 	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; iphysDispatcher(new InteractionPhysicsMetaEngine);
 		shared_ptr&lt;BrefcomMakeContact&gt; bmc(new BrefcomMakeContact);
 		bmc-&gt;cohesiveThresholdIter=-1;
-		bmc-&gt;calibratedEpsFracture=.5; /* arbitrary, but large enough */
+		//bmc-&gt;calibratedEpsFracture=.5; /* arbitrary, but large enough */
 		iphysDispatcher-&gt;add(bmc);
 	rootBody-&gt;engines.push_back(iphysDispatcher);
 
@@ -159,7 +159,7 @@
 		s1=Shop::sphere(Vector3r(0,-yCoord,-zCoord),.5),
 		s2=Shop::sphere(Vector3r(0,yCoord,zCoord),.5),
 		sMid=Shop::sphere(Vector3r(0,0,0.01),.5);
-	body_id_t id1=rootBody-&gt;bodies-&gt;insert(s1), id2=rootBody-&gt;bodies-&gt;insert(s2), id3=rootBody-&gt;bodies-&gt;insert(sMid);
+	body_id_t id1=rootBody-&gt;bodies-&gt;insert(s1), id2=rootBody-&gt;bodies-&gt;insert(s2); //, id3=rootBody-&gt;bodies-&gt;insert(sMid);
 	
 	//  engines should take care of the rest of interaction; this is what collider would do normally
 	/*

Modified: trunk/extra/SConscript
===================================================================
--- trunk/extra/SConscript	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/SConscript	2008-04-28 21:52:11 UTC (rev 1329)
@@ -104,6 +104,7 @@
 			'ElasticContactInteraction',
 			'SDECLinkGeometry',
 			'SDECLinkPhysics',
+			'$QGLVIEWER_LIB'
 			]),
 ])
 

Modified: trunk/extra/clump/Clump.cpp
===================================================================
--- trunk/extra/clump/Clump.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/clump/Clump.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -20,8 +20,7 @@
  * @param pp passed by the dispatcher
  * @param clump passed by the dispatcher
  */
-void ClumpMemberMover::applyCondition(Body* _rootBody){
-	MetaBody* rootBody = YADE_CAST&lt;MetaBody*&gt;(_rootBody);
+void ClumpMemberMover::applyCondition(MetaBody* rootBody){
 	for(BodyContainer::iterator I=rootBody-&gt;bodies-&gt;begin(); I!=rootBody-&gt;bodies-&gt;end(); ++I){
 		shared_ptr&lt;Body&gt; b = *I;
 		if(b-&gt;isClump()){

Modified: trunk/extra/clump/Clump.hpp
===================================================================
--- trunk/extra/clump/Clump.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/clump/Clump.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -107,7 +107,7 @@
 class ClumpMemberMover: public DeusExMachina {
 	public:
 		//! Interates over rootBody-&gt;bodies and calls Clump::moveSubBodies() for clumps.
-		virtual void applyCondition(Body* rootBody);
+		virtual void applyCondition(MetaBody* rootBody);
 		ClumpMemberMover();
 		virtual ~ClumpMemberMover(){};
 

Modified: trunk/extra/clump/PythonRecorder.cpp
===================================================================
--- trunk/extra/clump/PythonRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/clump/PythonRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -69,7 +69,7 @@
 	PyGILState_Release(pyState);
 }
 
-void PythonRecorder::action(Body *_rootBody)
+void PythonRecorder::action(MetaBody *rootBody)
 {
 	if(compiledRunExprCall){
 		PyGILState_STATE pyState = PyGILState_Ensure();
@@ -82,4 +82,4 @@
 
 
 
-YADE_PLUGIN();
\ No newline at end of file
+YADE_PLUGIN();

Modified: trunk/extra/clump/PythonRecorder.hpp
===================================================================
--- trunk/extra/clump/PythonRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/clump/PythonRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -29,7 +29,7 @@
 	public :
 		//! Constructor that imports pyade module (warns if there is an error).
 		PythonRecorder();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated(){return true;}
 		virtual void registerAttributes(){DataRecorder::registerAttributes(); REGISTER_ATTRIBUTE(runExpr); REGISTER_ATTRIBUTE(initExpr); REGISTER_ATTRIBUTE(outputFile);}
 		//! This expression will be interpreted when the engine is called (every iteration)

Modified: trunk/extra/clump/Shop.cpp
===================================================================
--- trunk/extra/clump/Shop.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/clump/Shop.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -1,6 +1,8 @@
 // 2007 &#169; V&#225;clav &#352;milauer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">eudoxos at arcig.cz</A>&gt;
 #include&quot;Shop.hpp&quot;
 
+#include&lt;limits&gt;
+
 #include&lt;boost/filesystem/convenience.hpp&gt;
 
 #include&lt;yade/core/MetaBody.hpp&gt;
@@ -62,7 +64,11 @@
 #include&lt;yade/pkg-dem/SDECLinkGeometry.hpp&gt;
 #include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
 
+#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
+#include&lt;yade/lib-QGLViewer/qglviewer.h&gt;
 
+
+
 #if 0
 #ifdef EMBED_PYTHON
 	#include&lt;yade/extra/PythonRecorder.hpp&gt;
@@ -1125,3 +1131,43 @@
 	return numNewLinks;
 }
 
+Real Shop::ElasticWaveTimestepEstimate(shared_ptr&lt;MetaBody&gt; rootBody){
+	Real minDt=std::numeric_limits&lt;Real&gt;::infinity();
+	BodyContainer::iterator Iend=rootBody-&gt;bodies-&gt;end();
+	for(BodyContainer::iterator I=rootBody-&gt;bodies-&gt;begin(); I!=Iend; ++I){
+		const shared_ptr&lt;Body&gt;&amp; b=*I;
+		shared_ptr&lt;Sphere&gt; sphere=dynamic_pointer_cast&lt;Sphere&gt;(b-&gt;geometricalModel);
+		shared_ptr&lt;ElasticBodyParameters&gt; elast=dynamic_pointer_cast&lt;ElasticBodyParameters&gt;(b-&gt;physicalParameters);
+		if(!sphere || !elast) continue;
+		Real density=elast-&gt;mass/((4./3.)*pow(Mathr::PI*sphere-&gt;radius,3));
+		Real thisDt=2*sphere-&gt;radius/sqrt(elast-&gt;young/density);
+		minDt=std::min(minDt,thisDt);
+	}
+	return minDt;
+}
+
+void Shop::GLDrawLine(Vector3r from, Vector3r to, Vector3r color){
+	glEnable(GL_LIGHTING); glColor3v(color);
+	glBegin(GL_LINES); glVertex3v(from); glVertex3v(to); glEnd();
+}
+
+void Shop::GLDrawArrow(Vector3r from, Vector3r to, Vector3r color){
+	glEnable(GL_LIGHTING); glColor3v(color); qglviewer::Vec a(from[0],from[1],from[2]),b(to[0],to[1],to[2]); QGLViewer::drawArrow(a,b);	
+}
+
+void Shop::GLDrawNum(Real n, Vector3r pos, Vector3r color, unsigned precision){
+	ostringstream oss; oss&lt;&lt;setprecision(precision)&lt;&lt; /* &quot;w=&quot;&lt;&lt; */ (double)n;
+	Shop::GLDrawText(oss.str(),pos,color);
+}
+
+void Shop::GLDrawText(std::string txt, Vector3r pos, Vector3r color){
+	glPushMatrix();
+	glTranslatev(pos);
+	glColor3(color[0],color[1],color[2]);
+	glRasterPos2i(0,0);
+	for(unsigned int i=0;i&lt;txt.length();i++)
+		glutBitmapCharacter(GLUT_BITMAP_HELVETICA_12, txt[i]);
+	glPopMatrix();
+
+}
+

Modified: trunk/extra/clump/Shop.hpp
===================================================================
--- trunk/extra/clump/Shop.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/clump/Shop.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -30,11 +30,6 @@
 using boost::shared_ptr;
 
 class Shop{
-	/* the only non-static thing to make class factory happy */
-	//public: Shop(){};
-	//REGISTER_CLASS_NAME(Shop);
-	//REGISTER_BASE_CLASS_NAME();
-		
 	private:
 		DECLARE_LOGGER;
 	public:
@@ -72,4 +67,11 @@
 		static int createCohesion(Real limitNormalForce, Real limitShearForce, int groupMask=0,
 			boost::function&lt;bool(body_id_t,body_id_t)&gt; linkOK = (true || boost::lambda::_1) );
 
+		static Real ElasticWaveTimestepEstimate(shared_ptr&lt;MetaBody&gt;);
+
+		static void GLDrawLine(Vector3r from, Vector3r to, Vector3r color=Vector3r(1,1,1));
+		static void GLDrawArrow(Vector3r from, Vector3r to, Vector3r color=Vector3r(1,1,1));
+		static void GLDrawText(std::string text, Vector3r pos, Vector3r color=Vector3r(1,1,1));
+		static void GLDrawNum(Real n, Vector3r pos, Vector3r color=Vector3r(1,1,1), unsigned precision=3);
+
 };

Modified: trunk/extra/tetra/Tetra.cpp
===================================================================
--- trunk/extra/tetra/Tetra.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/tetra/Tetra.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -373,10 +373,8 @@
 /*! Apply forces on tetrahedra in collision based on geometric configuration provided by Tetra2TetraBang.
  *
  * Comments on functionality limitations are in the code. It has not been tested at all!!! */
-void TetraLaw::action(Body* body)
+void TetraLaw::action(MetaBody* rootBody)
 {
- 	MetaBody* rootBody = dynamic_cast&lt;MetaBody*&gt;(body);
-	//shared_ptr&lt;BodyContainer&gt;&amp; bodies = rootBody-&gt;bodies;
 
 	for(InteractionContainer::iterator contactI=rootBody-&gt;transientInteractions-&gt;begin(); contactI!=rootBody-&gt;transientInteractions-&gt;end(); ++contactI){
 		if (!(*contactI)-&gt;isReal) continue; // Tetra2TetraBang::go returned false for this interaction, skip it

Modified: trunk/extra/tetra/Tetra.hpp
===================================================================
--- trunk/extra/tetra/Tetra.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/tetra/Tetra.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -147,7 +147,7 @@
 
 		int sdecGroupMask; // probably unused?!
 
-		void action(Body* body);
+		void action(MetaBody*);
 
 		DECLARE_LOGGER;
 	protected:

Modified: trunk/extra/usct/UniaxialStrainControlledTest.cpp
===================================================================
--- trunk/extra/usct/UniaxialStrainControlledTest.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/usct/UniaxialStrainControlledTest.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -23,6 +23,7 @@
 	originalLength=USCT_AXIS_COORD(posIds[0])-USCT_AXIS_COORD(negIds[0]);
 	LOG_DEBUG(&quot;Reference particles: positive #&quot;&lt;&lt;posIds[0]&lt;&lt;&quot; at &quot;&lt;&lt;USCT_AXIS_COORD(posIds[0])&lt;&lt;&quot;; negative #&quot;&lt;&lt;negIds[0]&lt;&lt;&quot; at &quot;&lt;&lt;USCT_AXIS_COORD(negIds[0]));
 	LOG_INFO(&quot;Setting initial length to &quot;&lt;&lt;originalLength);
+	if(originalLength&lt;=0) LOG_FATAL(&quot;Initial length is negative or zero (swapped reference particles?)! &quot;&lt;&lt;originalLength);
 	assert(originalLength&gt;0);
 	
 	shared_ptr&lt;AABB&gt; rbAABB;
@@ -39,7 +40,7 @@
 	recStream.open(&quot;/tmp/usct.data&quot;);
 }
 
-void UniaxialStrainer::applyCondition(Body* _rootBody){
+void UniaxialStrainer::applyCondition(MetaBody* rootBody){
 	if(needsInit) init();
 	// postconditions for initParams
 	assert(posIds.size()==posCoords.size() &amp;&amp; negIds.size()==negCoords.size() &amp;&amp; originalLength&gt;0 &amp;&amp; crossSectionArea&gt;1);
@@ -47,16 +48,14 @@
 	if(posIds.size()==0 || negIds.size()==0) return;
 	// linearly increase strain to the desired value
 	if(abs(currentStrainRate)&lt;abs(strainRate))currentStrainRate+=strainRate*.01; else currentStrainRate=strainRate;
-	// how much do we move
-	Real dAX=.5*currentStrainRate*originalLength*Omega::instance().getTimeStep();
+	// how much do we move; in the symmetric case, half of the strain is applied at each end;
+	Real dAX=(asymmetry==0?.5:1)*currentStrainRate*originalLength*Omega::instance().getTimeStep();
 	for(size_t i=0; i&lt;negIds.size(); i++){
-		//TRVAR1(USCT_AXIS_COORD(negIds[i]));
-		negCoords[i]-=dAX;
+		if(asymmetry==0 || asymmetry==-1 /* for +1, don't move*/) negCoords[i]-=dAX;
 		USCT_AXIS_COORD(negIds[i])=negCoords[i]; // update current position
-		negCoords[i]-=dAX; // store current position
 	}
 	for(size_t i=0; i&lt;posIds.size(); i++){
-		posCoords[i]+=dAX;
+		if(asymmetry==0 || asymmetry==1 /* for -1, don't move */) posCoords[i]+=dAX;
 		USCT_AXIS_COORD(posIds[i])=posCoords[i];
 	}
 
@@ -68,7 +67,7 @@
 	if(notYetReversed &amp;&amp; limitStrain!=0 &amp;&amp; ((currentStrainRate&gt;0 &amp;&amp; strain&gt;limitStrain) || (currentStrainRate&lt;0 &amp;&amp; strain&lt;limitStrain))) { currentStrainRate*=-1; notYetReversed=false; LOG_INFO(&quot;Reversed strain rate to &quot;&lt;&lt;currentStrainRate); }
 
 	if(Omega::instance().getCurrentIteration()%50==0 &amp;&amp; recStream.good()) {
-		computeAxialForce(static_cast&lt;MetaBody*&gt;(_rootBody));
+		computeAxialForce(rootBody);
 		Real midPos=Body::byId(1)-&gt;physicalParameters-&gt;se3.position[axis];
 		Real avgStress=(sumPosForces+sumNegForces)/(2*crossSectionArea); // average nominal stress
 		recStream&lt;&lt;Omega::instance().getCurrentIteration()&lt;&lt;&quot; &quot;&lt;&lt;strain&lt;&lt;&quot; &quot;&lt;&lt;avgStress&lt;&lt;&quot; &quot;&lt;&lt;sumPosForces&lt;&lt;&quot; &quot;&lt;&lt;sumNegForces&lt;&lt;&quot; &quot;&lt;&lt;posCoords[0]&lt;&lt;&quot; &quot;&lt;&lt;negCoords[0]&lt;&lt;&quot; &quot;&lt;&lt;midPos&lt;&lt;endl;
@@ -208,7 +207,7 @@
 		shared_ptr&lt;BrefcomMakeContact&gt; bmc(new BrefcomMakeContact);
 		bmc-&gt;cohesiveThresholdIter=cohesiveThresholdIter;
 		bmc-&gt;expBending=20;
-		bmc-&gt;calibratedEpsFracture=3e-4;
+		//bmc-&gt;calibratedEpsFracture=3e-4;
 		iphysDispatcher-&gt;add(bmc);
 	rootBody-&gt;engines.push_back(iphysDispatcher);
 

Modified: trunk/extra/usct/UniaxialStrainControlledTest.hpp
===================================================================
--- trunk/extra/usct/UniaxialStrainControlledTest.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/extra/usct/UniaxialStrainControlledTest.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -47,21 +47,26 @@
 		Real strainRate,currentStrainRate,originalLength,limitStrain;
 		Real sumPosForces,sumNegForces;
 		Real crossSectionArea;
+		//! Apply strain along x (0), y (1) or z(2) axis
 		int axis;
+		//! If 0, straining is symmetric for negIds and posIds; for 1 (or -1), only posIds are strained and negIds don't move (or vice versa)
+		int asymmetry;
+
 		bool notYetReversed;
 		bool clumped;
 		vector&lt;body_id_t&gt; posIds, negIds;
 		vector&lt;Real&gt; posCoords,negCoords;
 
-		virtual void applyCondition(Body* _rootBody);
+		virtual void applyCondition(MetaBody* rootBody);
 		void init();
-		UniaxialStrainer(){axis=2; currentStrainRate=0; originalLength=-1; limitStrain=-1; notYetReversed=true; crossSectionArea=-1; needsInit=true; clumped=false; };
+		UniaxialStrainer(){axis=2; asymmetry=0; currentStrainRate=0; originalLength=-1; limitStrain=0; notYetReversed=true; crossSectionArea=-1; needsInit=true; clumped=false; };
 		virtual ~UniaxialStrainer(){};
 		void registerAttributes(){
 			DeusExMachina::registerAttributes();
 			REGISTER_ATTRIBUTE(strainRate);
 			REGISTER_ATTRIBUTE(currentStrainRate);
 			REGISTER_ATTRIBUTE(axis);
+			REGISTER_ATTRIBUTE(asymmetry);
 			REGISTER_ATTRIBUTE(posIds);
 			REGISTER_ATTRIBUTE(negIds);
 			REGISTER_ATTRIBUTE(originalLength);

Modified: trunk/gui/cmd/attrUtils.cpp
===================================================================
--- trunk/gui/cmd/attrUtils.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/gui/cmd/attrUtils.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -16,13 +16,14 @@
 #define ATTR_ACCESS_CXX(accessor,ensureFunc) \
 	boost::python::object wrappedPyGet(std::string key){ensureFunc();return accessor-&gt;pyGet(key);} \
 	void wrappedPySet(std::string key,python::object val){ensureFunc(); accessor-&gt;pySet(key,val);} \
-	boost::python::list wrappedPyKeys(){ensureFunc(); return accessor-&gt;pyKeys();} 
+	boost::python::list wrappedPyKeys(){ensureFunc(); return accessor-&gt;pyKeys();} \
+	bool wrappedPyHasKey(std::string key){ensureFunc(); return accessor-&gt;descriptors.find(key)!=accessor-&gt;descriptors.end();}
 	
 /*! Python special functions complementing proxies defined by ATTR_ACCESS_CXX, to be used with boost::python::class_&lt;&gt;.
  *
  * They define python special functions that support dictionary operations on this object and calls proxies for them. */
 #define ATTR_ACCESS_PY(cxxClass) \
-	def(&quot;__getitem__&quot;,&amp;cxxClass::wrappedPyGet).def(&quot;__setitem__&quot;,&amp;cxxClass::wrappedPySet).def(&quot;keys&quot;,&amp;cxxClass::wrappedPyKeys)
+	def(&quot;__getitem__&quot;,&amp;cxxClass::wrappedPyGet).def(&quot;__setitem__&quot;,&amp;cxxClass::wrappedPySet).def(&quot;keys&quot;,&amp;cxxClass::wrappedPyKeys).def(&quot;has_key&quot;,&amp;cxxClass::wrappedPyHasKey)
 	//def(&quot;__getattr__&quot;,&amp;cxxClass::wrappedPyGet).def(&quot;__setattr__&quot;,&amp;cxxClass::wrappedPySet).def(&quot;attrs&quot;,&amp;cxxClass::wrappedPyKeys)
 
 

Modified: trunk/gui/cmd/yadeControl.cpp
===================================================================
--- trunk/gui/cmd/yadeControl.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/gui/cmd/yadeControl.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -139,6 +139,8 @@
 #define BASIC_PY_PROXY(pyClass,yadeClass) BASIC_PY_PROXY_HEAD(pyClass,yadeClass) BASIC_PY_PROXY_TAIL
 
 
+BASIC_PY_PROXY(pyGeneric,Serializable);
+
 BASIC_PY_PROXY(pyInteractionGeometry,InteractionGeometry);
 BASIC_PY_PROXY(pyInteractionPhysics,InteractionPhysics);
 
@@ -339,6 +341,24 @@
 
 	void saveSpheres(std::string fileName){ Shop::saveSpheresToFile(fileName); }
 
+	python::list miscParams_get(){
+		python::list ret;
+		BOOST_FOREACH(shared_ptr&lt;Serializable&gt;&amp; s, OMEGA.getRootBody()-&gt;miscParams){
+			ret.append(pyGeneric(s));
+		}
+		return ret;
+	}
+
+	void miscParams_set(python::list l){
+		int len=PySequence_Size(l.ptr());
+		vector&lt;shared_ptr&lt;Serializable&gt; &gt;&amp; miscParams=OMEGA.getRootBody()-&gt;miscParams;
+		miscParams.clear();
+		for(int i=0; i&lt;len; i++){
+			if(python::extract&lt;pyGeneric&gt;(PySequence_GetItem(l.ptr(),i)).check()){ pyGeneric g=python::extract&lt;pyGeneric&gt;(PySequence_GetItem(l.ptr(),i)); miscParams.push_back(g.proxee); }
+			else throw std::invalid_argument(&quot;Unable to extract `Generic' from item #&quot;+lexical_cast&lt;string&gt;(i)+&quot;.&quot;);
+		}
+	}
+
 	python::list anyEngines_get(vector&lt;shared_ptr&lt;Engine&gt; &gt;&amp; engContainer){
 		python::list ret; 
 		BOOST_FOREACH(shared_ptr&lt;Engine&gt;&amp; eng, engContainer){
@@ -502,6 +522,7 @@
 		.def(&quot;step&quot;,&amp;pyOmega::step)
 		.def(&quot;wait&quot;,&amp;pyOmega::wait)
 		.add_property(&quot;engines&quot;,&amp;pyOmega::engines_get,&amp;pyOmega::engines_set)
+		.add_property(&quot;miscParams&quot;,&amp;pyOmega::miscParams_get,&amp;pyOmega::miscParams_set)
 		.add_property(&quot;initializers&quot;,&amp;pyOmega::initializers_get,&amp;pyOmega::initializers_set)
 		.add_property(&quot;bodies&quot;,&amp;pyOmega::bodies_get)
 		.add_property(&quot;interactions&quot;,&amp;pyOmega::interactions_get)
@@ -558,6 +579,8 @@
 	BASIC_PY_PROXY_WRAPPER(pyInteractionGeometry,&quot;InteractionGeometry&quot;);
 	BASIC_PY_PROXY_WRAPPER(pyInteractionPhysics,&quot;InteractionPhysics&quot;);
 
+	BASIC_PY_PROXY_WRAPPER(pyGeneric,&quot;Generic&quot;);
+
 	BASIC_PY_PROXY_WRAPPER(pyBody,&quot;Body&quot;)
 		.add_property(&quot;shape&quot;,&amp;pyBody::shape_get,&amp;pyBody::shape_set)
 		.add_property(&quot;mold&quot;,&amp;pyBody::mold_get,&amp;pyBody::mold_set)

Modified: trunk/lib/QGLViewer/qglviewer.h
===================================================================
--- trunk/lib/QGLViewer/qglviewer.h	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/lib/QGLViewer/qglviewer.h	2008-04-28 21:52:11 UTC (rev 1329)
@@ -1228,4 +1228,8 @@
   bool updateGLOK_;
 };
 
+#undef DEBUG
+
 #endif // QGLVIEWER_QGLVIEWER_H
+
+

Modified: trunk/lib/serialization/PointerHandler.tpp
===================================================================
--- trunk/lib/serialization/PointerHandler.tpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/lib/serialization/PointerHandler.tpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -47,8 +47,13 @@
 		if(typeStr.size() != 0)
 		{
 			// FIXME : isn't it the same code code Serializable and custom ???
-			if(boost::is_base_and_derived&lt;Serializable,PointedType&gt;::value)
-			{				
+
+			if(boost::is_base_of&lt;Serializable,PointedType&gt;::value){
+				/*
+				the condition means: is_base_and_derived(A,B)||is_same(A,B).
+				This makes it possible to deserialize shared_ptr&lt;Serializable&gt;.
+				*/
+
 				// WARNING: this will not compile if you have 'int' or 'float' inside shared_ptr
 				// but I'm not going to change this into reinterpret_cast just because of that.
 				// nobody will have 'int' inside shared_ptr, and reinterpret_cast is here too risky hack.

Modified: trunk/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters.cpp
===================================================================
--- trunk/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -15,6 +15,7 @@
 	createIndex();
 	acceleration = Vector3r(0,0,0);
 	angularAcceleration = Vector3r(0,0,0);
+	angularVelocity=Vector3r(0,0,0);
 }
 
 RigidBodyParameters::~RigidBodyParameters()

Modified: trunk/pkg/common/Engine/DeusExMachina/CentralGravityEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/CentralGravityEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/CentralGravityEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -5,9 +5,7 @@
 
 YADE_PLUGIN(&quot;CentralGravityEngine&quot;,&quot;AxialGravityEngine&quot;);
 
-void CentralGravityEngine::applyCondition(Body* _rootBody){
-	/* get &quot;rootBody&quot;, which is the whole simulation */
-	MetaBody* rootBody=YADE_CAST&lt;MetaBody*&gt;(_rootBody);
+void CentralGravityEngine::applyCondition(MetaBody* rootBody){
 	/* get the central body, by its id; cast its Body::physicalParameters to ParticleParameters, since we need the mass */
 	Real centralMass=YADE_PTR_CAST&lt;ParticleParameters&gt;(Body::byId(centralBody)-&gt;physicalParameters)-&gt;mass;
 	/* position of the central body */
@@ -29,8 +27,7 @@
 	}
 }
 CREATE_LOGGER(AxialGravityEngine);
-void AxialGravityEngine::applyCondition(Body* _rootBody){
-	MetaBody* rootBody=YADE_CAST&lt;MetaBody*&gt;(_rootBody);
+void AxialGravityEngine::applyCondition(MetaBody* rootBody){
 	BodyContainer::iterator Iend=rootBody-&gt;bodies-&gt;end();
 	for(BodyContainer::iterator I=rootBody-&gt;bodies-&gt;begin(); I!=Iend; ++I){
 		const shared_ptr&lt;Body&gt;&amp; b(*I);

Modified: trunk/pkg/common/Engine/DeusExMachina/CentralGravityEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/CentralGravityEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/CentralGravityEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -23,7 +23,7 @@
 		Real kappa;
 		CentralGravityEngine(){ shared_ptr&lt;Force&gt; f(new Force); cachedForceClassIndex=f-&gt;getClassIndex(); }
 		virtual ~CentralGravityEngine(){};
-		virtual void applyCondition(Body*);
+		virtual void applyCondition(MetaBody*);
 	protected:
 		virtual void registerAttributes(){REGISTER_ATTRIBUTE(centralBody); REGISTER_ATTRIBUTE(kappa);}
 		REGISTER_CLASS_NAME(CentralGravityEngine);
@@ -46,7 +46,7 @@
 		Real acceleration;
 		AxialGravityEngine(){ shared_ptr&lt;Force&gt; f(new Force); cachedForceClassIndex=f-&gt;getClassIndex(); }
 		virtual ~AxialGravityEngine(){};
-		virtual void applyCondition(Body*);
+		virtual void applyCondition(MetaBody*);
 	protected:
 		virtual void registerAttributes(){REGISTER_ATTRIBUTE(axisPoint); REGISTER_ATTRIBUTE(axisDirection); REGISTER_ATTRIBUTE(acceleration); }
 		REGISTER_CLASS_NAME(AxialGravityEngine);

Modified: trunk/pkg/common/Engine/DeusExMachina/CinemCisEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/CinemCisEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/CinemCisEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -35,7 +35,7 @@
 }
 
 
-void CinemCisEngine::applyCondition(Body * body)
+void CinemCisEngine::applyCondition(MetaBody * body)
 {
 	if(theta&lt;=thetalim)
 	{
@@ -47,9 +47,8 @@
 
 
 
-void CinemCisEngine::applyRotTranslation(Body * body)
+void CinemCisEngine::applyRotTranslation(MetaBody * ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt; bodies = ncb-&gt;bodies;
 
 	Yplaqsup=((*bodies)[id_boxhaut]-&gt;physicalParameters.get())-&gt;se3.position.Y();	// the height of the sample, which may be different from the initial &quot;height&quot; defined in the Preprocessor
@@ -85,9 +84,8 @@
 }
 
 
-void CinemCisEngine::applyTranslation(Body * body)
+void CinemCisEngine::applyTranslation(MetaBody * ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 	int id_boxhaut=3;

Modified: trunk/pkg/common/Engine/DeusExMachina/CinemCisEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/CinemCisEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/CinemCisEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -28,7 +28,7 @@
 
 	public :
 		CinemCisEngine();
-		void applyCondition(Body * body);
+		void applyCondition(MetaBody * body);
 
 		Real	 shearSpeed	// to be defined in the PreProcessor
 			,thetalim 	// the maximum value of theta, at wich the displacement is stopped
@@ -39,8 +39,8 @@
 
 	protected :
 		void registerAttributes();
-		void applyRotTranslation(Body *body);	// to let move (rotation combined with translation) the lateral walls
-		void applyTranslation(Body *body);	// to let move (translation) the upper wall
+		void applyRotTranslation(MetaBody *);	// to let move (rotation combined with translation) the lateral walls
+		void applyTranslation(MetaBody *);	// to let move (translation) the upper wall
 	REGISTER_CLASS_NAME(CinemCisEngine);
 	REGISTER_BASE_CLASS_NAME(DeusExMachina);
 };

Modified: trunk/pkg/common/Engine/DeusExMachina/DisplacementEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/DisplacementEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/DisplacementEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -43,7 +43,7 @@
    return active;
 }
 
-void DisplacementEngine::applyCondition(Body * body)
+void DisplacementEngine::applyCondition(MetaBody * ncb)
 {
 
 /// FIXME - that's a hack! more control needed from the GUI !
@@ -65,10 +65,6 @@
 		if((count++)%6==0) oldSec=Omega::instance().isoSec;
 	}
 
-
-
-
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();

Modified: trunk/pkg/common/Engine/DeusExMachina/DisplacementEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/DisplacementEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/DisplacementEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -18,7 +18,7 @@
 	public :
 		Real displacement;
 		Vector3r translationAxis;
-		void applyCondition(Body * body);
+		void applyCondition(MetaBody *);
 		bool active;
 		DisplacementEngine():active(true){};
 		bool isActivated();

Modified: trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -49,9 +49,8 @@
 }
 
 
-void DisplacementToForceEngine::applyCondition(Body * body)
+void DisplacementToForceEngine::applyCondition(MetaBody * ncb)
 {
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();

Modified: trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/DisplacementToForceEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -28,7 +28,7 @@
 		DisplacementToForceEngine();
 		virtual ~DisplacementToForceEngine();
 
-		virtual void applyCondition(Body * body);
+		virtual void applyCondition(MetaBody *);
 
 	protected :
 		virtual void postProcessAttributes(bool);

Modified: trunk/pkg/common/Engine/DeusExMachina/FixedOrientationEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/FixedOrientationEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/FixedOrientationEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -31,9 +31,8 @@
 }
 
 
-void FixedOrientationEngine::applyCondition(Body * body)
+void FixedOrientationEngine::applyCondition(MetaBody * ncb)
 {
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();

Modified: trunk/pkg/common/Engine/DeusExMachina/FixedOrientationEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/FixedOrientationEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/FixedOrientationEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -17,7 +17,7 @@
 {
 	public :
 		Quaternionr fixedOrientation;
-		void applyCondition(Body * body);
+		void applyCondition(MetaBody *);
 
 		FixedOrientationEngine();
 

Modified: trunk/pkg/common/Engine/DeusExMachina/FixedPositionEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/FixedPositionEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/FixedPositionEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -6,57 +6,31 @@
 *  GNU General Public License v2 or later. See file LICENSE for details. *
 *************************************************************************/
 
-#include &quot;FixedPositionEngine.hpp&quot;
+#include&quot;FixedPositionEngine.hpp&quot;
 #include&lt;yade/core/MetaBody.hpp&gt;
+#include&lt;boost/foreach.hpp&gt;
 
-FixedPositionEngine::FixedPositionEngine()
-{
+FixedPositionEngine::FixedPositionEngine(){
 	fixedPosition=Vector3r(0,0,0);
 	mask=Vector3r(0,0,1);
 }
 
-void FixedPositionEngine::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-		std::cerr &lt;&lt; &quot;fixedPosition: &quot; &lt;&lt; fixedPosition &lt;&lt; &quot;\n&quot;;
-		std::cerr &lt;&lt; &quot;mask: &quot; &lt;&lt; mask &lt;&lt; &quot;\n\n&quot;;
-	}
-}
+void FixedPositionEngine::postProcessAttributes(bool deserializing){}
 
-
-void FixedPositionEngine::registerAttributes()
-{
-//	DeusExMachina::registerAttributes();
+void FixedPositionEngine::registerAttributes(){
+	DeusExMachina::registerAttributes(); // for subscribedBodies
 	REGISTER_ATTRIBUTE(fixedPosition);
 	REGISTER_ATTRIBUTE(mask);
 }
 
 
-void FixedPositionEngine::applyCondition(Body * body)
-{
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
+void FixedPositionEngine::applyCondition(MetaBody * ncb){
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-//	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();
-//	std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();
-//
-//	for(;ii!=iiEnd;++ii)
-//		if( bodies-&gt;exists(*ii) )
-//		{
-//			if(mask[0] != 0)  ((*bodies)[*ii]-&gt;physicalParameters.get())-&gt;se3.position[0] = fixedPosition[0];
-//			if(mask[1] != 0)  ((*bodies)[*ii]-&gt;physicalParameters.get())-&gt;se3.position[1] = fixedPosition[1];
-//			if(mask[2] != 0)  ((*bodies)[*ii]-&gt;physicalParameters.get())-&gt;se3.position[2] = fixedPosition[2];
-//		}
-
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		if(mask[0] != 0)  (b-&gt;physicalParameters.get())-&gt;se3.position[0] = fixedPosition[0];
-		if(mask[1] != 0)  (b-&gt;physicalParameters.get())-&gt;se3.position[1] = fixedPosition[1];
-		if(mask[2] != 0)  (b-&gt;physicalParameters.get())-&gt;se3.position[2] = fixedPosition[2];
+	BOOST_FOREACH(int id, subscribedBodies){
+		if(!bodies-&gt;exists(id)) continue;
+		if(mask[0]!=0) (*bodies)[id]-&gt;physicalParameters-&gt;se3.position[0]=fixedPosition[0];
+		if(mask[1]!=0) (*bodies)[id]-&gt;physicalParameters-&gt;se3.position[1]=fixedPosition[1];
+		if(mask[2]!=0) (*bodies)[id]-&gt;physicalParameters-&gt;se3.position[2]=fixedPosition[2];
 	}
 }
 

Modified: trunk/pkg/common/Engine/DeusExMachina/FixedPositionEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/FixedPositionEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/FixedPositionEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -13,15 +13,15 @@
 #include &lt;Wm3Vector3.h&gt;
 #include&lt;yade/lib-base/yadeWm3.hpp&gt;
 
-class FixedPositionEngine : public DeusExMachina
-{
-	public :
-		Vector3r fixedPosition,mask;
-		void applyCondition(Body * body);
-
+/* Resets spatial position for all subscribed bodies to the desired value. */
+class FixedPositionEngine : public DeusExMachina {
+	public:
+		Vector3r fixedPosition;
+		//! Non-zero components determine which components of fixedPosition will be used 
+		Vector3r mask;
+		void applyCondition(MetaBody*);
 		FixedPositionEngine();
-
-	protected :
+	protected:
 		virtual void postProcessAttributes(bool);
 		virtual void registerAttributes();
 	REGISTER_CLASS_NAME(FixedPositionEngine);

Modified: trunk/pkg/common/Engine/DeusExMachina/ForceEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/ForceEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/ForceEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -30,11 +30,8 @@
 }
 
 
-void ForceEngine::applyCondition(Body* body)
+void ForceEngine::applyCondition(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
 	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();
 	std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();
 	

Modified: trunk/pkg/common/Engine/DeusExMachina/ForceEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/ForceEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/ForceEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -23,7 +23,7 @@
 		ForceEngine();
 		virtual ~ForceEngine();
 	
-		virtual void applyCondition(Body*);
+		virtual void applyCondition(MetaBody*);
 	
 	protected :
 		virtual void registerAttributes();

Modified: trunk/pkg/common/Engine/DeusExMachina/GravityEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/GravityEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/GravityEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -27,9 +27,8 @@
 }
 
 
-void GravityEngine::applyCondition(Body* body)
+void GravityEngine::applyCondition(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	
 	BodyContainer::iterator bi    = bodies-&gt;begin();

Modified: trunk/pkg/common/Engine/DeusExMachina/GravityEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/GravityEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/GravityEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -23,7 +23,7 @@
 		GravityEngine();
 		virtual ~GravityEngine();
 	
-		virtual void applyCondition(Body*);
+		virtual void applyCondition(MetaBody*);
 	
 	protected :
 		virtual void registerAttributes();

Modified: trunk/pkg/common/Engine/DeusExMachina/MomentEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/MomentEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/MomentEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -30,10 +30,8 @@
 }
 
 
-void MomentEngine::applyCondition(Body* body)
+void MomentEngine::applyCondition(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	
 	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();
 	std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();

Modified: trunk/pkg/common/Engine/DeusExMachina/MomentEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/MomentEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/MomentEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -23,7 +23,7 @@
 		MomentEngine();
 		virtual ~MomentEngine();
 	
-		virtual void applyCondition(Body*);
+		virtual void applyCondition(MetaBody*);
 	
 	protected :
 		virtual void registerAttributes();

Modified: trunk/pkg/common/Engine/DeusExMachina/RotationEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/RotationEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/RotationEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -30,17 +30,16 @@
 }
 
 
-void RotationEngine::applyCondition(Body * body)
+void RotationEngine::applyCondition(MetaBody *ncb)
 {
 
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt; bodies = ncb-&gt;bodies;
 
 	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();
 	std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();
 
 	Real dt = Omega::instance().getTimeStep();
-	time = dt;
+	// time = dt;
 
 	Quaternionr q;
 	q.FromAxisAngle(rotationAxis,angularVelocity*dt);

Modified: trunk/pkg/common/Engine/DeusExMachina/RotationEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/RotationEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/RotationEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -22,7 +22,7 @@
 		Vector3r rotationAxis;
 		bool rotateAroundZero;
 
-		void applyCondition(Body * body);
+		void applyCondition(MetaBody * );
 
 	protected :
 		void registerAttributes();

Modified: trunk/pkg/common/Engine/DeusExMachina/StaticAttractionEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/StaticAttractionEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/StaticAttractionEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -39,10 +39,9 @@
  *   After the compression stage is over, engine should be disabled by 
  *   setting active=false;
  */
-void StaticAttractionEngine::applyCondition(Body * body)
+void StaticAttractionEngine::applyCondition(MetaBody * ncb)
 {
 
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	BodyContainer::iterator bi    = ncb-&gt;bodies-&gt;begin();
 	BodyContainer::iterator biEnd = ncb-&gt;bodies-&gt;end();
 	BodyContainer::iterator bi2;

Modified: trunk/pkg/common/Engine/DeusExMachina/StaticAttractionEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/StaticAttractionEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/StaticAttractionEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -16,7 +16,7 @@
 class StaticAttractionEngine : public DeusExMachina
 {
 	public :
-		void applyCondition(Body * body);
+		void applyCondition(MetaBody *);
 		bool active;
 		StaticAttractionEngine() : active(true) {};
 		virtual bool isActivated() { return active; };

Modified: trunk/pkg/common/Engine/DeusExMachina/TranslationEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/TranslationEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/TranslationEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -25,48 +25,26 @@
 }
 
 
-void TranslationEngine::applyCondition(Body * body)
-{
+void TranslationEngine::applyCondition(MetaBody * ncb){
+	shared_ptr&lt;BodyContainer&gt;&amp; bodies=ncb-&gt;bodies;
 
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
 	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();
 	std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();
 
-	Real dt = Omega::instance().getTimeStep();
-	time = dt;
+	Real dt=Omega::instance().getTimeStep();
+	//time=dt;
 	static int sign = 1;
-
-	//if ((Omega::instance().getCurrentIteration()/1000)%2==0)
-		sign = 1;
-	//else
-	//	sign = -1;
-
-	for(;ii!=iiEnd;++ii)
-		if(ParticleParameters* p = dynamic_cast&lt;ParticleParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get()))
-		{
-
-		// FIXME - specify intervals of activity for an engine =&gt; use isActivated method
-		//if( Omega::instance().getIter() &gt; 1000 )
-		//	b-&gt;velocity		= Vector3r(0,0,0);
-		//else
-		//{
-			p-&gt;se3.position		+= sign*dt*velocity*translationAxis;
-			p-&gt;velocity		=  sign*velocity*translationAxis;
-		//}
-		
+	for(;ii!=iiEnd;++ii){
+		if(ParticleParameters* p = dynamic_cast&lt;ParticleParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get())){
+			p-&gt;se3.position+=sign*dt*velocity*translationAxis;
+			p-&gt;velocity=sign*velocity*translationAxis;
+		} else if(PhysicalParameters* b = dynamic_cast&lt;PhysicalParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get())){
+			// NOT everyone has velocity !
+			b-&gt;se3.position+=sign*dt*velocity*translationAxis;
+		} else {
+			std::cerr &lt;&lt; &quot;TranslationEngine::applyCondition, WARNING! dynamic_cast failed! for id: &quot; &lt;&lt; *ii &lt;&lt; std::endl;
 		}
-		else if(PhysicalParameters* b = dynamic_cast&lt;PhysicalParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get()))
-		{ // NOT everyone has velocity !
-			b-&gt;se3.position		+= sign*dt*velocity*translationAxis;
-		}
-		else
-		{
-			std::cerr &lt;&lt; &quot;TranslationEngine::applyCondition, WARNING! dynamic_cast failed! for id: &quot; &lt;&lt; *ii &lt;&lt; std::endl; // FUCK! I've literally spent two days - 10hours to find a mistake caused by static_cast!!, we should never use static_cast when in DEBUG mode !!!!!
-		}
-
-
+	}
 }
 
 YADE_PLUGIN();

Modified: trunk/pkg/common/Engine/DeusExMachina/TranslationEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/DeusExMachina/TranslationEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/DeusExMachina/TranslationEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -18,7 +18,7 @@
 	public :
 		Real velocity;
 		Vector3r translationAxis;
-		void applyCondition(Body * body);
+		void applyCondition(MetaBody *);
 
 	protected :
 		virtual void postProcessAttributes(bool deserializing);

Modified: trunk/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -14,9 +14,8 @@
 #include&lt;yade/core/MetaBody.hpp&gt;
 
 
-void BoundingVolumeMetaEngine::action(Body* body)
+void BoundingVolumeMetaEngine::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	
 	BodyContainer::iterator bi    = bodies-&gt;begin();
@@ -28,7 +27,7 @@
 			operator()(b-&gt;interactingGeometry,b-&gt;boundingVolume,b-&gt;physicalParameters-&gt;se3,b.get());
 	}
 		
-	operator()(body-&gt;interactingGeometry,body-&gt;boundingVolume,body-&gt;physicalParameters-&gt;se3,body);
+	operator()(ncb-&gt;interactingGeometry,ncb-&gt;boundingVolume,ncb-&gt;physicalParameters-&gt;se3,ncb);
 }
 
 

Modified: trunk/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -33,7 +33,7 @@
 					&gt;
 {
 	public :
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 
 	REGISTER_CLASS_NAME(BoundingVolumeMetaEngine);
 	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);

Modified: trunk/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -9,9 +9,8 @@
 #include &quot;GeometricalModelMetaEngine.hpp&quot;
 #include&lt;yade/core/MetaBody.hpp&gt;
 
-void GeometricalModelMetaEngine::action(Body* body)
+void GeometricalModelMetaEngine::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	
 	BodyContainer::iterator bi    = bodies-&gt;begin();
@@ -23,8 +22,8 @@
 			operator()(b-&gt;physicalParameters,b-&gt;geometricalModel,b.get());
 	}
 	
-	if(body-&gt;geometricalModel)
-	 	operator()(body-&gt;physicalParameters,body-&gt;geometricalModel,body);
+	if(ncb-&gt;geometricalModel)
+	 	operator()(ncb-&gt;physicalParameters,ncb-&gt;geometricalModel,ncb);
 }
 
 YADE_PLUGIN();

Modified: trunk/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -29,7 +29,7 @@
 					&gt;
 {
 	public :
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 
 	REGISTER_CLASS_NAME(GeometricalModelMetaEngine);
 	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);

Modified: trunk/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -1,32 +1,31 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingGeometryMetaEngine.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-void InteractingGeometryMetaEngine::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		if(b-&gt;geometricalModel &amp;&amp; b-&gt;interactingGeometry)
-			operator()(b-&gt;geometricalModel,b-&gt;interactingGeometry,b-&gt;physicalParameters-&gt;se3,b.get());
-	}
-		
-	if(body-&gt;geometricalModel &amp;&amp; body-&gt;interactingGeometry)
-		operator()(body-&gt;geometricalModel,body-&gt;interactingGeometry,body-&gt;physicalParameters-&gt;se3,body);
-}
-
+/*************************************************************************
+*  Copyright (C) 2004 by Olivier Galizzi                                 *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
+*  Copyright (C) 2004 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include &quot;InteractingGeometryMetaEngine.hpp&quot;
+#include&lt;yade/core/MetaBody.hpp&gt;
+
+void InteractingGeometryMetaEngine::action(MetaBody* ncb)
+{
+	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
+	
+	BodyContainer::iterator bi    = bodies-&gt;begin();
+	BodyContainer::iterator biEnd = bodies-&gt;end();
+	for( ; bi!=biEnd ; ++bi )
+	{
+		shared_ptr&lt;Body&gt; b = *bi;
+		if(b-&gt;geometricalModel &amp;&amp; b-&gt;interactingGeometry)
+			operator()(b-&gt;geometricalModel,b-&gt;interactingGeometry,b-&gt;physicalParameters-&gt;se3,b.get());
+	}
+		
+	if(ncb-&gt;geometricalModel &amp;&amp; ncb-&gt;interactingGeometry)
+		operator()(ncb-&gt;geometricalModel,ncb-&gt;interactingGeometry,ncb-&gt;physicalParameters-&gt;se3,ncb);
+}
+
 YADE_PLUGIN();

Modified: trunk/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -31,7 +31,7 @@
 					&gt;
 {
 	public :
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 
 	REGISTER_CLASS_NAME(InteractingGeometryMetaEngine);
 	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);

Modified: trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -14,9 +14,8 @@
 #include&lt;yade/core/MetaBody.hpp&gt;
 
 
-void InteractionGeometryMetaEngine::action(Body* body)
+void InteractionGeometryMetaEngine::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	
 	shared_ptr&lt;InteractionContainer&gt;&amp; persistentInteractions = ncb-&gt;persistentInteractions;

Modified: trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -36,7 +36,7 @@
 					&gt;
 {
 	public :
-		virtual void action(Body* body);
+		virtual void action(MetaBody*);
 
 	REGISTER_CLASS_NAME(InteractionGeometryMetaEngine);
 	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);

Modified: trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -12,9 +12,8 @@
 #include&lt;yade/core/MetaBody.hpp&gt;
 
 
-void InteractionPhysicsMetaEngine::action(Body* body)
+void InteractionPhysicsMetaEngine::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	
 	shared_ptr&lt;InteractionContainer&gt;&amp; persistentInteractions = ncb-&gt;persistentInteractions;

Modified: trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -29,7 +29,7 @@
 					&gt;
 {		
 	public :
-		virtual void action(Body* body);
+		virtual void action(MetaBody*);
 
 	REGISTER_CLASS_NAME(InteractionPhysicsMetaEngine);
 	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -9,9 +9,8 @@
 #include &quot;PhysicalActionApplier.hpp&quot;
 #include&lt;yade/core/MetaBody.hpp&gt;
 
-void PhysicalActionApplier::action(Body* body)
+void PhysicalActionApplier::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 	PhysicalActionContainer::iterator pai    = ncb-&gt;physicalActions-&gt;begin();

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalActionApplier.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -33,7 +33,7 @@
 				&gt;
 {
 	public :
-		virtual void action(Body* body);
+		virtual void action(MetaBody*);
 
 	REGISTER_CLASS_NAME(PhysicalActionApplier);
 	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -11,9 +11,8 @@
 #include &quot;PhysicalActionDamper.hpp&quot;
 #include&lt;yade/core/MetaBody.hpp&gt;
 
-void PhysicalActionDamper::action(Body* body)
+void PhysicalActionDamper::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	PhysicalActionContainer::iterator pai    = ncb-&gt;physicalActions-&gt;begin();
 	PhysicalActionContainer::iterator paiEnd = ncb-&gt;physicalActions-&gt;end();

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalActionDamper.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -28,7 +28,7 @@
 				&gt;
 {
 	public :
-		virtual void action(Body* body);
+		virtual void action(MetaBody*);
 
 	REGISTER_CLASS_NAME(PhysicalActionDamper);
 	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.cpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -12,9 +12,8 @@
 #include&lt;yade/core/MetaBody.hpp&gt;
 
 
-void PhysicalParametersMetaEngine::action(Body* body)
+void PhysicalParametersMetaEngine::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	
 	BodyContainer::iterator bi    = bodies-&gt;begin();
@@ -25,7 +24,7 @@
 		operator()(b-&gt;physicalParameters,b.get());
 	}
 	
- 	operator()(body-&gt;physicalParameters,body);
+ 	operator()(ncb-&gt;physicalParameters,ncb);
 }
 
 YADE_PLUGIN();

Modified: trunk/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.hpp
===================================================================
--- trunk/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -26,7 +26,7 @@
 					&gt;
 {
 	public :
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 
 	REGISTER_CLASS_NAME(PhysicalParametersMetaEngine);
 	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine1D);

Modified: trunk/pkg/common/Engine/StandAloneEngine/DistantPersistentSAPCollider.cpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/DistantPersistentSAPCollider.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/DistantPersistentSAPCollider.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -38,10 +38,9 @@
 
 }
 
-void DistantPersistentSAPCollider::action(Body* body)
+void DistantPersistentSAPCollider::action(MetaBody* ncb)
 {
 
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt; bodies = ncb-&gt;bodies;
 	
 	if (2*bodies-&gt;size()!=xBounds.size())

Modified: trunk/pkg/common/Engine/StandAloneEngine/DistantPersistentSAPCollider.hpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/DistantPersistentSAPCollider.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/DistantPersistentSAPCollider.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -90,7 +90,7 @@
 		virtual ~DistantPersistentSAPCollider();
 
 		/// return a list &quot;transientInteractions&quot; of pairs of Body which Bounding volume are in potential interaction
-		void action(Body * body);
+		void action(MetaBody *);
 
 
 	REGISTER_CLASS_NAME(DistantPersistentSAPCollider);

Modified: trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -32,10 +32,8 @@
 
 }
 
-void PersistentSAPCollider::action(Body* body)
+void PersistentSAPCollider::action(MetaBody* ncb)
 {
-
-	MetaBody *ncb=YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt; bodies=ncb-&gt;bodies;
 	
 	if (2*bodies-&gt;size()!=xBounds.size()){

Modified: trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.hpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -91,7 +91,7 @@
 		virtual ~PersistentSAPCollider();
 
 		/// return a list &quot;transientInteractions&quot; of pairs of Body which Bounding volume are in potential interaction
-		void action(Body * body);
+		void action(MetaBody *);
 
 		//! When creating transient interaction, look first if a persistent link between the pair in question exists; in that case, skip it.
 		bool noTransientIfPersistentExists;

Modified: trunk/pkg/common/Engine/StandAloneEngine/PersistentTriangulationCollider.cpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PersistentTriangulationCollider.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/PersistentTriangulationCollider.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -41,10 +41,8 @@
 	delete Tes;
 }
 
-void PersistentTriangulationCollider::action ( Body* body )
+void PersistentTriangulationCollider::action ( MetaBody* ncb )
 {
-
-	MetaBody *ncb=YADE_CAST&lt;MetaBody*&gt; ( body );
 	shared_ptr&lt;BodyContainer&gt; bodies=ncb-&gt;bodies;
 	bool triangulationIteration = false;
 

Modified: trunk/pkg/common/Engine/StandAloneEngine/PersistentTriangulationCollider.hpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PersistentTriangulationCollider.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/PersistentTriangulationCollider.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -106,7 +106,7 @@
 		virtual ~PersistentTriangulationCollider();
 
 		/// return a list &quot;transientInteractions&quot; of pairs of Body which Bounding volume are in potential interaction
-		void action(Body * body);
+		void action(MetaBody *);
 
 		//! When creating transient interaction, look first if a persistent link between the pair in question exists; in that case, skip it.
 		bool noTransientIfPersistentExists;

Modified: trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -26,9 +26,8 @@
 	REGISTER_ATTRIBUTE(physicalActionNames);
 }
 
-void PhysicalActionContainerInitializer::action(Body* body)
+void PhysicalActionContainerInitializer::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	
 	vector&lt;shared_ptr&lt;PhysicalAction&gt; &gt; physicalActions;
 	physicalActions.clear();

Modified: trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.hpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -23,7 +23,7 @@
 	
 		PhysicalActionContainerInitializer();
 		virtual ~PhysicalActionContainerInitializer();
-		virtual void action(Body* body);
+		virtual void action(MetaBody*);
 	
 	protected : 
 		virtual void registerAttributes();

Modified: trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -18,9 +18,9 @@
 {
 }
 
-void PhysicalActionContainerReseter::action(Body* body)
+void PhysicalActionContainerReseter::action(MetaBody* ncb)
 {
-	(YADE_CAST&lt;MetaBody*&gt;(body))-&gt;physicalActions-&gt;reset();
+	ncb-&gt;physicalActions-&gt;reset();
 }
 
 

Modified: trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.hpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -18,7 +18,7 @@
 	public :
 		PhysicalActionContainerReseter();
 		virtual ~PhysicalActionContainerReseter();
-		virtual void action(Body* body);
+		virtual void action(MetaBody*);
 
 	REGISTER_CLASS_NAME(PhysicalActionContainerReseter);
 	REGISTER_BASE_CLASS_NAME(StandAloneEngine);

Modified: trunk/pkg/common/Engine/StandAloneEngine/SAPCollider.cpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/SAPCollider.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/SAPCollider.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -51,10 +51,8 @@
 }
 
 
-void SAPCollider::action(Body* body)
+void SAPCollider::action(MetaBody* ncb)
 {
-
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt; bodies = ncb-&gt;bodies;
 
 	unsigned int i;

Modified: trunk/pkg/common/Engine/StandAloneEngine/SAPCollider.hpp
===================================================================
--- trunk/pkg/common/Engine/StandAloneEngine/SAPCollider.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/common/Engine/StandAloneEngine/SAPCollider.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -63,7 +63,7 @@
 		~SAPCollider ();
 
 		// return a list &quot;transientInteractions&quot; of pairs of Body which Bounding volume are in potential interaction
-		void action(Body * body);
+		void action(MetaBody *);
 
 
 		// Used the first time broadInteractionTest is called, to initialize and sort the xBounds, yBounds,

Modified: trunk/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters.cpp
===================================================================
--- trunk/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -11,6 +11,8 @@
 BodyMacroParameters::BodyMacroParameters () : ElasticBodyParameters()
 {
 	createIndex();
+	poisson=.3;
+	frictionAngle=0.5236; /* 30&#730; */
 }
 
 BodyMacroParameters::~BodyMacroParameters()

Modified: trunk/pkg/dem/Engine/DeusExMachina/CapillaryPressureEngine.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/CapillaryPressureEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/CapillaryPressureEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -36,7 +36,7 @@
 }
 
 
-void CapillaryPressureEngine::applyCondition(Body * body)
+void CapillaryPressureEngine::applyCondition(MetaBody * rootBody)
 {		
 	//cerr &lt;&lt; &quot; CapillaryPressure = &quot; &lt;&lt; capillaryCohesiveLaw-&gt;CapillaryPressure &lt;&lt; endl;
 	
@@ -48,7 +48,7 @@
 // 	cerr &lt;&lt; &quot; CapillaryPressure = &quot; &lt;&lt; capillaryCohesiveLaw-&gt;CapillaryPressure &lt;&lt; endl;
 // 	cerr &lt;&lt; &quot; PressureVariation = &quot; &lt;&lt; PressureVariation &lt;&lt; endl;
 	
-	capillaryCohesiveLaw-&gt;action(body);
+	capillaryCohesiveLaw-&gt;action(rootBody);
 		
 	
 	

Modified: trunk/pkg/dem/Engine/DeusExMachina/CapillaryPressureEngine.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/CapillaryPressureEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/CapillaryPressureEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -28,7 +28,7 @@
 		//shared_ptr&lt;CapillaryCohesiveLaw&gt;  capillaryCohesiveLaw;
 		CapillaryCohesiveLaw* capillaryCohesiveLaw;
 				
-		void applyCondition(Body * body);
+		void applyCondition(MetaBody * body);
 
 	protected :
 		virtual void registerAttributes();

Modified: trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -49,10 +49,8 @@
 }
 
 
-void CapillaryRecorder::action(Body * body)
+void CapillaryRecorder::action(MetaBody * ncb)
 {
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
-		
 	Real fx=0, fy=0, fz=0;
 	
 	

Modified: trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/CapillaryRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -33,7 +33,7 @@
 		CapillaryRecorder ();
 
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/dem/Engine/DeusExMachina/CapillaryStressRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/CapillaryStressRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/CapillaryStressRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -76,9 +76,8 @@
 }
 
 
-void CapillaryStressRecorder::action(Body * body)
+void CapillaryStressRecorder::action(MetaBody * ncb)
 {
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 		
 	Real f1_cap_x=0, f1_cap_y=0, f1_cap_z=0, x1=0, y1=0, z1=0, x2=0, y2=0, z2=0;

Modified: trunk/pkg/dem/Engine/DeusExMachina/CapillaryStressRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/CapillaryStressRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/CapillaryStressRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -39,7 +39,7 @@
 		CapillaryStressRecorder ();
 
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -83,9 +83,8 @@
 }
 
 
-void ContactStressRecorder::action(Body * body)
+void ContactStressRecorder::action(MetaBody * ncb)
 {
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 		
 	Real f1_el_x=0, f1_el_y=0, f1_el_z=0, x1=0, y1=0, z1=0, x2=0, y2=0, z2=0;
@@ -306,7 +305,7 @@
 	
 	/// UnbalancedForce
 	
-	Real equilibriumForce = triaxCompEng-&gt;ComputeUnbalancedForce(body);
+	Real equilibriumForce = triaxCompEng-&gt;ComputeUnbalancedForce(ncb);
 // 	Real equilibriumForce = sampleCapPressEng-&gt;ComputeUnbalancedForce(body);
 
 	if (Omega::instance().getCurrentIteration() % 100 == 0)

Modified: trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/ContactStressRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -48,7 +48,7 @@
 		ContactStressRecorder ();
 
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -37,12 +37,11 @@
 }
 
 
-void HydraulicForceEngine::applyCondition(Body* body)
+void HydraulicForceEngine::applyCondition(MetaBody* ncb)
 {
 
     if (isActivated)
     {
-        MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
         shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
         
 //cerr &lt;&lt; &quot;HFinverted &quot; &lt;&lt; HFinverted &lt;&lt; &quot; Omega::instance().getTimeStep() &quot; &lt;&lt; Omega::instance().getCurrentIteration() &lt;&lt; endl;

Modified: trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/HydraulicForceEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -27,7 +27,7 @@
 		HydraulicForceEngine();
 		virtual ~HydraulicForceEngine();
 	
-		virtual void applyCondition(Body*);
+		virtual void applyCondition(MetaBody*);
 	
 	protected :
 		virtual void registerAttributes();

Modified: trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -27,9 +27,8 @@
 }
 
 
-void MakeItFlat::applyCondition(Body* body)
+void MakeItFlat::applyCondition(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	
 	BodyContainer::iterator bi    = bodies-&gt;begin();

Modified: trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/MakeItFlat.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -22,7 +22,7 @@
 		MakeItFlat();
 		virtual ~MakeItFlat();
 	
-		virtual void applyCondition(Body*);
+		virtual void applyCondition(MetaBody*);
 	
 	protected :
 		virtual void registerAttributes();

Modified: trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -29,11 +29,8 @@
 	
 }
 
-void NewtonsDampedLaw::applyCondition ( Body * body )
+void NewtonsDampedLaw::applyCondition ( MetaBody * ncb )
 {
-
-
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt; ( body );
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	BodyContainer::iterator bi    = bodies-&gt;begin();
 	BodyContainer::iterator biEnd = bodies-&gt;end();

Modified: trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/NewtonsDampedLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -50,7 +50,7 @@
 		
 		
 	public :
-		virtual	void applyCondition(Body * body);		
+		virtual	void applyCondition(MetaBody *);		
 		NewtonsDampedLaw();
 	
 	protected :

Modified: trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -50,10 +50,9 @@
 
 
 
-void ResultantForceEngine::applyCondition(Body* body)
+void ResultantForceEngine::applyCondition(MetaBody* ncb)
 {
 	//cerr &lt;&lt; &quot;void ResultantForceEngine::applyCondition(Body* body)&quot; &lt;&lt; std::endl;
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	
 	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();

Modified: trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -46,7 +46,7 @@
 		ResultantForceEngine();
 		virtual ~ResultantForceEngine();
 	
-		virtual void applyCondition(Body*);
+		virtual void applyCondition(MetaBody*);
 		
 	
 	protected :

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -79,7 +79,7 @@
 	REGISTER_ATTRIBUTE(frictionAngleDegree);
 }
 
-void TriaxialCompressionEngine::doStateTransition(Body * body, stateNum nextState){
+void TriaxialCompressionEngine::doStateTransition(MetaBody * body, stateNum nextState){
 	if ( /* currentState==STATE_UNINITIALIZED &amp;&amp; */ nextState==STATE_ISO_COMPACTION){
 		sigma_iso=sigmaIsoCompaction;
 		previousSigmaIso=sigma_iso;
@@ -126,11 +126,10 @@
 		LOG_ERROR(&quot;Undefined transition from &quot;&lt;&lt;stateName(currentState)&lt;&lt;&quot; to &quot;&lt;&lt;stateName(nextState)&lt;&lt;&quot;! (ignored)&quot;);
 }
 
-void TriaxialCompressionEngine::updateParameters ( Body * body )
+void TriaxialCompressionEngine::updateParameters ( MetaBody * ncb )
 {
 
-	UnbalancedForce=ComputeUnbalancedForce ( body ); // calculated at every iteration
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt; ( body );
+	UnbalancedForce=ComputeUnbalancedForce ( ncb ); // calculated at every iteration
 
 
 	if ( currentState==STATE_ISO_COMPACTION || currentState==STATE_ISO_UNLOADING )
@@ -148,13 +147,13 @@
 		{
 			if ( currentState==STATE_ISO_COMPACTION &amp;&amp; autoCompressionActivation )
 			{
-				doStateTransition (body, STATE_ISO_UNLOADING ); /*update stress and strain here*/ computeStressStrain ( ncb );
+				doStateTransition (ncb, STATE_ISO_UNLOADING ); /*update stress and strain here*/ computeStressStrain ( ncb );
 			}
 			else if ( currentState==STATE_ISO_UNLOADING &amp;&amp; autoCompressionActivation )
 			{
-				doStateTransition (body, STATE_TRIAX_LOADING ); computeStressStrain ( ncb );
+				doStateTransition (ncb, STATE_TRIAX_LOADING ); computeStressStrain ( ncb );
 			}
-			else doStateTransition (body, STATE_LIMBO );
+			else doStateTransition (ncb, STATE_LIMBO );
 		}
 #if 0
 		//This is a hack in order to allow subsequent run without activating compression - like for the YADE-COMSOL coupling
@@ -179,15 +178,15 @@
 }
 
 
-void TriaxialCompressionEngine::applyCondition ( Body * body )
+void TriaxialCompressionEngine::applyCondition ( MetaBody * ncb )
 {
 	// here, we make sure to get consistent parameters, in case someone fiddled with the scene .xml manually
 	if ( firstRun )
 	{
 		LOG_INFO ( &quot;First run, will initialize!&quot; );
 		//sigma_iso was changed, we need to rerun compaction
-		if ( (sigmaIsoCompaction!=previousSigmaIso || currentState==STATE_UNINITIALIZED || currentState== STATE_LIMBO) &amp;&amp; currentState!=STATE_TRIAX_LOADING ) doStateTransition (body, STATE_ISO_COMPACTION );
-		if ( previousState==STATE_LIMBO &amp;&amp; currentState==STATE_TRIAX_LOADING ) doStateTransition (body, STATE_TRIAX_LOADING );
+		if ( (sigmaIsoCompaction!=previousSigmaIso || currentState==STATE_UNINITIALIZED || currentState== STATE_LIMBO) &amp;&amp; currentState!=STATE_TRIAX_LOADING ) doStateTransition (ncb, STATE_ISO_COMPACTION );
+		if ( previousState==STATE_LIMBO &amp;&amp; currentState==STATE_TRIAX_LOADING ) doStateTransition (ncb, STATE_TRIAX_LOADING );
 		previousState=currentState;
 		previousSigmaIso=sigma_iso;
 		firstRun=false; // change this only _after_ state transitions
@@ -210,11 +209,11 @@
 		return;
 	}
 
-	TriaxialStressController::applyCondition ( body );
+	TriaxialStressController::applyCondition ( ncb );
 
 	if ( Omega::instance().getCurrentIteration() % testEquilibriumInterval == 0 )
 	{
-		updateParameters ( body );
+		updateParameters ( ncb );
 		LOG_INFO(&quot;UnbalancedForce=&quot;&lt;&lt; UnbalancedForce);
 	}
 	
@@ -238,9 +237,8 @@
 	}
 }
 
-void TriaxialCompressionEngine::setContactProperties(Body * body, Real frictionDegree)
+void TriaxialCompressionEngine::setContactProperties(MetaBody * ncb, Real frictionDegree)
 {
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt; ( body );
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 			
 	BodyContainer::iterator bi = bodies-&gt;begin();

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -44,7 +44,7 @@
 		// should be &quot;enum stateNum {...}&quot; once this is fixed
 		enum {STATE_UNINITIALIZED, STATE_ISO_COMPACTION, STATE_ISO_UNLOADING, STATE_TRIAX_LOADING, STATE_LIMBO};
 		stateNum currentState;
-		void doStateTransition(Body *body, stateNum nextState);
+		void doStateTransition(MetaBody *body, stateNum nextState);
 		#define _STATE_CASE(ST) case ST: return #ST
 		string stateName(stateNum st){switch(st){ _STATE_CASE(STATE_UNINITIALIZED);_STATE_CASE(STATE_ISO_COMPACTION);_STATE_CASE(STATE_ISO_UNLOADING);_STATE_CASE(STATE_TRIAX_LOADING);_STATE_CASE(STATE_LIMBO); default: return &quot;&lt;unknown state&gt;&quot;; } }
 		#undef _STATE_CASE
@@ -80,11 +80,11 @@
 		//! Auto-switch between isotropic and uniaxial compression?
 		bool autoCompressionActivation;
 				
-		virtual void applyCondition(Body * body);
-		void updateParameters(Body * body);
+		virtual void applyCondition(MetaBody * ncb);
+		void updateParameters(MetaBody * ncb);
 		
 		///Change physical properties of interactions and/or bodies in the middle of a simulation (change only friction for the moment, complete this function to set cohesion and others before compression test)
-		void setContactProperties(Body * body, Real frictionAngle);
+		void setContactProperties(MetaBody * body, Real frictionAngle);
 
 
 		DECLARE_LOGGER;

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -62,10 +62,8 @@
 }
 
 
-void TriaxialStateRecorder::action ( Body * body )
+void TriaxialStateRecorder::action (MetaBody * ncb )
 {
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt; ( body );
-
 	if ( !triaxialCompressionEngine )
 	{
 		vector&lt;shared_ptr&lt;Engine&gt; &gt;::iterator itFirst = ncb-&gt;engines.begin();
@@ -123,7 +121,7 @@
 	&lt;&lt; lexical_cast&lt;string&gt; ( triaxialCompressionEngine-&gt;strain[0] ) &lt;&lt; &quot; &quot;
 	&lt;&lt; lexical_cast&lt;string&gt; ( triaxialCompressionEngine-&gt;strain[1] ) &lt;&lt; &quot; &quot;
 	&lt;&lt; lexical_cast&lt;string&gt; ( triaxialCompressionEngine-&gt;strain[2] ) &lt;&lt; &quot; &quot;
-	&lt;&lt; lexical_cast&lt;string&gt; ( triaxialCompressionEngine-&gt;ComputeUnbalancedForce ( body ) ) &lt;&lt; &quot; &quot;
+	&lt;&lt; lexical_cast&lt;string&gt; ( triaxialCompressionEngine-&gt;ComputeUnbalancedForce ( ncb ) ) &lt;&lt; &quot; &quot;
 	&lt;&lt; lexical_cast&lt;string&gt; ( porosity )
 	&lt;&lt; endl;
 }

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialStateRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -48,7 +48,7 @@
 		TriaxialStateRecorder ();
 
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 		DECLARE_LOGGER;
 

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -185,10 +185,9 @@
 
 
 
-void TriaxialStressController::applyCondition(Body* body)
+void TriaxialStressController::applyCondition(MetaBody* ncb)
 {
 	//cerr &lt;&lt; &quot;TriaxialStressController::applyCondition&quot; &lt;&lt; endl;
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 
 	//Update stiffness only if it has been computed by StiffnessCounter (see &quot;stiffnessUpdateInterval&quot;)
 	if (Omega::instance().getCurrentIteration() % stiffnessUpdateInterval == 0 || Omega::instance().getCurrentIteration()&lt;1000)
@@ -314,13 +313,12 @@
 /*!
     \fn TriaxialStressController::ComputeUnbalancedForce()
  */
-Real TriaxialStressController::ComputeUnbalancedForce(Body * body, bool maxUnbalanced)
+Real TriaxialStressController::ComputeUnbalancedForce(MetaBody * ncb, bool maxUnbalanced)
 {
 	//compute the mean contact force
 	Real MeanForce = 0.f;
 	long nForce = 0;
 
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 	InteractionContainer::iterator ii    = ncb-&gt;transientInteractions-&gt;begin();

Modified: trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -74,14 +74,14 @@
 		TriaxialStressController();
 		virtual ~TriaxialStressController();
 	
-		virtual void applyCondition(Body*);
+		virtual void applyCondition(MetaBody*);
 		//! Regulate the stress applied on walls with flag wall_XXX_activated = true
 		void controlExternalStress(int wall, MetaBody* ncb, Vector3r resultantForce, PhysicalParameters* p, Real wall_max_vel);
 		void controlInternalStress(MetaBody* ncb, Real multiplier);
 		void updateStiffness(MetaBody* ncb);
 		Real computeStressStrain(MetaBody* ncb); //Compute stresses on walls and store the values in &quot;Vector3r stress[6]&quot;, return mean stress
 		//! Compute the mean/max unbalanced force in the assembly (normalized by mean contact force)
-    		Real ComputeUnbalancedForce(Body * body, bool maxUnbalanced=false);
+    		Real ComputeUnbalancedForce(MetaBody * ncb, bool maxUnbalanced=false);
 
 		DECLARE_LOGGER;
 		

Modified: trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -70,9 +70,8 @@
 }
 
 
-void WallStressRecorder::action(Body * body)
+void WallStressRecorder::action(MetaBody * ncb)
 {
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 		
 	/// dimensions de l'echantillon

Modified: trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/DeusExMachina/WallStressRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -37,7 +37,7 @@
 		WallStressRecorder ();
 
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -49,9 +49,8 @@
 }
 
 
-void AveragePositionRecorder::action(Body * body)
+void AveragePositionRecorder::action(MetaBody * ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	
 	Real x=0, y=0, z=0, size=0;

Modified: trunk/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -19,7 +19,7 @@
 	public :
 		AveragePositionRecorder ();
 		
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 	
 		virtual void registerAttributes();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -83,14 +83,13 @@
 ;
 
 //FIXME : remove bool first !!!!!
-void CapillaryCohesiveLaw::action(Body* body)
+void CapillaryCohesiveLaw::action(MetaBody* ncb)
 {
 
 //compteur1 = 0;
 //compteur2 = 0;
         // 	cerr &lt;&lt; &quot;CapillaryCohesiveLaw::action&quot; &lt;&lt; endl;
 	//if (CapillaryPressure!=0) {
-        MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
         shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 

Modified: trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/CapillaryCohesiveLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -58,7 +58,7 @@
 		shared_ptr&lt;capillarylaw&gt; capillary;
 						
 		CapillaryCohesiveLaw();
-		void action(Body* body);
+		void action(MetaBody* ncb);
 
 	protected : 
 		void registerAttributes();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -64,9 +64,8 @@
 	std::cout &lt;&lt; &quot; axis: &quot; &lt;&lt;  axis[0] &lt;&lt; &quot; &quot; &lt;&lt; axis[1] &lt;&lt; &quot; &quot; &lt;&lt; axis[2] &lt;&lt; &quot;, length: &quot; &lt;&lt; axis.Length() &lt;&lt; &quot; | &quot;;
 }
 
-void CohesiveFrictionalContactLaw::action(Body* body)
+void CohesiveFrictionalContactLaw::action(MetaBody* ncb)
 {
-    MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
     shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
     Real dt = Omega::instance().getTimeStep();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/CohesiveFrictionalContactLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -31,7 +31,7 @@
 		long iter;/// used for checking if new iteration
 	
 		CohesiveFrictionalContactLaw();
-		void action(Body* body);
+		void action(MetaBody*);
 
 	protected :
 		void registerAttributes();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -40,9 +40,8 @@
 }
 
 
-void ElasticCohesiveLaw::action(Body* body)
+void ElasticCohesiveLaw::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 	Real dt = Omega::instance().getTimeStep();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -28,7 +28,7 @@
 		bool momentRotationLaw;
 		
 		ElasticCohesiveLaw();
-		void action(Body* body);
+		void action(MetaBody*);
 
 	protected : 
 		void registerAttributes();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -36,9 +36,8 @@
 }
 
 
-void ElasticContactLaw::action(Body* body)
+void ElasticContactLaw::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 	Real dt = Omega::instance().getTimeStep();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -30,7 +30,7 @@
 		bool momentRotationLaw;
 	
 		ElasticContactLaw();
-		void action(Body* body);
+		void action(MetaBody*);
 
 	protected :
 		void registerAttributes();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -107,9 +107,8 @@
 }
 
 
-void ElasticCriterionTimeStepper::computeTimeStep(Body* body)
+void ElasticCriterionTimeStepper::computeTimeStep(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	shared_ptr&lt;InteractionContainer&gt;&amp; persistentInteractions = ncb-&gt;persistentInteractions;
 	shared_ptr&lt;InteractionContainer&gt;&amp; transientInteractions = ncb-&gt;transientInteractions;

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -31,7 +31,7 @@
 		ElasticCriterionTimeStepper();
 		virtual ~ElasticCriterionTimeStepper();
 	
-		virtual void computeTimeStep(Body* body);
+		virtual void computeTimeStep(MetaBody* body);
 
 	protected :
 		virtual void registerAttributes();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -51,9 +51,8 @@
 }
 
 
-void ForceRecorder::action(Body * body)
+void ForceRecorder::action(MetaBody * ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	Real x=0, y=0, z=0;
 	
 	for( int i = startId ; i &lt;= endId ; ++i )

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ForceRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -33,7 +33,7 @@
 		ForceRecorder ();
 
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ForceSnapshot.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ForceSnapshot.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ForceSnapshot.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -64,7 +64,7 @@
 
 
 
-void ForceSnapshot::action(Body * body)
+void ForceSnapshot::action(MetaBody * ncb)
 {
 // 	copie de outputFile dans ce qui sera utilise pour le nom des fichiers resultats
 	nom_int=outputFile;
@@ -77,7 +77,6 @@
 	myfile &lt;&lt; &quot;Id(body1) Id(body2) Fn R1 x1 y1 z1 R2 x2 y2 z2  a l'it &quot; &lt;&lt; Omega::instance().getCurrentIteration() &lt;&lt; endl;
 // 	that is to say : the ids of the two interacting bodies, the norm of the normal force, and the radii and the position of the centers of the two spheres, and finally the number of the corresponding iteration
 
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	Vector3r pos(Vector3r::ZERO);	// which will be the position (of the center) of the considered body
 

Modified: trunk/pkg/dem/Engine/StandAloneEngine/ForceSnapshot.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/ForceSnapshot.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/ForceSnapshot.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -33,7 +33,7 @@
 		
 		ForceSnapshot ();
 		~ForceSnapshot ();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -28,11 +28,10 @@
 }
 
 
-void GeometricalModelForceColorizer::action(Body * body)
+void GeometricalModelForceColorizer::action(MetaBody * ncb)
 {
 	// FIXME the same in GLDrawLatticeBeamState.cpp
 
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	BodyContainer* bodies = ncb-&gt;bodies.get();
 	
 	Real min=10000,max=-10000;

Modified: trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -21,7 +21,7 @@
 	public :
 		GeometricalModelForceColorizer ();
 
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	REGISTER_CLASS_NAME(GeometricalModelForceColorizer);

Modified: trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -146,9 +146,8 @@
 	}
 }
 
-void GlobalStiffnessCounter::action(Body* body)
+void GlobalStiffnessCounter::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	// shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	//	Real dt = Omega::instance().getTimeStep();
 

Modified: trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -41,7 +41,7 @@
 		bool assumeElasticSpheres;
 	
 		GlobalStiffnessCounter();
-		void action(Body* body);
+		void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -130,10 +130,9 @@
 }
 
 
-void GlobalStiffnessTimeStepper::computeTimeStep(Body* body)
+void GlobalStiffnessTimeStepper::computeTimeStep(MetaBody* ncb)
 {
 
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 // 	shared_ptr&lt;InteractionContainer&gt;&amp; persistentInteractions = ncb-&gt;persistentInteractions;
 // 	shared_ptr&lt;InteractionContainer&gt;&amp; transientInteractions = ncb-&gt;transientInteractions;

Modified: trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -47,7 +47,7 @@
 		GlobalStiffnessTimeStepper();
 		virtual ~GlobalStiffnessTimeStepper();
 	
-		virtual void computeTimeStep(Body* body);
+		virtual void computeTimeStep(MetaBody*);
 		virtual bool isActivated();
 		DECLARE_LOGGER;
 

Modified: trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -29,9 +29,8 @@
 }
 
 
-void MyTetrahedronLaw::action(Body* body)
+void MyTetrahedronLaw::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 //	Real dt = Omega::instance().getTimeStep();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -45,7 +45,7 @@
 
 	public :
 		MyTetrahedronLaw();
-		void action(Body* body);
+		void action(MetaBody*);
 
 	protected :
 		void registerAttributes();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -44,9 +44,8 @@
 }
 
 
-void PositionOrientationRecorder::action(Body * body)
+void PositionOrientationRecorder::action(MetaBody * ncb)
 {
-	MetaBody* ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	if( Omega::instance().getCurrentIteration() % interval == 0 ){
 		ostringstream oss;
 		oss&lt;&lt;setfill('0')&lt;&lt;outputFile&lt;&lt;&quot;_&quot;&lt;&lt;setw(6)&lt;&lt;Omega::instance().getCurrentIteration();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -29,7 +29,7 @@
 	
 		PositionOrientationRecorder ();
 		~PositionOrientationRecorder ();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 
 	protected :
 		virtual void postProcessAttributes(bool deserializing);

Modified: trunk/pkg/dem/Engine/StandAloneEngine/PositionRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/PositionRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/PositionRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -53,9 +53,8 @@
 
 
 
-void PositionRecorder::action(Body * body)
+void PositionRecorder::action(MetaBody * ncb)
 {
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	Vector3r pos(Vector3r::ZERO);
 

Modified: trunk/pkg/dem/Engine/StandAloneEngine/PositionRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/PositionRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/PositionRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -25,7 +25,7 @@
 	
 		PositionRecorder ();
 		~PositionRecorder ();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/dem/Engine/StandAloneEngine/PositionSnapshot.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/PositionSnapshot.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/PositionSnapshot.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -60,7 +60,7 @@
 
 
 
-void PositionSnapshot::action(Body * body)
+void PositionSnapshot::action(MetaBody * ncb)
 {
 // 	copie de outputFile dans ce qui sera utilise pour le nom des fichiers resultats
 	nom_int=outputFile;
@@ -72,7 +72,6 @@
 	// first line of output file
 	myfile &lt;&lt; &quot;Id Rayon Xc Yc Zc   a l'it &quot; &lt;&lt; Omega::instance().getCurrentIteration() &lt;&lt; endl;
 
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	Vector3r pos(Vector3r::ZERO);	// which will be the position (of the center) of the considered body
 	body_id_t Id;			// its identity

Modified: trunk/pkg/dem/Engine/StandAloneEngine/PositionSnapshot.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/PositionSnapshot.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/PositionSnapshot.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -31,7 +31,7 @@
 		
 		PositionSnapshot ();
 		~PositionSnapshot ();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -44,9 +44,8 @@
    return ((Omega::instance().getCurrentIteration() % interval == 0));
 }
 
-void RigidBodyRecorder::action(Body * body)
+void RigidBodyRecorder::action(MetaBody * ncb)
 {
-    MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
     shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
     BodyContainer::iterator bi	    = bodies-&gt;begin();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/RigidBodyRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -27,7 +27,7 @@
     RigidBodyRecorder ();
     ~RigidBodyRecorder ();
 
-    virtual void action(Body* body);
+    virtual void action(MetaBody*);
       bool isActivated();
 
 protected :

Modified: trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -37,9 +37,8 @@
 }
 
 
-void SimpleViscoelasticContactLaw::action(Body* body)
+void SimpleViscoelasticContactLaw::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 	Real dt = Omega::instance().getTimeStep();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticContactLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -31,7 +31,7 @@
 		bool momentRotationLaw;
 	
 		SimpleViscoelasticContactLaw();
-		void action(Body* body);
+		void action(MetaBody*);
 
 	protected :
 		void registerAttributes();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -44,9 +44,8 @@
    return ((Omega::instance().getCurrentIteration() % interval == 0));
 }
 
-void SimpleViscoelasticSpheresInteractionRecorder::action(Body * body)
+void SimpleViscoelasticSpheresInteractionRecorder::action(MetaBody * ncb)
 {
-    MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
     shared_ptr&lt;InteractionContainer&gt;&amp; interactions = ncb-&gt;transientInteractions;
   
     InteractionContainer::iterator ii    = interactions-&gt;begin();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/SimpleViscoelasticSpheresInteractionRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -31,7 +31,7 @@
     SimpleViscoelasticSpheresInteractionRecorder();
     ~SimpleViscoelasticSpheresInteractionRecorder();
 
-    virtual void action(Body* body);
+    virtual void action(MetaBody*);
     bool isActivated();
 
 protected :

Modified: trunk/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -45,9 +45,8 @@
 }
 
 
-void VelocityRecorder::action(Body * body)
+void VelocityRecorder::action(MetaBody * ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 	
 	Real x=0, y=0, z=0, size=0;//, totalMass=0; FIXME- how many recorders/Actors to make simple stuff?

Modified: trunk/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -25,7 +25,7 @@
 		unsigned int interval;
 		VelocityRecorder ();
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 	
 	protected :

Modified: trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -45,9 +45,8 @@
 }
 
 
-void VolumicContactLaw::action(Body* body)
+void VolumicContactLaw::action(MetaBody* ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
 
 	Real dt = Omega::instance().getTimeStep();

Modified: trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp
===================================================================
--- trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/dem/Engine/StandAloneEngine/VolumicContactLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -30,7 +30,7 @@
 		bool momentRotationLaw;
 	
 		VolumicContactLaw();
-		void action(Body* body);
+		void action(MetaBody*);
 
 	protected :
 		void registerAttributes();

Modified: trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.cpp
===================================================================
--- trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -39,9 +39,8 @@
 }
 
 
-void FEMLaw::action(Body* body)
+void FEMLaw::action(MetaBody* fem)
 {
-	MetaBody * fem = static_cast&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = fem-&gt;bodies;
 	shared_ptr&lt;PhysicalActionContainer&gt;&amp; physicalActions = fem-&gt;physicalActions;
 	

Modified: trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.hpp
===================================================================
--- trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/fem/Engine/StandAloneEngine/FEMLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -26,7 +26,7 @@
 		virtual ~FEMLaw();
 
 /// Methods
-		void action(Body* body);
+		void action(MetaBody*);
 
 /// Serializtion
 	protected :

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.cpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -110,12 +110,11 @@
 }
 
 
-void BeamRecorder::action(Body * body)
+void BeamRecorder::action(MetaBody * ncb)
 {
 //	std::cerr &lt;&lt; &quot;BeamRecorder quits\n&quot;;
 //	return;
 	
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 
 	if(first)
 	{

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -39,7 +39,7 @@
 		BeamRecorder ();
 
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -91,11 +91,10 @@
 
 }
 
-void LatticeLaw::action(Body* body)
+void LatticeLaw::action(MetaBody* lattice)
 {
 	futureDeletes.clear();
 
-	MetaBody * lattice = static_cast&lt;MetaBody*&gt;(body);
 
 	int nodeGroupMask  = static_cast&lt;LatticeSetParameters*&gt;(lattice-&gt;physicalParameters.get())-&gt;nodeGroupMask;
 	int beamGroupMask  = static_cast&lt;LatticeSetParameters*&gt;(lattice-&gt;physicalParameters.get())-&gt;beamGroupMask;

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -30,7 +30,7 @@
 		bool roughEdges,ensure2D,calcTorsion; // FIXME, FIXME, FIXME 
 		LatticeLaw();
 		virtual ~LatticeLaw();
-		void action(Body* body);
+		void action(MetaBody*);
 		void registerAttributes()
 		{
 			REGISTER_ATTRIBUTE(roughEdges);

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.cpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -58,7 +58,7 @@
 }
 
 
-void MeasurePoisson::action(Body * body)
+void MeasurePoisson::action(MetaBody * ncb)
 {
 
 
@@ -69,7 +69,6 @@
 		std::cerr &lt;&lt; &quot;bad nodes!\n&quot;;
 		return;
 	}
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 
 	LatticeNodeParameters* node_left   = YADE_CAST&lt;LatticeNodeParameters*&gt;( (*(ncb-&gt;bodies))[left  ]-&gt;physicalParameters . get() );
 	(*(ncb-&gt;bodies))[left  ]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(1.0,1.0,0.0); // FIXME [1]

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -31,7 +31,7 @@
 		MeasurePoisson ();
 
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.cpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -85,14 +85,13 @@
 }
 
 
-void MovingSupport::action(Body * body)
+void MovingSupport::action(MetaBody * ncb)
 	// FIXME: about &quot;bool first&quot;:
 	// FIXME: maybe it could be added to initialiers, and called with a bool argument saying that the initialisation is performed. 
 {
 //	std::cerr &lt;&lt; &quot;MovingSupport quits\n&quot;;
 //	return;
 	
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 
 	if(first)
 	{

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/MovingSupport.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -40,7 +40,7 @@
 		MovingSupport ();
 
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.cpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -90,12 +90,11 @@
 }
 
 
-void NodeRecorder::action(Body * body)
+void NodeRecorder::action(MetaBody * ncb)
 {
 //	std::cerr &lt;&lt; &quot;NodeRecorder quits\n&quot;;
 //	return;
 	
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 
 	if(first)
 	{

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -37,7 +37,7 @@
 		NodeRecorder ();
 
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.cpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -128,11 +128,10 @@
 	} 
 }
 
-void NonLocalInitializer::action(Body * body)
+void NonLocalInitializer::action(MetaBody * rootBody)
 {
 	return; // YADEview
 
-	MetaBody * rootBody = static_cast&lt;MetaBody*&gt;(body);
 	int beamGroupMask = YADE_CAST&lt;LatticeSetParameters*&gt;(rootBody-&gt;physicalParameters.get())-&gt;beamGroupMask;
 	//std::list&lt;std::list&lt;LatticeSetParameters::NonLocalInteraction&gt; &gt;
 	//std::vector&lt;std::list&lt;LatticeSetParameters::NonLocalInteraction , std::__malloc_alloc_template&lt;sizeof(LatticeSetParameters::NonLocalInteraction)&gt; &gt; &gt;&amp; nonl = dynamic_cast&lt;LatticeSetParameters*&gt;(rootBody-&gt;physicalParameters.get())-&gt;nonl;

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -28,7 +28,7 @@
 		
 		NonLocalInitializer ();
 		virtual ~NonLocalInitializer ();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 
 	protected :
 		virtual void registerAttributes();

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.cpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -51,12 +51,11 @@
 }
 
 
-void StrainRecorder::action(Body * body)
+void StrainRecorder::action(MetaBody * ncb)
 {
 //	std::cerr &lt;&lt; &quot;StrainRecorder quits\n&quot;;
 //	return;
 	
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
 	Real strain_y=0,stress_y=0,stress_s=0;//,stress_nonlocal_y=0;
 	
 	std::vector&lt;unsigned int&gt;::iterator i   = subscribedBodies.begin();

Modified: trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.hpp
===================================================================
--- trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -31,7 +31,7 @@
 		StrainRecorder ();
 
 		virtual void registerAttributes();
-		virtual void action(Body* b);
+		virtual void action(MetaBody*);
 		virtual bool isActivated();
 
 	protected :

Modified: trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.cpp
===================================================================
--- trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -30,9 +30,8 @@
 }
 
 
-void MassSpringLaw::action(Body * body)
+void MassSpringLaw::action(MetaBody * massSpring)
 {
-	MetaBody * massSpring = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = massSpring-&gt;bodies;
 	shared_ptr&lt;InteractionContainer&gt;&amp; persistentInteractions = massSpring-&gt;persistentInteractions;
 	shared_ptr&lt;PhysicalActionContainer&gt;&amp; physicalActions = massSpring-&gt;physicalActions;

Modified: trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.hpp
===================================================================
--- trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -21,7 +21,7 @@
 	public :
 		int springGroupMask;
 		MassSpringLaw ();
-		void action(Body* body);
+		void action(MetaBody*);
 
 	protected :
 		void registerAttributes();

Modified: trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.cpp
===================================================================
--- trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.cpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.cpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -34,9 +34,8 @@
 }
 
 
-void FrictionLessElasticContactLaw::action(Body * body)
+void FrictionLessElasticContactLaw::action(MetaBody * ncb)
 {
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
 	shared_ptr&lt;BodyContainer&gt; bodies = ncb-&gt;bodies;
 
 	Real stiffness = 10000;

Modified: trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.hpp
===================================================================
--- trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.hpp	2008-04-18 15:58:17 UTC (rev 1328)
+++ trunk/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.hpp	2008-04-28 21:52:11 UTC (rev 1329)
@@ -21,7 +21,7 @@
 
 	public :
 		FrictionLessElasticContactLaw ();
-		void action(Body* body);
+		void action(MetaBody*);
 
 	protected :
 		 void registerAttributes();


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000290.html">[Yade-commits] r1328 - in trunk/pkg/dem: .	DataClass/InteractionPhysics Engine/StandAloneEngine PreProcessor
</A></li>
	<LI>Next message: <A HREF="000292.html">[Yade-commits] r1330 - in trunk: . core gui gui/cmd gui/qt3 lib	lib/factory lib/serialization lib/serialization-bin	lib/serialization-xml scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#291">[ date ]</a>
              <a href="thread.html#291">[ thread ]</a>
              <a href="subject.html#291">[ subject ]</a>
              <a href="author.html#291">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/yade-commits">More information about the Yade-commits
mailing list</a><br>
</body></html>
