<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Yade-commits] r1445 - in trunk: extra extra/tetra gui/qt3 lib/serialization-qt pkg/common/RenderingEngine/GLDrawBoundingVolume pkg/common/RenderingEngine/GLDrawGeometricalModel pkg/common/RenderingEngine/GLDrawInteractingGeometry pkg/common/RenderingEngine/GLDrawInteractionGeometry pkg/common/RenderingEngine/GLDrawInteractionPhysics pkg/common/RenderingEngine/GLDrawShadowVolume pkg/common/RenderingEngine/GLDrawState pkg/common/RenderingEngine/OpenGLRenderingEngine pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction pkg/dem/RenderingEngine/GLDrawElasticContactInteraction pkg/dem/RenderingEngine/GLDrawInteractingMyTetrahedron pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry pkg/lattice/RenderingEngine/GLDrawLatticeBeamState pkg/lattice/RenderingEngine/GLDrawLatticeInteractingGeometry pkg/lattice/RenderingEngine/GLDrawLatticeSetGeometry pkg/lattice/RenderingE! ngine/GLDrawLineSegment
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/yade-commits/2008/index.html" >
   <LINK REL="made" HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1445%20-%20in%20trunk%3A%20extra%20extra/tetra%20gui/qt3%0A%20lib/serialization-qt%20pkg/common/RenderingEngine/GLDrawBoundingVolume%0A%20pkg/common/RenderingEngine/GLDrawGeometricalModel%0A%20pkg/common/RenderingEngine/GLDrawInteractingGeometry%0A%20pkg/common/RenderingEngine/GLDrawInteractionGeometry%0A%20pkg/common/RenderingEngine/GLDrawInteractionPhysics%0A%20pkg/common/RenderingEngine/GLDrawShadowVolume%0A%20pkg/common/RenderingEngine/GLDrawState%0A%20pkg/common/RenderingEngine/OpenGLRenderingEngine%0A%20pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction%0A%20pkg/dem/RenderingEngine/GLDrawElasticContactInteraction%0A%20pkg/dem/RenderingEngine/GLDrawInteractingMyTetrahedron%0A%20pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry%0A%20pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction%0A%20pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry%0A%20pkg/lattice/RenderingEngine/GLDrawLatticeBeamState%0A%20pkg/lattice/RenderingEngine/GLDrawLatticeInteractingGeometry%0A%20pkg/lattice/RenderingEngine/GLDrawLatticeSetGeometry%0A%20pkg/lattice/RenderingE%21%20ngine/GLDrawLineSegment&In-Reply-To=%3C200807241016.m6OAGsYA012825%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000404.html">
   <LINK REL="Next"  HREF="000406.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Yade-commits] r1445 - in trunk: extra extra/tetra gui/qt3 lib/serialization-qt pkg/common/RenderingEngine/GLDrawBoundingVolume pkg/common/RenderingEngine/GLDrawGeometricalModel pkg/common/RenderingEngine/GLDrawInteractingGeometry pkg/common/RenderingEngine/GLDrawInteractionGeometry pkg/common/RenderingEngine/GLDrawInteractionPhysics pkg/common/RenderingEngine/GLDrawShadowVolume pkg/common/RenderingEngine/GLDrawState pkg/common/RenderingEngine/OpenGLRenderingEngine pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction pkg/dem/RenderingEngine/GLDrawElasticContactInteraction pkg/dem/RenderingEngine/GLDrawInteractingMyTetrahedron pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry pkg/lattice/RenderingEngine/GLDrawLatticeBeamState pkg/lattice/RenderingEngine/GLDrawLatticeInteractingGeometry pkg/lattice/RenderingEngine/GLDrawLatticeSetGeometry pkg/lattice/RenderingE! ngine/GLDrawLineSegment</H1>
    <B>eudoxos at BerliOS</B> 
    <A HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1445%20-%20in%20trunk%3A%20extra%20extra/tetra%20gui/qt3%0A%20lib/serialization-qt%20pkg/common/RenderingEngine/GLDrawBoundingVolume%0A%20pkg/common/RenderingEngine/GLDrawGeometricalModel%0A%20pkg/common/RenderingEngine/GLDrawInteractingGeometry%0A%20pkg/common/RenderingEngine/GLDrawInteractionGeometry%0A%20pkg/common/RenderingEngine/GLDrawInteractionPhysics%0A%20pkg/common/RenderingEngine/GLDrawShadowVolume%0A%20pkg/common/RenderingEngine/GLDrawState%0A%20pkg/common/RenderingEngine/OpenGLRenderingEngine%0A%20pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction%0A%20pkg/dem/RenderingEngine/GLDrawElasticContactInteraction%0A%20pkg/dem/RenderingEngine/GLDrawInteractingMyTetrahedron%0A%20pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry%0A%20pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction%0A%20pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry%0A%20pkg/lattice/RenderingEngine/GLDrawLatticeBeamState%0A%20pkg/lattice/RenderingEngine/GLDrawLatticeInteractingGeometry%0A%20pkg/lattice/RenderingEngine/GLDrawLatticeSetGeometry%0A%20pkg/lattice/RenderingE%21%20ngine/GLDrawLineSegment&In-Reply-To=%3C200807241016.m6OAGsYA012825%40sheep.berlios.de%3E"
       TITLE="[Yade-commits] r1445 - in trunk: extra extra/tetra gui/qt3 lib/serialization-qt pkg/common/RenderingEngine/GLDrawBoundingVolume pkg/common/RenderingEngine/GLDrawGeometricalModel pkg/common/RenderingEngine/GLDrawInteractingGeometry pkg/common/RenderingEngine/GLDrawInteractionGeometry pkg/common/RenderingEngine/GLDrawInteractionPhysics pkg/common/RenderingEngine/GLDrawShadowVolume pkg/common/RenderingEngine/GLDrawState pkg/common/RenderingEngine/OpenGLRenderingEngine pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction pkg/dem/RenderingEngine/GLDrawElasticContactInteraction pkg/dem/RenderingEngine/GLDrawInteractingMyTetrahedron pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry pkg/lattice/RenderingEngine/GLDrawLatticeBeamState pkg/lattice/RenderingEngine/GLDrawLatticeInteractingGeometry pkg/lattice/RenderingEngine/GLDrawLatticeSetGeometry pkg/lattice/RenderingE! ngine/GLDrawLineSegment">eudoxos at mail.berlios.de
       </A><BR>
    <I>Thu Jul 24 12:16:54 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000404.html">[Yade-commits] r1444 - in trunk: core extra gui/qt3	pkg/common/RenderingEngine/OpenGLRenderingEngine	pkg/dem/Engine/DeusExMachina
</A></li>
        <LI>Next message: <A HREF="000406.html">[Yade-commits] r1446 - branches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#405">[ date ]</a>
              <a href="thread.html#405">[ thread ]</a>
              <a href="subject.html#405">[ subject ]</a>
              <a href="author.html#405">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: eudoxos
Date: 2008-07-24 12:16:51 +0200 (Thu, 24 Jul 2008)
New Revision: 1445

Added:
   trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawFunctors.hpp
Removed:
   trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawBoundingVolumeFunctor.hpp
   trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawGeometricalModelFunctor.hpp
   trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractingGeometryFunctor.hpp
   trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractionGeometryFunctor.hpp
   trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractionPhysicsFunctor.hpp
   trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawShadowVolumeFunctor.hpp
   trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawStateFunctor.hpp
Modified:
   trunk/extra/Brefcom.hpp
   trunk/extra/tetra/Tetra.hpp
   trunk/gui/qt3/SimulationController.cpp
   trunk/gui/qt3/YadeQtMainWindow.cpp
   trunk/lib/serialization-qt/QtGUIGenerator.cpp
   trunk/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB.hpp
   trunk/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere.hpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox.hpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawFacet.hpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawGeometricalEdge.hpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D.hpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral.hpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.hpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron.hpp
   trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawVertex.hpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox.hpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingEdge.hpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingFacet.hpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.hpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingVertex.hpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry.hpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures.hpp
   trunk/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction.hpp
   trunk/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume.hpp
   trunk/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume.hpp
   trunk/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState.hpp
   trunk/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState.hpp
   trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp
   trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp
   trunk/pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction/GLDrawCohesiveFrictionalContactInteraction.hpp
   trunk/pkg/dem/RenderingEngine/GLDrawElasticContactInteraction/GLDrawElasticContactInteraction.hpp
   trunk/pkg/dem/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.hpp
   trunk/pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.hpp
   trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.hpp
   trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.hpp
   trunk/pkg/lattice/RenderingEngine/GLDrawLatticeBeamState/GLDrawLatticeBeamState.hpp
   trunk/pkg/lattice/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.hpp
   trunk/pkg/lattice/RenderingEngine/GLDrawLatticeSetGeometry/GLDrawLatticeSetGeometry.hpp
   trunk/pkg/lattice/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.hpp
Log:
1. Cleanups in OpenGLRenderingEngine, use systematically clipping and scaling
2. Merge GL functor abstract class headers in one (GLDrawFunctors.hpp) and fix files using them
3. Make qt-serialization layout a bit more space-conservative.



Modified: trunk/extra/Brefcom.hpp
===================================================================
--- trunk/extra/Brefcom.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/extra/Brefcom.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #include&lt;yade/pkg-common/Momentum.hpp&gt;
 #include&lt;yade/pkg-common/InteractionPhysicsEngineUnit.hpp&gt;
 #include&lt;yade/pkg-dem/SpheresContactGeometry.hpp&gt;
-#include&lt;yade/pkg-common/GLDrawInteractionPhysicsFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 #include&lt;yade/pkg-common/PeriodicEngines.hpp&gt;
 #include&lt;yade/pkg-dem/GlobalStiffness.hpp&gt;
 

Modified: trunk/extra/tetra/Tetra.hpp
===================================================================
--- trunk/extra/tetra/Tetra.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/extra/tetra/Tetra.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -14,7 +14,7 @@
 #include&lt;yade/pkg-common/AABB.hpp&gt;
 #include&lt;yade/pkg-common/BoundingVolumeEngineUnit.hpp&gt;
 #include&lt;yade/pkg-common/InteractingGeometryEngineUnit.hpp&gt;
-#include&lt;yade/pkg-common/GLDrawInteractingGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 #include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
 
 #include&lt;yade/pkg-common/Force.hpp&gt;

Modified: trunk/gui/qt3/SimulationController.cpp
===================================================================
--- trunk/gui/qt3/SimulationController.cpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/gui/qt3/SimulationController.cpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -57,7 +57,7 @@
 	scrollView = new QScrollView( scrollViewOutsideFrame, &quot;scrollView&quot; );
 	scrollView-&gt;setVScrollBarMode(QScrollView::Auto);
 	scrollView-&gt;setHScrollBarMode(QScrollView::Auto);
-	scrollViewLayout-&gt;addWidget( scrollView );
+	scrollViewLayout-&gt;addWidget(scrollView);
 	scrollView-&gt;show();
 
 	YadeQtMainWindow::self-&gt;ensureRenderer(); /* create renderer if none, load its config */

Modified: trunk/gui/qt3/YadeQtMainWindow.cpp
===================================================================
--- trunk/gui/qt3/YadeQtMainWindow.cpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/gui/qt3/YadeQtMainWindow.cpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -118,6 +118,7 @@
 		LOG_DEBUG(&quot;Creating OpenGLRenderingEngine instance.&quot;);
 		shared_ptr&lt;Factorable&gt; tmpRenderer=ClassFactory::instance().createShared(&quot;OpenGLRenderingEngine&quot;);
 		renderer=static_pointer_cast&lt;OpenGLRenderingEngine&gt;(tmpRenderer);
+		renderer-&gt;init();
 	}
 
 	if(!renderer) throw runtime_error(&quot;Renderer could not be created, why?&quot;);

Modified: trunk/lib/serialization-qt/QtGUIGenerator.cpp
===================================================================
--- trunk/lib/serialization-qt/QtGUIGenerator.cpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/lib/serialization-qt/QtGUIGenerator.cpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -126,7 +126,7 @@
 			IOFormatManager::parseFundamental(stream.str(), descriptor-&gt;strings);
 				
 			descriptor-&gt;label = new QLabel( widget);
-			descriptor-&gt;label-&gt;setText(descriptor-&gt;name+&quot; : &quot;);
+			descriptor-&gt;label-&gt;setText(descriptor-&gt;name); // was: +&quot; : &quot;
 			
 			unsigned int nbStrings = descriptor-&gt;strings.size();
 			for(unsigned int i=0;i&lt;nbStrings;i++)

Modified: trunk/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWAABB_HPP
 #define GLDRAWAABB_HPP
 
-#include&lt;yade/pkg-common/GLDrawBoundingVolumeFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawAABB : public GLDrawBoundingVolumeFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWBOUNDINGSPHERE_HPP
 #define GLDRAWBOUNDINGSPHERE_HPP
 
-#include&lt;yade/pkg-common/GLDrawBoundingVolumeFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawBoundingSphere : public GLDrawBoundingVolumeFunctor
 {	

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWBOX_HPP
 #define GLDRAWBOX_HPP
 
-#include&lt;yade/pkg-common/GLDrawGeometricalModelFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawBox : public GLDrawGeometricalModelFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawFacet.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawFacet.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawFacet.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWFACET_HPP
 #define GLDRAWFACET_HPP
 
-#include&lt;yade/pkg-common/GLDrawGeometricalModelFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawFacet : public GLDrawGeometricalModelFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawGeometricalEdge.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawGeometricalEdge.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawGeometricalEdge.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -8,7 +8,7 @@
 #ifndef GLDRAWGEOMETRICALEDGE_HPP
 #define GLDRAWGEOMETRICALEDGE_HPP
 
-#include&lt;yade/pkg-common/GLDrawGeometricalModelFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawGeometricalEdge : public GLDrawGeometricalModelFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWMESH2D_HPP
 #define GLDRAWMESH2D_HPP
 
-#include&lt;yade/pkg-common/GLDrawGeometricalModelFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawMesh2D : public GLDrawGeometricalModelFunctor
 {	

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_QUADRILATERAL_HPP
 #define GLDRAW_QUADRILATERAL_HPP
 
-#include&lt;yade/pkg-common/GLDrawGeometricalModelFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawQuadrilateral : public GLDrawGeometricalModelFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWSPHERE_HPP
 #define GLDRAWSPHERE_HPP
 
-#include&lt;yade/pkg-common/GLDrawGeometricalModelFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawSphere : public GLDrawGeometricalModelFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_TETRAHEDRON_HPP
 #define GLDRAW_TETRAHEDRON_HPP 
 
-#include&lt;yade/pkg-common/GLDrawGeometricalModelFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawTetrahedron : public GLDrawGeometricalModelFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawVertex.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawVertex.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawVertex.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWVERTEX_HPP
 #define GLDRAWVERTEX_HPP
 
-#include&lt;yade/pkg-common/GLDrawGeometricalModelFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawVertex : public GLDrawGeometricalModelFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWINTERACTIONBOX_HPP
 #define GLDRAWINTERACTIONBOX_HPP
 
-#include&lt;yade/pkg-common/GLDrawInteractingGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawInteractingBox : public GLDrawInteractingGeometryFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingEdge.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingEdge.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingEdge.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef __GLDRAWINTERACTINGEDGE_HPP__
 #define __GLDRAWINTERACTINGEDGE_HPP__
 
-#include&lt;yade/pkg-common/GLDrawInteractingGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawInteractingEdge : public GLDrawInteractingGeometryFunctor
 {	

Modified: trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingFacet.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingFacet.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingFacet.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef __GLDRAWINTERACTINGFACET_HPP__
 #define __GLDRAWINTERACTINGFACET_HPP__
 
-#include&lt;yade/pkg-common/GLDrawInteractingGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawInteractingFacet : public GLDrawInteractingGeometryFunctor
 {	

Modified: trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef __GLDRAWINTERACTIONSPHERE_HPP__
 #define __GLDRAWINTERACTIONSPHERE_HPP__
 
-#include&lt;yade/pkg-common/GLDrawInteractingGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawInteractingSphere : public GLDrawInteractingGeometryFunctor
 {	

Modified: trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingVertex.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingVertex.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingVertex.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef __GLDRAWINTERACTINGVERTEX_HPP__
 #define __GLDRAWINTERACTINGVERTEX_HPP__
 
-#include&lt;yade/pkg-common/GLDrawInteractingGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawInteractingVertex : public GLDrawInteractingGeometryFunctor
 {	

Modified: trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWCOLLISIONGEOMETRYSET_HPP
 #define GLDRAWCOLLISIONGEOMETRYSET_HPP
 
-#include&lt;yade/pkg-common/GLDrawInteractingGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawMetaInteractingGeometry : public GLDrawInteractingGeometryFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_CLOSEST_FEATURES_HPP
 #define GLDRAW_CLOSEST_FEATURES_HPP
 
-#include&lt;yade/pkg-common/GLDrawInteractionGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawClosestFeatures : public GLDrawInteractionGeometryFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_SIMPLE_ELASTIC_INTERACTION_HPP
 #define GLDRAW_SIMPLE_ELASTIC_INTERACTION_HPP
 
-#include&lt;yade/pkg-common/GLDrawInteractionPhysicsFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawSimpleElasticInteraction : public GLDrawInteractionPhysicsFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWBOXSHADOWVOLUME_HPP
 #define GLDRAWBOXSHADOWVOLUME_HPP
 
-#include&lt;yade/pkg-common/GLDrawShadowVolumeFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawBoxShadowVolume : public GLDrawShadowVolumeFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWSPHERESHADOWVOLUME_HPP
 #define GLDRAWSPHERESHADOWVOLUME_HPP
 
-#include&lt;yade/pkg-common/GLDrawShadowVolumeFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawSphereShadowVolume : public GLDrawShadowVolumeFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWPARTICLESTATE_HPP
 #define GLDRAWPARTICLESTATE_HPP
 
-#include&lt;yade/pkg-common/GLDrawStateFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawParticleState : public GLDrawStateFunctor
 {

Modified: trunk/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAWRIGIDBODYSTATE_HPP
 #define GLDRAWRIGIDBODYSTATE_HPP
 
-#include&lt;yade/pkg-common/GLDrawStateFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawRigidBodyState : public GLDrawStateFunctor
 {

Deleted: trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawBoundingVolumeFunctor.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawBoundingVolumeFunctor.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawBoundingVolumeFunctor.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -1,36 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWBOUNDINGVOLUMEFUNCTOR_HPP
-#define GLDRAWBOUNDINGVOLUMEFUNCTOR_HPP
-
-#include&lt;yade/lib-multimethods/FunctorWrapper.hpp&gt;
-#include&lt;yade/core/BoundingVolume.hpp&gt;
-#include&lt;yade/core/EngineUnit1D.hpp&gt;
-
-#define RENDERS(name) 							\
-	public : virtual string renders() const { return #name; };
-
-class GLDrawBoundingVolumeFunctor : 	public EngineUnit1D
-					&lt;
-		 				void ,
-		 				TYPELIST_1(const shared_ptr&lt;BoundingVolume&gt;&amp;) 
-					&gt;
-{
-	public :
-		virtual ~GLDrawBoundingVolumeFunctor() {};
-		virtual string renders() const { std::cerr &lt;&lt; &quot;unregistered gldraw class.\n&quot;; throw; }; // FIXME - replace that with a nice exception
-
-	REGISTER_CLASS_NAME(GLDrawBoundingVolumeFunctor);
-	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
-};
-
-REGISTER_SERIALIZABLE(GLDrawBoundingVolumeFunctor,false);
-
-#endif //  GLDRAWBOUNDINGVOLUMEFUNCTOR_HPP
-

Added: trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawFunctors.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawFunctors.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawFunctors.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -0,0 +1,81 @@
+// &#169; 2004 Olivier Galizzi &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>&gt;
+// &#169; 2006 Janek Kozicki &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>&gt;
+
+#pragma once
+
+#include&lt;yade/lib-multimethods/FunctorWrapper.hpp&gt;
+#include&lt;yade/core/BoundingVolume.hpp&gt;
+#include&lt;yade/core/PhysicalParameters.hpp&gt;
+#include&lt;yade/core/GeometricalModel.hpp&gt;
+#include&lt;yade/core/InteractingGeometry.hpp&gt;
+#include&lt;yade/core/EngineUnit1D.hpp&gt;
+#include&lt;yade/core/InteractionGeometry.hpp&gt;
+#include&lt;yade/core/Body.hpp&gt;
+#include&lt;yade/core/InteractionPhysics.hpp&gt;
+#include&lt;yade/core/GeometricalModel.hpp&gt;
+
+#define RENDERS(name) public: virtual string renders() const { return #name;};
+
+class GLDrawBoundingVolumeFunctor: public EngineUnit1D&lt;void, TYPELIST_1(const shared_ptr&lt;BoundingVolume&gt;&amp;)&gt; {
+	public:
+		virtual ~GLDrawBoundingVolumeFunctor() {};
+		virtual string renders() const { std::cerr&lt;&lt;&quot;Unregistered gldraw class.\n&quot;; throw; };
+	REGISTER_CLASS_NAME(GLDrawBoundingVolumeFunctor);
+	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
+};
+REGISTER_SERIALIZABLE(GLDrawBoundingVolumeFunctor,false);
+
+class GLDrawGeometricalModelFunctor: public EngineUnit1D&lt;void,TYPELIST_3(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool)&gt;{
+	public: 
+		virtual ~GLDrawGeometricalModelFunctor() {};
+		virtual string renders() const { std::cerr&lt;&lt;&quot;Unregistered gldraw class.\n&quot;; throw; };
+	REGISTER_CLASS_NAME(GLDrawGeometricalModelFunctor);
+	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
+};
+REGISTER_SERIALIZABLE(GLDrawGeometricalModelFunctor,false);
+
+
+class GLDrawInteractingGeometryFunctor: public EngineUnit1D&lt;void, TYPELIST_3(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool)&gt;{
+	public:
+		virtual ~GLDrawInteractingGeometryFunctor() {};
+		virtual string renders() const { std::cerr&lt;&lt;&quot;Unregistered gldraw class.\n&quot;; throw; };
+	REGISTER_CLASS_NAME(GLDrawInteractingGeometryFunctor);
+	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
+};
+REGISTER_SERIALIZABLE(GLDrawInteractingGeometryFunctor,false);
+
+class GLDrawInteractionGeometryFunctor: public EngineUnit1D&lt;void,TYPELIST_5(const shared_ptr&lt;InteractionGeometry&gt;&amp;, const shared_ptr&lt;Interaction&gt;&amp;, const shared_ptr&lt;Body&gt;&amp;, const shared_ptr&lt;Body&gt;&amp;, bool)&gt;{
+	public: 
+		virtual ~GLDrawInteractionGeometryFunctor() {};
+		virtual string renders() const { std::cerr&lt;&lt;&quot;Unregistered gldraw class.\n&quot;; throw; };
+	REGISTER_CLASS_NAME(GLDrawInteractionGeometryFunctor);
+	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
+};
+REGISTER_SERIALIZABLE(GLDrawInteractionGeometryFunctor,false);
+
+class GLDrawInteractionPhysicsFunctor: public EngineUnit1D&lt;void, TYPELIST_5(const shared_ptr&lt;InteractionPhysics&gt;&amp;, const shared_ptr&lt;Interaction&gt;&amp;, const shared_ptr&lt;Body&gt;&amp;, const shared_ptr&lt;Body&gt;&amp;, bool)&gt;{
+	public: 
+		virtual ~GLDrawInteractionPhysicsFunctor() {};
+		virtual string renders() const { std::cerr&lt;&lt;&quot;Unregistered gldraw class.\n&quot;; throw; };
+	REGISTER_CLASS_NAME(GLDrawInteractionPhysicsFunctor);
+	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
+};
+REGISTER_SERIALIZABLE(GLDrawInteractionPhysicsFunctor,false);
+
+class GLDrawShadowVolumeFunctor: public EngineUnit1D&lt;void, TYPELIST_3(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Vector3r&amp;)&gt;{
+	public:
+		virtual string renders() const { std::cerr&lt;&lt;&quot;Unregistered gldraw class.\n&quot;; throw; };
+	REGISTER_CLASS_NAME(GLDrawShadowVolumeFunctor);
+	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
+};
+REGISTER_SERIALIZABLE(GLDrawShadowVolumeFunctor,false);
+
+class GLDrawStateFunctor: public EngineUnit1D&lt;void,TYPELIST_1(const shared_ptr&lt;PhysicalParameters&gt;&amp;/*, draw parameters: color, scale, given from OpenGLRenderer, or sth.... */)&gt;{
+	public : 
+		virtual ~GLDrawStateFunctor() {};
+		virtual string renders() const { std::cerr&lt;&lt;&quot;Unregistered gldraw class.\n&quot;; throw; };
+	REGISTER_CLASS_NAME(GLDrawStateFunctor);
+	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
+};
+REGISTER_SERIALIZABLE(GLDrawStateFunctor,false);
+

Deleted: trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawGeometricalModelFunctor.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawGeometricalModelFunctor.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawGeometricalModelFunctor.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -1,39 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWGEOMETRICALMODELFUNCTOR_HPP
-#define GLDRAWGEOMETRICALMODELFUNCTOR_HPP
-
-#include&lt;yade/core/EngineUnit1D.hpp&gt;
-#include&lt;yade/lib-multimethods/FunctorWrapper.hpp&gt;
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-
-
-#define RENDERS(name) 							\
-	public : virtual string renders() const { return #name; };
-
-class GLDrawGeometricalModelFunctor : 	public EngineUnit1D
-					&lt;
-		 				void ,
-		 				TYPELIST_3(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool) 
-					&gt;
-{
-	public : 
-		virtual ~GLDrawGeometricalModelFunctor() {};
-		virtual string renders() const { std::cerr &lt;&lt; &quot;unregistered gldraw class.\n&quot;; throw; }; // FIXME - replace that with a nice exception
-	
-	REGISTER_CLASS_NAME(GLDrawGeometricalModelFunctor);
-	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
-};
-
-REGISTER_SERIALIZABLE(GLDrawGeometricalModelFunctor,false);
-
-#endif //  GLDRAWGEOMETRICALMODELFUNCTOR_HPP
-
-

Deleted: trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractingGeometryFunctor.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractingGeometryFunctor.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractingGeometryFunctor.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -1,36 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWINTERACTIONGEOMETRYFUNCTOR_HPP
-#define GLDRAWINTERACTIONGEOMETRYFUNCTOR_HPP
-
-#include&lt;yade/core/EngineUnit1D.hpp&gt;
-#include&lt;yade/lib-multimethods/FunctorWrapper.hpp&gt;
-#include&lt;yade/core/InteractingGeometry.hpp&gt;
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-
-#define RENDERS(name) 							\
-	public : virtual string renders() const { return #name; };
-
-class GLDrawInteractingGeometryFunctor :	public EngineUnit1D
-						&lt;
-		 					void ,
-		 					TYPELIST_3(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool) 
-						&gt;
-{
-	public :
-		virtual ~GLDrawInteractingGeometryFunctor() {};
-		virtual string renders() const { std::cerr &lt;&lt; &quot;unregistered gldraw class.\n&quot;; throw; }; // FIXME - replace that with a nice exception
-	REGISTER_CLASS_NAME(GLDrawInteractingGeometryFunctor);
-	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
-};
-
-REGISTER_SERIALIZABLE(GLDrawInteractingGeometryFunctor,false);
-
-#endif //  GLDRAWINTERACTIONGEOMETRYFUNCTOR_HPP
-

Deleted: trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractionGeometryFunctor.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractionGeometryFunctor.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractionGeometryFunctor.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -1,40 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAW_INTERACTION_GEOMETRY_FUNCTOR_HPP
-#define GLDRAW_INTERACTION_GEOMETRY_FUNCTOR_HPP
-
-#include&lt;yade/lib-multimethods/FunctorWrapper.hpp&gt;
-#include&lt;yade/core/InteractionGeometry.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/EngineUnit1D.hpp&gt;
-
-
-#define RENDERS(name) 							\
-	public : virtual string renders() const { return #name; };
-
-class GLDrawInteractionGeometryFunctor
-	: public EngineUnit1D
-	&lt;
-		void ,
-		TYPELIST_5(const shared_ptr&lt;InteractionGeometry&gt;&amp;, const shared_ptr&lt;Interaction&gt;&amp;, const shared_ptr&lt;Body&gt;&amp;, const shared_ptr&lt;Body&gt;&amp;, bool)
-	&gt;
-{
-	public : 
-		virtual ~GLDrawInteractionGeometryFunctor() {};
-		virtual string renders() const { std::cerr &lt;&lt; &quot;unregistered gldraw class.\n&quot;; throw; }; // FIXME - replace that with a nice exception
-	
-	REGISTER_CLASS_NAME(GLDrawInteractionGeometryFunctor);
-	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
-};
-
-REGISTER_SERIALIZABLE(GLDrawInteractionGeometryFunctor,false);
-
-#endif //  GLDRAWGEOMETRICALMODELFUNCTOR_HPP
-
-

Deleted: trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractionPhysicsFunctor.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractionPhysicsFunctor.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractionPhysicsFunctor.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -1,40 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAW_INTERACTION_PHYSICS_FUNCTOR_HPP
-#define GLDRAW_INTERACTION_PHYSICS_FUNCTOR_HPP
-
-#include&lt;yade/lib-multimethods/FunctorWrapper.hpp&gt;
-#include&lt;yade/core/InteractionPhysics.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/EngineUnit1D.hpp&gt;
-
-
-#define RENDERS(name) 							\
-	public : virtual string renders() const { return #name; };
-
-class GLDrawInteractionPhysicsFunctor
-	: public EngineUnit1D
-	&lt;
-		void ,
-		TYPELIST_5(const shared_ptr&lt;InteractionPhysics&gt;&amp;, const shared_ptr&lt;Interaction&gt;&amp;, const shared_ptr&lt;Body&gt;&amp;, const shared_ptr&lt;Body&gt;&amp;, bool) 
-	&gt;
-{
-	public : 
-		virtual ~GLDrawInteractionPhysicsFunctor() {};
-		virtual string renders() const { std::cerr &lt;&lt; &quot;unregistered gldraw class.\n&quot;; throw; }; // FIXME - replace that with a nice exception
-	
-	REGISTER_CLASS_NAME(GLDrawInteractionPhysicsFunctor);
-	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
-};
-
-REGISTER_SERIALIZABLE(GLDrawInteractionPhysicsFunctor,false);
-
-#endif //  GLDRAWGEOMETRICALMODELFUNCTOR_HPP
-
-

Deleted: trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawShadowVolumeFunctor.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawShadowVolumeFunctor.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawShadowVolumeFunctor.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -1,39 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWSHADOWVOLUMEFUNCTOR_HPP
-#define GLDRAWSHADOWVOLUMEFUNCTOR_HPP
-
-#include&lt;yade/core/EngineUnit1D.hpp&gt;
-#include&lt;yade/lib-multimethods/FunctorWrapper.hpp&gt;
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-
-#define RENDERS(name) 							\
-	public : virtual string renders() const { return #name; };
-
-class GLDrawShadowVolumeFunctor : 	public EngineUnit1D
-					&lt;
-		 				void ,
-		 				TYPELIST_3(	  const shared_ptr&lt;GeometricalModel&gt;&amp;
-		 						, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-								, const Vector3r&amp;	
-							  )
-					&gt;
-{
-	public:
-		virtual string renders() const { std::cerr &lt;&lt; &quot;unregistered gldraw class.\n&quot;; throw; }; // FIXME - replace that with a nice exception
-
-	REGISTER_CLASS_NAME(GLDrawShadowVolumeFunctor);
-	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
-};
-
-REGISTER_SERIALIZABLE(GLDrawShadowVolumeFunctor,false);
-
-#endif //  GLDRAWSHADOWVOLUMEFUNCTOR_HPP
-

Deleted: trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawStateFunctor.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawStateFunctor.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/GLDrawStateFunctor.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -1,39 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAW_STATE_FUNCTOR_HPP
-#define GLDRAW_STATE_FUNCTOR_HPP
-
-#include&lt;yade/lib-multimethods/FunctorWrapper.hpp&gt;
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include&lt;yade/core/EngineUnit1D.hpp&gt;
-
-
-#define RENDERS(name) 							\
-	public : virtual string renders() const { return #name; };
-
-class GLDrawStateFunctor
-	: public EngineUnit1D
-	&lt;
-		void ,
-		TYPELIST_1(const shared_ptr&lt;PhysicalParameters&gt;&amp;/*, draw parameters: color, scale, given from OpenGLRenderer, or sth.... */) 
-	&gt;
-{
-	public : 
-		virtual ~GLDrawStateFunctor() {};
-		virtual string renders() const { std::cerr &lt;&lt; &quot;unregistered gldraw class.\n&quot;; throw; }; // FIXME - replace that with a nice exception
-	
-	REGISTER_CLASS_NAME(GLDrawStateFunctor);
-	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
-};
-
-REGISTER_SERIALIZABLE(GLDrawStateFunctor,false);
-
-#endif //  GLDRAWGEOMETRICALMODELFUNCTOR_HPP
-
-

Modified: trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp
===================================================================
--- trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -1,21 +1,18 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
+// &#169; 2004 Olivier Galizzi &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>&gt;
+// &#169; 2008 V&#225;clav &#352;milauer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">eudoxos at arcig.cz</A>&gt;
 
-#include &quot;OpenGLRenderingEngine.hpp&quot;
+#include&quot;OpenGLRenderingEngine.hpp&quot;
 #include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-#include &lt;GL/glu.h&gt;
-#include &lt;GL/gl.h&gt;
-#include &lt;GL/glut.h&gt;
+#include&lt;GL/glu.h&gt;
+#include&lt;GL/gl.h&gt;
+#include&lt;GL/glut.h&gt;
+
+YADE_PLUGIN(&quot;OpenGLRenderingEngine&quot;);
 CREATE_LOGGER(OpenGLRenderingEngine);
 
-OpenGLRenderingEngine::OpenGLRenderingEngine() : RenderingEngine(), clipPlaneNum(3)
-{
+bool OpenGLRenderingEngine::glutInitDone=false;
 
+OpenGLRenderingEngine::OpenGLRenderingEngine() : RenderingEngine(), clipPlaneNum(3){
 	Body_state = false;
 	Body_bounding_volume = false;
 	Body_interacting_geom = false;
@@ -26,7 +23,6 @@
 	Body_wire = false;
 	Interaction_wire = false;
 	Draw_inside = true;
-	needInit = true;
 	Draw_mask = ~0;
 	Light_position = Vector3r(75.0,130.0,0.0);
 	Background_color = Vector3r(0.2,0.2,0.2);
@@ -37,7 +33,6 @@
 	displacementScale=Vector3r(1,1,1); rotationScale=1;
 	numBodiesWhenRefSe3LastSet=0;
 
-
 	for(int i=0; i&lt;clipPlaneNum; i++){clipPlaneSe3.push_back(Se3r(Vector3r::ZERO,Quaternionr::IDENTITY)); clipPlaneActive.push_back(false); clipPlaneNormals.push_back(Vector3r(1,0,0));}
 	
 	map&lt;string,DynlibDescriptor&gt;::const_iterator di = Omega::instance().getDynlibsDescriptor().begin();
@@ -55,16 +50,20 @@
 }
 
 OpenGLRenderingEngine::~OpenGLRenderingEngine(){}
-void OpenGLRenderingEngine::init(){ if (needInit)needInit = false; }
 
+void OpenGLRenderingEngine::init(){
+	if (glutInitDone) return;
+	glutInit(&amp;Omega::instance().origArgc,Omega::instance().origArgv);
+	/* transparent spheres (still not working): glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGBA | GLUT_DEPTH | GLUT_MULTISAMPLE | GLUT_ALPHA); glEnable(GL_BLEND); glBlendFunc(GL_SRC_ALPHA, GL_ONE); */
+	glutInitDone=true;
+}
+
 void OpenGLRenderingEngine::renderWithNames(const shared_ptr&lt;MetaBody&gt;&amp; rootBody){
 	FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *rootBody-&gt;bodies){
 		if(!b-&gt;geometricalModel) continue;
 		glPushMatrix();
-		Se3r&amp; se3 = b-&gt;physicalParameters-&gt;se3;
-		Real angle;
-		Vector3r axis;	
-		se3.orientation.ToAxisAngle(axis,angle);	
+		const Se3r&amp; se3=b-&gt;physicalParameters-&gt;se3;
+		Real angle; Vector3r axis;	se3.orientation.ToAxisAngle(axis,angle);	
 		glTranslatef(se3.position[0],se3.position[1],se3.position[2]);
 		glRotatef(angle*Mathr::RAD_TO_DEG,axis[0],axis[1],axis[2]);
 		if(b-&gt;geometricalModel-&gt;getClassName() != &quot;LineSegment&quot;){ // FIXME: a body needs to say: I am selectable ?!?!
@@ -84,12 +83,14 @@
 
 void OpenGLRenderingEngine::setBodiesRefSe3(const shared_ptr&lt;MetaBody&gt;&amp; rootBody){
 	LOG_DEBUG(&quot;(re)initializing reference positions and orientations.&quot;);
-	FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *rootBody-&gt;bodies) b-&gt;physicalParameters-&gt;refSe3=b-&gt;physicalParameters-&gt;se3;
+	FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *rootBody-&gt;bodies) if(b-&gt;physicalParameters) b-&gt;physicalParameters-&gt;refSe3=b-&gt;physicalParameters-&gt;se3;
 	numBodiesWhenRefSe3LastSet=rootBody-&gt;bodies-&gt;size();
+	numIterWhenRefSe3LastSet=Omega::instance().getCurrentIteration();
 }
 
 void OpenGLRenderingEngine::setBodiesDispSe3(const shared_ptr&lt;MetaBody&gt;&amp; rootBody){
 	FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *rootBody-&gt;bodies){
+		if(!b-&gt;physicalParameters) continue;
 		const Se3r&amp; se3=b-&gt;physicalParameters-&gt;se3; const Se3r&amp; refSe3=b-&gt;physicalParameters-&gt;refSe3; Se3r&amp; dispSe3=b-&gt;physicalParameters-&gt;dispSe3;
 		b-&gt;physicalParameters-&gt;isDisplayed=!pointClipped(se3.position);
 		// if no scaling, return quickly
@@ -105,49 +106,33 @@
 	}
 }
 
-void OpenGLRenderingEngine::render(
-		const shared_ptr&lt;MetaBody&gt;&amp; rootBody, 
-		body_id_t selection	// FIXME: not sure. maybe a list of selections, 
-					// or maybe bodies themselves should remember if they are selected?
-		)
-{	// FIXME - make a compile time flag for that. So yade can compile with different versions.
-#ifndef NO_GLUTINIT
-	static bool initDone=false;
-	if(!initDone) // FIXME - this is a quick hack for newest version of libglut
-	{
-		int a=1;
-		char* b=(char*)&quot;./yade&quot;;
-		glutInit(&amp;a,&amp;b);
-// transparent spheres (still not working)
-//glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGBA | GLUT_DEPTH | GLUT_MULTISAMPLE | GLUT_ALPHA);
-//glEnable(GL_BLEND);
-//glBlendFunc(GL_SRC_ALPHA, GL_ONE);
-		initDone=true;
-	}
-#endif
+void OpenGLRenderingEngine::render(const shared_ptr&lt;MetaBody&gt;&amp; rootBody, body_id_t selection	/*FIXME: not sure. maybe a list of selections, or maybe bodies themselves should remember if they are selected? */) {
+
+	assert(glutInitDone);
 	current_selection = selection;
 
+	// Draw light source
 	const GLfloat pos[4]	= {Light_position[0],Light_position[1],Light_position[2],1.0};
 	const GLfloat ambientColor[4]	= {0.5,0.5,0.5,1.0};	
-
 	glClearColor(Background_color[0],Background_color[1],Background_color[2],1.0);
 	glLightfv(GL_LIGHT0, GL_POSITION, pos);
 	glLightModelfv(GL_LIGHT_MODEL_AMBIENT,ambientColor);
 	glEnable(GL_LIGHT0);
-	
 	glDisable(GL_LIGHTING);
-	
 	glPushMatrix();
-	glTranslatef(Light_position[0],Light_position[1],Light_position[2]);
-	glColor3f(1.0,1.0,1.0);
-	glutSolidSphere(3,10,10);
+		glTranslatef(Light_position[0],Light_position[1],Light_position[2]);
+		glColor3f(1.0,1.0,1.0);
+		glutSolidSphere(3,10,10);
 	glPopMatrix();	
 
-	// TODO: do this only if clipping is effective (i.e. if clipPlaneActive[i] AND'ed together); dtto for pointClipped
-	for(int i=0;i&lt;clipPlaneNum; i++){ clipPlaneNormals[i]=clipPlaneSe3[i].orientation*Vector3r(0,0,1); /* glBegin(GL_LINES);glVertex3v(clipPlaneSe3[i].position);glVertex3v(clipPlaneSe3[i].position+clipPlaneNormals[i]);glEnd(); */ }
+	// clipping
+	for(int i=0;i&lt;clipPlaneNum; i++){
+		if(clipPlaneActive[i]) clipPlaneNormals[i]=clipPlaneSe3[i].orientation*Vector3r(0,0,1);
+		/* glBegin(GL_LINES);glVertex3v(clipPlaneSe3[i].position);glVertex3v(clipPlaneSe3[i].position+clipPlaneNormals[i]);glEnd(); */
+	}
 
-	// if scaling positions or orientations, save reference values if not already done; if # of bodies changes, we have to reset those
-	if((scaleDisplacements || scaleRotations) &amp;&amp; rootBody-&gt;bodies-&gt;size()!=numBodiesWhenRefSe3LastSet){setBodiesRefSe3(rootBody);}
+	// if scaling positions or orientations, save reference values if not already done; if # of bodies changes, we have to reset those; remember iteration when this was done to detect (at least in most cases) that the simulation was reloaded
+	if((scaleDisplacements || scaleRotations) &amp;&amp; (rootBody-&gt;bodies-&gt;size()!=numBodiesWhenRefSe3LastSet||Omega::instance().getCurrentIteration()&lt;=numIterWhenRefSe3LastSet)){setBodiesRefSe3(rootBody);}
 	
 	// set displayed Se3 of body (scaling) and isDisplayed (clipping)
 	setBodiesDispSe3(rootBody);
@@ -157,8 +142,7 @@
 		if(scaleDisplacements){
 			glColor3d(1,1,0); glBegin(GL_LINES); 
 			FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *rootBody-&gt;bodies){
-				Se3r se3=renderedSe3(b);
-				glVertex3v(b-&gt;physicalParameters-&gt;se3.position); glVertex3v(se3.position); }
+				glVertex3v(b-&gt;physicalParameters-&gt;se3.position); glVertex3v(b-&gt;physicalParameters-&gt;dispSe3.position); }
 			glEnd();
 		}
 	#endif
@@ -347,7 +331,7 @@
 void OpenGLRenderingEngine::renderShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r Light_position){	
 	if (!rootBody-&gt;geometricalModel){
 		FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *rootBody-&gt;bodies){
-			if(pointClipped(b-&gt;physicalParameters-&gt;se3.position)) continue;
+			if(!b-&gt;physicalParameters-&gt;isDisplayed) continue;
 			if (b-&gt;geometricalModel-&gt;shadowCaster &amp;&amp; ( (b-&gt;getGroupMask() &amp; Draw_mask) || b-&gt;getGroupMask()==0 ))
 				shadowVolumeDispatcher(b-&gt;geometricalModel,b-&gt;physicalParameters,Light_position);
 		}
@@ -361,7 +345,7 @@
 	if((rootBody-&gt;geometricalModel || Draw_inside) &amp;&amp; Draw_inside) {
 		FOREACH(const shared_ptr&lt;Body&gt; b, *rootBody-&gt;bodies){
 			if(b-&gt;geometricalModel &amp;&amp; ((b-&gt;getGroupMask() &amp; Draw_mask) || b-&gt;getGroupMask()==0)){
-				if(!b-&gt;physicalParameters-&gt;isDisplayed) continue;
+				if(b-&gt;physicalParameters &amp;&amp; !b-&gt;physicalParameters-&gt;isDisplayed) continue;
 				const Se3r&amp; se3=b-&gt;physicalParameters-&gt;dispSe3;
 				glPushMatrix();
 				Real angle; Vector3r axis;	se3.orientation.ToAxisAngle(axis,angle);	
@@ -381,113 +365,69 @@
 void OpenGLRenderingEngine::renderInteractionGeometry(const shared_ptr&lt;MetaBody&gt;&amp; rootBody){	
 	{
 		boost::mutex::scoped_lock lock(rootBody-&gt;persistentInteractions-&gt;drawloopmutex);
-
-		InteractionContainer::iterator bi    = rootBody-&gt;persistentInteractions-&gt;begin();
-		InteractionContainer::iterator biEnd = rootBody-&gt;persistentInteractions-&gt;end();
-		for( ; bi!=biEnd ; ++bi)
-		{
-			if((*bi)-&gt;interactionGeometry){
-				const shared_ptr&lt;Body&gt;&amp; b1=Body::byId((*bi)-&gt;getId1(),rootBody), b2=Body::byId((*bi)-&gt;getId2(),rootBody);
-				if(pointClipped(b1-&gt;physicalParameters-&gt;se3.position)&amp;&amp;pointClipped(b2-&gt;physicalParameters-&gt;se3.position)) continue;
-				glPushMatrix();
-					interactionGeometryDispatcher((*bi)-&gt;interactionGeometry,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],Interaction_wire);
-				glPopMatrix();
-			}
+		FOREACH(const shared_ptr&lt;Interaction&gt;&amp; I, *rootBody-&gt;persistentInteractions){
+			if(!I-&gt;interactionGeometry) continue;
+			const shared_ptr&lt;Body&gt;&amp; b1=Body::byId(I-&gt;getId1(),rootBody), b2=Body::byId(I-&gt;getId2(),rootBody);
+			if(!(b1-&gt;physicalParameters-&gt;isDisplayed||b2-&gt;physicalParameters-&gt;isDisplayed)) continue;
+			glPushMatrix(); interactionGeometryDispatcher(I-&gt;interactionGeometry,I,b1,b2,Interaction_wire); glPopMatrix();
 		}
 	}
-
 	{
 		boost::mutex::scoped_lock lock(rootBody-&gt;transientInteractions-&gt;drawloopmutex);
-
-		InteractionContainer::iterator bi    = rootBody-&gt;transientInteractions-&gt;begin();
-		InteractionContainer::iterator biEnd = rootBody-&gt;transientInteractions-&gt;end();
-		for( ; bi!=biEnd ; ++bi)
-		{
-			glPushMatrix();
-			if((*bi)-&gt;interactionGeometry)
-				interactionGeometryDispatcher((*bi)-&gt;interactionGeometry,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],Interaction_wire);
-			glPopMatrix();
+		FOREACH(const shared_ptr&lt;Interaction&gt;&amp; I, *rootBody-&gt;transientInteractions){
+			if(!I-&gt;interactionGeometry) continue;
+			const shared_ptr&lt;Body&gt;&amp; b1=Body::byId(I-&gt;getId1(),rootBody), b2=Body::byId(I-&gt;getId2(),rootBody);
+			if(!(b1-&gt;physicalParameters-&gt;isDisplayed||b2-&gt;physicalParameters-&gt;isDisplayed)) continue;
+			glPushMatrix(); interactionGeometryDispatcher(I-&gt;interactionGeometry,I,b1,b2,Interaction_wire); glPopMatrix();
 		}
 	}
 }
 
 
-void OpenGLRenderingEngine::renderInteractionPhysics(const shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{	
+void OpenGLRenderingEngine::renderInteractionPhysics(const shared_ptr&lt;MetaBody&gt;&amp; rootBody){	
 	{
 		boost::mutex::scoped_lock lock(rootBody-&gt;persistentInteractions-&gt;drawloopmutex);
-
-		InteractionContainer::iterator bi    = rootBody-&gt;persistentInteractions-&gt;begin();
-		InteractionContainer::iterator biEnd = rootBody-&gt;persistentInteractions-&gt;end();
-		for( ; bi!=biEnd ; ++bi)
-		{
-			glPushMatrix();
-			if((*bi)-&gt;interactionPhysics)
-				interactionPhysicsDispatcher((*bi)-&gt;interactionPhysics,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],Interaction_wire);
-			glPopMatrix();
+		FOREACH(const shared_ptr&lt;Interaction&gt;&amp; I, *rootBody-&gt;persistentInteractions){
+			if(!I-&gt;interactionGeometry) continue;
+			const shared_ptr&lt;Body&gt;&amp; b1=Body::byId(I-&gt;getId1(),rootBody), b2=Body::byId(I-&gt;getId2(),rootBody);
+			if(!(b1-&gt;physicalParameters-&gt;isDisplayed||b2-&gt;physicalParameters-&gt;isDisplayed)) continue;
+			glPushMatrix(); interactionPhysicsDispatcher(I-&gt;interactionPhysics,I,b1,b2,Interaction_wire); glPopMatrix();
 		}
 	}
-
 	{
 		boost::mutex::scoped_lock lock(rootBody-&gt;transientInteractions-&gt;drawloopmutex);
-
-		InteractionContainer::iterator bi    = rootBody-&gt;transientInteractions-&gt;begin();
-		InteractionContainer::iterator biEnd = rootBody-&gt;transientInteractions-&gt;end();
-		for( ; bi!=biEnd ; ++bi)
-		{
-			if((*bi)-&gt;interactionPhysics){
-				const shared_ptr&lt;Body&gt;&amp; b1=Body::byId((*bi)-&gt;getId1(),rootBody), b2=Body::byId((*bi)-&gt;getId2(),rootBody);
-				if(pointClipped(b1-&gt;physicalParameters-&gt;se3.position)&amp;&amp;pointClipped(b2-&gt;physicalParameters-&gt;se3.position)) continue;
-				glPushMatrix();
-					interactionPhysicsDispatcher((*bi)-&gt;interactionPhysics,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],Interaction_wire);
-				glPopMatrix();
-			}
+		FOREACH(const shared_ptr&lt;Interaction&gt;&amp; I, *rootBody-&gt;transientInteractions){
+			if(!I-&gt;interactionGeometry) continue;
+			const shared_ptr&lt;Body&gt;&amp; b1=Body::byId(I-&gt;getId1(),rootBody), b2=Body::byId(I-&gt;getId2(),rootBody);
+			if(!(b1-&gt;physicalParameters-&gt;isDisplayed||b2-&gt;physicalParameters-&gt;isDisplayed)) continue;
+			glPushMatrix(); interactionPhysicsDispatcher(I-&gt;interactionPhysics,I,b1,b2,Interaction_wire); glPopMatrix();
 		}
 	}
 }
 
 
-void OpenGLRenderingEngine::renderState(const shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{	
-	BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-	BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi)
-	{
-		if(pointClipped((*bi)-&gt;physicalParameters-&gt;se3.position)) continue;
-		glPushMatrix();
-		if((*bi)-&gt;physicalParameters &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; Draw_mask ) || (*bi)-&gt;getGroupMask()==0 ))
-			stateDispatcher((*bi)-&gt;physicalParameters);
-		glPopMatrix();
+void OpenGLRenderingEngine::renderState(const shared_ptr&lt;MetaBody&gt;&amp; rootBody){	
+	FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *rootBody-&gt;bodies){
+		if(b-&gt;physicalParameters &amp;&amp; !b-&gt;physicalParameters-&gt;isDisplayed) continue;
+		if(b-&gt;physicalParameters &amp;&amp; ((b-&gt;getGroupMask()&amp;Draw_mask) || b-&gt;getGroupMask()==0)){
+			glPushMatrix(); stateDispatcher(b-&gt;physicalParameters); glPopMatrix();
+		}
 	}
-	
-	glPushMatrix();
-	if(rootBody-&gt;physicalParameters)
-		stateDispatcher(rootBody-&gt;physicalParameters);
-	glPopMatrix();
+	if(rootBody-&gt;physicalParameters){ glPushMatrix(); stateDispatcher(rootBody-&gt;physicalParameters); glPopMatrix();}
 }
 
 
-void OpenGLRenderingEngine::renderBoundingVolume(const shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{	
-	BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-	BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi)
-	{		
-		if(pointClipped((*bi)-&gt;physicalParameters-&gt;se3.position)) continue;
-		glPushMatrix();
-		if((*bi)-&gt;boundingVolume &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; Draw_mask) || (*bi)-&gt;getGroupMask()==0 ))
-			boundingVolumeDispatcher((*bi)-&gt;boundingVolume);
-		glPopMatrix();
+void OpenGLRenderingEngine::renderBoundingVolume(const shared_ptr&lt;MetaBody&gt;&amp; rootBody){	
+	FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *rootBody-&gt;bodies){
+		if(b-&gt;physicalParameters &amp;&amp; !b-&gt;physicalParameters-&gt;isDisplayed) continue;
+		if(b-&gt;boundingVolume &amp;&amp; ((b-&gt;getGroupMask()&amp;Draw_mask) || b-&gt;getGroupMask()==0)){
+			glPushMatrix(); boundingVolumeDispatcher(b-&gt;boundingVolume); glPopMatrix();
+		}
 	}
-	
-	glPushMatrix();
-	if(rootBody-&gt;boundingVolume)
-		boundingVolumeDispatcher(rootBody-&gt;boundingVolume);
-	glPopMatrix();
+	if(rootBody-&gt;boundingVolume){ glPushMatrix(); boundingVolumeDispatcher(rootBody-&gt;boundingVolume); glPopMatrix(); }
 }
 
 
-
 void OpenGLRenderingEngine::renderInteractingGeometry(const shared_ptr&lt;MetaBody&gt;&amp; rootBody)
 {
 	// Additional clipping planes: <A HREF="http://fly.srk.fer.hr/~unreal/theredbook/chapter03.html">http://fly.srk.fer.hr/~unreal/theredbook/chapter03.html</A>
@@ -497,19 +437,18 @@
 		glEnable(GL_CLIP_PLANE0);
 	#endif
 	FOREACH(const shared_ptr&lt;Body&gt;&amp; b, *rootBody-&gt;bodies){
-		if(!b-&gt;physicalParameters-&gt;isDisplayed) continue;
+		if(b-&gt;physicalParameters &amp;&amp; !b-&gt;physicalParameters-&gt;isDisplayed) continue;
 		const Se3r&amp; se3=b-&gt;physicalParameters-&gt;dispSe3;
-		glPushMatrix();
+		if(b-&gt;interactingGeometry &amp;&amp; ((b-&gt;getGroupMask()&amp;Draw_mask) || b-&gt;getGroupMask()==0)){
+			glPushMatrix();
 			Real angle;	Vector3r axis;	se3.orientation.ToAxisAngle(axis,angle);	
 			glTranslatef(se3.position[0],se3.position[1],se3.position[2]);
 			glRotatef(angle*Mathr::RAD_TO_DEG,axis[0],axis[1],axis[2]);
-			if(b-&gt;interactingGeometry &amp;&amp; ( (b-&gt;getGroupMask() &amp; Draw_mask) || b-&gt;getGroupMask()==0 ))
-				interactingGeometryDispatcher(b-&gt;interactingGeometry,b-&gt;physicalParameters,Body_wire);
-		glPopMatrix();
+			interactingGeometryDispatcher(b-&gt;interactingGeometry,b-&gt;physicalParameters,Body_wire);
+			glPopMatrix();
+		}
 	}
-	glPushMatrix();
-		if(rootBody-&gt;interactingGeometry) interactingGeometryDispatcher(rootBody-&gt;interactingGeometry,rootBody-&gt;physicalParameters,Body_wire);
-	glPopMatrix();
+	if(rootBody-&gt;interactingGeometry){ glPushMatrix(); interactingGeometryDispatcher(rootBody-&gt;interactingGeometry,rootBody-&gt;physicalParameters,Body_wire); glPopMatrix(); }
 }
 
 
@@ -546,99 +485,42 @@
 }
 
 
-void OpenGLRenderingEngine::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-		for(unsigned int i=0;i&lt;stateFunctorNames.size();i++)
-			stateDispatcher.add1DEntry(stateFunctorNames[i][0],stateFunctorNames[i][1]);
-			
-		for(unsigned int i=0;i&lt;boundingVolumeFunctorNames.size();i++)
-			boundingVolumeDispatcher.add1DEntry(boundingVolumeFunctorNames[i][0],boundingVolumeFunctorNames[i][1]);
-			
-		for(unsigned int i=0;i&lt;interactingGeometryFunctorNames.size();i++)
-			interactingGeometryDispatcher.add1DEntry(interactingGeometryFunctorNames[i][0],interactingGeometryFunctorNames[i][1]);
-			
-		for(unsigned int i=0;i&lt;geometricalModelFunctorNames.size();i++)
-			geometricalModelDispatcher.add1DEntry(geometricalModelFunctorNames[i][0],geometricalModelFunctorNames[i][1]);
-		
-		for(unsigned int i=0;i&lt;shadowVolumeFunctorNames.size();i++)
-			shadowVolumeDispatcher.add1DEntry(shadowVolumeFunctorNames[i][0],shadowVolumeFunctorNames[i][1]);
-		
-		for(unsigned int i=0;i&lt;interactionGeometryFunctorNames.size();i++)
-			interactionGeometryDispatcher.add1DEntry(interactionGeometryFunctorNames[i][0],interactionGeometryFunctorNames[i][1]);
-			
-		for(unsigned int i=0;i&lt;interactionPhysicsFunctorNames.size();i++)
-			interactionPhysicsDispatcher.add1DEntry(interactionPhysicsFunctorNames[i][0],interactionPhysicsFunctorNames[i][1]);	
-	}
+void OpenGLRenderingEngine::postProcessAttributes(bool deserializing){
+	if(!deserializing) return;
+	for(unsigned int i=0;i&lt;stateFunctorNames.size();i++) stateDispatcher.add1DEntry(stateFunctorNames[i][0],stateFunctorNames[i][1]);
+	for(unsigned int i=0;i&lt;boundingVolumeFunctorNames.size();i++) boundingVolumeDispatcher.add1DEntry(boundingVolumeFunctorNames[i][0],boundingVolumeFunctorNames[i][1]);
+	for(unsigned int i=0;i&lt;interactingGeometryFunctorNames.size();i++) interactingGeometryDispatcher.add1DEntry(interactingGeometryFunctorNames[i][0],interactingGeometryFunctorNames[i][1]);
+	for(unsigned int i=0;i&lt;geometricalModelFunctorNames.size();i++) geometricalModelDispatcher.add1DEntry(geometricalModelFunctorNames[i][0],geometricalModelFunctorNames[i][1]);
+	for(unsigned int i=0;i&lt;shadowVolumeFunctorNames.size();i++) shadowVolumeDispatcher.add1DEntry(shadowVolumeFunctorNames[i][0],shadowVolumeFunctorNames[i][1]);
+	for(unsigned int i=0;i&lt;interactionGeometryFunctorNames.size();i++) interactionGeometryDispatcher.add1DEntry(interactionGeometryFunctorNames[i][0],interactionGeometryFunctorNames[i][1]);
+	for(unsigned int i=0;i&lt;interactionPhysicsFunctorNames.size();i++) interactionPhysicsDispatcher.add1DEntry(interactionPhysicsFunctorNames[i][0],interactionPhysicsFunctorNames[i][1]);	
 }
-
-
-void OpenGLRenderingEngine::addInteractionGeometryFunctor(const string&amp; str2)
-{
+void OpenGLRenderingEngine::addInteractionGeometryFunctor(const string&amp; str2){
 	string str1 = (static_pointer_cast&lt;GLDrawInteractionGeometryFunctor&gt;(ClassFactory::instance().createShared(str2)))-&gt;renders();
-	vector&lt;string&gt; v;
-	v.push_back(str1);
-	v.push_back(str2);
-	interactionGeometryFunctorNames.push_back(v);
+	vector&lt;string&gt; v; v.push_back(str1); v.push_back(str2); interactionGeometryFunctorNames.push_back(v);
 }
-
-void OpenGLRenderingEngine::addInteractionPhysicsFunctor(const string&amp; str2)
-{
+void OpenGLRenderingEngine::addInteractionPhysicsFunctor(const string&amp; str2){
 	string str1 = (static_pointer_cast&lt;GLDrawInteractionPhysicsFunctor&gt;(ClassFactory::instance().createShared(str2)))-&gt;renders();
-	vector&lt;string&gt; v;
-	v.push_back(str1);
-	v.push_back(str2);
-	interactionPhysicsFunctorNames.push_back(v);
+	vector&lt;string&gt; v; v.push_back(str1); v.push_back(str2); interactionPhysicsFunctorNames.push_back(v);
 }
-
-void OpenGLRenderingEngine::addStateFunctor(const string&amp; str2)
-{
+void OpenGLRenderingEngine::addStateFunctor(const string&amp; str2){
 	string str1 = (static_pointer_cast&lt;GLDrawStateFunctor&gt;(ClassFactory::instance().createShared(str2)))-&gt;renders();
-	vector&lt;string&gt; v;
-	v.push_back(str1);
-	v.push_back(str2);
-	stateFunctorNames.push_back(v);
+	vector&lt;string&gt; v; v.push_back(str1); v.push_back(str2); stateFunctorNames.push_back(v);
 }
-
-
-void OpenGLRenderingEngine::addBoundingVolumeFunctor(const string&amp; str2)
-{
+void OpenGLRenderingEngine::addBoundingVolumeFunctor(const string&amp; str2){
 	string str1 = (static_pointer_cast&lt;GLDrawBoundingVolumeFunctor&gt;(ClassFactory::instance().createShared(str2)))-&gt;renders();
-	vector&lt;string&gt; v;
-	v.push_back(str1);
-	v.push_back(str2);
-	boundingVolumeFunctorNames.push_back(v);
+	vector&lt;string&gt; v; v.push_back(str1); v.push_back(str2); boundingVolumeFunctorNames.push_back(v);
 }
-
-
-void OpenGLRenderingEngine::addInteractingGeometryFunctor(const string&amp; str2)
-{
+void OpenGLRenderingEngine::addInteractingGeometryFunctor(const string&amp; str2){
 	string str1 = (static_pointer_cast&lt;GLDrawInteractingGeometryFunctor&gt;(ClassFactory::instance().createShared(str2)))-&gt;renders();
-	vector&lt;string&gt; v;
-	v.push_back(str1);
-	v.push_back(str2);
-	interactingGeometryFunctorNames.push_back(v);
+	vector&lt;string&gt; v; v.push_back(str1); v.push_back(str2); interactingGeometryFunctorNames.push_back(v);
 }
-
-
-void OpenGLRenderingEngine::addGeometricalModelFunctor(const string&amp; str2)
-{
+void OpenGLRenderingEngine::addGeometricalModelFunctor(const string&amp; str2){
 	string str1 = (static_pointer_cast&lt;GLDrawGeometricalModelFunctor&gt;(ClassFactory::instance().createShared(str2)))-&gt;renders();
-	vector&lt;string&gt; v;
-	v.push_back(str1);
-	v.push_back(str2);
-	geometricalModelFunctorNames.push_back(v);
+	vector&lt;string&gt; v; v.push_back(str1); v.push_back(str2); geometricalModelFunctorNames.push_back(v);
 }
-
-
-void OpenGLRenderingEngine::addShadowVolumeFunctor(const string&amp; str2)
-{
+void OpenGLRenderingEngine::addShadowVolumeFunctor(const string&amp; str2){
 	string str1 = (static_pointer_cast&lt;GLDrawShadowVolumeFunctor&gt;(ClassFactory::instance().createShared(str2)))-&gt;renders();
-	vector&lt;string&gt; v;
-	v.push_back(str1);
-	v.push_back(str2);
-	shadowVolumeFunctorNames.push_back(v);
+	vector&lt;string&gt; v; v.push_back(str1); v.push_back(str2); shadowVolumeFunctorNames.push_back(v);
 }
 
-YADE_PLUGIN();

Modified: trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp
===================================================================
--- trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/common/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -1,32 +1,19 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
+// &#169; 2004 Olivier Galizzi &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>&gt;
+// &#169; 2008 V&#225;clav &#352;milauer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">eudoxos at arcig.cz</A>&gt;
+#pragma once
 
-#ifndef OPENGLRENDERINGENGINE_HPP
-#define OPENGLRENDERINGENGINE_HPP
-
 #include&lt;yade/core/RenderingEngine.hpp&gt;
 #include&lt;yade/lib-multimethods/DynLibDispatcher.hpp&gt;
 #include&lt;yade/core/MetaEngine1D.hpp&gt;
 #include&lt;yade/core/Body.hpp&gt;
 
-#include&lt;yade/pkg-common/GLDrawStateFunctor.hpp&gt;
-#include&lt;yade/pkg-common/GLDrawBoundingVolumeFunctor.hpp&gt;
-#include&lt;yade/pkg-common/GLDrawInteractingGeometryFunctor.hpp&gt;
-#include&lt;yade/pkg-common/GLDrawGeometricalModelFunctor.hpp&gt;
-#include&lt;yade/pkg-common/GLDrawShadowVolumeFunctor.hpp&gt;
-#include&lt;yade/pkg-common/GLDrawInteractionPhysicsFunctor.hpp&gt;
-#include&lt;yade/pkg-common/GLDrawInteractionGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class OpenGLRenderingEngine : public RenderingEngine
 {	
 	public :
 		Vector3r Light_position,Background_color;
-		bool Body_state,Body_bounding_volume,Body_interacting_geom,Body_geometrical_model,Cast_shadows,Shadow_volumes,Fast_shadow_volume,Body_wire,Interaction_wire,Draw_inside,Interaction_geometry,Interaction_physics,needInit;
+		bool Body_state,Body_bounding_volume,Body_interacting_geom,Body_geometrical_model,Cast_shadows,Shadow_volumes,Fast_shadow_volume,Body_wire,Interaction_wire,Draw_inside,Interaction_geometry,Interaction_physics;
 		body_id_t current_selection;
 		int Draw_mask;
 
@@ -40,7 +27,8 @@
 		vector&lt;Vector3r&gt; clipPlaneNormals;
 		void setBodiesRefSe3(const shared_ptr&lt;MetaBody&gt;&amp; rootBody);
 		void setBodiesDispSe3(const shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		long numBodiesWhenRefSe3LastSet;
+		long numBodiesWhenRefSe3LastSet,numIterWhenRefSe3LastSet;
+		static bool glutInitDone;
 
 	private :
 		DynLibDispatcher&lt; InteractionGeometry , GLDrawInteractionGeometryFunctor, void , TYPELIST_5(const shared_ptr&lt;InteractionGeometry&gt;&amp;, const shared_ptr&lt;Interaction&gt;&amp; , const shared_ptr&lt;Body&gt;&amp;, const shared_ptr&lt;Body&gt;&amp;, bool) &gt; interactionGeometryDispatcher;
@@ -97,7 +85,4 @@
 	REGISTER_CLASS_NAME(OpenGLRenderingEngine);
 	REGISTER_BASE_CLASS_NAME(RenderingEngine);
 };
-
 REGISTER_SERIALIZABLE(OpenGLRenderingEngine,false);
-
-#endif // OPENGLRENDERINGENGINE_HPP

Modified: trunk/pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction/GLDrawCohesiveFrictionalContactInteraction.hpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction/GLDrawCohesiveFrictionalContactInteraction.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/dem/RenderingEngine/GLDrawCohesiveFrictionalContactInteraction/GLDrawCohesiveFrictionalContactInteraction.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_CohesiveFrictionalContactInteraction_HPP
 #define GLDRAW_CohesiveFrictionalContactInteraction_HPP
 
-#include&lt;yade/pkg-common/GLDrawInteractionPhysicsFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawCohesiveFrictionalContactInteraction : public GLDrawInteractionPhysicsFunctor
 {	

Modified: trunk/pkg/dem/RenderingEngine/GLDrawElasticContactInteraction/GLDrawElasticContactInteraction.hpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawElasticContactInteraction/GLDrawElasticContactInteraction.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/dem/RenderingEngine/GLDrawElasticContactInteraction/GLDrawElasticContactInteraction.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_ElasticContactInteraction_HPP
 #define GLDRAW_ElasticContactInteraction_HPP
 
-#include&lt;yade/pkg-common/GLDrawInteractionPhysicsFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawElasticContactInteraction : public GLDrawInteractionPhysicsFunctor
 {	

Modified: trunk/pkg/dem/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.hpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/dem/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -8,7 +8,7 @@
 #ifndef GLDRAWINTERACTINGMYTETRAHEDRON_HPP
 #define GLDRAWINTERACTINGMYTETRAHEDRON_HPP
 
-#include&lt;yade/pkg-common/GLDrawInteractingGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 /*! 
  * \brief This class exists for the sole purpose of drawing InteractingMyTetrahedron using OpenGL

Modified: trunk/pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.hpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_SPHERES_LINK_CONTACT_GEOMETRY_HPP
 #define GLDRAW_SPHERES_LINK_CONTACT_GEOMETRY_HPP
 
-#include&lt;yade/pkg-common/GLDrawInteractionGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawSDECLinkGeometry : public GLDrawInteractionGeometryFunctor
 {	

Modified: trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.hpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/dem/RenderingEngine/GLDrawSimpleViscoelasticInteraction/GLDrawSimpleViscoelasticInteraction.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_SIMPLEVISCOELASTIC_INTERACTION_HPP
 #define GLDRAW_SIMPLEVISCOELASTIC_INTERACTION_HPP
 
-#include &lt;yade/pkg-common/GLDrawInteractionPhysicsFunctor.hpp&gt;
+#include &lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawSimpleViscoelasticInteraction : public GLDrawInteractionPhysicsFunctor
 {

Modified: trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.hpp
===================================================================
--- trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_SPHERES_CONTACT_GEOMETRY_HPP
 #define GLDRAW_SPHERES_CONTACT_GEOMETRY_HPP
 
-#include&lt;yade/pkg-common/GLDrawInteractionGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawSpheresContactGeometry : public GLDrawInteractionGeometryFunctor
 {	

Modified: trunk/pkg/lattice/RenderingEngine/GLDrawLatticeBeamState/GLDrawLatticeBeamState.hpp
===================================================================
--- trunk/pkg/lattice/RenderingEngine/GLDrawLatticeBeamState/GLDrawLatticeBeamState.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/lattice/RenderingEngine/GLDrawLatticeBeamState/GLDrawLatticeBeamState.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_LATTICE_BEAM_STATE_HPP
 #define GLDRAW_LATTICE_BEAM_STATE_HPP
 
-#include&lt;yade/pkg-common/GLDrawStateFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawLatticeBeamState : public GLDrawStateFunctor
 {

Modified: trunk/pkg/lattice/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.hpp
===================================================================
--- trunk/pkg/lattice/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/lattice/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_LATTICE_INTERACTING_GEOMETRY_HPP
 #define GLDRAW_LATTICE_INTERACTING_GEOMETRY_HPP
 
-#include&lt;yade/pkg-common/GLDrawInteractingGeometryFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 #include &lt;vector&gt;
 
 class GLDrawLatticeInteractingGeometry : public GLDrawInteractingGeometryFunctor

Modified: trunk/pkg/lattice/RenderingEngine/GLDrawLatticeSetGeometry/GLDrawLatticeSetGeometry.hpp
===================================================================
--- trunk/pkg/lattice/RenderingEngine/GLDrawLatticeSetGeometry/GLDrawLatticeSetGeometry.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/lattice/RenderingEngine/GLDrawLatticeSetGeometry/GLDrawLatticeSetGeometry.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_LATTICE_SET_GEOMETRY_HPP
 #define GLDRAW_LATTICE_SET_GEOMETRY_HPP
 
-#include&lt;yade/pkg-common/GLDrawGeometricalModelFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 #include&lt;yade/lib-computational-geometry/MarchingCube.hpp&gt;
 #include &lt;vector&gt;
 

Modified: trunk/pkg/lattice/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.hpp
===================================================================
--- trunk/pkg/lattice/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.hpp	2008-07-23 21:02:29 UTC (rev 1444)
+++ trunk/pkg/lattice/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.hpp	2008-07-24 10:16:51 UTC (rev 1445)
@@ -9,7 +9,7 @@
 #ifndef GLDRAW_LINE_SEGMENT_HPP
 #define GLDRAW_LINE_SEGMENT_HPP
 
-#include&lt;yade/pkg-common/GLDrawGeometricalModelFunctor.hpp&gt;
+#include&lt;yade/pkg-common/GLDrawFunctors.hpp&gt;
 
 class GLDrawLineSegment : public GLDrawGeometricalModelFunctor
 {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000404.html">[Yade-commits] r1444 - in trunk: core extra gui/qt3	pkg/common/RenderingEngine/OpenGLRenderingEngine	pkg/dem/Engine/DeusExMachina
</A></li>
	<LI>Next message: <A HREF="000406.html">[Yade-commits] r1446 - branches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#405">[ date ]</a>
              <a href="thread.html#405">[ thread ]</a>
              <a href="subject.html#405">[ subject ]</a>
              <a href="author.html#405">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/yade-commits">More information about the Yade-commits
mailing list</a><br>
</body></html>
