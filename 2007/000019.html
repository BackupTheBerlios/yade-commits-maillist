<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Yade-commits] r1054 - in trunk: yade-guis/yade-gui-qt/src/QtGUI	yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere	yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine	yade-packages/yade-package-dem/src/Engine/StandAloneEngine/ElasticCohesiveLaw	yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer	yade-packages/yade-package-dem/src/PreProcessor	yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending	yade-packages/yade-package-dem/src/RenderingEngine	yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry	yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/yade-commits/2007/index.html" >
   <LINK REL="made" HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1054%20-%20in%20trunk%3A%20yade-guis/yade-gui-qt/src/QtGUI%0A%09yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere%0A%09yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine%0A%09yade-packages/yade-package-dem/src/Engine/StandAloneEngine/ElasticCohesiveLaw%0A%09yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer%0A%09yade-packages/yade-package-dem/src/PreProcessor%0A%09yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending%0A%09yade-packages/yade-package-dem/src/RenderingEngine%0A%09yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry%0A%09yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry&In-Reply-To=%3C200702021510.l12FAJHl011773%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000018.html">
   <LINK REL="Next"  HREF="000020.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Yade-commits] r1054 - in trunk: yade-guis/yade-gui-qt/src/QtGUI	yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere	yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine	yade-packages/yade-package-dem/src/Engine/StandAloneEngine/ElasticCohesiveLaw	yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer	yade-packages/yade-package-dem/src/PreProcessor	yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending	yade-packages/yade-package-dem/src/RenderingEngine	yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry	yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry</H1>
    <B>cosurgi at BerliOS</B> 
    <A HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1054%20-%20in%20trunk%3A%20yade-guis/yade-gui-qt/src/QtGUI%0A%09yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere%0A%09yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine%0A%09yade-packages/yade-package-dem/src/Engine/StandAloneEngine/ElasticCohesiveLaw%0A%09yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer%0A%09yade-packages/yade-package-dem/src/PreProcessor%0A%09yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending%0A%09yade-packages/yade-package-dem/src/RenderingEngine%0A%09yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry%0A%09yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry&In-Reply-To=%3C200702021510.l12FAJHl011773%40sheep.berlios.de%3E"
       TITLE="[Yade-commits] r1054 - in trunk: yade-guis/yade-gui-qt/src/QtGUI	yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere	yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine	yade-packages/yade-package-dem/src/Engine/StandAloneEngine/ElasticCohesiveLaw	yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer	yade-packages/yade-package-dem/src/PreProcessor	yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending	yade-packages/yade-package-dem/src/RenderingEngine	yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry	yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry">cosurgi at mail.berlios.de
       </A><BR>
    <I>Fri Feb  2 16:10:19 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000018.html">[Yade-commits] r1053 - in trunk: yade-core/src/yade yade-packages/yade-package-common/src/Container/InteractionContainer/InteractionHashMap yade-packages/yade-package-common/src/Container/InteractionContainer/InteractionVecSet yade-packages/yade-package-common/src/DataClass/InteractionGeometry/ClosestFeatures yade-packages/yade-package-common/src/DataClass/InteractionPhysics/SimpleElasticInteraction yade-packages/yade-package-common/src/Engine/DeusExMachina/DisplacementEngine yade-packages/yade-package-common/src/RenderingEngine yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionGeometry yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionPhysics yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction! yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/InteractionOfMyTetrahedron yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/SDECLinkGeometry yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/SpheresContactGeometry yade-packages/yade-package-dem/src/DataClass/InteractionPhysics/ElasticContactInteraction yade-packages/yade-package-dem/src/DataClass/InteractionPhysics/SDECLinkPhysics yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer yade-packages/yade-package-dem/src/RenderingEngine yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry yade-packages/yade-package-lattice/src/DataClass/InteractionPhysics/LatticeBeamAngularSpring yade-packages/yade-package-lattice/src/DataClass/InteractionPhysics/NonLocalDependency yade-packages/yade-package-mass-spring/src/DataClass/InteractionGeometry/Sprin! gGeometry yade-packages/yade-package-mass-spring/src/DataClass! /Interac
</A></li>
        <LI>Next message: <A HREF="000020.html">[Yade-commits] r1055 - trunk/yade-guis/yade-gui-qt/src/QtGUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19">[ date ]</a>
              <a href="thread.html#19">[ thread ]</a>
              <a href="subject.html#19">[ subject ]</a>
              <a href="author.html#19">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: cosurgi
Date: 2007-02-02 16:10:15 +0100 (Fri, 02 Feb 2007)
New Revision: 1054

Added:
   trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/
   trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.cpp
   trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.hpp
   trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.pro
   trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/
   trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp
   trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.hpp
   trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.pro
Modified:
   trunk/yade-guis/yade-gui-qt/src/QtGUI/GLViewer.cpp
   trunk/yade-guis/yade-gui-qt/src/QtGUI/SimulationController.cpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.hpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp
   trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.cpp
   trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp
   trunk/yade-packages/yade-package-dem/src/PreProcessor/PreProcessor.pro
   trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
   trunk/yade-packages/yade-package-dem/src/RenderingEngine/RenderingEngine.pro
Log:

- in GLViewer new keys: 'o' and 'p' to change the field of view. Useful for changing the perspective.

- GLDrawSphere now plots a wireframe sphere very nicely: a circle facing the
  camera. Look very neat when combined with drawn interactions

- I have changed the flag names in OpenGLRenderingEngine. Maybe this look better, what do you think?

- I added a ThreePointBending. It can load spheres from some other simulation,
  put two supports and a moving piston. So we get a beam bending. It works in
  such a way, that first we generate an assembly of compacted spheres using
  Bruno's triaxial compression, with the dimensions of desired beam. Then load
  them into ThreePointBending, and we can bend a beam. It uses a linked spheres
  with unfinished formulas from Jean Patrick Plassiard, so it is rather
  unfinished... just like SDECLinkedSpheres example...




Modified: trunk/yade-guis/yade-gui-qt/src/QtGUI/GLViewer.cpp
===================================================================
--- trunk/yade-guis/yade-gui-qt/src/QtGUI/GLViewer.cpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-guis/yade-gui-qt/src/QtGUI/GLViewer.cpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -108,6 +108,10 @@
 			camera()-&gt;setType(qglviewer::Camera::ORTHOGRAPHIC);
 		updateGL();
 	}
+	else if( e-&gt;key()==Qt::Key_O )
+		camera()-&gt;setFieldOfView(camera()-&gt;fieldOfView()*0.9), updateGL();
+	else if( e-&gt;key()==Qt::Key_P )
+		camera()-&gt;setFieldOfView(camera()-&gt;fieldOfView()*1.1), updateGL();
 
 	else if( e-&gt;key()!=Qt::Key_Escape &amp;&amp; e-&gt;key()!=Qt::Key_Space )
 		QGLViewer::keyPressEvent(e);

Modified: trunk/yade-guis/yade-gui-qt/src/QtGUI/SimulationController.cpp
===================================================================
--- trunk/yade-guis/yade-gui-qt/src/QtGUI/SimulationController.cpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-guis/yade-gui-qt/src/QtGUI/SimulationController.cpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -161,7 +161,8 @@
 }
 
 
-void SimulationController::loadSimulationFromFileName(const std::string&amp; fileName){
+void SimulationController::loadSimulationFromFileName(const std::string&amp; fileName)
+{
 	assert(filesystem::exists(fileName));
 
 //		updater-&gt;stop();

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -11,11 +11,11 @@
 #include &lt;yade/yade-lib-opengl/OpenGLWrapper.hpp&gt;
 
 
-int GLDrawSphere::glSphereList=-1;
-int GLDrawSphere::glWiredSphereList=-1;
+//int GLDrawSphere::glSphereList=-1;
+//int GLDrawSphere::glWiredSphereList=-1;
 
-vector&lt;Vector3r&gt; GLDrawSphere::vertices;
-vector&lt;Vector3r&gt; GLDrawSphere::faces;
+//vector&lt;Vector3r&gt; GLDrawSphere::vertices;
+//vector&lt;Vector3r&gt; GLDrawSphere::faces;
 
 //void drawString(string str,int x,int y,float * c)
 //{
@@ -27,11 +27,12 @@
 //      glPopMatrix();
 //}
 
+GLDrawSphere::GLDrawSphere() : first(true), glSphereList(-1), glWiredSphereList(-1)
+{
+};
 
 void GLDrawSphere::go(const shared_ptr&lt;GeometricalModel&gt;&amp; gm, const shared_ptr&lt;PhysicalParameters&gt;&amp; ph,bool wire)
 {
-        static bool first=true;
-        
 	if (first)
 	{
 		Real X = 0.525731112119133606;
@@ -94,8 +95,51 @@
 		//glScalef(radius,radius,radius);
                 //glCallList(glWiredSphereList);
 
-                glutWireSphere(radius,4,4);
-                
+//                glutWireSphere(radius,4,4);
+
+		///////////////////////
+		// draw a circle from a bunch of short lines
+		//
+		// FACING the camera !!
+		///////////////////////
+		//
+			glPushMatrix();
+
+			float modelview[16];
+			int i,j;
+			glGetFloatv(GL_MODELVIEW_MATRIX , modelview);
+			// undo all rotations
+			// beware all scaling is lost as well 
+			for( i=0; i&lt;3; i++ ) 
+				for( j=0; j&lt;3; j++ ) {
+					if ( i==j )
+						modelview[i*4+j] = 1.0;
+					else
+						modelview[i*4+j] = 0.0;
+				}
+			glLoadMatrixf(modelview);
+
+
+		
+		glDisable(GL_LIGHTING);
+		float vectorY1=radius,startY=vectorY1;
+		float vectorX1=0,startX=vectorX1;
+		glBegin(GL_LINE_STRIP);			
+		for(float angle=0.0f ; angle &lt;= (2.0f*3.14159) ; angle+=0.31f)
+		{		
+			float vectorX=(radius*(float)sin((double)angle));
+			float vectorY=(radius*(float)cos((double)angle));		
+			glVertex2d(vectorX1,vectorY1);
+			vectorY1=vectorY;
+			vectorX1=vectorX;			
+		}
+		glVertex2d(startX,startY);
+		glEnd();
+
+			glPopMatrix();
+
+		/////////////////////
+		
 /////////////////////////// FIXME - display coordinates (stupid place!!)
 //              glPushMatrix();
 //              glRasterPos2i(0,0);
@@ -123,7 +167,11 @@
 		Vector3r v = (v1+v2+v3)/3.0;
 		Real angle = atan(v[2]/v[0])/v.Length();
 
-		// FIXME - another parameter to GLDraw* to allow to disable that stripe on the sphere
+	////////////////////////////
+	//
+	// FIXME - another parameter to GLDraw* to allow to disable that stripe on the sphere
+	//
+	// BEGIN mark
 		GLfloat matAmbient[4];
 
 		if (angle&gt;-Mathr::PI/6.0 &amp;&amp; angle&lt;=Mathr::PI/6.0)
@@ -140,9 +188,12 @@
 			matAmbient[2] = 0.0;
 			matAmbient[3] = 0.0;
 		}
-
+	
 		glMaterialfv(GL_FRONT_AND_BACK,GL_SPECULAR,matAmbient);
-		
+	// END mark
+	////////////////////////////
+	
+	
 		glBegin(GL_TRIANGLES);
 			glNormal3v(v3);
 			glVertex3v(v3);

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.hpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.hpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.hpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -14,14 +14,16 @@
 class GLDrawSphere : public GLDrawGeometricalModelFunctor
 {
 	private :
-		static vector&lt;Vector3r&gt; vertices;
-		static vector&lt;Vector3r&gt; faces;
-		static int glWiredSphereList;
-		static int glSphereList;
+		bool first;
+		vector&lt;Vector3r&gt; vertices;
+		vector&lt;Vector3r&gt; faces;
+		int glWiredSphereList;
+		int glSphereList;
 		void subdivideTriangle(Vector3r&amp; v1,Vector3r&amp; v2,Vector3r&amp; v3, int depth);
 		void drawSphere(int depth);
 	
 	public :
+		GLDrawSphere();
 		virtual void go(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
 		
 	RENDERS(Sphere);

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -16,22 +16,23 @@
 OpenGLRenderingEngine::OpenGLRenderingEngine() : RenderingEngine()
 {
 
-	drawState		= false;
-	drawBoundingVolume	= false;
-	drawInteractingGeometry	= false;
-	drawGeometricalModel	= true;
-	castShadow		= false;
-	drawShadowVolumes	= false;
-	useFastShadowVolume	= true;
-	drawWireFrame		= false;
-	drawInside		= true;
+	Body_state		= false;
+	Body_bounding_volume	= false;
+	Body_interacting_geom	= false;
+	Body_geometrical_model	= true;
+	Cast_shadows		= false;
+	Shadow_volumes	= false;
+	Fast_shadow_volume	= true;
+	Body_wire		= false;
+	Interaction_wire	= false;
+	Draw_inside		= true;
 	needInit		= true;
-	drawMask		= ~0;
-	lightPos		= Vector3r(75.0,130.0,0.0);
-	backGroundColor		= Vector3r(0.2,0.2,0.2);
+	Draw_mask		= ~0;
+	Light_position		= Vector3r(75.0,130.0,0.0);
+	Background_color		= Vector3r(0.2,0.2,0.2);
 	
-	drawInteractionGeometry	= false;
-	drawInteractionPhysics	= false;
+	Interaction_geometry	= false;
+	Interaction_physics	= false;
 	
 	map&lt;string,DynlibDescriptor&gt;::const_iterator di    = Omega::instance().getDynlibsDescriptor().begin();
 	map&lt;string,DynlibDescriptor&gt;::const_iterator diEnd = Omega::instance().getDynlibsDescriptor().end();
@@ -120,10 +121,10 @@
 #endif
 	current_selection = selection;
 	//
-	const GLfloat pos[4]	= {lightPos[0],lightPos[1],lightPos[2],1.0};
+	const GLfloat pos[4]	= {Light_position[0],Light_position[1],Light_position[2],1.0};
 	const GLfloat ambientColor[4]	= {0.5,0.5,0.5,1.0};	
 
-	glClearColor(backGroundColor[0],backGroundColor[1],backGroundColor[2],1.0);
+	glClearColor(Background_color[0],Background_color[1],Background_color[2],1.0);
 	glLightfv(GL_LIGHT0, GL_POSITION, pos);
 	glLightModelfv(GL_LIGHT_MODEL_AMBIENT,ambientColor);
 	glEnable(GL_LIGHT0);
@@ -131,23 +132,23 @@
 	glDisable(GL_LIGHTING);
 	
 	glPushMatrix();
-	glTranslatef(lightPos[0],lightPos[1],lightPos[2]);
+	glTranslatef(Light_position[0],Light_position[1],Light_position[2]);
 	glColor3f(1.0,1.0,1.0);
 	glutSolidSphere(3,10,10);
 	glPopMatrix();	
 	
-	if (drawGeometricalModel)
+	if (Body_geometrical_model)
 	{
-		if (castShadow)
+		if (Cast_shadows)
 		{	
 			
-			if (useFastShadowVolume)
-				renderSceneUsingFastShadowVolumes(rootBody,lightPos);
+			if (Fast_shadow_volume)
+				renderSceneUsingFastShadowVolumes(rootBody,Light_position);
 			else
-				renderSceneUsingShadowVolumes(rootBody,lightPos);
+				renderSceneUsingShadowVolumes(rootBody,Light_position);
 				
 			// draw transparent shadow volume
-			if (drawShadowVolumes)
+			if (Shadow_volumes)
 			{
 				glAlphaFunc(GL_GREATER, 1.0f/255.0f);
 				glEnable(GL_ALPHA_TEST);
@@ -160,10 +161,10 @@
 				glEnable(GL_CULL_FACE);
 			
 				glCullFace(GL_FRONT);
-				renderShadowVolumes(rootBody,lightPos);
+				renderShadowVolumes(rootBody,Light_position);
 				
 				glCullFace(GL_BACK);
-				renderShadowVolumes(rootBody,lightPos);
+				renderShadowVolumes(rootBody,Light_position);
 				
 				glEnable(GL_DEPTH_TEST);
 				glDisable(GL_BLEND);
@@ -178,23 +179,23 @@
 		}
 	}
 	
-	if (drawState)
+	if (Body_state)
 		renderState(rootBody);
 	
-	if (drawBoundingVolume)
+	if (Body_bounding_volume)
 		renderBoundingVolume(rootBody);
 	
-	if (drawInteractingGeometry)
+	if (Body_interacting_geom)
 	{
 		glEnable(GL_LIGHTING);
 		glEnable(GL_CULL_FACE);
 		renderInteractingGeometry(rootBody);
 	}
 
-	if (drawInteractionGeometry)
+	if (Interaction_geometry)
 		renderInteractionGeometry(rootBody);
 	
-	if (drawInteractionPhysics)
+	if (Interaction_physics)
 		renderInteractionPhysics(rootBody);
 	
 
@@ -229,7 +230,7 @@
 }
 
 
-void OpenGLRenderingEngine::renderSceneUsingShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r lightPos)
+void OpenGLRenderingEngine::renderSceneUsingShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r Light_position)
 {
 	glColorMask(GL_FALSE, GL_FALSE, GL_FALSE, GL_FALSE);
 	glEnable(GL_CULL_FACE);
@@ -244,11 +245,11 @@
 
 	glStencilOp(GL_KEEP, GL_KEEP, GL_INCR);
 	glCullFace(GL_BACK);  /* increment using front face of shadow volume */
-	renderShadowVolumes(rootBody,lightPos);
+	renderShadowVolumes(rootBody,Light_position);
 	
 	glStencilOp(GL_KEEP, GL_KEEP, GL_DECR);
 	glCullFace(GL_FRONT);  /* increment using front face of shadow volume */
-	renderShadowVolumes(rootBody,lightPos);	
+	renderShadowVolumes(rootBody,Light_position);	
 			
 	glDepthMask(GL_TRUE);
 	glColorMask(GL_TRUE, GL_TRUE, GL_TRUE, GL_TRUE);
@@ -274,7 +275,7 @@
 }
 
 
-void OpenGLRenderingEngine::renderSceneUsingFastShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r lightPos)
+void OpenGLRenderingEngine::renderSceneUsingFastShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r Light_position)
 {
 	glEnable(GL_CULL_FACE);
 	glEnable(GL_NORMALIZE);
@@ -289,11 +290,11 @@
 
 	glStencilOp(GL_KEEP, GL_KEEP, GL_INCR);
 	glCullFace(GL_BACK);  /* increment using front face of shadow volume */
-	renderShadowVolumes(rootBody,lightPos);
+	renderShadowVolumes(rootBody,Light_position);
 	
 	glStencilOp(GL_KEEP, GL_KEEP, GL_DECR);
 	glCullFace(GL_FRONT);  /* increment using front face of shadow volume */
-	renderShadowVolumes(rootBody,lightPos);	
+	renderShadowVolumes(rootBody,Light_position);	
 	
 	// Need to do that to remove shadow that are not on object but if glClear is 0
 /*	glStencilOp(GL_KEEP, GL_KEEP, GL_INCR);	
@@ -367,7 +368,7 @@
 }	
 
 
-void OpenGLRenderingEngine::renderShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r lightPos)
+void OpenGLRenderingEngine::renderShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r Light_position)
 {	
 	if (!rootBody-&gt;geometricalModel)
 	{
@@ -375,12 +376,12 @@
 		BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
 		for(; bi!=biEnd ; ++bi )
 		{
-			if ((*bi)-&gt;geometricalModel-&gt;shadowCaster &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; drawMask) || (*bi)-&gt;getGroupMask()==0 ))
-				shadowVolumeDispatcher((*bi)-&gt;geometricalModel,(*bi)-&gt;physicalParameters,lightPos);
+			if ((*bi)-&gt;geometricalModel-&gt;shadowCaster &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; Draw_mask) || (*bi)-&gt;getGroupMask()==0 ))
+				shadowVolumeDispatcher((*bi)-&gt;geometricalModel,(*bi)-&gt;physicalParameters,Light_position);
 		}
 	}
 	else
-		shadowVolumeDispatcher(rootBody-&gt;geometricalModel,rootBody-&gt;physicalParameters,lightPos);
+		shadowVolumeDispatcher(rootBody-&gt;geometricalModel,rootBody-&gt;physicalParameters,Light_position);
 }
 
 
@@ -389,13 +390,13 @@
 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = rootBody-&gt;bodies;
 	bool done=false;
 
-	if((rootBody-&gt;geometricalModel || drawInside) &amp;&amp; drawInside)
+	if((rootBody-&gt;geometricalModel || Draw_inside) &amp;&amp; Draw_inside)
 	{
 		BodyContainer::iterator bi    = bodies-&gt;begin();
 		BodyContainer::iterator biEnd = bodies-&gt;end();
 		for( ; bi!=biEnd ; ++bi)
 		{
-			if((*bi)-&gt;geometricalModel &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; drawMask) || (*bi)-&gt;getGroupMask()==0 ))
+			if((*bi)-&gt;geometricalModel &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; Draw_mask) || (*bi)-&gt;getGroupMask()==0 ))
 			{
 				glPushMatrix();
 				Se3r&amp; se3 = (*bi)-&gt;physicalParameters-&gt;se3;
@@ -415,7 +416,7 @@
 					glLightModelfv(GL_LIGHT_MODEL_AMBIENT,ambientColor);
 				}
 				// FIXME FIXME - in fact it is a 1D dispatcher
-				geometricalModelDispatcher((*bi)-&gt;geometricalModel,(*bi)-&gt;physicalParameters,drawWireFrame);
+				geometricalModelDispatcher((*bi)-&gt;geometricalModel,(*bi)-&gt;physicalParameters,Body_wire);
 				if(current_selection == (*bi)-&gt;getId())
 					done = true;
 				glPopMatrix();
@@ -424,7 +425,7 @@
 	}
 	
 	if(rootBody-&gt;geometricalModel)
-		geometricalModelDispatcher(rootBody-&gt;geometricalModel,rootBody-&gt;physicalParameters,drawWireFrame);
+		geometricalModelDispatcher(rootBody-&gt;geometricalModel,rootBody-&gt;physicalParameters,Body_wire);
 }
 
 
@@ -439,7 +440,7 @@
 		{
 			glPushMatrix();
 			if((*bi)-&gt;interactionGeometry)
-				interactionGeometryDispatcher((*bi)-&gt;interactionGeometry,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],drawWireFrame);
+				interactionGeometryDispatcher((*bi)-&gt;interactionGeometry,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],Interaction_wire);
 			glPopMatrix();
 		}
 	}
@@ -453,7 +454,7 @@
 		{
 			glPushMatrix();
 			if((*bi)-&gt;interactionGeometry)
-				interactionGeometryDispatcher((*bi)-&gt;interactionGeometry,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],drawWireFrame);
+				interactionGeometryDispatcher((*bi)-&gt;interactionGeometry,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],Interaction_wire);
 			glPopMatrix();
 		}
 	}
@@ -471,7 +472,7 @@
 		{
 			glPushMatrix();
 			if((*bi)-&gt;interactionPhysics)
-				interactionPhysicsDispatcher((*bi)-&gt;interactionPhysics,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],drawWireFrame);
+				interactionPhysicsDispatcher((*bi)-&gt;interactionPhysics,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],Interaction_wire);
 			glPopMatrix();
 		}
 	}
@@ -485,7 +486,7 @@
 		{
 			glPushMatrix();
 			if((*bi)-&gt;interactionPhysics)
-				interactionPhysicsDispatcher((*bi)-&gt;interactionPhysics,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],drawWireFrame);
+				interactionPhysicsDispatcher((*bi)-&gt;interactionPhysics,(*bi),(*(rootBody-&gt;bodies))[(*bi)-&gt;getId1()],(*(rootBody-&gt;bodies))[(*bi)-&gt;getId2()],Interaction_wire);
 			glPopMatrix();
 		}
 	}
@@ -499,7 +500,7 @@
 	for( ; bi!=biEnd ; ++bi)
 	{
 		glPushMatrix();
-		if((*bi)-&gt;physicalParameters &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; drawMask ) || (*bi)-&gt;getGroupMask()==0 ))
+		if((*bi)-&gt;physicalParameters &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; Draw_mask ) || (*bi)-&gt;getGroupMask()==0 ))
 			stateDispatcher((*bi)-&gt;physicalParameters);
 		glPopMatrix();
 	}
@@ -518,7 +519,7 @@
 	for( ; bi!=biEnd ; ++bi)
 	{
 		glPushMatrix();
-		if((*bi)-&gt;boundingVolume &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; drawMask) || (*bi)-&gt;getGroupMask()==0 ))
+		if((*bi)-&gt;boundingVolume &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; Draw_mask) || (*bi)-&gt;getGroupMask()==0 ))
 			boundingVolumeDispatcher((*bi)-&gt;boundingVolume);
 		glPopMatrix();
 	}
@@ -544,7 +545,7 @@
 		se3.orientation.ToAxisAngle(axis,angle);	
 		glTranslatef(se3.position[0],se3.position[1],se3.position[2]);
 		glRotatef(angle*Mathr::RAD_TO_DEG,axis[0],axis[1],axis[2]);
-		if((*bi)-&gt;interactingGeometry &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; drawMask) || (*bi)-&gt;getGroupMask()==0 ))
+		if((*bi)-&gt;interactingGeometry &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; Draw_mask) || (*bi)-&gt;getGroupMask()==0 ))
 			interactingGeometryDispatcher((*bi)-&gt;interactingGeometry,(*bi)-&gt;physicalParameters);
 		glPopMatrix();
 	}
@@ -558,26 +559,26 @@
 
 void OpenGLRenderingEngine::registerAttributes()
 {
-	REGISTER_ATTRIBUTE(drawState);
-	REGISTER_ATTRIBUTE(drawBoundingVolume);
-	REGISTER_ATTRIBUTE(drawInteractingGeometry);
-	REGISTER_ATTRIBUTE(drawGeometricalModel);
+	REGISTER_ATTRIBUTE(Light_position);
+	REGISTER_ATTRIBUTE(Background_color);
 	
-	REGISTER_ATTRIBUTE(drawMask);
-	
-	REGISTER_ATTRIBUTE(drawWireFrame);
+	REGISTER_ATTRIBUTE(Body_wire);
 
-	REGISTER_ATTRIBUTE(drawInteractionGeometry);
-	REGISTER_ATTRIBUTE(drawInteractionPhysics);
+	REGISTER_ATTRIBUTE(Body_state);
+	REGISTER_ATTRIBUTE(Body_bounding_volume);
+	REGISTER_ATTRIBUTE(Body_interacting_geom);
+	REGISTER_ATTRIBUTE(Body_geometrical_model);
 	
-	REGISTER_ATTRIBUTE(lightPos);
-	REGISTER_ATTRIBUTE(backGroundColor);
+	REGISTER_ATTRIBUTE(Interaction_wire);
+	REGISTER_ATTRIBUTE(Interaction_geometry);
+	REGISTER_ATTRIBUTE(Interaction_physics);
 	
-	REGISTER_ATTRIBUTE(drawInside);
+	REGISTER_ATTRIBUTE(Draw_mask);
+	REGISTER_ATTRIBUTE(Draw_inside);
 
-	REGISTER_ATTRIBUTE(castShadow);
-	REGISTER_ATTRIBUTE(drawShadowVolumes);
-	REGISTER_ATTRIBUTE(useFastShadowVolume);	
+	REGISTER_ATTRIBUTE(Cast_shadows);
+	REGISTER_ATTRIBUTE(Shadow_volumes);
+	REGISTER_ATTRIBUTE(Fast_shadow_volume);	
 }
 
 

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -24,24 +24,25 @@
 class OpenGLRenderingEngine : public RenderingEngine
 {	
 	public : // FIXME - why public ?
-		Vector3r	 lightPos
-				,backGroundColor;
+		Vector3r	 Light_position
+				,Background_color;
 
-		bool		 drawState
-				,drawBoundingVolume
-				,drawInteractingGeometry
-				,drawGeometricalModel
-				,castShadow
-				,drawShadowVolumes
-				,useFastShadowVolume
-				,drawWireFrame
-				,drawInside
-				,drawInteractionGeometry
-				,drawInteractionPhysics
+		bool		 Body_state
+				,Body_bounding_volume
+				,Body_interacting_geom
+				,Body_geometrical_model
+				,Cast_shadows
+				,Shadow_volumes
+				,Fast_shadow_volume
+				,Body_wire
+				,Interaction_wire
+				,Draw_inside
+				,Interaction_geometry
+				,Interaction_physics
 		
 				,needInit;
 		int		 current_selection
-				,drawMask;
+				,Draw_mask;
 
 	private :
 		DynLibDispatcher&lt; InteractionGeometry , GLDrawInteractionGeometryFunctor, void , TYPELIST_5(const shared_ptr&lt;InteractionGeometry&gt;&amp;, const shared_ptr&lt;Interaction&gt;&amp; , const shared_ptr&lt;Body&gt;&amp;, const shared_ptr&lt;Body&gt;&amp;, bool) &gt; interactionGeometryDispatcher;
@@ -85,9 +86,9 @@
 		void renderState(const shared_ptr&lt;MetaBody&gt;&amp; rootBody);
 		void renderBoundingVolume(const shared_ptr&lt;MetaBody&gt;&amp; rootBody);
 		void renderInteractingGeometry(const shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void renderShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r lightPos);
-		void renderSceneUsingShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r lightPos);
-		void renderSceneUsingFastShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r lightPos);
+		void renderShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r Light_position);
+		void renderSceneUsingShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r Light_position);
+		void renderSceneUsingFastShadowVolumes(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,Vector3r Light_position);
 	
 	protected :
 		void postProcessAttributes(bool deserializing);

Modified: trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.cpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.cpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.cpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -64,8 +64,8 @@
 			if( !( (*bodies)[id1]-&gt;getGroupMask() &amp; (*bodies)[id2]-&gt;getGroupMask() &amp; sdecGroupMask) )
 				continue; // skip other groups, BTW: this is example of a good usage of 'continue' keyword
 	
-			BodyMacroParameters* de1				= dynamic_cast&lt;BodyMacroParameters*&gt;((*bodies)[id1]-&gt;physicalParameters.get());
-			BodyMacroParameters* de2				= dynamic_cast&lt;BodyMacroParameters*&gt;((*bodies)[id2]-&gt;physicalParameters.get());
+			BodyMacroParameters* de1			= dynamic_cast&lt;BodyMacroParameters*&gt;((*bodies)[id1]-&gt;physicalParameters.get());
+			BodyMacroParameters* de2			= dynamic_cast&lt;BodyMacroParameters*&gt;((*bodies)[id2]-&gt;physicalParameters.get());
 			SDECLinkPhysics* currentContactPhysics		= dynamic_cast&lt;SDECLinkPhysics*&gt;(contact2-&gt;interactionPhysics.get());
 			SDECLinkGeometry* currentContactGeometry	= dynamic_cast&lt;SDECLinkGeometry*&gt;(contact2-&gt;interactionGeometry.get());
 	

Modified: trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -63,8 +63,8 @@
 			unsigned int i = body -&gt; getId();
 			Vector3r force = dynamic_cast&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find( i , actionForce-&gt;getClassIndex() ) . get() )-&gt;force;
 
-			gm-&gt;diffuseColor[0] = (force[0]-min)/(max-min);
-			gm-&gt;diffuseColor[1] = (force[1]-min)/(max-min);
+			gm-&gt;diffuseColor[0] = (force[2]-min)/(max-min);
+			gm-&gt;diffuseColor[1] = (force[2]-min)/(max-min);
 			gm-&gt;diffuseColor[2] = (force[2]-min)/(max-min);
 
 		/*

Modified: trunk/yade-packages/yade-package-dem/src/PreProcessor/PreProcessor.pro
===================================================================
--- trunk/yade-packages/yade-package-dem/src/PreProcessor/PreProcessor.pro	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-dem/src/PreProcessor/PreProcessor.pro	2007-02-02 15:10:15 UTC (rev 1054)
@@ -9,7 +9,8 @@
            SDECSpheresPlane \
            SDECMovingWall \
            TetrahedronsTest \
-	   TriaxialTest
+	   TriaxialTest \
+	   ThreePointBending
 	   
 
 CONFIG += debug \

Added: trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.cpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.cpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.cpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -0,0 +1,432 @@
+/*************************************************************************
+*  Copyright (C) 2007 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+///
+// FIXME : add CohesiveContactLaw engine to make it work
+///
+
+
+#include &quot;ThreePointBending.hpp&quot;
+
+#include &quot;ElasticContactLaw.hpp&quot;
+#include &quot;ElasticCohesiveLaw.hpp&quot;
+#include &quot;MacroMicroElasticRelationships.hpp&quot;
+#include &quot;BodyMacroParameters.hpp&quot;
+#include &quot;SDECLinkGeometry.hpp&quot;
+#include &quot;SDECLinkPhysics.hpp&quot;
+#include &quot;ElasticCriterionTimeStepper.hpp&quot;
+
+
+#include &lt;yade/yade-core/yadeExceptions.hpp&gt;
+#include &lt;yade/yade-package-common/Box.hpp&gt;
+#include &lt;yade/yade-package-common/AABB.hpp&gt;
+#include &lt;yade/yade-package-common/Sphere.hpp&gt;
+#include &lt;yade/yade-core/MetaBody.hpp&gt;
+#include &lt;yade/yade-package-common/SAPCollider.hpp&gt;
+#include &lt;yade/yade-package-common/PersistentSAPCollider.hpp&gt;
+#include &lt;yade/yade-lib-serialization/IOFormatManager.hpp&gt;
+#include &lt;yade/yade-core/Interaction.hpp&gt;
+#include &lt;yade/yade-package-common/BoundingVolumeMetaEngine.hpp&gt;
+#include &lt;yade/yade-package-common/MetaInteractingGeometry2AABB.hpp&gt;
+#include &lt;yade/yade-package-common/MetaInteractingGeometry.hpp&gt;
+
+#include &lt;yade/yade-package-common/PhysicalActionDamper.hpp&gt;
+#include &lt;yade/yade-package-common/PhysicalActionApplier.hpp&gt;
+#include &lt;yade/yade-package-common/CundallNonViscousForceDamping.hpp&gt;
+#include &lt;yade/yade-package-common/CundallNonViscousMomentumDamping.hpp&gt;
+#include &lt;yade/yade-package-common/GravityEngine.hpp&gt;
+
+#include &lt;yade/yade-package-common/InteractionGeometryMetaEngine.hpp&gt;
+#include &lt;yade/yade-package-common/InteractionPhysicsMetaEngine.hpp&gt;
+#include &lt;yade/yade-core/Body.hpp&gt;
+#include &lt;yade/yade-package-common/InteractingBox.hpp&gt;
+#include &lt;yade/yade-package-common/InteractingSphere.hpp&gt;
+
+#include &lt;yade/yade-package-common/PhysicalActionContainerReseter.hpp&gt;
+#include &lt;yade/yade-package-common/PhysicalActionContainerInitializer.hpp&gt;
+#include &lt;yade/yade-package-common/PhysicalParametersMetaEngine.hpp&gt;
+
+#include &lt;yade/yade-package-common/BodyRedirectionVector.hpp&gt;
+#include &lt;yade/yade-package-common/InteractionVecSet.hpp&gt;
+#include &lt;yade/yade-package-common/PhysicalActionVectorVector.hpp&gt;
+
+#include &lt;yade/yade-package-common/TranslationEngine.hpp&gt;
+
+#include &lt;boost/filesystem/operations.hpp&gt;
+#include &lt;boost/filesystem/convenience.hpp&gt;
+
+
+ThreePointBending::ThreePointBending () : FileGenerator()
+{
+	yadeFileWithSpheres	=&quot;../data/someFileFromTriaxial.yade&quot;;
+	gravity			= Vector3r(0,-9.81,0);
+
+	supportDepth		= 10;
+	pistonWidth		= 5;
+	pistonVelocity		= 0.1;
+	dampingForce		= 0.2;
+	dampingMomentum		= 0.2;
+	
+	timeStepUpdateInterval	= 300;
+	momentRotationLaw       = true;
+	
+	//sphereYoungModulus	= 10000000;
+	sphereYoungModulus	= 30000000;
+	spherePoissonRatio	= 0.2;
+	sphereFrictionDeg       = 18.0;
+	
+	linkKn			= 50000000;
+	linkKs			= 5000000;
+	linkMaxNormalForce	= 5500000;
+	linkMaxShearForce       = 550000;
+}
+
+
+ThreePointBending::~ThreePointBending ()
+{
+
+}
+
+
+void ThreePointBending::postProcessAttributes(bool)
+{
+}
+
+
+void ThreePointBending::registerAttributes()
+{
+	FileGenerator::registerAttributes();
+	
+	REGISTER_ATTRIBUTE(yadeFileWithSpheres);
+	REGISTER_ATTRIBUTE(gravity);
+
+	REGISTER_ATTRIBUTE(pistonWidth);
+	REGISTER_ATTRIBUTE(supportDepth);
+	REGISTER_ATTRIBUTE(pistonVelocity);
+	REGISTER_ATTRIBUTE(dampingForce);
+	REGISTER_ATTRIBUTE(dampingMomentum);
+
+	REGISTER_ATTRIBUTE(timeStepUpdateInterval);
+	REGISTER_ATTRIBUTE(momentRotationLaw);
+	
+	REGISTER_ATTRIBUTE(sphereYoungModulus);
+	REGISTER_ATTRIBUTE(spherePoissonRatio);
+	REGISTER_ATTRIBUTE(sphereFrictionDeg);
+	
+	REGISTER_ATTRIBUTE(linkKn);
+	REGISTER_ATTRIBUTE(linkKs);
+	REGISTER_ATTRIBUTE(linkMaxNormalForce);
+	REGISTER_ATTRIBUTE(linkMaxShearForce);
+}
+
+
+string ThreePointBending::generate()
+{
+	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
+	createActors(rootBody);
+	positionRootBody(rootBody);
+
+////////////////////////////////////
+	
+	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
+	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
+	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
+	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
+
+/////////////////////////////////////
+/////////////////////////////////////
+	// load file
+	
+	shared_ptr&lt;MetaBody&gt; metaBodyWithSpheres;
+
+	if ( 	   yadeFileWithSpheres.size()!=0 
+		&amp;&amp; filesystem::exists(yadeFileWithSpheres) 
+		&amp;&amp; (filesystem::extension(yadeFileWithSpheres)==&quot;.xml&quot; || filesystem::extension(yadeFileWithSpheres)==&quot;.yade&quot;))
+	{
+		try
+		{
+			if(filesystem::extension(yadeFileWithSpheres)==&quot;.xml&quot;)
+				IOFormatManager::loadFromFile(&quot;XMLFormatManager&quot;,yadeFileWithSpheres,&quot;rootBody&quot;,metaBodyWithSpheres);
+
+			else if(filesystem::extension(yadeFileWithSpheres)==&quot;.yade&quot; )
+				IOFormatManager::loadFromFile(&quot;BINFormatManager&quot;,yadeFileWithSpheres,&quot;rootBody&quot;,metaBodyWithSpheres);
+
+			if( metaBodyWithSpheres-&gt;getClassName() != &quot;MetaBody&quot;)
+				return &quot;Error: cannot load the file that should contain spheres&quot;;
+		} 
+		catch(SerializableError&amp; e)
+		{
+			return &quot;Error: cannot load the file that should contain spheres&quot;;
+		}
+		catch(yadeError&amp; e)
+		{
+			return &quot;Error: cannot load the file that should contain spheres&quot;;
+		}
+	}
+/////////////////////////////////////
+	Vector3r min(10000,10000,10000),max(-10000,-10000,-10000);
+	{// calc min/max
+		BodyContainer::iterator bi    = metaBodyWithSpheres-&gt;bodies-&gt;begin();
+		BodyContainer::iterator biEnd = metaBodyWithSpheres-&gt;bodies-&gt;end();
+		for( ; bi!=biEnd ; ++bi )
+		{
+			if((*bi)-&gt;geometricalModel-&gt;getClassName() == &quot;Sphere&quot; )
+			{
+				shared_ptr&lt;Body&gt; b = *bi;
+				min = componentMinVector(min,b-&gt;physicalParameters-&gt;se3.position - static_cast&lt;Sphere*&gt;(b-&gt;geometricalModel.get())-&gt;radius * Vector3r(1,1,1));
+				max = componentMaxVector(max,b-&gt;physicalParameters-&gt;se3.position + static_cast&lt;Sphere*&gt;(b-&gt;geometricalModel.get())-&gt;radius * Vector3r(1,1,1));
+
+				BodyMacroParameters* bm = dynamic_cast&lt;BodyMacroParameters*&gt;(b-&gt;physicalParameters.get());
+				if(!bm)
+					return &quot;Error: spheres don't use BodyMacroParameters for physical parameters&quot;;
+
+				bm-&gt;young		= sphereYoungModulus;
+				bm-&gt;poisson		= spherePoissonRatio;
+				bm-&gt;frictionAngle	= sphereFrictionDeg * Mathr::PI/180.0;
+			}
+		}
+	}
+////////////////////////////////////
+
+	shared_ptr&lt;Body&gt; piston;
+	shared_ptr&lt;Body&gt; supportBox1;
+	shared_ptr&lt;Body&gt; supportBox2;
+	
+	createBox(piston,      Vector3r( (max[0]+min[0])*0.5 , max[1] + (max[0]-min[0])*0.5 ,          (max[2]+min[2])*0.5                ), Vector3r( (max[0]-min[0])*0.5, (max[0]-min[0])*0.5 , pistonWidth          ));
+	createBox(supportBox1, Vector3r( (max[0]+min[0])*0.5 , min[1] - (max[0]-min[0])*0.5 , min[2] - (max[0]-min[0])*0.5 + supportDepth ), Vector3r( (max[0]-min[0])*0.5, (max[0]-min[0])*0.5 , (max[0]-min[0])*0.5  ));
+	createBox(supportBox2, Vector3r( (max[0]+min[0])*0.5 , min[1] - (max[0]-min[0])*0.5 , max[2] + (max[0]-min[0])*0.5 - supportDepth ), Vector3r( (max[0]-min[0])*0.5, (max[0]-min[0])*0.5 , (max[0]-min[0])*0.5  ));
+			
+	rootBody-&gt;bodies-&gt;insert(piston);
+	rootBody-&gt;bodies-&gt;insert(supportBox1);
+	rootBody-&gt;bodies-&gt;insert(supportBox2);
+
+/////////////////////////////////////
+        
+	{// insert Spheres
+		BodyContainer::iterator bi    = metaBodyWithSpheres-&gt;bodies-&gt;begin();
+		BodyContainer::iterator biEnd = metaBodyWithSpheres-&gt;bodies-&gt;end();
+		for( ; bi!=biEnd ; ++bi )
+		{
+			if((*bi)-&gt;geometricalModel-&gt;getClassName() == &quot;Sphere&quot; )
+			{
+				shared_ptr&lt;Body&gt; b = *bi;
+			        rootBody-&gt;bodies-&gt;insert(b);
+			}
+		}
+	}
+	
+/////////////////////////////////////
+
+	rootBody-&gt;persistentInteractions-&gt;clear();
+	
+	shared_ptr&lt;Body&gt; bodyA;
+
+	BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
+	BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
+	BodyContainer::iterator bi2;
+
+	++bi; // skips piston
+	++bi; // skips supportBox1
+	++bi; // skips supportBox2
+		
+		
+	for( ; bi!=biEnd ; ++bi )
+	{
+		bodyA =*bi;
+		bi2=bi;
+		++bi2;
+		for( ; bi2!=biEnd ; ++bi2 )
+		{
+			shared_ptr&lt;Body&gt; bodyB = *bi2;
+
+			shared_ptr&lt;BodyMacroParameters&gt; a = dynamic_pointer_cast&lt;BodyMacroParameters&gt;(bodyA-&gt;physicalParameters);
+			shared_ptr&lt;BodyMacroParameters&gt; b = dynamic_pointer_cast&lt;BodyMacroParameters&gt;(bodyB-&gt;physicalParameters);
+			shared_ptr&lt;InteractingSphere&gt;	as = dynamic_pointer_cast&lt;InteractingSphere&gt;(bodyA-&gt;interactingGeometry);
+			shared_ptr&lt;InteractingSphere&gt;	bs = dynamic_pointer_cast&lt;InteractingSphere&gt;(bodyB-&gt;interactingGeometry);
+
+			if ((a-&gt;se3.position - b-&gt;se3.position).Length() &lt; (as-&gt;radius + bs-&gt;radius))  
+			{
+				shared_ptr&lt;Interaction&gt; 		link(new Interaction( bodyA-&gt;getId() , bodyB-&gt;getId() ));
+				shared_ptr&lt;SDECLinkGeometry&gt;		geometry(new SDECLinkGeometry);
+				shared_ptr&lt;SDECLinkPhysics&gt;	physics(new SDECLinkPhysics);
+				
+				geometry-&gt;radius1			= as-&gt;radius - fabs(as-&gt;radius - bs-&gt;radius)*0.5;
+				geometry-&gt;radius2			= bs-&gt;radius - fabs(as-&gt;radius - bs-&gt;radius)*0.5;
+
+				physics-&gt;initialKn			= linkKn; // FIXME - BIG problem here.
+				physics-&gt;initialKs			= linkKs;
+				physics-&gt;heta				= 1;
+				physics-&gt;initialEquilibriumDistance	= (a-&gt;se3.position - b-&gt;se3.position).Length();
+				physics-&gt;knMax				= linkMaxNormalForce;
+				physics-&gt;ksMax				= linkMaxShearForce;
+
+				link-&gt;interactionGeometry 		= geometry;
+				link-&gt;interactionPhysics 		= physics;
+				link-&gt;isReal 				= true;
+				link-&gt;isNew 				= false;
+				
+				rootBody-&gt;persistentInteractions-&gt;insert(link);
+			}
+		}
+	}
+	
+	return &quot;total number of permament links created: &quot; 
+		+ lexical_cast&lt;string&gt;(rootBody-&gt;persistentInteractions-&gt;size()) 
+		+ &quot;\nWARNING: link bonds are nearly working, but the formulas are waiting for total rewrite!&quot;;
+}
+
+
+void ThreePointBending::createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents)
+{
+	body = shared_ptr&lt;Body&gt;(new Body(0,55));
+	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
+	shared_ptr&lt;AABB&gt; aabb(new AABB);
+	shared_ptr&lt;Box&gt; gBox(new Box);
+	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
+	
+	Quaternionr q;
+	q.FromAxisAngle( Vector3r(0,0,1),0);
+
+	body-&gt;isDynamic			= false;
+	
+	physics-&gt;angularVelocity	= Vector3r(0,0,0);
+	physics-&gt;velocity		= Vector3r(0,0,0);
+	physics-&gt;mass			= extents[0]*extents[1]*extents[2]*2; 
+	physics-&gt;inertia		= Vector3r(
+							  physics-&gt;mass*(extents[1]*extents[1]+extents[2]*extents[2])/3
+							, physics-&gt;mass*(extents[0]*extents[0]+extents[2]*extents[2])/3
+							, physics-&gt;mass*(extents[1]*extents[1]+extents[0]*extents[0])/3
+						);
+//	physics-&gt;mass			= 0;
+//	physics-&gt;inertia		= Vector3r(0,0,0);
+	physics-&gt;se3			= Se3r(position,q);
+	physics-&gt;young			= sphereYoungModulus;
+	physics-&gt;poisson		= spherePoissonRatio;
+	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
+
+	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
+
+	gBox-&gt;extents			= extents;
+	gBox-&gt;diffuseColor		= Vector3f(1,1,1);
+	gBox-&gt;wire			= false;
+	gBox-&gt;visible			= true;
+	gBox-&gt;shadowCaster		= true;
+	
+	iBox-&gt;extents			= extents;
+	iBox-&gt;diffuseColor		= Vector3f(1,1,1);
+
+	body-&gt;boundingVolume		= aabb;
+	body-&gt;interactingGeometry	= iBox;
+	body-&gt;geometricalModel		= gBox;
+	body-&gt;physicalParameters	= physics;
+}
+
+
+void ThreePointBending::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
+{
+	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
+	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
+	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
+	
+	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
+	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingSphere&quot;,&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
+	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
+
+	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
+	interactionPhysicsDispatcher-&gt;add(&quot;BodyMacroParameters&quot;,&quot;BodyMacroParameters&quot;,&quot;MacroMicroElasticRelationships&quot;);
+		
+	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
+	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
+	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
+	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
+		
+	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
+	gravityCondition-&gt;gravity = gravity;
+	
+	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
+	actionForceDamping-&gt;damping = dampingForce;
+	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
+	actionMomentumDamping-&gt;damping = dampingMomentum;
+	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
+	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
+	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
+	
+	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
+	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;NewtonsForceLaw&quot;);
+	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
+	
+	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
+	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
+	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
+	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
+ 	
+	shared_ptr&lt;ElasticCriterionTimeStepper&gt; sdecTimeStepper(new ElasticCriterionTimeStepper);
+	sdecTimeStepper-&gt;sdecGroupMask = 55;
+	sdecTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
+
+// moving wall
+	shared_ptr&lt;TranslationEngine&gt; kinematic = shared_ptr&lt;TranslationEngine&gt;(new TranslationEngine);
+	kinematic-&gt;velocity  = pistonVelocity;
+	kinematic-&gt;translationAxis  = Vector3r(0,-1,0);
+	kinematic-&gt;subscribedBodies.push_back(0);
+
+	shared_ptr&lt;ElasticContactLaw&gt; constitutiveLaw(new ElasticContactLaw);
+	constitutiveLaw-&gt;sdecGroupMask = 55;
+	constitutiveLaw-&gt;momentRotationLaw = momentRotationLaw;
+// FIXME FIXME FIXME ....	
+	shared_ptr&lt;ElasticCohesiveLaw&gt; constitutiveLaw2(new ElasticCohesiveLaw);
+	constitutiveLaw2-&gt;sdecGroupMask = 55;
+	constitutiveLaw2-&gt;momentRotationLaw = momentRotationLaw;
+	
+	rootBody-&gt;engines.clear();
+	rootBody-&gt;engines.push_back(sdecTimeStepper);
+	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
+	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);
+	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
+	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
+	rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
+	rootBody-&gt;engines.push_back(constitutiveLaw);
+	rootBody-&gt;engines.push_back(constitutiveLaw2);
+	rootBody-&gt;engines.push_back(gravityCondition);
+	rootBody-&gt;engines.push_back(actionDampingDispatcher);
+	rootBody-&gt;engines.push_back(applyActionDispatcher);
+	rootBody-&gt;engines.push_back(positionIntegrator);
+	rootBody-&gt;engines.push_back(orientationIntegrator);
+	rootBody-&gt;engines.push_back(kinematic);
+
+	rootBody-&gt;initializers.clear();
+	rootBody-&gt;initializers.push_back(physicalActionInitializer);
+	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
+}
+	
+
+void ThreePointBending::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
+{
+	rootBody-&gt;isDynamic		= false;
+	
+	Quaternionr q;
+	q.FromAxisAngle( Vector3r(0,0,1),0);
+	
+	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters); // FIXME : fix indexable class PhysicalParameters
+	physics-&gt;se3			= Se3r(Vector3r(0,0,0),q);
+	physics-&gt;mass			= 0;
+	physics-&gt;velocity		= Vector3r::ZERO;
+	physics-&gt;acceleration		= Vector3r::ZERO;
+	
+	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
+	set-&gt;diffuseColor		= Vector3f(0,0,1);
+
+	shared_ptr&lt;AABB&gt; aabb(new AABB);
+	aabb-&gt;diffuseColor		= Vector3r(0,0,1);
+	
+	rootBody-&gt;interactingGeometry	= dynamic_pointer_cast&lt;InteractingGeometry&gt;(set);	
+	rootBody-&gt;boundingVolume	= dynamic_pointer_cast&lt;BoundingVolume&gt;(aabb);
+	rootBody-&gt;physicalParameters 	= physics;
+	
+}
+

Added: trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.hpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.hpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.hpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -0,0 +1,60 @@
+/*************************************************************************
+*  Copyright (C) 2007 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef LINKEDSPHERES_HPP
+#define LINKEDSPHERES_HPP
+
+#include &lt;yade/yade-core/FileGenerator.hpp&gt;
+#include &lt;Wm3Vector3.h&gt;
+#include &lt;yade/yade-lib-base/yadeWm3.hpp&gt;
+#include &lt;yade/yade-core/Body.hpp&gt;
+
+class ThreePointBending : public FileGenerator
+{
+	private	:
+		std::string	 yadeFileWithSpheres;
+		Vector3r	 gravity;
+
+		Real		 supportDepth
+				,pistonWidth
+				,pistonVelocity
+				,dampingForce
+				,dampingMomentum
+
+				,linkKn
+				,linkKs
+				,linkMaxNormalForce
+				,linkMaxShearForce
+				,sphereYoungModulus
+				,spherePoissonRatio
+				,sphereFrictionDeg;
+
+		int		 timeStepUpdateInterval;
+
+		bool		 momentRotationLaw;
+	
+		void createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents);
+		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
+		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
+	
+	public :
+		ThreePointBending ();
+		~ThreePointBending ();
+		string generate();
+	
+	protected :
+		virtual void postProcessAttributes(bool deserializing);
+		void registerAttributes();
+	REGISTER_CLASS_NAME(ThreePointBending);
+	REGISTER_BASE_CLASS_NAME(FileGenerator);
+};
+
+REGISTER_SERIALIZABLE(ThreePointBending,false);
+
+#endif // LINKEDSPHERES_HPP
+

Added: trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.pro
===================================================================
--- trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.pro	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.pro	2007-02-02 15:10:15 UTC (rev 1054)
@@ -0,0 +1,63 @@
+isEmpty ( YADE_QMAKE_PATH ) {
+error( &quot;YADE_QMAKE_PATH internal qmake variable is not set, you should run for example qmake YADE_QMAKE_PATH=/usr/local, this will not work from inside kdevelop (when they will fix it?)&quot; )
+}
+
+
+LIBS += -lSDECLinkGeometry \
+        -lElasticContactLaw \
+        -lElasticCohesiveLaw \
+        -lMacroMicroElasticRelationships \
+        -lElasticCriterionTimeStepper \
+        -lPhysicalActionVectorVector \
+        -lInteractionVecSet \
+        -lBodyRedirectionVector \
+        -lInteractingSphere \
+        -lInteractingBox \
+        -lCundallNonViscousMomentumDamping \
+        -lCundallNonViscousForceDamping \
+        -lMetaInteractingGeometry \
+        -lGravityEngine \
+        -lyade-lib-serialization \
+        -lyade-lib-base -lWm3Foundation \
+        -lPhysicalActionContainerInitializer \
+        -lPhysicalActionContainerReseter \
+        -lInteractionGeometryMetaEngine \
+        -lInteractionPhysicsMetaEngine \
+        -lPhysicalActionApplier \
+        -lPhysicalParametersMetaEngine \
+        -lBoundingVolumeMetaEngine \
+        -lBox \
+        -lSphere \
+        -lAABB \
+        -lPersistentSAPCollider \
+        -lParticleParameters \
+        -lSAPCollider \
+        -lMetaInteractingGeometry2AABB \
+        -lyade-lib-multimethods \
+	-lboost_filesystem \
+	-lTranslationEngine \
+        -rdynamic 
+INCLUDEPATH += $${YADE_QMAKE_PATH}/include/ \
+               ../../Engine/StandAloneEngine/ElasticCriterionTimeStepper \
+               ../../Engine/StandAloneEngine/ElasticContactLaw \
+               ../../Engine/StandAloneEngine/ElasticCohesiveLaw \
+               ../../Engine/EngineUnit/MacroMicroElasticRelationships \
+               ../../DataClass/InteractionPhysics/SDECLinkPhysics \
+               ../../DataClass/InteractionGeometry/SDECLinkGeometry \
+               ../../DataClass/PhysicalParameters/BodyMacroParameters 
+QMAKE_LIBDIR = ../../../bin \
+               $${YADE_QMAKE_PATH}/lib/yade/yade-package-common/ \
+               $${YADE_QMAKE_PATH}/lib/yade/yade-libs/ 
+QMAKE_CXXFLAGS_RELEASE += -lpthread \
+                          -pthread 
+QMAKE_CXXFLAGS_DEBUG += -lpthread \
+                        -pthread 
+DESTDIR = ../../../bin 
+CONFIG += debug \
+          thread \
+          warn_on \
+          dll 
+TEMPLATE = lib 
+HEADERS += ThreePointBending.hpp 
+SOURCES += ThreePointBending.cpp 
+QMAKE_RUN_CXX_IMP = $(CXX) -c $(CXXFLAGS) $(INCPATH) -o $@ $(shell pwd)/$&lt;

Added: trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -0,0 +1,80 @@
+/*************************************************************************
+*  Copyright (C) 2007 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include &quot;GLDrawSDECLinkGeometry.hpp&quot;
+#include &quot;SDECLinkGeometry.hpp&quot;
+#include &quot;SimpleElasticInteraction.hpp&quot;
+#include &quot;SDECLinkPhysics.hpp&quot;
+
+#include &lt;yade/yade-lib-opengl/OpenGLWrapper.hpp&gt;
+
+GLDrawSDECLinkGeometry::GLDrawSDECLinkGeometry() : midMax(0), forceMax(0)
+{
+}
+
+void GLDrawSDECLinkGeometry::go(
+		const shared_ptr&lt;InteractionGeometry&gt;&amp; ig,
+		const shared_ptr&lt;Interaction&gt;&amp; ip,
+		const shared_ptr&lt;Body&gt;&amp; b1,
+		const shared_ptr&lt;Body&gt;&amp; b2,
+		bool wireFrame)
+{
+	SDECLinkGeometry*	sc = static_cast&lt;SDECLinkGeometry*&gt;(ig.get());
+	SDECLinkPhysics*	el = static_cast&lt;SDECLinkPhysics*&gt;(ip-&gt;interactionPhysics.get());
+
+	Vector3r contactPoint = (b1-&gt;physicalParameters-&gt;se3.position + b2-&gt;physicalParameters-&gt;se3.position)*0.5 ;
+
+	if(wireFrame)
+	{
+		midMax=0;
+		forceMax=0;
+
+		glTranslatev( contactPoint );
+		glBegin(GL_LINES);
+			glColor3(0.2,0.2,0.9);
+			glVertex3(0.0,0.0,0.0);
+			glVertex3v(-1.0*(sc-&gt;normal*sc-&gt;radius1));
+			glVertex3(0.0,0.0,0.0);
+			glVertex3v( 1.0*(sc-&gt;normal*sc-&gt;radius2));
+		glEnd();
+	}
+	else
+	{
+		Quaternionr q;
+		q.Align(Vector3r(1.0,0.0,0.0),sc-&gt;normal);
+		Vector3r axis;	
+		Real angle;
+		q.ToAxisAngle(axis,angle);
+
+		Real mid = (sc-&gt;radius1 + sc-&gt;radius2);
+		Real dif = (sc-&gt;radius1 - sc-&gt;radius2)*0.5;
+		midMax = std::max(mid,midMax);
+
+		glTranslatev( contactPoint-(sc-&gt;normal*dif) );
+		glRotatef(angle*Mathr::RAD_TO_DEG,axis[0],axis[1],axis[2]);
+		
+	// FIXME - we need a way to give parameters from outside, again.... so curerntly this scale is hardcoded here
+		if( (!ip-&gt;isNew) &amp;&amp; /*ip-&gt;isReal &amp;&amp;*/ ip-&gt;interactionPhysics)
+		{
+			Real force = el-&gt;normalForce.Length()/600;
+			forceMax = std::max(force,forceMax);
+
+			Real scale = midMax*(force/forceMax)*0.3;
+			glScalef(mid,scale,scale);
+		}
+		else
+			glScalef(mid,mid*0.05,mid*0.05);
+		glColor3(0.2,0.2,0.7);
+	// ///////////
+
+		glEnable(GL_LIGHTING);
+		glutSolidCube(1.0);
+
+	}
+}
+

Added: trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.hpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.hpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.hpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -0,0 +1,31 @@
+/*************************************************************************
+*  Copyright (C) 2007 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef GLDRAW_SPHERES_LINK_CONTACT_GEOMETRY_HPP
+#define GLDRAW_SPHERES_LINK_CONTACT_GEOMETRY_HPP
+
+#include &lt;yade/yade-package-common/GLDrawInteractionGeometryFunctor.hpp&gt;
+
+class GLDrawSDECLinkGeometry : public GLDrawInteractionGeometryFunctor
+{	
+	private :
+		Real midMax;
+		Real forceMax;
+	public :
+		GLDrawSDECLinkGeometry();
+		virtual void go(const shared_ptr&lt;InteractionGeometry&gt;&amp;,const shared_ptr&lt;Interaction&gt;&amp;,const shared_ptr&lt;Body&gt;&amp;,const shared_ptr&lt;Body&gt;&amp;,bool wireFrame);
+
+	RENDERS(SDECLinkGeometry);
+	REGISTER_CLASS_NAME(GLDrawSDECLinkGeometry);
+	REGISTER_BASE_CLASS_NAME(GLDrawInteractionGeometryFunctor);
+};
+
+REGISTER_SERIALIZABLE(GLDrawSDECLinkGeometry,false);
+
+#endif 
+

Added: trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.pro
===================================================================
--- trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.pro	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.pro	2007-02-02 15:10:15 UTC (rev 1054)
@@ -0,0 +1,33 @@
+isEmpty ( YADE_QMAKE_PATH ) {
+error( &quot;YADE_QMAKE_PATH internal qmake variable is not set, you should run for example qmake YADE_QMAKE_PATH=/usr/local, this will not work from inside kdevelop (when they will fix it?)&quot; )
+}
+
+
+LIBS += -lSDECLinkGeometry \
+        -lSDECLinkPhysics \
+	-lSimpleElasticInteraction \
+        -lyade-lib-opengl \
+        -rdynamic 
+INCLUDEPATH += $${YADE_QMAKE_PATH}/include/ \
+               ../../DataClass/InteractionGeometry/SDECLinkGeometry \
+	       ../../DataClass/InteractionPhysics/SDECLinkPhysics \
+	       ../../../../yade-package-common/src/DataClass/InteractionPhysics/SimpleElasticInteraction \
+               ../../RenderingEngine/OpenGLRenderingEngine 
+QMAKE_LIBDIR = ../../../bin \
+               ../../../../yade-package-common/bin \
+               $${YADE_QMAKE_PATH}/lib/yade/yade-libs/ 
+QMAKE_CXXFLAGS_RELEASE += -lpthread \
+                          -pthread 
+QMAKE_CXXFLAGS_DEBUG += -lpthread \
+                        -pthread 
+DESTDIR = ../../../bin 
+CONFIG += debug \
+          thread \
+          warn_on \
+          dll 
+TEMPLATE = lib 
+HEADERS += GLDrawSDECLinkGeometry.hpp 
+SOURCES += GLDrawSDECLinkGeometry.cpp 
+
+QMAKE_RUN_CXX_IMP = $(CXX) -c $(CXXFLAGS) $(INCPATH) -o $@ $(shell pwd)/$&lt;
+

Modified: trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2007-02-02 15:10:15 UTC (rev 1054)
@@ -63,12 +63,12 @@
 			Real force = el-&gt;normalForce.Length()/600;
 			forceMax = std::max(force,forceMax);
 
-			Real scale = midMax*(force/forceMax)*0.2;
+			Real scale = midMax*(force/forceMax)*0.3;
 			glScalef(mid,scale,scale);
 		}
 		else
 			glScalef(mid,mid*0.05,mid*0.05);
-		glColor3(0.7,0.7,0.7);
+		glColor3(0.5,0.5,0.5);
 	// ///////////
 
 		glEnable(GL_LIGHTING);

Modified: trunk/yade-packages/yade-package-dem/src/RenderingEngine/RenderingEngine.pro
===================================================================
--- trunk/yade-packages/yade-package-dem/src/RenderingEngine/RenderingEngine.pro	2007-02-01 16:45:03 UTC (rev 1053)
+++ trunk/yade-packages/yade-package-dem/src/RenderingEngine/RenderingEngine.pro	2007-02-02 15:10:15 UTC (rev 1054)
@@ -4,7 +4,8 @@
 
 
 SUBDIRS += GLDrawInteractingMyTetrahedron \
-           GLDrawSpheresContactGeometry
+           GLDrawSpheresContactGeometry \
+	   GLDrawSDECLinkGeometry
 
 CONFIG += debug \
           thread \


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000018.html">[Yade-commits] r1053 - in trunk: yade-core/src/yade yade-packages/yade-package-common/src/Container/InteractionContainer/InteractionHashMap yade-packages/yade-package-common/src/Container/InteractionContainer/InteractionVecSet yade-packages/yade-package-common/src/DataClass/InteractionGeometry/ClosestFeatures yade-packages/yade-package-common/src/DataClass/InteractionPhysics/SimpleElasticInteraction yade-packages/yade-package-common/src/Engine/DeusExMachina/DisplacementEngine yade-packages/yade-package-common/src/RenderingEngine yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionGeometry yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionPhysics yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction! yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/InteractionOfMyTetrahedron yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/SDECLinkGeometry yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/SpheresContactGeometry yade-packages/yade-package-dem/src/DataClass/InteractionPhysics/ElasticContactInteraction yade-packages/yade-package-dem/src/DataClass/InteractionPhysics/SDECLinkPhysics yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer yade-packages/yade-package-dem/src/RenderingEngine yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry yade-packages/yade-package-lattice/src/DataClass/InteractionPhysics/LatticeBeamAngularSpring yade-packages/yade-package-lattice/src/DataClass/InteractionPhysics/NonLocalDependency yade-packages/yade-package-mass-spring/src/DataClass/InteractionGeometry/Sprin! gGeometry yade-packages/yade-package-mass-spring/src/DataClass! /Interac
</A></li>
	<LI>Next message: <A HREF="000020.html">[Yade-commits] r1055 - trunk/yade-guis/yade-gui-qt/src/QtGUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19">[ date ]</a>
              <a href="thread.html#19">[ thread ]</a>
              <a href="subject.html#19">[ subject ]</a>
              <a href="author.html#19">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/yade-commits">More information about the Yade-commits
mailing list</a><br>
</body></html>
