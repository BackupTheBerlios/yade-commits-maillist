<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Yade-commits] r1107 - in branches/scons-layout: extra gui pkg/common pkg/common/Container pkg/common/Container/BodyContainer/BodyAssocVector pkg/common/Container/BodyContainer/BodyRedirectionVector pkg/common/Container/InteractionContainer/InteractionHashMap pkg/common/Container/InteractionContainer/InteractionVecSet pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector pkg/common/DataClass/BoundingVolume pkg/common/DataClass/BoundingVolume/AABB pkg/common/DataClass/BoundingVolume/BoundingSphere pkg/common/DataClass/GeometricalModel pkg/common/DataClass/GeometricalModel/Box pkg/common/DataClass/GeometricalModel/Mesh2D pkg/common/DataClass/GeometricalModel/Quadrilateral pkg/common/DataClass/GeometricalModel/Sphere pkg/common/DataClass/GeometricalModel/Tetrahedron pkg/common/DataClass/InteractingGeometry pkg/common/DataClass/InteractingGeometry/InteractingBox pkg/common/DataClass/InteractingGeometry/InteractingSphere pkg/common/DataClass/InteractingGeometry/MetaIn! teractingGeometry pkg/common/DataClass/InteractionGeometry pkg/common/DataClass/InteractionGeometry/ClosestFeatures pkg/common/DataClass/InteractionPhysics pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction pkg/common/DataClass/PhysicalAction pkg/common/DataClass/PhysicalAction/Force pkg/common/DataClass/PhysicalAction/Momentum pkg/common/DataClass/PhysicalParameters pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters pkg/common/DataClass/PhysicalParameters/ParticleParameters pkg/common/DataClass/PhysicalParameters/RigidBodyParameters pkg/common/Engine/DeusExMachina pkg/common/Engine/DeusExMachina/DisplacementEngine pkg/common/Engine/DeusExMachina/ForceEngine pkg/common/Engine/DeusExMachina/GravityEngine pkg/common/Engine/DeusExMachina/RotationEngine pkg/common/Engine/DeusExMachina/TranslationEngine pkg/common/Engine/EngineUnit pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping pkg! /common/Engine/EngineUnit/ElasticBodySimpleRelationship pkg/co! mmon/Eng
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/yade-commits/2007/index.html" >
   <LINK REL="made" HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1107%20-%20in%20branches/scons-layout%3A%20extra%20gui%0A%20pkg/common%20pkg/common/Container%0A%20pkg/common/Container/BodyContainer/BodyAssocVector%0A%20pkg/common/Container/BodyContainer/BodyRedirectionVector%0A%20pkg/common/Container/InteractionContainer/InteractionHashMap%0A%20pkg/common/Container/InteractionContainer/InteractionVecSet%0A%20pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector%0A%20pkg/common/DataClass/BoundingVolume%0A%20pkg/common/DataClass/BoundingVolume/AABB%0A%20pkg/common/DataClass/BoundingVolume/BoundingSphere%0A%20pkg/common/DataClass/GeometricalModel%0A%20pkg/common/DataClass/GeometricalModel/Box%0A%20pkg/common/DataClass/GeometricalModel/Mesh2D%0A%20pkg/common/DataClass/GeometricalModel/Quadrilateral%0A%20pkg/common/DataClass/GeometricalModel/Sphere%0A%20pkg/common/DataClass/GeometricalModel/Tetrahedron%0A%20pkg/common/DataClass/InteractingGeometry%0A%20pkg/common/DataClass/InteractingGeometry/InteractingBox%0A%20pkg/common/DataClass/InteractingGeometry/InteractingSphere%0A%20pkg/common/DataClass/InteractingGeometry/MetaIn%21%20teractingGeometry%0A%20pkg/common/DataClass/InteractionGeometry%0A%20pkg/common/DataClass/InteractionGeometry/ClosestFeatures%0A%20pkg/common/DataClass/InteractionPhysics%0A%20pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction%0A%20pkg/common/DataClass/PhysicalAction%0A%20pkg/common/DataClass/PhysicalAction/Force%0A%20pkg/common/DataClass/PhysicalAction/Momentum%0A%20pkg/common/DataClass/PhysicalParameters%0A%20pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters%0A%20pkg/common/DataClass/PhysicalParameters/ParticleParameters%0A%20pkg/common/DataClass/PhysicalParameters/RigidBodyParameters%0A%20pkg/common/Engine/DeusExMachina%0A%20pkg/common/Engine/DeusExMachina/DisplacementEngine%0A%20pkg/common/Engine/DeusExMachina/ForceEngine%0A%20pkg/common/Engine/DeusExMachina/GravityEngine%0A%20pkg/common/Engine/DeusExMachina/RotationEngine%0A%20pkg/common/Engine/DeusExMachina/TranslationEngine%0A%20pkg/common/Engine/EngineUnit%0A%20pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping%0A%20pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping%20pkg%21%0A%20/common/Engine/EngineUnit/ElasticBodySimpleRelationship%20pkg/co%21%20mmon/Eng&In-Reply-To=%3C200703071413.l27EDSco018822%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000067.html">
   <LINK REL="Next"  HREF="000068.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Yade-commits] r1107 - in branches/scons-layout: extra gui pkg/common pkg/common/Container pkg/common/Container/BodyContainer/BodyAssocVector pkg/common/Container/BodyContainer/BodyRedirectionVector pkg/common/Container/InteractionContainer/InteractionHashMap pkg/common/Container/InteractionContainer/InteractionVecSet pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector pkg/common/DataClass/BoundingVolume pkg/common/DataClass/BoundingVolume/AABB pkg/common/DataClass/BoundingVolume/BoundingSphere pkg/common/DataClass/GeometricalModel pkg/common/DataClass/GeometricalModel/Box pkg/common/DataClass/GeometricalModel/Mesh2D pkg/common/DataClass/GeometricalModel/Quadrilateral pkg/common/DataClass/GeometricalModel/Sphere pkg/common/DataClass/GeometricalModel/Tetrahedron pkg/common/DataClass/InteractingGeometry pkg/common/DataClass/InteractingGeometry/InteractingBox pkg/common/DataClass/InteractingGeometry/InteractingSphere pkg/common/DataClass/InteractingGeometry/MetaIn! teractingGeometry pkg/common/DataClass/InteractionGeometry pkg/common/DataClass/InteractionGeometry/ClosestFeatures pkg/common/DataClass/InteractionPhysics pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction pkg/common/DataClass/PhysicalAction pkg/common/DataClass/PhysicalAction/Force pkg/common/DataClass/PhysicalAction/Momentum pkg/common/DataClass/PhysicalParameters pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters pkg/common/DataClass/PhysicalParameters/ParticleParameters pkg/common/DataClass/PhysicalParameters/RigidBodyParameters pkg/common/Engine/DeusExMachina pkg/common/Engine/DeusExMachina/DisplacementEngine pkg/common/Engine/DeusExMachina/ForceEngine pkg/common/Engine/DeusExMachina/GravityEngine pkg/common/Engine/DeusExMachina/RotationEngine pkg/common/Engine/DeusExMachina/TranslationEngine pkg/common/Engine/EngineUnit pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping pkg! /common/Engine/EngineUnit/ElasticBodySimpleRelationship pkg/co! mmon/Eng</H1>
    <B>eudoxos at BerliOS</B> 
    <A HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1107%20-%20in%20branches/scons-layout%3A%20extra%20gui%0A%20pkg/common%20pkg/common/Container%0A%20pkg/common/Container/BodyContainer/BodyAssocVector%0A%20pkg/common/Container/BodyContainer/BodyRedirectionVector%0A%20pkg/common/Container/InteractionContainer/InteractionHashMap%0A%20pkg/common/Container/InteractionContainer/InteractionVecSet%0A%20pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector%0A%20pkg/common/DataClass/BoundingVolume%0A%20pkg/common/DataClass/BoundingVolume/AABB%0A%20pkg/common/DataClass/BoundingVolume/BoundingSphere%0A%20pkg/common/DataClass/GeometricalModel%0A%20pkg/common/DataClass/GeometricalModel/Box%0A%20pkg/common/DataClass/GeometricalModel/Mesh2D%0A%20pkg/common/DataClass/GeometricalModel/Quadrilateral%0A%20pkg/common/DataClass/GeometricalModel/Sphere%0A%20pkg/common/DataClass/GeometricalModel/Tetrahedron%0A%20pkg/common/DataClass/InteractingGeometry%0A%20pkg/common/DataClass/InteractingGeometry/InteractingBox%0A%20pkg/common/DataClass/InteractingGeometry/InteractingSphere%0A%20pkg/common/DataClass/InteractingGeometry/MetaIn%21%20teractingGeometry%0A%20pkg/common/DataClass/InteractionGeometry%0A%20pkg/common/DataClass/InteractionGeometry/ClosestFeatures%0A%20pkg/common/DataClass/InteractionPhysics%0A%20pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction%0A%20pkg/common/DataClass/PhysicalAction%0A%20pkg/common/DataClass/PhysicalAction/Force%0A%20pkg/common/DataClass/PhysicalAction/Momentum%0A%20pkg/common/DataClass/PhysicalParameters%0A%20pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters%0A%20pkg/common/DataClass/PhysicalParameters/ParticleParameters%0A%20pkg/common/DataClass/PhysicalParameters/RigidBodyParameters%0A%20pkg/common/Engine/DeusExMachina%0A%20pkg/common/Engine/DeusExMachina/DisplacementEngine%0A%20pkg/common/Engine/DeusExMachina/ForceEngine%0A%20pkg/common/Engine/DeusExMachina/GravityEngine%0A%20pkg/common/Engine/DeusExMachina/RotationEngine%0A%20pkg/common/Engine/DeusExMachina/TranslationEngine%0A%20pkg/common/Engine/EngineUnit%0A%20pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping%0A%20pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping%20pkg%21%0A%20/common/Engine/EngineUnit/ElasticBodySimpleRelationship%20pkg/co%21%20mmon/Eng&In-Reply-To=%3C200703071413.l27EDSco018822%40sheep.berlios.de%3E"
       TITLE="[Yade-commits] r1107 - in branches/scons-layout: extra gui pkg/common pkg/common/Container pkg/common/Container/BodyContainer/BodyAssocVector pkg/common/Container/BodyContainer/BodyRedirectionVector pkg/common/Container/InteractionContainer/InteractionHashMap pkg/common/Container/InteractionContainer/InteractionVecSet pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector pkg/common/DataClass/BoundingVolume pkg/common/DataClass/BoundingVolume/AABB pkg/common/DataClass/BoundingVolume/BoundingSphere pkg/common/DataClass/GeometricalModel pkg/common/DataClass/GeometricalModel/Box pkg/common/DataClass/GeometricalModel/Mesh2D pkg/common/DataClass/GeometricalModel/Quadrilateral pkg/common/DataClass/GeometricalModel/Sphere pkg/common/DataClass/GeometricalModel/Tetrahedron pkg/common/DataClass/InteractingGeometry pkg/common/DataClass/InteractingGeometry/InteractingBox pkg/common/DataClass/InteractingGeometry/InteractingSphere pkg/common/DataClass/InteractingGeometry/MetaIn! teractingGeometry pkg/common/DataClass/InteractionGeometry pkg/common/DataClass/InteractionGeometry/ClosestFeatures pkg/common/DataClass/InteractionPhysics pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction pkg/common/DataClass/PhysicalAction pkg/common/DataClass/PhysicalAction/Force pkg/common/DataClass/PhysicalAction/Momentum pkg/common/DataClass/PhysicalParameters pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters pkg/common/DataClass/PhysicalParameters/ParticleParameters pkg/common/DataClass/PhysicalParameters/RigidBodyParameters pkg/common/Engine/DeusExMachina pkg/common/Engine/DeusExMachina/DisplacementEngine pkg/common/Engine/DeusExMachina/ForceEngine pkg/common/Engine/DeusExMachina/GravityEngine pkg/common/Engine/DeusExMachina/RotationEngine pkg/common/Engine/DeusExMachina/TranslationEngine pkg/common/Engine/EngineUnit pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping pkg! /common/Engine/EngineUnit/ElasticBodySimpleRelationship pkg/co! mmon/Eng">eudoxos at mail.berlios.de
       </A><BR>
    <I>Wed Mar  7 15:13:28 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000067.html">[Yade-commits] r1106 - branches/scons-layout/scripts
</A></li>
        <LI>Next message: <A HREF="000068.html">[Yade-commits] r1108 - in branches/scons-layout/pkg: common/Container/BodyContainer common/Container/InteractionContainer common/Container/PhysicalActionContainer common/DataClass/BoundingVolume common/DataClass/GeometricalModel common/DataClass/InteractingGeometry common/DataClass/InteractionGeometry common/DataClass/InteractionPhysics common/DataClass/PhysicalAction common/DataClass/PhysicalParameters common/Engine/DeusExMachina common/Engine/EngineUnit common/Engine/MetaEngine common/Engine/StandAloneEngine common/RenderingEngine/GLDrawBoundingVolume common/RenderingEngine/GLDrawGeometricalModel common/RenderingEngine/GLDrawInteractingGeometry common/RenderingEngine/GLDrawInteractionGeometry common/RenderingEngine/GLDrawInteractionPhysics common/RenderingEngine/GLDrawShadowVolume common/RenderingEngine/GLDrawState dem/DataClass/InteractingGeometry dem/DataClass/InteractionGeometry dem/DataClass/InteractionPhysics dem/DataClass/PhysicalAction dem/DataClass/PhysicalParameters dem! /Engine/DeusExMachina dem/Engine/EngineUnit dem/Engine/StandAloneEngine dem/PreProcessor fem/DataClass/GeometricalModel fem/DataClass/PhysicalParameters fem/Engine/EngineUnit fem/Engine/StandAloneEngine fem/PreProcessor lattice/DataClass/GeometricalModel lattice/DataClass/InteractingGeometry lattice/DataClass/InteractionPhysics lattice/DataClass/PhysicalParameters lattice/Engine/EngineUnit lattice/Engine/StandAloneEngine lattice/PreProcessor mass-spring/DataClass/InteractionGeometry mass-spring/DataClass/InteractionPhysics mass-spring/DataClass/PhysicalParameters mass-spring/Engine/EngineUnit mass-spring/Engine/StandAloneEngine mass-spring/PreProcessor realtime-rigidbody/DataClass/InteractionGeometry realtime-rigidbody/Engine/EngineUnit realtime-rigidbody/Engine/StandAloneEngine realtime-rigidbody/PreProcessor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73">[ date ]</a>
              <a href="thread.html#73">[ thread ]</a>
              <a href="subject.html#73">[ subject ]</a>
              <a href="author.html#73">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: eudoxos
Date: 2007-03-07 15:13:16 +0100 (Wed, 07 Mar 2007)
New Revision: 1107

Added:
   branches/scons-layout/pkg/common/Container/BodyAssocVector.cpp
   branches/scons-layout/pkg/common/Container/BodyAssocVector.hpp
   branches/scons-layout/pkg/common/Container/BodyAssocVectorIterator.cpp
   branches/scons-layout/pkg/common/Container/BodyAssocVectorIterator.hpp
   branches/scons-layout/pkg/common/Container/BodyRedirectionVector.cpp
   branches/scons-layout/pkg/common/Container/BodyRedirectionVector.hpp
   branches/scons-layout/pkg/common/Container/BodyRedirectionVectorIterator.cpp
   branches/scons-layout/pkg/common/Container/BodyRedirectionVectorIterator.hpp
   branches/scons-layout/pkg/common/Container/InteractionHashMap.cpp
   branches/scons-layout/pkg/common/Container/InteractionHashMap.hpp
   branches/scons-layout/pkg/common/Container/InteractionHashMapIterator.cpp
   branches/scons-layout/pkg/common/Container/InteractionHashMapIterator.hpp
   branches/scons-layout/pkg/common/Container/InteractionVecSet.cpp
   branches/scons-layout/pkg/common/Container/InteractionVecSet.hpp
   branches/scons-layout/pkg/common/Container/InteractionVecSetIterator.cpp
   branches/scons-layout/pkg/common/Container/InteractionVecSetIterator.hpp
   branches/scons-layout/pkg/common/Container/PhysicalActionVectorVector.cpp
   branches/scons-layout/pkg/common/Container/PhysicalActionVectorVector.hpp
   branches/scons-layout/pkg/common/Container/PhysicalActionVectorVectorIterator.cpp
   branches/scons-layout/pkg/common/Container/PhysicalActionVectorVectorIterator.hpp
   branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB.cpp
   branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB.hpp
   branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere.cpp
   branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere.hpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box.cpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box.hpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D.cpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D.hpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral.cpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral.hpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere.cpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere.hpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron.cpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron.hpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox.cpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox.hpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere.cpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere.hpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry.cpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry.hpp
   branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures.cpp
   branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures.hpp
   branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction.cpp
   branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction.hpp
   branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force.cpp
   branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force.hpp
   branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum.cpp
   branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum.hpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters.cpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters.hpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters.cpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters.hpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters.cpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters.hpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine.cpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine.hpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine.cpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine.hpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine.cpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine.hpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine.cpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine.hpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine.cpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplierUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamperUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.hpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.hpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.hpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider.cpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics.hpp
   branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness.cpp
   branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness.hpp
   branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters.cpp
   branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters.hpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.cpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.hpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.hpp
   branches/scons-layout/pkg/dem/PreProcessor/Funnel.cpp
   branches/scons-layout/pkg/dem/PreProcessor/Funnel.hpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest.cpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest.hpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres.cpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres.hpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall.cpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall.hpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane.cpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane.hpp
   branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest.cpp
   branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest.hpp
   branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending.cpp
   branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending.hpp
   branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest.cpp
   branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest.hpp
   branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry.cpp
   branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry.hpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData.cpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData.hpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters.cpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters.hpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData.cpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData.hpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons.cpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons.hpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader.cpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader.hpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness.cpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness.hpp
   branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw.cpp
   branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw.hpp
   branches/scons-layout/pkg/fem/PreProcessor/FEMBeam.cpp
   branches/scons-layout/pkg/fem/PreProcessor/FEMBeam.hpp
   branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry.cpp
   branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry.hpp
   branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment.cpp
   branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment.hpp
   branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry.cpp
   branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry.hpp
   branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring.cpp
   branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring.hpp
   branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency.cpp
   branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency.hpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters.cpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters.hpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters.cpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters.hpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters.cpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters.hpp
   branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams.cpp
   branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.hpp
   branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample.cpp
   branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample.hpp
   branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry.cpp
   branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry.hpp
   branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics.cpp
   branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics.hpp
   branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters.cpp
   branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters.hpp
   branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D.cpp
   branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D.hpp
   branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.cpp
   branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.hpp
   branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth.cpp
   branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth.hpp
   branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact.cpp
   branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.hpp
   branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack.cpp
   branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack.hpp
   branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox.cpp
   branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox.hpp
Removed:
   branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVector.cpp
   branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVector.hpp
   branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVectorIterator.cpp
   branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVectorIterator.hpp
   branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVector.cpp
   branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVector.hpp
   branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVectorIterator.cpp
   branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVectorIterator.hpp
   branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMap.cpp
   branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMap.hpp
   branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMapIterator.cpp
   branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMapIterator.hpp
   branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSet.cpp
   branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSet.hpp
   branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSetIterator.cpp
   branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSetIterator.hpp
   branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVector.cpp
   branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVector.hpp
   branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVectorIterator.cpp
   branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVectorIterator.hpp
   branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB/AABB.cpp
   branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB/AABB.hpp
   branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere/BoundingSphere.cpp
   branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere/BoundingSphere.hpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box/Box.cpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box/Box.hpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D/Mesh2D.cpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D/Mesh2D.hpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral/Quadrilateral.cpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral/Quadrilateral.hpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere/Sphere.cpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere/Sphere.hpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron/Tetrahedron.cpp
   branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron/Tetrahedron.hpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox/InteractingBox.cpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox/InteractingBox.hpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere/InteractingSphere.cpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere/InteractingSphere.hpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry/MetaInteractingGeometry.cpp
   branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry/MetaInteractingGeometry.hpp
   branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures/ClosestFeatures.cpp
   branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures/ClosestFeatures.hpp
   branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction/SimpleElasticInteraction.cpp
   branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction/SimpleElasticInteraction.hpp
   branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force/Force.cpp
   branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force/Force.hpp
   branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum/Momentum.cpp
   branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum/Momentum.hpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters/ElasticBodyParameters.cpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters/ElasticBodyParameters.hpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters/ParticleParameters.cpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters/ParticleParameters.hpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters/RigidBodyParameters.cpp
   branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters/RigidBodyParameters.hpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine/DisplacementEngine.cpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine/DisplacementEngine.hpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine/ForceEngine.cpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine/ForceEngine.hpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine/GravityEngine.cpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine/GravityEngine.hpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine/RotationEngine.cpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine/RotationEngine.hpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine/TranslationEngine.cpp
   branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine/TranslationEngine.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping/CundallNonViscousForceDamping.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping/CundallNonViscousForceDamping.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping/CundallNonViscousMomentumDamping.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping/CundallNonViscousMomentumDamping.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship/ElasticBodySimpleRelationship.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship/ElasticBodySimpleRelationship.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB/InteractingBox2AABB.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB/InteractingBox2AABB.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB/InteractingSphere2AABB.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB/InteractingSphere2AABB.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB/MetaInteractingGeometry2AABB.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB/MetaInteractingGeometry2AABB.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.hpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.cpp
   branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplier.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplier.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplierUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamper.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamper.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamperUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersEngineUnit.hpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersMetaEngine.cpp
   branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersMetaEngine.hpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.cpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.hpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer/PhysicalActionContainerInitializer.cpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer/PhysicalActionContainerInitializer.hpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter/PhysicalActionContainerReseter.cpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter/PhysicalActionContainerReseter.hpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider/SAPCollider.cpp
   branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider/SAPCollider.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB/GLDrawAABB.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB/GLDrawAABB.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere/GLDrawBoundingSphere.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere/GLDrawBoundingSphere.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox/GLDrawBox.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox/GLDrawBox.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D/GLDrawMesh2D.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D/GLDrawMesh2D.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral/GLDrawQuadrilateral.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral/GLDrawQuadrilateral.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron/GLDrawTetrahedron.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron/GLDrawTetrahedron.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures/GLDrawClosestFeatures.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures/GLDrawClosestFeatures.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction/GLDrawSimpleElasticInteraction.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction/GLDrawSimpleElasticInteraction.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume/GLDrawBoxShadowVolume.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume/GLDrawBoxShadowVolume.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume/GLDrawSphereShadowVolume.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume/GLDrawSphereShadowVolume.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState/GLDrawParticleState.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState/GLDrawParticleState.hpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState/GLDrawRigidBodyState.cpp
   branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState/GLDrawRigidBodyState.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron/InteractingMyTetrahedron.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron/InteractingMyTetrahedron.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron/InteractionOfMyTetrahedron.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron/InteractionOfMyTetrahedron.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry/SDECLinkGeometry.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry/SDECLinkGeometry.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry/SpheresContactGeometry.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry/SpheresContactGeometry.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction/ElasticContactInteraction.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction/ElasticContactInteraction.hpp
   branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics/SDECLinkPhysics.cpp
   branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics/SDECLinkPhysics.hpp
   branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness/GlobalStiffness.cpp
   branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness/GlobalStiffness.hpp
   branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters/BodyMacroParameters.cpp
   branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters/BodyMacroParameters.hpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine/ResultantForceEngine.cpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine/ResultantForceEngine.hpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine/TriaxialCompressionEngine.cpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine/TriaxialCompressionEngine.hpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController/TriaxialStressController.cpp
   branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController/TriaxialStressController.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB/InteractingMyTetrahedron2AABB.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB/InteractingMyTetrahedron2AABB.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships/MacroMicroElasticRelationships.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships/MacroMicroElasticRelationships.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships/SimpleElasticRelationships.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships/SimpleElasticRelationships.hpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron/Tetrahedron2InteractingMyTetrahedron.cpp
   branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron/Tetrahedron2InteractingMyTetrahedron.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder/AveragePositionRecorder.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder/AveragePositionRecorder.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw/ElasticContactLaw.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw/ElasticContactLaw.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper/ElasticCriterionTimeStepper.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper/ElasticCriterionTimeStepper.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder/ForceRecorder.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder/ForceRecorder.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter/GlobalStiffnessCounter.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter/GlobalStiffnessCounter.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper/GlobalStiffnessTimeStepper.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper/GlobalStiffnessTimeStepper.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw/MyTetrahedronLaw.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw/MyTetrahedronLaw.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder/PositionOrientationRecorder.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder/PositionOrientationRecorder.hpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder/VelocityRecorder.cpp
   branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder/VelocityRecorder.hpp
   branches/scons-layout/pkg/dem/PreProcessor/Funnel/Funnel.cpp
   branches/scons-layout/pkg/dem/PreProcessor/Funnel/Funnel.hpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest/SDECImpactTest.cpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest/SDECImpactTest.hpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres/SDECLinkedSpheres.cpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres/SDECLinkedSpheres.hpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall/SDECMovingWall.cpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall/SDECMovingWall.hpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane/SDECSpheresPlane.cpp
   branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane/SDECSpheresPlane.hpp
   branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest/TetrahedronsTest.cpp
   branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest/TetrahedronsTest.hpp
   branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending/ThreePointBending.cpp
   branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending/ThreePointBending.hpp
   branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest/TriaxialTest.cpp
   branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest/TriaxialTest.hpp
   branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry/FEMSetGeometry.cpp
   branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry/FEMSetGeometry.hpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData/FEMNodeData.cpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData/FEMNodeData.hpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters/FEMSetParameters.cpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters/FEMSetParameters.hpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData/FEMTetrahedronData.cpp
   branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData/FEMTetrahedronData.hpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons/FEMSet2Tetrahedrons.cpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons/FEMSet2Tetrahedrons.hpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader/FEMSetTextLoader.cpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader/FEMSetTextLoader.hpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness/FEMTetrahedronStiffness.cpp
   branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness/FEMTetrahedronStiffness.hpp
   branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw/FEMLaw.cpp
   branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw/FEMLaw.hpp
   branches/scons-layout/pkg/fem/PreProcessor/FEMBeam/FEMBeam.cpp
   branches/scons-layout/pkg/fem/PreProcessor/FEMBeam/FEMBeam.hpp
   branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry/LatticeSetGeometry.cpp
   branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry/LatticeSetGeometry.hpp
   branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment/LineSegment.cpp
   branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment/LineSegment.hpp
   branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.cpp
   branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.hpp
   branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring/LatticeBeamAngularSpring.cpp
   branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring/LatticeBeamAngularSpring.hpp
   branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency/NonLocalDependency.cpp
   branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency/NonLocalDependency.hpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters/LatticeBeamParameters.cpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters/LatticeBeamParameters.hpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters/LatticeNodeParameters.cpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters/LatticeNodeParameters.hpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters/LatticeSetParameters.cpp
   branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters/LatticeSetParameters.hpp
   branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams/LatticeSet2LatticeBeams.cpp
   branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams/LatticeSet2LatticeBeams.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder/BeamRecorder.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder/BeamRecorder.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw/LatticeLaw.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw/LatticeLaw.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson/MeasurePoisson.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson/MeasurePoisson.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport/MovingSupport.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport/MovingSupport.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder/NodeRecorder.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder/NodeRecorder.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer/NonLocalInitializer.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer/NonLocalInitializer.hpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder/StrainRecorder.cpp
   branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder/StrainRecorder.hpp
   branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample/LatticeExample.cpp
   branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample/LatticeExample.hpp
   branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry/SpringGeometry.cpp
   branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry/SpringGeometry.hpp
   branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics/SpringPhysics.cpp
   branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics/SpringPhysics.hpp
   branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters/ParticleSetParameters.cpp
   branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters/ParticleSetParameters.hpp
   branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D/ParticleSet2Mesh2D.cpp
   branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D/ParticleSet2Mesh2D.hpp
   branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw/MassSpringLaw.cpp
   branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw/MassSpringLaw.hpp
   branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth/HangingCloth.cpp
   branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth/HangingCloth.hpp
   branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact/ErrorTolerantContact.cpp
   branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact/ErrorTolerantContact.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures/AAInteractingBox2InteractingSphere4ClosestFeatures.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures/AAInteractingBox2InteractingSphere4ClosestFeatures.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures/InteractingBox2InteractingBox4ClosestFeatures.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures/InteractingBox2InteractingBox4ClosestFeatures.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures/InteractingBox2InteractingSphere4ClosestFeatures.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures/InteractingBox2InteractingSphere4ClosestFeatures.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact/InteractingBox2InteractingSphere4ErrorTolerantContact.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact/InteractingBox2InteractingSphere4ErrorTolerantContact.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures/InteractingSphere2InteractingSphere4ClosestFeatures.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures/InteractingSphere2InteractingSphere4ClosestFeatures.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact/InteractingSphere2InteractingSphere4ErrorTolerantContact.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact/InteractingSphere2InteractingSphere4ErrorTolerantContact.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw/ErrorTolerantLaw.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw/ErrorTolerantLaw.hpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw/FrictionLessElasticContactLaw.cpp
   branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw/FrictionLessElasticContactLaw.hpp
   branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack/BoxStack.cpp
   branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack/BoxStack.hpp
   branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox/RotatingBox.cpp
   branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox/RotatingBox.hpp
Modified:
   branches/scons-layout/extra/SConscript
   branches/scons-layout/gui/SConscript
   branches/scons-layout/pkg/common/SConscript
   branches/scons-layout/pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp
   branches/scons-layout/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
   branches/scons-layout/pkg/dem/SConscript
   branches/scons-layout/pkg/fem/SConscript
   branches/scons-layout/pkg/lattice/SConscript
   branches/scons-layout/pkg/mass-spring/SConscript
   branches/scons-layout/pkg/realtime-rigidbody/SConscript
   branches/scons-layout/scripts/ysl1.py
Log:
Compiles withou trouble. Empty dirs will be removed shortly.



Modified: branches/scons-layout/extra/SConscript
===================================================================
--- branches/scons-layout/extra/SConscript	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/extra/SConscript	2007-03-07 14:13:16 UTC (rev 1107)
@@ -2,8 +2,8 @@
 env.Install('$PREFIX/lib/yade$POSTFIX/extra',[
 
 	env.SharedLibrary('SphericalDEMSimulator',
-		['yade-spherical-dem-simulator/PersistentAloneSAPCollider.cpp',
-			'yade-spherical-dem-simulator/SphericalDEMSimulator.cpp'],
+		['spherical-dem-simulator/PersistentAloneSAPCollider.cpp',
+			'spherical-dem-simulator/SphericalDEMSimulator.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'MacroMicroElasticRelationships',
@@ -19,7 +19,7 @@
 			'yade-serialization',
 			'yade-base',
 			'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['yade-spherical-dem-simulator/src/SphericalDEMSimulator', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['spherical-dem-simulator/src/SphericalDEMSimulator', '$PREFIX/include']),
 
 	env.SharedLibrary('Clump',
 		['clump/Clump.cpp'],

Modified: branches/scons-layout/gui/SConscript
===================================================================
--- branches/scons-layout/gui/SConscript	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/gui/SConscript	2007-03-07 14:13:16 UTC (rev 1107)
@@ -38,11 +38,11 @@
 			'yade-opengl',
 			'yade-serialization',
 			'yade-computational-geometry',
-			'XMLFormatManager',
+			'yade-XMLFormatManager',
 			'yade-serialization-qt',
 			'QGLViewer',
 			'boost_date_time',
 			'boost_filesystem'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'yade-gui-qt/src/QtGUI'])
+		CPPPATH=env['CPPPATH']+['qt'])
 ])
 

Copied: branches/scons-layout/pkg/common/Container/BodyAssocVector.cpp (from rev 1105, branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVector.cpp)

Copied: branches/scons-layout/pkg/common/Container/BodyAssocVector.hpp (from rev 1105, branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVector.hpp)

Copied: branches/scons-layout/pkg/common/Container/BodyAssocVectorIterator.cpp (from rev 1105, branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVectorIterator.cpp)

Copied: branches/scons-layout/pkg/common/Container/BodyAssocVectorIterator.hpp (from rev 1105, branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVectorIterator.hpp)

Deleted: branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVector.cpp
===================================================================
--- branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVector.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVector.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,174 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;BodyAssocVector.hpp&quot;
-#include &quot;BodyAssocVectorIterator.hpp&quot;
-
-
-#include&lt;yade/core/Body.hpp&gt;
-
-
-BodyAssocVector::BodyAssocVector()
-{
-	clear();
-}
-
-
-BodyAssocVector::~BodyAssocVector()
-{
-}
-
-
-unsigned int BodyAssocVector::insert(shared_ptr&lt;Body&gt;&amp; b)
-{
-//	unsigned int max;
-//	if( bodies.begin() != bodies.end() )
-//		max = (--(bodies.end()))-&gt;first + 1;
-//	else
-//		max = 0;
-//	bodies.insert( Loki::AssocVector::value_type( max , b ));
-//	bodies[max]=b;
-//	BodyContainer::setId(b,max);
-//	return max;
-
-	unsigned int position = b-&gt;getId();
-
-	Loki::AssocVector&lt;unsigned int , shared_ptr&lt;Body&gt; &gt;::const_iterator tmpBii;
-	tmpBii = bodies.find(position);
-	if( tmpBii != bodies.end() )
-	{
-		unsigned int newPosition = position;
-		// finds the first free key, which is bigger than id.
-		while( bodies.find(newPosition) != bodies.end() )
-			++newPosition;
-		//cerr &lt;&lt; &quot;WARNING: body id=\&quot;&quot; &lt;&lt; position &lt;&lt; &quot;\&quot; is already used. Using first free id=\&quot;&quot; &lt;&lt; newPosition &lt;&lt; &quot;\&quot;, beware - if you are loading a file, this will break interactions for this body!\n&quot;;
-		position = newPosition;
-	}
-	BodyContainer::setId(b,position);
-	bodies[position]=b;
-	return position;
-}
-
-
-unsigned int BodyAssocVector::insert(shared_ptr&lt;Body&gt;&amp; b, unsigned int newId)
-{
-	BodyContainer::setId(b,newId);
-	return insert(b);
-}
-
-
-void BodyAssocVector::clear()
-{
-	bodies.clear();
-}
-
-
-bool BodyAssocVector::erase(unsigned int id)
-{
-
-// WARNING!!! AssocVector.erase() invalidates all iterators !!!
-
-	Loki::AssocVector&lt;unsigned int , shared_ptr&lt;Body&gt; &gt;::iterator bii = bodies.find(id);
-
-	if( bii != bodies.end() )
-	{
-		bodies.erase(bii);
-		return true;
-	}
-	else
-		return false;
-}
-
-
-bool BodyAssocVector::exists(unsigned int id) const
-{
-	Loki::AssocVector&lt;unsigned int , shared_ptr&lt;Body&gt; &gt;::const_iterator tmpBii;
-	tmpBii = bodies.find(id);
-
-	return (tmpBii != bodies.end());
-}
-
-bool BodyAssocVector::find(unsigned int id , shared_ptr&lt;Body&gt;&amp; b) const
-{
-	// do not modify the interanl iterator
-	Loki::AssocVector&lt;unsigned int , shared_ptr&lt;Body&gt; &gt;::const_iterator tmpBii;
-	tmpBii = bodies.find(id);
-
-	if (tmpBii != bodies.end())
-	{
-		b = (*tmpBii).second;
-		return true;
-	}
-	else
-		return false;
-}
-
-
-shared_ptr&lt;Body&gt;&amp; BodyAssocVector::operator[](unsigned int id)
-{
-	// do not modify bii iterator
-	Loki::AssocVector&lt;unsigned int , shared_ptr&lt;Body&gt; &gt;::iterator temporaryBii = bodies.find(id);
-//	if (bii != bodies.end())
-	return (*temporaryBii).second;
-//	else
-//		return shared_ptr&lt;Body&gt;();
-}
-
-
-const shared_ptr&lt;Body&gt;&amp; BodyAssocVector::operator[](unsigned int id) const
-{
-	Loki::AssocVector&lt;unsigned int , shared_ptr&lt;Body&gt; &gt;::const_iterator tmpBii;
-	tmpBii = bodies.find(id);
-// when commented it is faster, but less secure.
-//	if (tmpBii != bodies.end())
-		return (*tmpBii).second;
-//	else
-//		return shared_ptr&lt;Body&gt;();
-}
-
-
-BodyContainer::iterator BodyAssocVector::begin()
-{
-	shared_ptr&lt;BodyAssocVectorIterator&gt; it(new BodyAssocVectorIterator());
-	it-&gt;bii   = bodies.begin();
-
-	return BodyContainer::iterator(it);
-
-}
-
-
-BodyContainer::iterator BodyAssocVector::end()
-{
-	shared_ptr&lt;BodyAssocVectorIterator&gt; it(new BodyAssocVectorIterator());
-	it-&gt;bii   = bodies.end();
-
-	return BodyContainer::iterator(it);
-}
-
-
- 
-// 
-// void BodyAssocVector::pushIterator()
-// {// FIXME - make sure that this is FIFO (I'm tired now...)
-// 	iteratorList.push_front(bii);
-// }
-// 
-// 
-// void BodyAssocVector::popIterator()
-// {
-// 	bii = iteratorList.front();
-// 	iteratorList.pop_front();
-// }
-// 
-
-unsigned int BodyAssocVector::size()
-{
-	return bodies.size();
-}
-
-

Deleted: branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVector.hpp
===================================================================
--- branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVector.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVector.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,54 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-#ifndef BODYASSOCVEC_HPP
-#define BODYASSOCVEC_HPP
-
-#include&lt;yade/core/BodyContainer.hpp&gt;
-#include&lt;yade/lib-loki/AssocVector.hpp&gt;
-
-#include &lt;list&gt;
-
-class Body;
-
-using namespace boost;
-
-class BodyAssocVector : public BodyContainer
-{
-	private	:
-		Loki::AssocVector&lt;unsigned int , shared_ptr&lt;Body&gt; &gt; bodies;
-
-	public	:
-		BodyAssocVector();
-		virtual ~BodyAssocVector();
-
-		virtual unsigned int insert(shared_ptr&lt;Body&gt;&amp;);
-		virtual unsigned int insert(shared_ptr&lt;Body&gt;&amp; , unsigned int);
-		virtual void clear();
-		virtual bool erase(unsigned int);
-		virtual bool find(unsigned int , shared_ptr&lt;Body&gt;&amp;) const;
-		virtual bool exists(unsigned int id) const;
-		virtual shared_ptr&lt;Body&gt;&amp; operator[](unsigned int);
-		virtual const shared_ptr&lt;Body&gt;&amp; operator[](unsigned int) const;
-
-		virtual BodyContainer::iterator begin();
-        	virtual BodyContainer::iterator end();
-
-		virtual unsigned int size();
-
-	REGISTER_CLASS_NAME(BodyAssocVector);
-	REGISTER_BASE_CLASS_NAME(BodyContainer);
-};
-
-REGISTER_SERIALIZABLE(BodyAssocVector,false);
-
-#endif // BODYASSOCVEC_HPP
-

Deleted: branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVectorIterator.cpp
===================================================================
--- branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVectorIterator.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVectorIterator.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,53 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;BodyAssocVectorIterator.hpp&quot;
-
-
-BodyAssocVectorIterator::BodyAssocVectorIterator() : BodyContainerIterator()
-{
-
-}
-
-
-BodyAssocVectorIterator::~BodyAssocVectorIterator()
-{
-
-}
-
-
-bool BodyAssocVectorIterator::isDifferent(const BodyContainerIterator&amp; i)
-{
-	return (bii != static_cast&lt;const BodyAssocVectorIterator&amp;&gt;(i).bii );
-}
-
-
-void BodyAssocVectorIterator::increment()
-{
-	++bii;
-}
-
-
-void BodyAssocVectorIterator::affect(const BodyContainerIterator&amp; i)
-{
-	bii = static_cast&lt;const BodyAssocVectorIterator&amp;&gt;(i).bii;
-}
-
-
-shared_ptr&lt;Body&gt; BodyAssocVectorIterator::getValue()
-{
-	return (*bii).second;
-}
-
-
-shared_ptr&lt;BodyContainerIterator&gt; BodyAssocVectorIterator::createPtr()
-{
-	return shared_ptr&lt;BodyContainerIterator&gt;(new BodyAssocVectorIterator());
-}
-
-

Deleted: branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVectorIterator.hpp
===================================================================
--- branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVectorIterator.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/BodyContainer/BodyAssocVector/BodyAssocVectorIterator.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BODYASSOCVECTORITERATOR
-#define BODYASSOCVECTORITERATOR
-
-#include&lt;yade/core/BodyContainerIterator.hpp&gt;
-
-#include &lt;vector&gt;
-
-using namespace std;
-
-class BodyAssocVectorIterator : public BodyContainerIterator 
-{
-	public :
-		Loki::AssocVector&lt;unsigned int , shared_ptr&lt;Body&gt; &gt;::iterator bii; // FIXME - private maybe?
-
-		BodyAssocVectorIterator();
-		~BodyAssocVectorIterator();
-		
-		virtual bool isDifferent(const BodyContainerIterator&amp; i);
-		virtual void affect(const BodyContainerIterator&amp; i);
-		virtual void increment();
-		virtual shared_ptr&lt;Body&gt; getValue();
-		virtual shared_ptr&lt;BodyContainerIterator&gt; createPtr();
-
-};
-
-#endif // __BODYASSOCVECTORITERATOR__
-

Deleted: branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVector.cpp
===================================================================
--- branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVector.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVector.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,212 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;BodyRedirectionVector.hpp&quot;
-#include &quot;BodyRedirectionVectorIterator.hpp&quot;
-
-
-#include&lt;yade/core/Body.hpp&gt;
-
-
-BodyRedirectionVector::BodyRedirectionVector()
-{
-	clear();
-}
-
-
-BodyRedirectionVector::~BodyRedirectionVector()
-{
-}
-
-
-// FIXME - make sure that this is correct
-unsigned int BodyRedirectionVector::insert(shared_ptr&lt;Body&gt;&amp; b)
-{
-	unsigned int position = b-&gt;getId();
-
-//	std::vector&lt; shared_ptr&lt;Body&gt; &gt;::iterator tmpVii    = bodies.begin();
-//	std::vector&lt; shared_ptr&lt;Body&gt; &gt;::iterator tmpViiEnd = bodies.end();
-//	tmpVii = bodies.find(position);
-
-	bool used = false;
-
-//	for( ; tmpVii != tmpViiEnd ; ++tmpVii )
-//		if(position == (*tmpVii)-&gt;getId() )
-
-	if( (indexes.size() &gt; position)  &amp;&amp; (indexes[position] != -1) )
-			used = true;
-
-	if( used )
-	{
-		unsigned int newPosition = position;
-		// finds the first free key, which is bigger than id.
-		bool newUsed = true;
-		while( newUsed )
-		{
-			newUsed = false;
-			++newPosition;
-
-//			tmpVii    = bodies.begin();
-//			tmpViiEnd = bodies.end();
-//			for( ; tmpVii != tmpViiEnd ; ++tmpVii )
-//				if(newPosition == (*tmpVii)-&gt;getId() )
-			if( (indexes.size() &gt; newPosition)  &amp;&amp; (indexes[newPosition] != -1) )
-					newUsed = true;
-		}
-		//cerr &lt;&lt; &quot;WARNING: body id=\&quot;&quot; &lt;&lt; position &lt;&lt; &quot;\&quot; is already used. Using first free id=\&quot;&quot; &lt;&lt; newPosition &lt;&lt; &quot;\&quot;, beware - if you are loading a file, this will break transientInteractions for this body!\n&quot;;
-		position = newPosition;
-	}
-	BodyContainer::setId(b,position);
-	bodies.push_back(b);
-	
-	if(indexes.size() &lt; position+1)
-		indexes.resize(position+1, -1 );
-
-	indexes[position] = bodies.size()-1;
-	
-	return position;
-}
-
-
-unsigned int BodyRedirectionVector::insert(shared_ptr&lt;Body&gt;&amp; b, unsigned int newId)
-{
-	BodyContainer::setId(b,newId);
-	return insert(b);
-}
-
-
-void BodyRedirectionVector::clear()
-{
-	bodies.clear();
-	indexes.clear();
-}
-
-
-bool BodyRedirectionVector::erase(unsigned int id)
-{
-//	std::vector&lt; shared_ptr&lt;Body&gt; &gt;::iterator tmpVii    = bodies.begin();
-//	std::vector&lt; shared_ptr&lt;Body&gt; &gt;::iterator tmpViiEnd = bodies.end();
-//	for( ; tmpVii != tmpViiEnd ; ++tmpVii )
-//		if(id == (*tmpVii)-&gt;getId() )
-//		{
-//			bodies.erase(tmpVii); // WRONG - bodies do change their indexes!
-//			indexes[id] = -1;
-//			return true;
-//		}
-//	return false;
-
-	long int deleted = indexes[id];
-	if( deleted != -1 )
-	{
-		std::vector&lt; shared_ptr&lt;Body&gt; &gt;::iterator tmpVii    = bodies.begin(); 
-		tmpVii += deleted;
-//		assert( (*tmpVii)-&gt;getId() == id );
-		bodies.erase(tmpVii);
-		indexes[id] = -1;
-		
-		std::vector&lt;long int&gt;::iterator scan = indexes.begin();
-		std::vector&lt;long int&gt;::iterator end  = indexes.end();
-		for( ; scan != end ; ++scan )
-			if( *scan &gt; deleted )
-				--(*scan); 
-		return true;
-	}
-	else
-		return false;
-}
-
-
-bool BodyRedirectionVector::exists(unsigned int id) const
-{
-        return id&lt;indexes.size() &amp;&amp; (indexes[id] != -1);
-}
-
-bool BodyRedirectionVector::find(unsigned int id , shared_ptr&lt;Body&gt;&amp; b) const
-{
-//	std::vector&lt; shared_ptr&lt;Body&gt; &gt;::iterator tmpVii    = bodies.begin();
-//	std::vector&lt; shared_ptr&lt;Body&gt; &gt;::iterator tmpViiEnd = bodies.end();
-//	for( ; tmpVii != tmpViiEnd ; ++tmpVii )
-//		if(id == tmpVii-&gt;getId())
-//		{
-//			b = *tmpBii;
-//			return true;
-//		}
-
-	if(indexes[id] == -1)
-		return false;
-	else
-	{
-		b = bodies[ indexes[id] ];
-		return true;
-	}
-}
-
-
-shared_ptr&lt;Body&gt;&amp; BodyRedirectionVector::operator[](unsigned int id)
-{
-	// do not modify bii iterator
-//	temporaryBii = bodies.find(id);
-//	if (bii != bodies.end())
-//		return (*temporaryBii).second;
-//	else
-//		return shared_ptr&lt;Body&gt;();
-
-	return bodies[ indexes[id] ];
-}
-
-
-const shared_ptr&lt;Body&gt;&amp; BodyRedirectionVector::operator[](unsigned int id) const
-{
-//	Loki::AssocVector&lt;unsigned int , shared_ptr&lt;Body&gt; &gt;::const_iterator tmpBii;
-//	tmpBii = bodies.find(id);
-//	return (*tmpBii).second;
-	
-	return bodies[ indexes[id] ];
-}
-
-
-BodyContainer::iterator BodyRedirectionVector::begin()
-{
-	shared_ptr&lt;BodyRedirectionVectorIterator&gt; it(new BodyRedirectionVectorIterator());
-	it-&gt;vii   = bodies.begin();
-
-	return BodyContainer::iterator(it);
-}
-
-
-BodyContainer::iterator BodyRedirectionVector::end()
-{
-	shared_ptr&lt;BodyRedirectionVectorIterator&gt; it(new BodyRedirectionVectorIterator());
-	it-&gt;vii   = bodies.end();
-
-	return BodyContainer::iterator(it);
-}
-
-
-
-// 
-// void BodyRedirectionVector::pushIterator()
-// {// FIXME - make sure that this is FIFO (I'm tired now...)
-// 	iteratorList.push_front(vii);
-// }
-// 
-// 
-// void BodyRedirectionVector::popIterator()
-// {
-// 	vii = iteratorList.front();
-// 	iteratorList.pop_front();
-// }
-// 
-
-unsigned int BodyRedirectionVector::size()
-{
-	return bodies.size();
-}
-
-
-

Deleted: branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVector.hpp
===================================================================
--- branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVector.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVector.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,54 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-#ifndef BODYREDIRECTIONVECTOR_HPP
-#define BODYREDIRECTIONVECTOR_HPP
-
-
-#include&lt;yade/core/BodyContainer.hpp&gt;
-
-#include &lt;vector&gt;
-
-class Body;
-
-using namespace boost;
-
-class BodyRedirectionVector : public BodyContainer
-{
-	private	:
-		std::vector&lt; shared_ptr&lt;Body&gt; &gt; bodies;
-		std::vector&lt; long int &gt; indexes;
-
-	public :
-		BodyRedirectionVector();
-		virtual ~BodyRedirectionVector();
-	
-		virtual unsigned int insert(shared_ptr&lt;Body&gt;&amp;);
-		virtual unsigned int insert(shared_ptr&lt;Body&gt;&amp; , unsigned int);
-		virtual void clear();
-		virtual bool erase(unsigned int);
-		virtual bool find(unsigned int , shared_ptr&lt;Body&gt;&amp;) const;
-		virtual bool exists(unsigned int id) const;
-		virtual shared_ptr&lt;Body&gt;&amp; operator[](unsigned int);
-		virtual const shared_ptr&lt;Body&gt;&amp; operator[](unsigned int) const;
-	
-		virtual BodyContainer::iterator begin();
-	        virtual BodyContainer::iterator end();
-		
-		virtual unsigned int size();
-
-	// serialization of this class...
-	REGISTER_CLASS_NAME(BodyRedirectionVector);
-	REGISTER_BASE_CLASS_NAME(BodyContainer);
-};
-
-REGISTER_SERIALIZABLE(BodyRedirectionVector,false);
-
-#endif // BODYREDIRECTIONVECTOR_HPP
-

Deleted: branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVectorIterator.cpp
===================================================================
--- branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVectorIterator.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVectorIterator.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,53 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;BodyRedirectionVectorIterator.hpp&quot;
-
-
-BodyRedirectionVectorIterator::BodyRedirectionVectorIterator() : BodyContainerIterator()
-{
-
-}
-
-
-BodyRedirectionVectorIterator::~BodyRedirectionVectorIterator()
-{
-
-}
-
-
-bool BodyRedirectionVectorIterator::isDifferent(const BodyContainerIterator&amp; i)
-{
-	return (vii != static_cast&lt;const BodyRedirectionVectorIterator&amp;&gt;(i).vii );
-}
-
-
-void BodyRedirectionVectorIterator::increment()
-{
-	++vii;
-}
-
-
-void BodyRedirectionVectorIterator::affect(const BodyContainerIterator&amp; i)
-{
-	vii = static_cast&lt;const BodyRedirectionVectorIterator&amp;&gt;(i).vii;
-}
-
-
-shared_ptr&lt;Body&gt; BodyRedirectionVectorIterator::getValue()
-{
-	return (*vii);
-}
-
-
-shared_ptr&lt;BodyContainerIterator&gt; BodyRedirectionVectorIterator::createPtr()
-{
-	return shared_ptr&lt;BodyContainerIterator&gt;(new BodyRedirectionVectorIterator());
-}
-
-

Deleted: branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVectorIterator.hpp
===================================================================
--- branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVectorIterator.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVectorIterator.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BODYREDIRECTIONVECTORITERATOR_HPP
-#define BODYREDIRECTIONVECTORITERATOR_HPP
-
-#include&lt;yade/core/BodyContainerIterator.hpp&gt;
-
-#include &lt;vector&gt;
-
-using namespace std;
-
-class BodyRedirectionVectorIterator : public BodyContainerIterator 
-{
-	public :
-		vector&lt; shared_ptr&lt;Body&gt; &gt;::iterator vii;
-
-		BodyRedirectionVectorIterator();
-		~BodyRedirectionVectorIterator();
-
-		virtual bool isDifferent(const BodyContainerIterator&amp; i);
-		virtual void affect(const BodyContainerIterator&amp; i);
-		virtual void increment();
-		virtual shared_ptr&lt;Body&gt; getValue();
-		virtual shared_ptr&lt;BodyContainerIterator&gt; createPtr();
-
-};
-
-#endif // __BODYREDIRECTIONVECTORITERATOR__
-

Copied: branches/scons-layout/pkg/common/Container/BodyRedirectionVector.cpp (from rev 1105, branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVector.cpp)

Copied: branches/scons-layout/pkg/common/Container/BodyRedirectionVector.hpp (from rev 1105, branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVector.hpp)

Copied: branches/scons-layout/pkg/common/Container/BodyRedirectionVectorIterator.cpp (from rev 1105, branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVectorIterator.cpp)

Copied: branches/scons-layout/pkg/common/Container/BodyRedirectionVectorIterator.hpp (from rev 1105, branches/scons-layout/pkg/common/Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVectorIterator.hpp)

Deleted: branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMap.cpp
===================================================================
--- branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMap.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMap.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,123 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractionHashMap.hpp&quot;
-#include &quot;InteractionHashMapIterator.hpp&quot;
-
-
-InteractionHashMap::InteractionHashMap()
-{
-	clear();
-}
-
-
-InteractionHashMap::~InteractionHashMap()
-{
-}
-
-
-bool InteractionHashMap::insert(shared_ptr&lt;Interaction&gt;&amp; i)
-{
-	boost::mutex::scoped_lock lock(drawloopmutex);
-
-	unsigned int id1 = i-&gt;getId1();
-	unsigned int id2 = i-&gt;getId2();
-	if (id1&gt;id2)
-		swap(id1,id2);
-
-	return interactions.insert( IHashMap::value_type( pair&lt;unsigned int,unsigned int&gt;(id1,id2) , i )).second;
-}
-
-
-bool InteractionHashMap::insert(unsigned int id1,unsigned int id2)
-{
-	shared_ptr&lt;Interaction&gt; i(new Interaction(id1,id2) );
-	return insert(i);	
-}
-
-
-void InteractionHashMap::clear()
-{
-	boost::mutex::scoped_lock lock(drawloopmutex);
-
-	interactions.clear();
-}
-
-
-bool InteractionHashMap::erase(unsigned int id1,unsigned int id2)
-{
-	boost::mutex::scoped_lock lock(drawloopmutex);
-
-	if (id1&gt;id2)
-		swap(id1,id2);
-
-	unsigned int oldSize = interactions.size();
-	pair&lt;unsigned int,unsigned int&gt; p(id1,id2);
-	unsigned int size = interactions.erase(p);
-
-	return size!=oldSize;
-
-}
-
-
-const shared_ptr&lt;Interaction&gt;&amp; InteractionHashMap::find(unsigned int id1,unsigned int id2)
-{
-	if (id1&gt;id2)
-		swap(id1,id2);
-
-	IHashMap::iterator hmii = interactions.find(pair&lt;unsigned int,unsigned int&gt;(id1,id2));
-	if (hmii!=interactions.end())
-		return (*hmii).second;
-	else
-	{
-		empty = shared_ptr&lt;Interaction&gt;(); 
-		return empty;
-	}
-}
-
-
-InteractionContainer::iterator InteractionHashMap::begin()
-{
-	shared_ptr&lt;InteractionHashMapIterator&gt; it(new InteractionHashMapIterator());
-	it-&gt;hmii   = interactions.begin();
-
-	return InteractionContainer::iterator(it);
-}
-
-
-InteractionContainer::iterator InteractionHashMap::end()
-{
-	shared_ptr&lt;InteractionHashMapIterator&gt; it(new InteractionHashMapIterator());
-	it-&gt;hmii   = interactions.end();
-
-	return InteractionContainer::iterator(it);
-}
-
-
-// void InteractionHashMap::eraseCurrentAndGotoNextPotential()
-// {
-// 	if (notAtEnd())
-// 	{
-// 		IHashMap::iterator tmpHmii=hmii;
-// 		++hmii;
-// 		interactions.erase(tmpHmii);
-// 	}
-// }
-// 
-// void InteractionHashMap::eraseCurrentAndGotoNext()
-// {
-// 	IHashMap::iterator tmpHmii=hmii;	
-// 	while (notAtEnd() &amp;&amp; !((*hmii).second-&gt;isReal))
-// 		++hmii;	
-// 	interactions.erase(tmpHmii);
-// }
-
-unsigned int InteractionHashMap::size()
-{
-	return interactions.size();
-}

Deleted: branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMap.hpp
===================================================================
--- branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMap.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMap.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,65 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTIONHASHMAP_HPP
-#define INTERACTIONHASHMAP_HPP
-
-#include&lt;yade/core/InteractionContainer.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include &lt;ext/hash_map&gt;
-
-using namespace std;
-using namespace __gnu_cxx;
-
-struct eqPair
-{
-	bool operator()(const pair&lt;unsigned int,unsigned int&gt;&amp; p1, const pair&lt;unsigned int,unsigned int&gt;&amp; p2) const
-	{
-		return (p1.first==p2.first &amp;&amp; p1.second==p2.second);
-	}
-};
-
-struct hashPair
-{
-	unsigned int operator()(const pair&lt;unsigned int,unsigned int&gt;&amp; p) const
-	{
-		return (p.first+p.second)%182501621;
-	}
-};
-
-typedef hash_map&lt;pair&lt;unsigned int,unsigned int&gt;, shared_ptr&lt;Interaction&gt;, hashPair, eqPair &gt; IHashMap;
-
-class InteractionHashMap : public InteractionContainer
-{
-	private :
-		IHashMap interactions;
-		shared_ptr&lt;Interaction&gt; empty;
-
-	public :
-		InteractionHashMap();
-		virtual ~InteractionHashMap();
-
-		virtual bool insert(unsigned int id1,unsigned int id2);
-		virtual bool insert(shared_ptr&lt;Interaction&gt;&amp; i);
-		virtual void clear();
-		virtual bool erase(unsigned int id1,unsigned int id2);
-		virtual const shared_ptr&lt;Interaction&gt;&amp; find(unsigned int id1,unsigned int id2);
-	
-		virtual InteractionContainer::iterator begin();
-	        virtual InteractionContainer::iterator end();
-	
-		virtual unsigned int size();
-
-	REGISTER_CLASS_NAME(InteractionHashMap);
-	REGISTER_BASE_CLASS_NAME(InteractionContainer);
-};
-
-REGISTER_SERIALIZABLE(InteractionHashMap,false);
-
-#endif //  INTERACTIONHASHMAP_HPP
-

Deleted: branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMapIterator.cpp
===================================================================
--- branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMapIterator.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMapIterator.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,53 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractionHashMapIterator.hpp&quot;
-
-
-InteractionHashMapIterator::InteractionHashMapIterator() : InteractionContainerIterator()
-{
-
-}
-
-
-InteractionHashMapIterator::~InteractionHashMapIterator()
-{
-
-}
-
-
-bool InteractionHashMapIterator::isDifferent(const InteractionContainerIterator&amp; i)
-{
-	return (hmii != static_cast&lt;const InteractionHashMapIterator&amp;&gt;(i).hmii );
-}
-
-
-void InteractionHashMapIterator::increment()
-{
-	++hmii;
-}
-
-
-void InteractionHashMapIterator::affect(const InteractionContainerIterator&amp; i)
-{
-	hmii = static_cast&lt;const InteractionHashMapIterator&amp;&gt;(i).hmii;
-}
-
-
-shared_ptr&lt;Interaction&gt; InteractionHashMapIterator::getValue()
-{
-	return (*hmii).second;
-}
-
-
-shared_ptr&lt;InteractionContainerIterator&gt; InteractionHashMapIterator::createPtr()
-{
-	return shared_ptr&lt;InteractionContainerIterator&gt;(new InteractionHashMapIterator());
-}
-
-

Deleted: branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMapIterator.hpp
===================================================================
--- branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMapIterator.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMapIterator.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTIONHASHMAPITERATOR_HPP
-#define INTERACTIONHASHMAPITERATOR_HPP
-
-#include&lt;yade/core/InteractionContainerIterator.hpp&gt;
-#include &lt;vector&gt;
-#include &quot;InteractionHashMap.hpp&quot;
-
-using namespace std;
-
-class InteractionHashMapIterator : public InteractionContainerIterator 
-{
-	public :
-		IHashMap::iterator hmii;
-
-		InteractionHashMapIterator();
-		~InteractionHashMapIterator();
-
-		virtual bool isDifferent(const InteractionContainerIterator&amp; i);
-		virtual void affect(const InteractionContainerIterator&amp; i);
-		virtual void increment();
-		virtual shared_ptr&lt;Interaction&gt; getValue();
-		virtual shared_ptr&lt;InteractionContainerIterator&gt; createPtr();
-
-};
-
-#endif // INTERACTIONHASHMAPITERATOR_HPP
-

Deleted: branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSet.cpp
===================================================================
--- branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSet.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSet.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,194 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractionVecSet.hpp&quot;
-#include &quot;InteractionVecSetIterator.hpp&quot;
-#include &lt;iostream&gt;
-
-InteractionVecSet::InteractionVecSet()
-{
-	currentSize = 0;
-	clear();
-}
-
-
-InteractionVecSet::~InteractionVecSet()
-{
-}
-
-
-bool InteractionVecSet::insert(shared_ptr&lt;Interaction&gt;&amp; i)
-{
-	boost::mutex::scoped_lock lock(drawloopmutex);
-
-	unsigned int id1 = i-&gt;getId1();
-	unsigned int id2 = i-&gt;getId2();
-
-	if (id1&gt;id2)
-		swap(id1,id2);
-
-	if ( id1 &gt;=interactions.size())
-		interactions.resize(id1+1);
-
-	if (interactions[id1].insert(pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;(id2,i)).second)
-	{
-		currentSize++;
-		return true;
-	}
-	else
-		return false;
-}
-
-
-bool InteractionVecSet::insert(unsigned int id1,unsigned int id2)
-{
-	shared_ptr&lt;Interaction&gt; i(new Interaction(id1,id2) );
-	return insert(i);	
-}
-
-
-void InteractionVecSet::clear()
-{
-	boost::mutex::scoped_lock lock(drawloopmutex);
-
-	interactions.clear();
-	currentSize=0;
-}
-
-
-bool InteractionVecSet::erase(unsigned int id1,unsigned int id2)
-{
-	boost::mutex::scoped_lock lock(drawloopmutex);
-
-	if (id1&gt;id2)
-		swap(id1,id2);
-
-	if ( id1 &lt; interactions.size())
-	{
-		shared_ptr&lt;Interaction&gt; tmpI;
-		if (interactions[id1].erase(pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;(id2,tmpI)))
-		{
-			currentSize--;
-			return true;
-		}
-		else
-			return false;
-	}
-
-	return false;
-
-}
-
-
-const shared_ptr&lt;Interaction&gt;&amp; InteractionVecSet::find(unsigned int id1,unsigned int id2)
-{
-	if (id1&gt;id2)
-		swap(id1,id2);
-
-	if (static_cast&lt;unsigned int&gt;(id1)&lt;interactions.size())
-	{
-		set&lt;pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;,lessThanPair &gt;::iterator sii;
-		shared_ptr&lt;Interaction&gt; tmpI;
-		sii = interactions[id1].find(pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;(id2,tmpI));
-		if (sii!=interactions[id1].end())
-			return (*sii).second;
-		else
-		{
-			empty = shared_ptr&lt;Interaction&gt;();
-			return empty;
-		}
-	}
-	else
-	{
-		empty = shared_ptr&lt;Interaction&gt;();
-		return empty;
-	}
-}
-
-
-InteractionContainer::iterator InteractionVecSet::begin()
-{
-	shared_ptr&lt;InteractionVecSetIterator&gt; it(new InteractionVecSetIterator());
-	it-&gt;vii    = interactions.begin();
-	it-&gt;viiEnd = interactions.end();
- 
-	if (it-&gt;vii!=it-&gt;viiEnd)
-	{
-		it-&gt;sii    = (*it-&gt;vii).begin();
- 		it-&gt;siiEnd = (*it-&gt;vii).end();
-	
-		while( it-&gt;sii == it-&gt;siiEnd )
-		{
-			++it-&gt;vii;
-			if(it-&gt;vii != it-&gt;viiEnd)
-			{
-				it-&gt;sii	   = (*it-&gt;vii).begin();
-				it-&gt;siiEnd = (*it-&gt;vii).end();
-			}
-			else
-				return InteractionContainer::iterator(it);
-		}
-	}
-
-	return InteractionContainer::iterator(it);
-
-}
-
-
-InteractionContainer::iterator InteractionVecSet::end()
-{
-
-	shared_ptr&lt;InteractionVecSetIterator&gt; it(new InteractionVecSetIterator());
-
-	it-&gt;vii		= interactions.end();
-	it-&gt;viiEnd	= interactions.end();
-	
-// in fact it is not possible to assign ssi, because it doesn't exist at all. (both begin() and end() do not exist)
-
-//	it-&gt;sii		= interactions.begin()-&gt;end();
-//	it-&gt;siiEnd	= interactions.begin()-&gt;end();
-// trying to access out of memory bounds: end() points behind LAST element. so accessing it causes segfault.
-//	it-&gt;sii		= (*it-&gt;vii).end();
-//	it-&gt;siiEnd	= (*it-&gt;vii).end();
-
-	return InteractionContainer::iterator(it);
-
-}
-
-
-// 
-// void InteractionVecSet::eraseCurrentAndGotoNextPotential()
-// {
-// 	vector&lt;set&lt;pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;,lessThanPair &gt; &gt;::iterator tmpVii = vii;
-// 	set&lt;pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;,lessThanPair &gt;::iterator tmpSii          = sii;
-// 	
-// 	gotoNextPotential();
-// 	
-// 	(*tmpVii).erase(tmpSii);
-// 	currentSize--;	
-// }
-// 
-// void InteractionVecSet::eraseCurrentAndGotoNext()
-// {
-// 	vector&lt;set&lt;pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;,lessThanPair &gt; &gt;::iterator tmpVii = vii;
-// 	set&lt;pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;,lessThanPair &gt;::iterator tmpSii          = sii;
-// 	
-// 	gotoNext();
-// 	
-// 	(*tmpVii).erase(tmpSii);
-// 	currentSize--;	
-// 	
-// }
-
-unsigned int InteractionVecSet::size()
-{
-	return currentSize;
-}
-

Deleted: branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSet.hpp
===================================================================
--- branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSet.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSet.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,55 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTIONVECSET_HPP
-#define INTERACTIONVECSET_HPP
-
-#include&lt;yade/core/InteractionContainer.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include &lt;vector&gt;
-#include &lt;set&gt;
-#include &quot;InteractionVecSetIterator.hpp&quot;
-
-
-using namespace std;
-using namespace __gnu_cxx;
-
-class InteractionVecSet : public InteractionContainer
-{
-	private :
-		vector&lt;set&lt;pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;,lessThanPair &gt; &gt; interactions;
-		unsigned int currentSize;
-		shared_ptr&lt;Interaction&gt; empty;
-
-
-	public :
-		InteractionVecSet();
-		virtual ~InteractionVecSet();
-
-		virtual bool insert(unsigned int id1,unsigned int id2);
-		virtual bool insert(shared_ptr&lt;Interaction&gt;&amp; i);
-		virtual void clear();
-		virtual bool erase(unsigned int id1,unsigned int id2);
-		virtual const shared_ptr&lt;Interaction&gt;&amp; find(unsigned int id1,unsigned int id2);
-
-		virtual InteractionContainer::iterator begin();
-        	virtual InteractionContainer::iterator end();
-	
-		virtual unsigned int size();
-
-	REGISTER_CLASS_NAME(InteractionVecSet);
-	REGISTER_BASE_CLASS_NAME(InteractionContainer);
-
-};
-
-REGISTER_SERIALIZABLE(InteractionVecSet,false);
-
-#endif // INTERACTIONVECSET_HPP
-

Deleted: branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSetIterator.cpp
===================================================================
--- branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSetIterator.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSetIterator.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,72 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractionVecSetIterator.hpp&quot;
-
-InteractionVecSetIterator::InteractionVecSetIterator() : InteractionContainerIterator()
-{
-
-}
-
-
-InteractionVecSetIterator::~InteractionVecSetIterator()
-{
-
-}
-
-
-bool InteractionVecSetIterator::isDifferent(const InteractionContainerIterator&amp; i)
-{
-	const InteractionVecSetIterator&amp; it = static_cast&lt;const InteractionVecSetIterator&amp;&gt;(i);
-	if (it.vii == it.viiEnd) // we are at end of container
-		return !(vii==viiEnd);
-	else
-		return (sii != it.sii );
-}
-
-
-void InteractionVecSetIterator::increment()
-{
-	if ( sii != siiEnd )
-		++sii;
-	while( sii == siiEnd )
-	{
-		++vii;
-		if(vii != viiEnd)
-		{
-			sii	= (*vii).begin();
-			siiEnd	= (*vii).end();
-		}
-		else
-			break;
-	}
-}
-
-
-void InteractionVecSetIterator::affect(const InteractionContainerIterator&amp; i)
-{
-	const InteractionVecSetIterator&amp; tmpi = static_cast&lt;const InteractionVecSetIterator&amp;&gt;(i);
-	vii    = tmpi.vii;
-	viiEnd = tmpi.viiEnd;
-	sii    = tmpi.sii;
-	siiEnd = tmpi.siiEnd;
-}
-
-
-shared_ptr&lt;Interaction&gt; InteractionVecSetIterator::getValue()
-{
-	return (*sii).second;
-}
-
-
-shared_ptr&lt;InteractionContainerIterator&gt; InteractionVecSetIterator::createPtr()
-{
-	return shared_ptr&lt;InteractionContainerIterator&gt;(new InteractionVecSetIterator());
-}
-
-

Deleted: branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSetIterator.hpp
===================================================================
--- branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSetIterator.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSetIterator.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,46 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTIONVECSETITERATOR_HPP
-#define INTERACTIONVECSETITERATOR_HPP
-
-
-#include&lt;yade/core/InteractionContainerIterator.hpp&gt;
-#include &lt;vector&gt;
-
-using namespace std;
-
-struct lessThanPair
-{
-	bool operator()(const pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;&amp; p1, const pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;&amp; p2) const
-	{
-		return (p1.first&lt;p2.first);
-	}
-};
-
-class InteractionVecSetIterator : public InteractionContainerIterator 
-{
-	public :
-		vector&lt;set&lt;pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;,lessThanPair &gt; &gt;::iterator vii;
-		vector&lt;set&lt;pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;,lessThanPair &gt; &gt;::iterator viiEnd;
-		set&lt;pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;,lessThanPair &gt;::iterator sii;
-		set&lt;pair&lt;unsigned int,shared_ptr&lt;Interaction&gt; &gt;,lessThanPair &gt;::iterator siiEnd;
-
-		InteractionVecSetIterator();
-		~InteractionVecSetIterator();
-
-		virtual bool isDifferent(const InteractionContainerIterator&amp; i);
-		virtual void affect(const InteractionContainerIterator&amp; i);
-		virtual void increment();
-		virtual shared_ptr&lt;Interaction&gt; getValue();
-		virtual shared_ptr&lt;InteractionContainerIterator&gt; createPtr();
-
-};
-
-#endif // INTERACTIONVECSETITERATOR_HPP
-

Copied: branches/scons-layout/pkg/common/Container/InteractionHashMap.cpp (from rev 1105, branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMap.cpp)

Copied: branches/scons-layout/pkg/common/Container/InteractionHashMap.hpp (from rev 1105, branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMap.hpp)

Copied: branches/scons-layout/pkg/common/Container/InteractionHashMapIterator.cpp (from rev 1105, branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMapIterator.cpp)

Copied: branches/scons-layout/pkg/common/Container/InteractionHashMapIterator.hpp (from rev 1105, branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionHashMap/InteractionHashMapIterator.hpp)

Copied: branches/scons-layout/pkg/common/Container/InteractionVecSet.cpp (from rev 1105, branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSet.cpp)

Copied: branches/scons-layout/pkg/common/Container/InteractionVecSet.hpp (from rev 1105, branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSet.hpp)

Copied: branches/scons-layout/pkg/common/Container/InteractionVecSetIterator.cpp (from rev 1105, branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSetIterator.cpp)

Copied: branches/scons-layout/pkg/common/Container/InteractionVecSetIterator.hpp (from rev 1105, branches/scons-layout/pkg/common/Container/InteractionContainer/InteractionVecSet/InteractionVecSetIterator.hpp)

Deleted: branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVector.cpp
===================================================================
--- branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVector.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVector.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,133 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;PhysicalActionVectorVector.hpp&quot;
-#include &quot;PhysicalActionVectorVectorIterator.hpp&quot;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-
-
-PhysicalActionVectorVector::PhysicalActionVectorVector()
-{
-	clear();
-//	currentIndex = -1;
-}
-
-
-PhysicalActionVectorVector::~PhysicalActionVectorVector()
-{
-}
-
-
-void PhysicalActionVectorVector::clear()
-{
-	physicalActions.clear();
-	usedIds.clear();
-}
-
-
-// doesn't not delete all, just resets data
-void PhysicalActionVectorVector::reset()
-{
-	vector&lt; vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt; &gt;::iterator vvi    = physicalActions.begin();
-	vector&lt; vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt; &gt;::iterator vviEnd = physicalActions.end();
-	for( ; vvi != vviEnd ; ++vvi )
-	{
-		vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt;::iterator vi    = (*vvi).begin();
-		vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt;::iterator viEnd = (*vvi).end();
-		for( ; vi != viEnd ; ++vi)
-		//if(*vi) // FIXME ?? do not check - all fields are NOT empty.
-			(*vi)-&gt;reset();
-	}
-}
-
-
-unsigned int PhysicalActionVectorVector::size()
-{
-	return physicalActions.size();
-}
-
-
-// fills container with resetted fields. argument here, should be all PhysicalAction types that are planned to use
-void PhysicalActionVectorVector::prepare(std::vector&lt;shared_ptr&lt;PhysicalAction&gt; &gt;&amp; actionTypes)
-{
-	unsigned int size = actionTypes.size();
-	int maxSize = 0;
-	for(unsigned int i = 0 ; i &lt; size ; ++i)
-		maxSize = max(maxSize , actionTypes[i]-&gt;getClassIndex() );
-	++maxSize;
-	actionTypesResetted.resize(maxSize);
-	for(unsigned int i = 0 ; i &lt; size ; ++i )
-	{
-		actionTypesResetted[actionTypes[i]-&gt;getClassIndex()] = actionTypes[i]-&gt;clone();
-		actionTypesResetted[actionTypes[i]-&gt;getClassIndex()] -&gt; reset();
-	}
-}
-
-
-// finds and returns action of given polymorphic type, for body of given Id,
-// should be always succesfull. if it is not - you forgot to call prepare()
-shared_ptr&lt;PhysicalAction&gt;&amp; PhysicalActionVectorVector::find(unsigned int id , int actionIndex )
-{
-	if( physicalActions.size() &lt;= id ) // this is very rarely executed, only at beginning.
-	// somebody is accesing out of bounds, make sure he will find, what he needs - a resetted PhysicalAction of his type
-	{
-		unsigned int oldSize = physicalActions.size();
-		unsigned int newSize = id+1;
-		usedIds.resize(newSize,false);
-		physicalActions.resize(newSize);
-		for(unsigned int i = oldSize ; i &lt; newSize ; ++i )
-		{
-			unsigned int actionTypesSize = actionTypesResetted.size();
-			physicalActions[i].resize(actionTypesSize);
-			for( unsigned int j = 0 ; j &lt; actionTypesSize ; ++j )
-				physicalActions[i][j] = actionTypesResetted[j]-&gt;clone();
-		}
-	}
-	usedIds[id] = true;
-	return physicalActions[id][actionIndex];
-}
-
-
-PhysicalActionContainer::iterator PhysicalActionVectorVector::begin()
-{
-	shared_ptr&lt;PhysicalActionVectorVectorIterator&gt; it(new PhysicalActionVectorVectorIterator());
-	it-&gt;currentIndex = 0;
-	it-&gt;usedIds	 = &usedIds;
-	it-&gt;vvi		 = physicalActions.begin();
-	it-&gt;vviEnd	 = physicalActions.end();
-	while(it-&gt;vvi!=it-&gt;vviEnd &amp;&amp; !usedIds[it-&gt;currentIndex])
-	{
-		++(it-&gt;currentIndex);
-		++(it-&gt;vvi);
-	}
-	if(it-&gt;vvi != it-&gt;vviEnd)
-	{
-		it-&gt;vi     = (*it-&gt;vvi).begin();
-		it-&gt;viEnd  = (*it-&gt;vvi).end();
-	}
-
-	return PhysicalActionContainer::iterator(it);
-}
-
-
-PhysicalActionContainer::iterator PhysicalActionVectorVector::end()
-{
-	shared_ptr&lt;PhysicalActionVectorVectorIterator&gt; it(new PhysicalActionVectorVectorIterator());
-	it-&gt;currentIndex = physicalActions.size();
-	it-&gt;vvi		 = physicalActions.end();
-	it-&gt;vviEnd	 = physicalActions.end();
-	/* Using nested iterator when the first one is end() already would be error, therefore we leave it-&gt;vi and it-&gt;viEnd alone.
-	 * (see PhysicalActionVectorVectorIterator::isDifferent for exact implementation of !=end()) */
-	return PhysicalActionContainer::iterator(it);
-
-}
-
-

Deleted: branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVector.hpp
===================================================================
--- branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVector.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVector.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,68 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef PHYSICALACTIONVECTORVECTOR_HPP
-#define PHYSICALACTIONVECTORVECTOR_HPP
-
-#include&lt;yade/core/PhysicalActionContainer.hpp&gt;
-
-#include &lt;list&gt;
-#include &lt;vector&gt;
-
-class PhysicalAction;
-
-using namespace boost;
-using namespace std;
-
-class PhysicalActionVectorVector : public PhysicalActionContainer
-{
-	private	:
-	// this in fact should be also a RedirectionVector in respect to the Body.id
-	// this container is memory-consuming, because size of this vector is depending on highest id
-	// from all bodies, not on the number of bodies
-	
-	// in this two-dimensional table:
-	// 	- first  dimension is Body-&gt;getId() number
-	//	- second dimension is PhysicalAction-&gt;getClassIndex() number
-		vector&lt; vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt; &gt; physicalActions;
-			vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt;   actionTypesResetted;
-		vector&lt; bool &gt; usedIds;
-	
-	public :
-		PhysicalActionVectorVector();
-		virtual ~PhysicalActionVectorVector();
-
-		virtual void clear();
-
-		// doesn't delete all, just resets data
-		virtual void reset();
-		virtual unsigned int size();
-		// fills container with resetted fields. argument here, should be all PhysicalAction types that are planned to use
-		virtual void prepare(std::vector&lt;shared_ptr&lt;PhysicalAction&gt; &gt;&amp; );
-	
-		// finds and returns action of given polymorphic type, for body of given Id,
-		// should be always succesfull. if it is not - you forgot to call prepare()
-		virtual shared_ptr&lt;PhysicalAction&gt;&amp; find(
-					  unsigned int /*Body-&gt;getId() */
-					, int /*ActionForce::getClassIndexStatic()*/);
-
-		virtual PhysicalActionContainer::iterator begin();
-		virtual PhysicalActionContainer::iterator end();
-
-/// Serialization
-	REGISTER_CLASS_NAME(PhysicalActionVectorVector);
-	REGISTER_BASE_CLASS_NAME(PhysicalActionContainer);
-
-};
-
-REGISTER_SERIALIZABLE(PhysicalActionVectorVector,false);
-
-#endif // __ACTION_VEC_VEC_HPP__
-

Deleted: branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVectorIterator.cpp
===================================================================
--- branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVectorIterator.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVectorIterator.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,82 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;PhysicalActionVectorVectorIterator.hpp&quot;
-
-
-PhysicalActionVectorVectorIterator::PhysicalActionVectorVectorIterator() : PhysicalActionContainerIterator()
-{
-	currentIndex = -1;
-}
-
-
-PhysicalActionVectorVectorIterator::~PhysicalActionVectorVectorIterator()
-{
-
-}
-
-
-bool PhysicalActionVectorVectorIterator::isDifferent(const PhysicalActionContainerIterator&amp; i)
-{
-	const PhysicalActionVectorVectorIterator&amp; it = static_cast&lt;const PhysicalActionVectorVectorIterator&amp;&gt;(i);
-	if (it.vvi==it.vviEnd)
-		return !(vvi==vviEnd);
-	else
-		return (vi != it.vi );
-}
-
-
-void PhysicalActionVectorVectorIterator::increment()
-{
-	++vi;
-	if(vi == viEnd)
-	{
-		++vvi;
-		++currentIndex;
-		while(!(*usedIds)[currentIndex] &amp;&amp; vvi != vviEnd)
-		{
-			++currentIndex;
-			++vvi;
-		}
-		if(vvi != vviEnd)
-		{
-			vi	= (*vvi).begin();
-			viEnd	= (*vvi).end();
-		}
-	}
-}
-
-
-void PhysicalActionVectorVectorIterator::affect(const PhysicalActionContainerIterator&amp; i)
-{
-	const PhysicalActionVectorVectorIterator&amp; tmpi = static_cast&lt;const PhysicalActionVectorVectorIterator&amp;&gt;(i);
-	vi     = tmpi.vi;
-	viEnd  = tmpi.viEnd;
-	vvi    = tmpi.vvi;
-	vviEnd = tmpi.vviEnd;
-	currentIndex = tmpi.currentIndex;
-	usedIds	= tmpi.usedIds;
-}
-
-
-shared_ptr&lt;PhysicalAction&gt; PhysicalActionVectorVectorIterator::getValue()
-{	
-	return *vi;
-}
-
-
-int PhysicalActionVectorVectorIterator::getCurrentIndex()
-{
-	return currentIndex;
-}
-
-
-shared_ptr&lt;PhysicalActionContainerIterator&gt; PhysicalActionVectorVectorIterator::createPtr()
-{
-	return shared_ptr&lt;PhysicalActionContainerIterator&gt;(new PhysicalActionVectorVectorIterator());
-}

Deleted: branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVectorIterator.hpp
===================================================================
--- branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVectorIterator.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVectorIterator.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,39 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef PHYSICALACTIONVECTORVECTORITERATOR_HPP
-#define PHYSICALACTIONVECTORVECTORITERATOR_HPP
-
-#include&lt;yade/core/PhysicalActionContainerIterator.hpp&gt;
-#include &lt;vector&gt;
-
-using namespace std;
-
-class PhysicalActionVectorVectorIterator : public PhysicalActionContainerIterator
-{
-	public :
-		vector&lt; vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt; &gt;::iterator vvi;
-		vector&lt; vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt; &gt;::iterator vviEnd;
-			vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt;  ::iterator vi;
-		vector&lt; shared_ptr&lt;PhysicalAction&gt; &gt;  ::iterator viEnd;
-		vector&lt; bool &gt; * usedIds;
-
-	public :
-		PhysicalActionVectorVectorIterator();
-		~PhysicalActionVectorVectorIterator();
-
-		virtual bool isDifferent(const PhysicalActionContainerIterator&amp; i);
-		virtual void affect(const PhysicalActionContainerIterator&amp; i);
-		virtual void increment();
-		virtual shared_ptr&lt;PhysicalAction&gt; getValue();
-		virtual shared_ptr&lt;PhysicalActionContainerIterator&gt; createPtr();
-		virtual int getCurrentIndex();
-};
-
-#endif // __PHYSICALACTIONVECTORVECTORITERATOR__
-

Copied: branches/scons-layout/pkg/common/Container/PhysicalActionVectorVector.cpp (from rev 1105, branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVector.cpp)

Copied: branches/scons-layout/pkg/common/Container/PhysicalActionVectorVector.hpp (from rev 1105, branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVector.hpp)

Copied: branches/scons-layout/pkg/common/Container/PhysicalActionVectorVectorIterator.cpp (from rev 1105, branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVectorIterator.cpp)

Copied: branches/scons-layout/pkg/common/Container/PhysicalActionVectorVectorIterator.hpp (from rev 1105, branches/scons-layout/pkg/common/Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVectorIterator.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB/AABB.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB/AABB.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB/AABB.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,19 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;AABB.hpp&quot;
-
-AABB::AABB () : BoundingVolume()
-{
-	createIndex();
-}
-
-AABB::~AABB ()
-{
-}
-

Deleted: branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB/AABB.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB/AABB.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB/AABB.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,36 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef AABB_HPP
-#define AABB_HPP
-
-#include&lt;yade/core/BoundingVolume.hpp&gt;
-
-class AABB : public BoundingVolume
-{
-	public :
-		Vector3r	 halfSize
-				,center;
-
-		AABB();
-		virtual ~AABB();
-	
-/// Serialization
-	
-	REGISTER_CLASS_NAME(AABB);	
-	REGISTER_BASE_CLASS_NAME(BoundingVolume);
-
-/// Indexable
-	
-	REGISTER_CLASS_INDEX(AABB,BoundingVolume);
-};
-
-REGISTER_SERIALIZABLE(AABB,false);
-
-#endif // __AABB_H__
-

Copied: branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB/AABB.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/BoundingVolume/AABB/AABB.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere/BoundingSphere.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere/BoundingSphere.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere/BoundingSphere.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;BoundingSphere.hpp&quot;
-
-
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-BoundingSphere::BoundingSphere () : BoundingVolume()
-{
-	createIndex();
-}
-
-BoundingSphere::~BoundingSphere ()
-{
-}
-
-void BoundingSphere::registerAttributes() // FIXME - remove that function, dispatcher shoul take care of that
-{
-	BoundingVolume::registerAttributes();
-	REGISTER_ATTRIBUTE(radius);
-	REGISTER_ATTRIBUTE(center);
-}
-
-// void BoundingSphere::update(Se3r&amp; se3)
-// {
-// 	Vector3r v(radius,radius,radius);
-// 	center = se3.position;
-// 	min = center-v;
-// 	max = center+v;	
-// }

Deleted: branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere/BoundingSphere.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere/BoundingSphere.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere/BoundingSphere.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,36 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BOUNDINGSPHERE_HPP
-#define BOUNDINGSPHERE_HPP
-
-#include&lt;yade/core/BoundingVolume.hpp&gt;
-
-class BoundingSphere : public BoundingVolume
-{
-	public :
-		Real		radius;
-		Vector3r	center;
-
-		BoundingSphere();
-		virtual ~BoundingSphere();
-
-/// Serialization
-		void registerAttributes();
-
-	REGISTER_CLASS_NAME(BoundingSphere);
-	REGISTER_BASE_CLASS_NAME(BoundingVolume);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(BoundingSphere,BoundingVolume);
-};
-
-REGISTER_SERIALIZABLE(BoundingSphere,false);
-
-#endif // __BOUNDINGSPHERE_H__
-

Copied: branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere/BoundingSphere.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/BoundingVolume/BoundingSphere/BoundingSphere.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box/Box.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box/Box.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box/Box.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,29 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-#include &quot;Box.hpp&quot;
-#include &lt;iostream&gt;
-
-Box::Box () : GeometricalModel()
-{		
-	createIndex();
-}
-
-
-Box::~Box ()
-{		
-}
-
-
-void Box::registerAttributes()
-{
-	GeometricalModel::registerAttributes();
-	REGISTER_ATTRIBUTE(extents);
-}
-

Deleted: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box/Box.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box/Box.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box/Box.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,40 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BOX_HPP
-#define BOX_HPP
-
-
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-
-
-class Box : public GeometricalModel
-{
-	public :
-		Vector3r extents;
-
-		Box ();
-		virtual ~Box ();
-	
-/// Serialization
-	
-	REGISTER_CLASS_NAME(Box);
-	REGISTER_BASE_CLASS_NAME(GeometricalModel);
-
-	public : void registerAttributes();
-	
-/// Indexable
-	
-	REGISTER_CLASS_INDEX(Box,GeometricalModel);
-
-};
-
-REGISTER_SERIALIZABLE(Box,false);
-
-#endif // BOX_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box/Box.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/GeometricalModel/Box/Box.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D/Mesh2D.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D/Mesh2D.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D/Mesh2D.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,61 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;Mesh2D.hpp&quot;
-
-
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-#include &lt;iostream&gt;
-
-
-Mesh2D::Mesh2D () : GeometricalModel()
-{		
-	createIndex();
-}
-
-
-Mesh2D::~Mesh2D ()
-{
-
-}
-
-
-void Mesh2D::postProcessAttributes(bool deserializing)
-{
-	GeometricalModel::postProcessAttributes(deserializing);
-	
-	if(deserializing)
-	{
-	
-		fNormals.resize(faces.size());
-		vNormals.resize(vertices.size());
-		triPerVertices.resize(vertices.size());
-		for(unsigned int i=0;i&lt;faces.size();i++)
-		{
-			triPerVertices[faces[i][0]].push_back(i);
-			triPerVertices[faces[i][1]].push_back(i);
-			triPerVertices[faces[i][2]].push_back(i);
-		}
-	}
-}
-
-
-void Mesh2D::registerAttributes()
-{
-	GeometricalModel::registerAttributes();
-	REGISTER_ATTRIBUTE(vertices);
-	REGISTER_ATTRIBUTE(edges);
-	REGISTER_ATTRIBUTE(faces);
-}
-
-
-
-
-

Deleted: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D/Mesh2D.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D/Mesh2D.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D/Mesh2D.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,68 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef MESH2D_HPP
-#define MESH2D_HPP
-
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-
-#define offset(i,j) ((i)*height+(j))
-
-class Edge : public Serializable
-{
-	public :
-		int	 first
-			,second;
-
-		Edge() {};
-		Edge(int f,int s) :first(f), second(s) {};
-
-	protected :
-		virtual void postProcessAttributes(bool) {};
-		void registerAttributes()
-		{
-			REGISTER_ATTRIBUTE(first);
-			REGISTER_ATTRIBUTE(second);
-		};
-	REGISTER_CLASS_NAME(Edge);
-	REGISTER_BASE_CLASS_NAME(Serializable);
-
-};
-
-REGISTER_SERIALIZABLE(Edge,true);
-
-class Mesh2D : public GeometricalModel
-{
-	public :
-		vector&lt;Edge&gt;		edges;
-
-		vector&lt;Vector3r&gt;	 vertices
-					,fNormals
-					,vNormals;
-		
-		vector&lt;vector&lt;int&gt; &gt;	 faces
-					,triPerVertices;
-
-		Mesh2D ();
-		virtual ~Mesh2D ();
-
-/// Serialization
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-		void registerAttributes();
-	REGISTER_CLASS_NAME(Mesh2D);
-	REGISTER_BASE_CLASS_NAME(Serializable);
-
-/// Indexable
-	REGISTER_CLASS_INDEX(Mesh2D,GeometricalModel);
-};
-
-REGISTER_SERIALIZABLE(Mesh2D,false);
-
-#endif // MESH2D_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D/Mesh2D.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/GeometricalModel/Mesh2D/Mesh2D.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral/Quadrilateral.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral/Quadrilateral.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral/Quadrilateral.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,49 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;Quadrilateral.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-Quadrilateral::Quadrilateral() : GeometricalModel()
-{
-	createIndex();
-}
-
-Quadrilateral::Quadrilateral(int p1,int p2,int p3,int p4,MetaBody* mb) : GeometricalModel()
-{
-	createIndex();
-	n1 = p1;
-	n2 = p2;
-	n3 = p3;
-	n4 = p4;
-	#define Q(x) ( (*(mb-&gt;bodies))[x]-&gt;physicalParameters-&gt;se3.position )
-	i1 = Q(n1);
-	i2 = Q(n2);
-	i3 = Q(n3);
-	i4 = Q(n4);
-	#undef Q
-}
-
-Quadrilateral::~Quadrilateral()
-{
-}
-
-void Quadrilateral::registerAttributes()
-{
-	GeometricalModel::registerAttributes();
-	REGISTER_ATTRIBUTE(n1);
-	REGISTER_ATTRIBUTE(n2);
-	REGISTER_ATTRIBUTE(n3);
-	REGISTER_ATTRIBUTE(n4);
-	
-	REGISTER_ATTRIBUTE(i1);
-	REGISTER_ATTRIBUTE(i2);
-	REGISTER_ATTRIBUTE(i3);
-	REGISTER_ATTRIBUTE(i4);
-}
-

Deleted: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral/Quadrilateral.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral/Quadrilateral.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral/Quadrilateral.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,39 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef QUADRILATERAL_HPP
-#define QUADRILATERAL_HPP
-
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-#include &lt;Wm3Math.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class MetaBody;
-
-class Quadrilateral : public GeometricalModel
-{
-	public :
-		int	 n1,n2,n3,n4;	// nodes of quadrilateral
-		Vector3r i1,i2,i3,i4;	// initial coordinates FIXME - this Quadrilateral is used only 
-					// for strain map display. some design changes are needed here anyway.
-
-		Quadrilateral();
-		Quadrilateral(int p1,int p2,int p3,int p4,MetaBody* mb);
-		virtual ~Quadrilateral();
-
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(Quadrilateral);
-	REGISTER_BASE_CLASS_NAME(GeometricalModel);
-	REGISTER_CLASS_INDEX(Quadrilateral,GeometricalModel);
-};
-
-REGISTER_SERIALIZABLE(Quadrilateral,false);
-
-#endif // TETRAHEDRON_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral/Quadrilateral.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/GeometricalModel/Quadrilateral/Quadrilateral.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere/Sphere.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere/Sphere.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere/Sphere.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,28 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;Sphere.hpp&quot;
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-Sphere::Sphere () : GeometricalModel()
-{
-	createIndex();
-}
-
-
-Sphere::~Sphere ()
-{
-}
-
-
-void Sphere::registerAttributes()
-{
-	GeometricalModel::registerAttributes();
-	REGISTER_ATTRIBUTE(radius);
-}
-

Deleted: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere/Sphere.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere/Sphere.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere/Sphere.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,32 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SPHERE_HPP
-#define SPHERE_HPP
-
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-
-class Sphere : public GeometricalModel
-{
-	public :
-		Real radius;
-
-		Sphere ();
-		virtual ~Sphere ();
-
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(Sphere);
-	REGISTER_BASE_CLASS_NAME(GeometricalModel);
-	REGISTER_CLASS_INDEX(Sphere,GeometricalModel);
-};
-
-REGISTER_SERIALIZABLE(Sphere,false);
-
-#endif // SPHERE_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere/Sphere.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/GeometricalModel/Sphere/Sphere.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron/Tetrahedron.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron/Tetrahedron.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron/Tetrahedron.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,38 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;Tetrahedron.hpp&quot;
-
-
-Tetrahedron::Tetrahedron() : GeometricalModel()
-{
-	createIndex();
-}
-
-Tetrahedron::Tetrahedron(Vector3r&amp; p1,Vector3r&amp; p2,Vector3r&amp; p3,Vector3r&amp; p4) : GeometricalModel()
-{
-	createIndex();
-	v1 = p1;
-	v2 = p2;
-	v3 = p3;
-	v4 = p4;
-}
-
-Tetrahedron::~Tetrahedron()
-{
-}
-
-void Tetrahedron::registerAttributes()
-{
-	GeometricalModel::registerAttributes();
-	// FIXME
-	REGISTER_ATTRIBUTE(v1); // no need to save them (?)
-	REGISTER_ATTRIBUTE(v2); // no need to save them (?)
-	REGISTER_ATTRIBUTE(v3); // no need to save them (?)
-	REGISTER_ATTRIBUTE(v4); // no need to save them (?)
-}

Deleted: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron/Tetrahedron.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron/Tetrahedron.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron/Tetrahedron.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef TETRAHEDRON_HPP
-#define TETRAHEDRON_HPP
-
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-#include &lt;Wm3Math.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class Tetrahedron : public GeometricalModel
-{
-	public :
-		Vector3r	v1,v2,v3,v4; // vertices of tetrahedron
-
-		Tetrahedron();
-		Tetrahedron(Vector3r&amp; p1,Vector3r&amp; p2,Vector3r&amp; p3,Vector3r&amp; p4);
-		virtual ~Tetrahedron();
-
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(Tetrahedron);
-	REGISTER_BASE_CLASS_NAME(GeometricalModel);
-	REGISTER_CLASS_INDEX(Tetrahedron,GeometricalModel);
-};
-
-REGISTER_SERIALIZABLE(Tetrahedron,false);
-
-#endif // TETRAHEDRON_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron/Tetrahedron.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/GeometricalModel/Tetrahedron/Tetrahedron.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox/InteractingBox.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox/InteractingBox.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox/InteractingBox.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,26 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingBox.hpp&quot;
-
-
-InteractingBox::InteractingBox () : InteractingGeometry()
-{		
-	createIndex();
-}
-
-InteractingBox::~InteractingBox ()
-{		
-}
-
-void InteractingBox::registerAttributes()
-{
-	InteractingGeometry::registerAttributes();
-	REGISTER_ATTRIBUTE(extents);
-}
-

Deleted: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox/InteractingBox.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox/InteractingBox.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox/InteractingBox.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTION_BOX_HPP
-#define INTERACTION_BOX_HPP
-
-
-#include&lt;yade/core/InteractingGeometry.hpp&gt;
-
-
-class InteractingBox : public InteractingGeometry
-{
-	public :
-		Vector3r extents;
-
-		InteractingBox ();
-		virtual ~InteractingBox ();	
-	
-	protected :
-		void registerAttributes();
-	
-	REGISTER_CLASS_INDEX(InteractingBox,InteractingGeometry);
-	REGISTER_CLASS_NAME(InteractingBox);
-	REGISTER_BASE_CLASS_NAME(InteractingGeometry);
-
-
-};
-
-REGISTER_SERIALIZABLE(InteractingBox,false);
-
-#endif //  INTERACTION_BOX_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox/InteractingBox.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingBox/InteractingBox.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere/InteractingSphere.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere/InteractingSphere.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere/InteractingSphere.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,26 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingSphere.hpp&quot;
-
-InteractingSphere::InteractingSphere () : InteractingGeometry()
-{
-	createIndex();
-}
-
-InteractingSphere::~InteractingSphere ()
-{
-}
-
-void InteractingSphere::registerAttributes()
-{
-	InteractingGeometry::registerAttributes();
-	REGISTER_ATTRIBUTE(radius);
-}
-
-

Deleted: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere/InteractingSphere.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere/InteractingSphere.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere/InteractingSphere.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTIONSPHERE_HPP
-#define INTERACTIONSPHERE_HPP
-
-#include&lt;yade/core/InteractingGeometry.hpp&gt;
-
-class InteractingSphere : public InteractingGeometry
-{
-	public :
-		Real radius;
-
-		InteractingSphere ();
-		virtual ~InteractingSphere ();
-
-/// Serialization
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(InteractingSphere);
-	REGISTER_BASE_CLASS_NAME(InteractingGeometry);
-
-/// Indexable
-	REGISTER_CLASS_INDEX(InteractingSphere,InteractingGeometry);
-};
-
-REGISTER_SERIALIZABLE(InteractingSphere,false);
-
-#endif // INTERACTIONSPHERE_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere/InteractingSphere.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/InteractingGeometry/InteractingSphere/InteractingSphere.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry/MetaInteractingGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry/MetaInteractingGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry/MetaInteractingGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,19 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;MetaInteractingGeometry.hpp&quot;
-
-MetaInteractingGeometry::MetaInteractingGeometry () : InteractingGeometry()
-{
-	createIndex();
-}
-
-MetaInteractingGeometry::~MetaInteractingGeometry ()
-{
-}
-

Deleted: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry/MetaInteractingGeometry.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry/MetaInteractingGeometry.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry/MetaInteractingGeometry.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,31 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef METAINTERACTINGGEOMETRY_HPP
-#define METAINTERACTINGGEOMETRY_HPP
-
-#include&lt;yade/core/InteractingGeometry.hpp&gt;
-
-class MetaInteractingGeometry : public InteractingGeometry
-{
-	public :
-		MetaInteractingGeometry ();
-		virtual ~MetaInteractingGeometry ();
-
-/// Serialization
-	REGISTER_CLASS_NAME(MetaInteractingGeometry);
-	REGISTER_BASE_CLASS_NAME(InteractingGeometry);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(MetaInteractingGeometry,InteractingGeometry);
-};
-
-REGISTER_SERIALIZABLE(MetaInteractingGeometry,false);
-
-#endif // METAINTERACTINGGEOMETRY_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry/MetaInteractingGeometry.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/InteractingGeometry/MetaInteractingGeometry/MetaInteractingGeometry.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures/ClosestFeatures.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures/ClosestFeatures.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures/ClosestFeatures.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,34 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ClosestFeatures.hpp&quot;
-
-
-ClosestFeatures::ClosestFeatures() : InteractionGeometry()
-{
-	createIndex();
-	closestsPoints.clear();
-}
-
-
-ClosestFeatures::~ClosestFeatures ()
-{
-}
-
-
-// 
-// void ClosestFeatures::postProcessAttributes(bool)
-// {
-// 
-// }
-// 
-// void ClosestFeatures::registerAttributes()
-// {
-// 
-// }
-

Deleted: branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures/ClosestFeatures.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures/ClosestFeatures.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures/ClosestFeatures.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,36 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef CLOSESTSFEATURES_HPP
-#define CLOSESTSFEATURES_HPP
-
-#include &lt;vector&gt;
-
-#include&lt;yade/core/InteractionGeometry.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class ClosestFeatures : public InteractionGeometry
-{
-	public :
-		std::vector&lt;std::pair&lt;Vector3r,Vector3r&gt; &gt; closestsPoints;
-		std::vector&lt;int&gt; verticesId;
-		
-		ClosestFeatures();
-		virtual ~ClosestFeatures();
-
-	REGISTER_CLASS_NAME(ClosestFeatures);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometry);
-
-	REGISTER_CLASS_INDEX(ClosestFeatures,InteractionGeometry);
-};
-
-REGISTER_SERIALIZABLE(ClosestFeatures,false);
-
-#endif // __CLOSESTSFEATURES_H__
-

Copied: branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures/ClosestFeatures.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/InteractionGeometry/ClosestFeatures/ClosestFeatures.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction/SimpleElasticInteraction.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction/SimpleElasticInteraction.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction/SimpleElasticInteraction.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,24 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;SimpleElasticInteraction.hpp&quot;
-
-
-SimpleElasticInteraction::SimpleElasticInteraction()
-{
-	createIndex();
-}
-
-SimpleElasticInteraction::~SimpleElasticInteraction()
-{
-}
-
-void SimpleElasticInteraction::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(kn);
-}

Deleted: branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction/SimpleElasticInteraction.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction/SimpleElasticInteraction.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction/SimpleElasticInteraction.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SIMPLEELASTICINTERACTION_HPP
-#define SIMPLEELASTICINTERACTION_HPP
-
-#include&lt;yade/core/InteractionPhysics.hpp&gt;
-
-//class ip_simple_elastic : public interaction_physics
-class SimpleElasticInteraction : public InteractionPhysics
-{
-	public :
-		Real		 kn;				// normal elastic constant.
-	
-		SimpleElasticInteraction();
-		virtual ~SimpleElasticInteraction();
-	protected :
-		virtual void registerAttributes();
-
-	REGISTER_CLASS_NAME(SimpleElasticInteraction);
-	REGISTER_BASE_CLASS_NAME(InteractionPhysics);
-
-	REGISTER_CLASS_INDEX(SimpleElasticInteraction,InteractionPhysics);
-
-};
-
-REGISTER_SERIALIZABLE(SimpleElasticInteraction,false);
-
-#endif // ELASTIC_CONTACT_PARAMETERS_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction/SimpleElasticInteraction.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/InteractionPhysics/SimpleElasticInteraction/SimpleElasticInteraction.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force/Force.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force/Force.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force/Force.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,49 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;Force.hpp&quot;
-
-
-Force::Force() : PhysicalAction()
-{
-	createIndex();
-}
-
-Force::~Force()
-{
-}
-
-
-/* FIXME - not used
-void Force::add(const shared_ptr&lt;PhysicalAction&gt;&amp; a)
-{
-	Force * f = static_cast&lt;Force*&gt;(a.get());
-	force += f-&gt;force;
-}
-
-
-void Force::sub(const shared_ptr&lt;PhysicalAction&gt;&amp; a)
-{
-	Force * f = static_cast&lt;Force*&gt;(a.get());
-	force -= f-&gt;force;
-}
-*/
-
-void Force::reset()
-{
-	force = Vector3r::ZERO;
-}
-
-
-shared_ptr&lt;PhysicalAction&gt; Force::clone()
-{
-	return shared_ptr&lt;Force&gt;(new Force(*this));
-}
-

Deleted: branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force/Force.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force/Force.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force/Force.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,43 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ACTIONFORCE_HPP
-#define ACTIONFORCE_HPP
-
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class Force : public PhysicalAction
-{
-	public :
-		Vector3r force;
-
-		Force();
-		virtual ~Force();
-
-/// Methods
-//		virtual void add(const shared_ptr&lt;PhysicalAction&gt;&amp; a); // FIXME - not used
-//		virtual void sub(const shared_ptr&lt;PhysicalAction&gt;&amp; a); // FIXME - not used
-
-		virtual void reset();
-		virtual shared_ptr&lt;PhysicalAction&gt; clone();
-		
-/// Serialization
-	REGISTER_CLASS_NAME(Force);
-	REGISTER_BASE_CLASS_NAME(PhysicalAction);
-
-/// Indexable
-	REGISTER_CLASS_INDEX(Force,PhysicalAction);
-	
-};
-
-REGISTER_SERIALIZABLE(Force,false);
-
-#endif // ACTIONFORCE_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force/Force.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/PhysicalAction/Force/Force.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum/Momentum.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum/Momentum.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum/Momentum.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,48 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;Momentum.hpp&quot;
-
-
-Momentum::Momentum() : PhysicalAction()
-{
-	createIndex();
-}
-
-Momentum::~Momentum()
-{
-}
-
-/* FIXME - not used
-void Momentum::add(const shared_ptr&lt;PhysicalAction&gt;&amp; a)
-{
-	Momentum * m = static_cast&lt;Momentum*&gt;(a.get());
-	momentum += m-&gt;momentum;
-}
-
-
-void Momentum::sub(const shared_ptr&lt;PhysicalAction&gt;&amp; a)
-{
-	Momentum * m = static_cast&lt;Momentum*&gt;(a.get());
-	momentum -= m-&gt;momentum;
-}
-*/
-
-void Momentum::reset()
-{
-	momentum = Vector3r::ZERO;
-}
-
-
-shared_ptr&lt;PhysicalAction&gt; Momentum::clone()
-{
-	return shared_ptr&lt;Momentum&gt;(new Momentum(*this));
-}
-

Deleted: branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum/Momentum.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum/Momentum.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum/Momentum.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,42 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef MOMENTUM_HPP
-#define MOMENTUM_HPP
-
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class Momentum : public PhysicalAction
-{
-	public :
-		Vector3r momentum;
-		Momentum();
-		virtual ~Momentum();
-
-//		virtual void add(const shared_ptr&lt;PhysicalAction&gt;&amp; a); // FIXME - not used
-//		virtual void sub(const shared_ptr&lt;PhysicalAction&gt;&amp; a); // FIXME - not used
-
-		virtual void reset();
-		virtual shared_ptr&lt;PhysicalAction&gt; clone();
-	
-/// Serialization
-	REGISTER_CLASS_NAME(Momentum);
-	REGISTER_BASE_CLASS_NAME(PhysicalAction);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(Momentum,PhysicalAction);
-};
-
-REGISTER_SERIALIZABLE(Momentum,false);
-
-#endif // MOMENTUM_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum/Momentum.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/PhysicalAction/Momentum/Momentum.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters/ElasticBodyParameters.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters/ElasticBodyParameters.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters/ElasticBodyParameters.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,25 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ElasticBodyParameters.hpp&quot;
-
-ElasticBodyParameters::ElasticBodyParameters () : RigidBodyParameters()
-{
-	createIndex();
-}
-
-ElasticBodyParameters::~ElasticBodyParameters()
-{
-}
-
-void ElasticBodyParameters::registerAttributes()
-{
-	RigidBodyParameters::registerAttributes();
-	REGISTER_ATTRIBUTE(young);
-}
-

Deleted: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters/ElasticBodyParameters.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters/ElasticBodyParameters.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters/ElasticBodyParameters.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,38 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-#ifndef ELASTICBODYPARAMETERS_HPP
-#define ELASTICBODYPARAMETERS_HPP
-
-
-#include &quot;RigidBodyParameters.hpp&quot;
-
-
-class ElasticBodyParameters : public RigidBodyParameters
-{
-	public :
-		Real		 young;
-
-		ElasticBodyParameters ();
-		virtual ~ElasticBodyParameters ();
-
-/// Serialization
-	REGISTER_CLASS_NAME(ElasticBodyParameters);
-	REGISTER_BASE_CLASS_NAME(RigidBodyParameters);
-
-	public : void registerAttributes();
-
-/// Indexable
-	REGISTER_CLASS_INDEX(ElasticBodyParameters,RigidBodyParameters);
-};
-
-REGISTER_SERIALIZABLE(ElasticBodyParameters,false);
-
-#endif 
-

Copied: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters/ElasticBodyParameters.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ElasticBodyParameters/ElasticBodyParameters.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters/ParticleParameters.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters/ParticleParameters.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters/ParticleParameters.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,31 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ParticleParameters.hpp&quot;
-
-
-ParticleParameters::ParticleParameters() : PhysicalParameters()
-{
-	createIndex();
-	acceleration = Vector3r(0,0,0);
-}
-
-ParticleParameters::~ParticleParameters()
-{
-}
-
-
-void ParticleParameters::registerAttributes()
-{
-	PhysicalParameters::registerAttributes();
-	REGISTER_ATTRIBUTE(mass);
-	REGISTER_ATTRIBUTE(velocity);
-}
-

Deleted: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters/ParticleParameters.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters/ParticleParameters.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters/ParticleParameters.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,44 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef PARTICLEPARAMETERS_HPP
-#define PARTICLEPARAMETERS_HPP
-
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-class ParticleParameters : public PhysicalParameters
-{
-	public :
-		// parameters
-		Real		 mass;
-
-		// state
-		Vector3r	 acceleration
-				,velocity;
-
-		ParticleParameters();
-		virtual ~ParticleParameters();
-
-/// Serializable
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(ParticleParameters);
-	REGISTER_BASE_CLASS_NAME(PhysicalParameters);
-
-/// Indexable
-	REGISTER_CLASS_INDEX(ParticleParameters,PhysicalParameters);
-
-};
-
-REGISTER_SERIALIZABLE(ParticleParameters,false);
-
-#endif // PARTICLEPARAMETERS_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters/ParticleParameters.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/PhysicalParameters/ParticleParameters/ParticleParameters.hpp)

Deleted: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters/RigidBodyParameters.cpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters/RigidBodyParameters.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters/RigidBodyParameters.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,30 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;RigidBodyParameters.hpp&quot;
-
-RigidBodyParameters::RigidBodyParameters() : ParticleParameters()
-{
-	createIndex();
-	acceleration = Vector3r(0,0,0);
-	angularAcceleration = Vector3r(0,0,0);
-}
-
-RigidBodyParameters::~RigidBodyParameters()
-{
-}
-
-void RigidBodyParameters::registerAttributes()
-{
-	ParticleParameters::registerAttributes();
-	REGISTER_ATTRIBUTE(inertia);
-	REGISTER_ATTRIBUTE(angularVelocity);
-}
-

Deleted: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters/RigidBodyParameters.hpp
===================================================================
--- branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters/RigidBodyParameters.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters/RigidBodyParameters.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,41 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef RIGIDBODYPARAMETERS_HPP
-#define RIGIDBODYPARAMETERS_HPP
-
-#include &quot;ParticleParameters.hpp&quot;
-#include &lt;Wm3Matrix3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class RigidBodyParameters : public ParticleParameters
-{	
-	public :
-		// parameters
-		Vector3r	 inertia
-		// state
-				,angularAcceleration
-				,angularVelocity;
-	
-		RigidBodyParameters ();
-		virtual ~RigidBodyParameters ();
-
-/// Serialization										///
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(RigidBodyParameters);
-	REGISTER_BASE_CLASS_NAME(ParticleParameters);
-	
-/// Indexable											///
-	REGISTER_CLASS_INDEX(RigidBodyParameters,ParticleParameters);
-};
-
-REGISTER_SERIALIZABLE(RigidBodyParameters,false);
-
-#endif // RIGIDBODYPARAMETERS_HPP
-

Copied: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters.cpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters/RigidBodyParameters.cpp)

Copied: branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters.hpp (from rev 1105, branches/scons-layout/pkg/common/DataClass/PhysicalParameters/RigidBodyParameters/RigidBodyParameters.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine/DisplacementEngine.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine/DisplacementEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine/DisplacementEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,71 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;DisplacementEngine.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-void DisplacementEngine::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-		translationAxis.Normalize();
-
-		/*
-		if(displacement==0)
-			displacement=2e-10;
-		else
-			displacement=0;
-		*/
-	//	displacement *= 10.0;
-
-		std::cerr &lt;&lt; &quot;displacement: &quot; &lt;&lt; displacement &lt;&lt; &quot;\n&quot;;
-	}
-}
-
-
-void DisplacementEngine::registerAttributes()
-{
-	DeusExMachina::registerAttributes();
-	REGISTER_ATTRIBUTE(displacement);
-	REGISTER_ATTRIBUTE(translationAxis);
-}
-
-
-void DisplacementEngine::applyCondition(Body * body)
-{
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();
-	std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();
-
-//
-// FIXME - we really need to set intervals for engines.
-//
-
-//	if(Omega::instance().getCurrentIteration() &gt; 2000)
-//		return;
-
-
-//      {
-
-
-	for(;ii!=iiEnd;++ii)
-		if( bodies-&gt;exists(*ii) )
-			((*bodies)[*ii]-&gt;physicalParameters.get())-&gt;se3.position += displacement*translationAxis;
-		
-		
-//	}
-//	else
-//	{
-//	for(;ii!=iiEnd;++ii)
-//		((*bodies)[*ii])-&gt;isDynamic = true;
-//	}
-
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine/DisplacementEngine.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine/DisplacementEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine/DisplacementEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,33 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef DISPLACEMENTENGINE_HPP
-#define DISPLACEMENTENGINE_HPP
-
-#include&lt;yade/core/DeusExMachina.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class DisplacementEngine : public DeusExMachina
-{
-	public :
-		Real displacement;
-		Vector3r translationAxis;
-		void applyCondition(Body * body);
-
-	protected :
-		virtual void postProcessAttributes(bool);
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(DisplacementEngine);
-	REGISTER_BASE_CLASS_NAME(DeusExMachina);
-};
-
-REGISTER_SERIALIZABLE(DisplacementEngine,false);
-
-#endif //  DISPLACEMENTENGINE_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine/DisplacementEngine.cpp)

Copied: branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/DeusExMachina/DisplacementEngine/DisplacementEngine.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine/ForceEngine.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine/ForceEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine/ForceEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,45 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ForceEngine.hpp&quot;
-#include &quot;ParticleParameters.hpp&quot;
-#include &quot;Force.hpp&quot;
-
-
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-ForceEngine::ForceEngine() : actionParameterForce(new Force), force(Vector3r::ZERO)
-{
-}
-
-ForceEngine::~ForceEngine()
-{
-}
-
-
-void ForceEngine::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(force);
-}
-
-
-void ForceEngine::applyCondition(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find( b-&gt;getId() , actionParameterForce-&gt;getClassIndex() ).get() )-&gt;force += force;
-        }
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine/ForceEngine.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine/ForceEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine/ForceEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FORCE_ENGINE_HPP
-#define FORCE_ENGINE_HPP
-
-#include&lt;yade/core/DeusExMachina.hpp&gt;
-
-class Force;
-
-class ForceEngine : public DeusExMachina 
-{
-	private :
-		shared_ptr&lt;Force&gt;	actionParameterForce;
-	public :
-		Vector3r		force;
-
-		ForceEngine();
-		virtual ~ForceEngine();
-	
-		virtual void applyCondition(Body*);
-	
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(ForceEngine);
-	REGISTER_BASE_CLASS_NAME(DeusExMachina);
-};
-
-REGISTER_SERIALIZABLE(ForceEngine,false);
-
-#endif // FORCE_ENGINE_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine/ForceEngine.cpp)

Copied: branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/DeusExMachina/ForceEngine/ForceEngine.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine/GravityEngine.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine/GravityEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine/GravityEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,53 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GravityEngine.hpp&quot;
-#include &quot;ParticleParameters.hpp&quot;
-#include &quot;Force.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-GravityEngine::GravityEngine() : actionParameterForce(new Force), gravity(Vector3r::ZERO)
-{
-}
-
-
-GravityEngine::~GravityEngine()
-{
-}
-
-
-void GravityEngine::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(gravity);
-}
-
-
-void GravityEngine::applyCondition(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		/* skip bodies that are within a clump;
-		 * even if they are marked isDynamic==false, forces applied to them are passed to the clump, which is dynamic;
-		 * and since clump is a body with mass equal to the sum of masses of its components, it would have gravity applied twice.
-		 *
-		 * The choice is to skip (b-&gt;isClumpMember()) or (b-&gt;isClump()). We rather skip members,
-		 * since that will apply smaller number of forces and (theoretically) improve numerical stability ;-) */
-		if(b-&gt;isClumpMember()) continue;
-
-		ParticleParameters* p = dynamic_cast&lt;ParticleParameters*&gt;(b-&gt;physicalParameters.get());
-		if (p)
-			static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find( b-&gt;getId() , actionParameterForce-&gt;getClassIndex() ).get() )-&gt;force += gravity * p-&gt;mass;
-        }
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine/GravityEngine.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine/GravityEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine/GravityEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GRAVITY_FORCE_FUNCTOR_HPP
-#define GRAVITY_FORCE_FUNCTOR_HPP 
-
-#include&lt;yade/core/DeusExMachina.hpp&gt;
-
-class Force;
-
-class GravityEngine : public DeusExMachina 
-{
-	private	:
-		shared_ptr&lt;Force&gt; actionParameterForce;
-
-	public :
-		Vector3r gravity;
-		GravityEngine();
-		virtual ~GravityEngine();
-	
-		virtual void applyCondition(Body*);
-	
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(GravityEngine);
-	REGISTER_BASE_CLASS_NAME(DeusExMachina);
-};
-
-REGISTER_SERIALIZABLE(GravityEngine,false);
-
-#endif // GRAVITY_FORCE_FUNCTOR_HPP 
-

Copied: branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine/GravityEngine.cpp)

Copied: branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/DeusExMachina/GravityEngine/GravityEngine.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine/RotationEngine.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine/RotationEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine/RotationEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,69 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-#include &quot;RotationEngine.hpp&quot;
-#include &quot;RigidBodyParameters.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-RotationEngine::RotationEngine()
-{
-	rotateAroundZero = false;
-}
-
-
-void RotationEngine::registerAttributes()
-{
-	DeusExMachina::registerAttributes();
-	REGISTER_ATTRIBUTE(angularVelocity);
-	REGISTER_ATTRIBUTE(rotationAxis);
-	REGISTER_ATTRIBUTE(rotateAroundZero);
-}
-
-
-void RotationEngine::applyCondition(Body * body)
-{
-
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt; bodies = ncb-&gt;bodies;
-
-	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();
-	std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();
-
-	Real dt = Omega::instance().getTimeStep();
-	time = dt;
-
-	Quaternionr q;
-	q.FromAxisAngle(rotationAxis,angularVelocity*dt);
-
-	Vector3r ax;
-	Real an;
-	
-	for(;ii!=iiEnd;++ii)
-	{
-		RigidBodyParameters * rb = static_cast&lt;RigidBodyParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get());
-
-		if(rotateAroundZero)
-			rb-&gt;se3.position	= q*rb-&gt;se3.position; // for RotatingBox
-			
-		rb-&gt;se3.orientation	= q*rb-&gt;se3.orientation;
-
-		rb-&gt;se3.orientation.Normalize();
-		rb-&gt;se3.orientation.ToAxisAngle(ax,an);
-		
-		rb-&gt;angularVelocity	= rotationAxis*angularVelocity;
-		rb-&gt;velocity		= Vector3r(0,0,0);
-	}
-
-
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine/RotationEngine.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine/RotationEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine/RotationEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,36 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ROTATIONENGINE_HPP
-#define ROTATIONENGINE_HPP
-
-#include&lt;yade/core/DeusExMachina.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class RotationEngine : public DeusExMachina
-{
-	public :
-		RotationEngine();
-
-		Real angularVelocity;
-		Vector3r rotationAxis;
-		bool rotateAroundZero;
-
-		void applyCondition(Body * body);
-
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(RotationEngine);
-	REGISTER_BASE_CLASS_NAME(DeusExMachina);
-};
-
-REGISTER_SERIALIZABLE(RotationEngine,false);
-
-#endif // ROTATIONENGINE_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine/RotationEngine.cpp)

Copied: branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/DeusExMachina/RotationEngine/RotationEngine.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine/TranslationEngine.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine/TranslationEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine/TranslationEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,71 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;TranslationEngine.hpp&quot;
-#include &quot;ParticleParameters.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-void TranslationEngine::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-		translationAxis.Normalize();
-}
-
-
-void TranslationEngine::registerAttributes()
-{
-	DeusExMachina::registerAttributes();
-	REGISTER_ATTRIBUTE(velocity);
-	REGISTER_ATTRIBUTE(translationAxis);
-}
-
-
-void TranslationEngine::applyCondition(Body * body)
-{
-
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();
-	std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();
-
-	Real dt = Omega::instance().getTimeStep();
-	time = dt;
-	static int sign = 1;
-
-	//if ((Omega::instance().getCurrentIteration()/1000)%2==0)
-		sign = 1;
-	//else
-	//	sign = -1;
-
-	for(;ii!=iiEnd;++ii)
-		if(ParticleParameters* p = dynamic_cast&lt;ParticleParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get()))
-		{
-
-		// FIXME - specify intervals of activity for an engine =&gt; use isActivated method
-		//if( Omega::instance().getIter() &gt; 1000 )
-		//	b-&gt;velocity		= Vector3r(0,0,0);
-		//else
-		//{
-			p-&gt;se3.position		+= sign*dt*velocity*translationAxis;
-			p-&gt;velocity		=  sign*velocity*translationAxis;
-		//}
-		
-		}
-		else if(PhysicalParameters* b = dynamic_cast&lt;PhysicalParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get()))
-		{ // NOT everyone has velocity !
-			b-&gt;se3.position		+= sign*dt*velocity*translationAxis;
-		}
-		else
-		{
-			std::cerr &lt;&lt; &quot;TranslationEngine::applyCondition, WARNING! dynamic_cast failed! for id: &quot; &lt;&lt; *ii &lt;&lt; std::endl; // FUCK! I've literally spent two days - 10hours to find a mistake caused by static_cast!!, we should never use static_cast when in DEBUG mode !!!!!
-		}
-
-
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine/TranslationEngine.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine/TranslationEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine/TranslationEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,33 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef TRANSLATOR_HPP
-#define TRANSLATOR_HPP
-
-#include&lt;yade/core/DeusExMachina.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class TranslationEngine : public DeusExMachina
-{
-	public :
-		Real velocity;
-		Vector3r translationAxis;
-		void applyCondition(Body * body);
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-		void registerAttributes();
-	REGISTER_CLASS_NAME(TranslationEngine);
-	REGISTER_BASE_CLASS_NAME(DeusExMachina);
-};
-
-REGISTER_SERIALIZABLE(TranslationEngine,false);
-
-#endif // TRANSLATOR_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine/TranslationEngine.cpp)

Copied: branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/DeusExMachina/TranslationEngine/TranslationEngine.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping/CundallNonViscousForceDamping.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping/CundallNonViscousForceDamping.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping/CundallNonViscousForceDamping.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,44 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;CundallNonViscousForceDamping.hpp&quot;
-#include &quot;ParticleParameters.hpp&quot;
-#include &quot;Force.hpp&quot;
-
-
-CundallNonViscousForceDamping::CundallNonViscousForceDamping() : damping(0)
-{
-}
-
-
-void CundallNonViscousForceDamping::registerAttributes()
-{
-	PhysicalActionDamperUnit::registerAttributes();
-	REGISTER_ATTRIBUTE(damping);
-}
-
-
-// this is Cundall non-viscous local damping, applied to force (Force)
-
-void CundallNonViscousForceDamping::go(    const shared_ptr&lt;PhysicalAction&gt;&amp; a
-						, const shared_ptr&lt;PhysicalParameters&gt;&amp; b
-						, const Body* body)
-{
-	if(body-&gt;isClump()) return;
-	Force * af = static_cast&lt;Force*&gt;(a.get());
-	ParticleParameters * p = static_cast&lt;ParticleParameters*&gt;(b.get());
-		
-	
-	for (int i=0; i&lt;3; ++i)
-	{
-		af-&gt;force[i] *= 1 - damping*Mathr::Sign(af-&gt;force[i]*p-&gt;velocity[i]);	
-	}
-	
-}
-
-

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping/CundallNonViscousForceDamping.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping/CundallNonViscousForceDamping.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping/CundallNonViscousForceDamping.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,34 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ACTION_FORCE_DAMPING_HPP
-#define ACTION_FORCE_DAMPING_HPP
-
-#include &quot;PhysicalActionDamperUnit.hpp&quot;
-
-class CundallNonViscousForceDamping : public PhysicalActionDamperUnit
-{
-	public :
-		Real	damping;
-
-		CundallNonViscousForceDamping();
-	
-		virtual void go( 	  const shared_ptr&lt;PhysicalAction&gt;&amp;
-					, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-					, const Body*);
-	
-	protected :
-		virtual void registerAttributes();
-
-	REGISTER_CLASS_NAME(CundallNonViscousForceDamping);
-	REGISTER_BASE_CLASS_NAME(PhysicalActionDamperUnit);
-};
-
-REGISTER_SERIALIZABLE(CundallNonViscousForceDamping,false);
-
-#endif // ACTION_FORCE_DAMPING_HPP

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping/CundallNonViscousForceDamping.cpp)

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousForceDamping/CundallNonViscousForceDamping.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping/CundallNonViscousMomentumDamping.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping/CundallNonViscousMomentumDamping.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping/CundallNonViscousMomentumDamping.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,48 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;CundallNonViscousMomentumDamping.hpp&quot;
-#include &quot;RigidBodyParameters.hpp&quot;
-#include &quot;Momentum.hpp&quot;
-
-
-CundallNonViscousMomentumDamping::CundallNonViscousMomentumDamping() : damping(0)
-{
-}
-
-
-void CundallNonViscousMomentumDamping::registerAttributes()
-{
-	PhysicalActionDamperUnit::registerAttributes();
-	REGISTER_ATTRIBUTE(damping);
-}
-
-
-// this is Cundall non-viscous local damping, applied to momentum (Momentum)
-
-void CundallNonViscousMomentumDamping::go( 	  const shared_ptr&lt;PhysicalAction&gt;&amp; a
-						, const shared_ptr&lt;PhysicalParameters&gt;&amp; b
-						, const Body* body)
-{
-	if(body-&gt;isClump()) return;
-	Momentum * am = static_cast&lt;Momentum*&gt;(a.get());
-	RigidBodyParameters * rb = static_cast&lt;RigidBodyParameters*&gt;(b.get());
-	
-	Vector3r&amp; m  = am-&gt;momentum;
-	
-	
-	for (int i=0; i&lt;3; ++i)
-	{
-		m[i] *= 1 - damping*Mathr::Sign(m[i]*rb-&gt;angularVelocity[i]);	
-	}
-	
-		
-
-}
-
-

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping/CundallNonViscousMomentumDamping.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping/CundallNonViscousMomentumDamping.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping/CundallNonViscousMomentumDamping.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,33 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ACTION_MOMENTUM_DAMPING_HPP
-#define ACTION_MOMENTUM_DAMPING_HPP
-
-#include &quot;PhysicalActionDamperUnit.hpp&quot;
-
-class CundallNonViscousMomentumDamping : public PhysicalActionDamperUnit
-{
-	public :
-		Real	damping;
-
-		CundallNonViscousMomentumDamping();
-	
-		virtual void go( 	  const shared_ptr&lt;PhysicalAction&gt;&amp;
-					, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-					, const Body*);
-	
-	protected :
-		 virtual void registerAttributes();
-	REGISTER_CLASS_NAME(CundallNonViscousMomentumDamping);
-	REGISTER_BASE_CLASS_NAME(PhysicalActionDamperUnit);
-};
-
-REGISTER_SERIALIZABLE(CundallNonViscousMomentumDamping,false);
-
-#endif // ACTION_MOMENTUM_DAMPING_HPP

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping/CundallNonViscousMomentumDamping.cpp)

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/CundallNonViscousMomentumDamping/CundallNonViscousMomentumDamping.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship/ElasticBodySimpleRelationship.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship/ElasticBodySimpleRelationship.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship/ElasticBodySimpleRelationship.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ElasticBodySimpleRelationship.hpp&quot;
-#include &quot;SimpleElasticInteraction.hpp&quot;
-#include &quot;ElasticBodyParameters.hpp&quot;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-void ElasticBodySimpleRelationship::go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp; b1
-					, const shared_ptr&lt;PhysicalParameters&gt;&amp; b2
-					, const shared_ptr&lt;Interaction&gt;&amp; interaction)
-{
-	ElasticBodyParameters* s1 = static_cast&lt;ElasticBodyParameters*&gt;(b1.get());
-	ElasticBodyParameters* s2 = static_cast&lt;ElasticBodyParameters*&gt;(b2.get());
-	
-	// the need to calculate this is only when the interaction is new
-	if( interaction-&gt;isNew)
-	{
-		boost::shared_ptr&lt;SimpleElasticInteraction&gt; sei(new SimpleElasticInteraction);
-		sei-&gt;kn = (s1-&gt;young + s2-&gt;young)*0.5;
-		interaction-&gt;interactionPhysics=sei;
-	}	
-};
-
-void ElasticBodySimpleRelationship::registerAttributes()
-{
-};
-

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship/ElasticBodySimpleRelationship.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship/ElasticBodySimpleRelationship.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship/ElasticBodySimpleRelationship.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,32 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ELASTICBODYSIMPLERELATIONSHIP_HPP
-#define ELASTICBODYSIMPLERELATIONSHIP_HPP
-
-#include &quot;InteractionPhysicsEngineUnit.hpp&quot;
-
-class ElasticBodySimpleRelationship : public InteractionPhysicsEngineUnit
-{
-	public :
-		virtual void go(	const shared_ptr&lt;PhysicalParameters&gt;&amp; b1,
-					const shared_ptr&lt;PhysicalParameters&gt;&amp; b2,
-					const shared_ptr&lt;Interaction&gt;&amp; interaction);
-
-	protected :
-		virtual void registerAttributes();
-
-	REGISTER_CLASS_NAME(ElasticBodySimpleRelationship);
-	REGISTER_BASE_CLASS_NAME(InteractionPhysicsEngineUnit);
-
-};
-
-REGISTER_SERIALIZABLE(ElasticBodySimpleRelationship,false);
-
-#endif // 
-

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship/ElasticBodySimpleRelationship.cpp)

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/ElasticBodySimpleRelationship/ElasticBodySimpleRelationship.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB/InteractingBox2AABB.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB/InteractingBox2AABB.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB/InteractingBox2AABB.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,34 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#include &quot;InteractingBox2AABB.hpp&quot;
-#include &quot;InteractingBox.hpp&quot;
-#include &quot;AABB.hpp&quot;
-
-
-void InteractingBox2AABB::go(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm,
-				shared_ptr&lt;BoundingVolume&gt;&amp; bv,
-				const Se3r&amp; se3,
-				const Body*	)
-{
-	InteractingBox* box = static_cast&lt;InteractingBox*&gt;(cm.get());
-	AABB* aabb = static_cast&lt;AABB*&gt;(bv.get());
-	
-	aabb-&gt;center = se3.position;
-
-	Matrix3r r;
-	se3.orientation.ToRotationMatrix(r);
-	aabb-&gt;halfSize = Vector3r(0,0,0);
-	for( int i=0; i&lt;3; ++i )
-		for( int j=0; j&lt;3; ++j )
-			aabb-&gt;halfSize[i] += fabs( r[i][j] * box-&gt;extents[j] );
-	
-	aabb-&gt;min = aabb-&gt;center-aabb-&gt;halfSize;
-	aabb-&gt;max = aabb-&gt;center+aabb-&gt;halfSize;
-}
-	

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB/InteractingBox2AABB.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB/InteractingBox2AABB.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB/InteractingBox2AABB.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,31 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#ifndef INTERACTINGBOX2AABB_HPP
-#define INTERACTINGBOX2AABB_HPP
-
-
-#include &quot;BoundingVolumeEngineUnit.hpp&quot;
-
-
-class InteractingBox2AABB : public BoundingVolumeEngineUnit
-{
-	public :
-		void go(	  const shared_ptr&lt;InteractingGeometry&gt;&amp; cm
-				, shared_ptr&lt;BoundingVolume&gt;&amp; bv
-				, const Se3r&amp; se3
-				, const Body*	);
-
-	REGISTER_CLASS_NAME(InteractingBox2AABB);
-	REGISTER_BASE_CLASS_NAME(BoundingVolumeEngineUnit);
-};
-
-REGISTER_SERIALIZABLE(InteractingBox2AABB,false);
-
-#endif // INTERACTINGBOX2AABB_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB/InteractingBox2AABB.cpp)

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingBox2AABB/InteractingBox2AABB.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB/InteractingSphere2AABB.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB/InteractingSphere2AABB.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB/InteractingSphere2AABB.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,29 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#include &quot;InteractingSphere2AABB.hpp&quot;
-#include &quot;InteractingSphere.hpp&quot;
-#include &quot;AABB.hpp&quot;
-
-void InteractingSphere2AABB::go(	  const shared_ptr&lt;InteractingGeometry&gt;&amp; cm
-				, shared_ptr&lt;BoundingVolume&gt;&amp; bv
-				, const Se3r&amp; se3
-				, const Body*	)
-{
-	InteractingSphere* sphere = static_cast&lt;InteractingSphere*&gt;(cm.get());
-	AABB* aabb = static_cast&lt;AABB*&gt;(bv.get());
-	
-	aabb-&gt;center = se3.position;
-	
-	aabb-&gt;halfSize = Vector3r(sphere-&gt;radius,sphere-&gt;radius,sphere-&gt;radius);
-	
-	aabb-&gt;min = aabb-&gt;center-aabb-&gt;halfSize;
-	aabb-&gt;max = aabb-&gt;center+aabb-&gt;halfSize;	
-
-}
-	

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB/InteractingSphere2AABB.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB/InteractingSphere2AABB.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB/InteractingSphere2AABB.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,28 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#ifndef SPHERE2AABB_HPP
-#define SPHERE2AABB_HPP
-
-#include &quot;BoundingVolumeEngineUnit.hpp&quot;
-
-class InteractingSphere2AABB : public BoundingVolumeEngineUnit
-{
-	public :
-		void go(	  const shared_ptr&lt;InteractingGeometry&gt;&amp; cm
-				, shared_ptr&lt;BoundingVolume&gt;&amp; bv
-				, const Se3r&amp; se3
-				, const Body*	);
-	REGISTER_CLASS_NAME(InteractingSphere2AABB);
-	REGISTER_BASE_CLASS_NAME(BoundingVolumeEngineUnit);
-};
-
-REGISTER_SERIALIZABLE(InteractingSphere2AABB,false);
-
-#endif // SPHERE2AABB_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB/InteractingSphere2AABB.cpp)

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/InteractingSphere2AABB/InteractingSphere2AABB.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,45 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LeapFrogOrientationIntegrator.hpp&quot;
-#include &quot;RigidBodyParameters.hpp&quot;
-#include&lt;yade/core/Omega.hpp&gt;
-
-// FIXME : should we pass timestep as parameter of functor
-// FIXME : what's with timestepper
-void LeapFrogOrientationIntegrator::go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp; b
-						, Body* body)
-{
-	if(!body-&gt;isDynamic) return;
-		
-	unsigned int id = body-&gt;getId();
-	
-	if (prevAngularVelocities.size()&lt;=id)
-	{
-		prevAngularVelocities.resize(id+1);
-		firsts.resize(id+1,true);
-	}
-
-	RigidBodyParameters * rb = YADE_CAST&lt;RigidBodyParameters*&gt;(b.get());
-	
-	Real dt = Omega::instance().getTimeStep();
-		
-	if (!firsts[id])
-		rb-&gt;angularVelocity = prevAngularVelocities[id]+rb-&gt;angularAcceleration*0.5*dt;
-		
-	prevAngularVelocities[id] = rb-&gt;angularVelocity+((Real)(0.5*dt))*rb-&gt;angularAcceleration;
-	Vector3r axis = rb-&gt;angularVelocity;
-	Real angle = axis.Normalize();
-	Quaternionr q;
-	q.FromAxisAngle(axis,angle*dt);
-	rb-&gt;se3.orientation = q*rb-&gt;se3.orientation;
-	rb-&gt;se3.orientation.Normalize();
-
-	firsts[id] = false;
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,31 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LEAP_FROG_ORIENTATION_INTEGRATOR_HPP
-#define LEAP_FROG_ORIENTATION_INTEGRATOR_HPP 
-
-#include &quot;PhysicalParametersEngineUnit.hpp&quot;
-
-class LeapFrogOrientationIntegrator : public PhysicalParametersEngineUnit 
-{
-	private :
-		vector&lt;Vector3r&gt; prevAngularVelocities;
-		vector&lt;bool&gt; firsts;
-	
-	public :
-		virtual void go( 	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-					, Body*);
-	
-	REGISTER_CLASS_NAME(LeapFrogOrientationIntegrator);
-	REGISTER_BASE_CLASS_NAME(PhysicalParametersEngineUnit);
-};
-
-REGISTER_SERIALIZABLE(LeapFrogOrientationIntegrator,false);
-
-#endif // LEAP_FROG_MOMENTUM_INTEGRATOR_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.cpp)

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,43 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LeapFrogPositionIntegrator.hpp&quot; 
-#include &quot;ParticleParameters.hpp&quot;
-#include&lt;yade/core/Omega.hpp&gt;
-
-// FIXME : should we pass timestep as parameter of functor
-// FIXME : what's with timestepper
-void LeapFrogPositionIntegrator::go(       const shared_ptr&lt;PhysicalParameters&gt;&amp; b
-						, Body* body)
-{
-	if(!body-&gt;isDynamic) return;
-
-	unsigned int id = body-&gt;getId();
-	
-	if (prevVelocities.size()&lt;=id)
-	{
-		prevVelocities.resize(id+1);
-		firsts.resize(id+1,true);
-	}
-
-	ParticleParameters * p = YADE_CAST&lt;ParticleParameters*&gt;(b.get());
-
-	Real dt = Omega::instance().getTimeStep();
-
-	if (!firsts[id])
-		p-&gt;velocity = prevVelocities[id]+((Real)0.5)*dt*p-&gt;acceleration;
-
-	prevVelocities[id] = p-&gt;velocity+((Real)0.5)*dt*p-&gt;acceleration;
-	p-&gt;se3.position += prevVelocities[id]*dt;
-
-	//cerr&lt;&lt;&quot;#&quot;&lt;&lt;body-&gt;getId()&lt;&lt;&quot;dx=&quot;&lt;&lt;prevVelocities[id]*dt&lt;&lt;endl;
-
-	firsts[id] = false;
-}
-
-

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,32 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LEAPFROG_POSITION_INTEGRATOR_HPP
-#define LEAPFROG_POSITION_INTEGRATOR_HPP 
-
-#include &quot;PhysicalParametersEngineUnit.hpp&quot;
-
-class LeapFrogPositionIntegrator : public PhysicalParametersEngineUnit
-{
-	private :
-		vector&lt;Vector3r&gt; prevVelocities;
-		vector&lt;bool&gt; firsts;
-	
-	public :
-		virtual void go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-					, Body*);
-	
-	REGISTER_CLASS_NAME(LeapFrogPositionIntegrator);
-	REGISTER_BASE_CLASS_NAME(PhysicalParametersEngineUnit);
-};
-
-REGISTER_SERIALIZABLE(LeapFrogPositionIntegrator,false);
-
-#endif // LEAPFROG_POSITION_INTEGRATOR_HPP
-
-

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.cpp)

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB/MetaInteractingGeometry2AABB.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB/MetaInteractingGeometry2AABB.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB/MetaInteractingGeometry2AABB.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,53 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#include &quot;MetaInteractingGeometry2AABB.hpp&quot;
-
-
-#include &quot;MetaInteractingGeometry.hpp&quot;
-#include &quot;AABB.hpp&quot;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-void MetaInteractingGeometry2AABB::go(	  const shared_ptr&lt;InteractingGeometry&gt;&amp;
-						, shared_ptr&lt;BoundingVolume&gt;&amp; bv
-						, const Se3r&amp;
-						, const Body* body )
-{
-	AABB* aabb = static_cast&lt;AABB*&gt;(bv.get());
-	
-	Vector3r max(-Mathr::MAX_REAL,-Mathr::MAX_REAL,-Mathr::MAX_REAL);
-	Vector3r min( Mathr::MAX_REAL, Mathr::MAX_REAL, Mathr::MAX_REAL);
-	
-	const MetaBody * ncb = YADE_CAST&lt;const MetaBody*&gt;(body);
-	const shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		if(b-&gt;boundingVolume)
-		{
-	 		max = componentMaxVector(max,b-&gt;boundingVolume-&gt;max);
- 			min = componentMinVector(min,b-&gt;boundingVolume-&gt;min);
-		} 
-		else
-		{
-	 		max = componentMaxVector(max,b-&gt;physicalParameters-&gt;se3.position);
- 			min = componentMinVector(min,b-&gt;physicalParameters-&gt;se3.position);
-		}
-	}
-	
-	aabb-&gt;center = (max+min)*0.5;
-	aabb-&gt;halfSize = (max-min)*0.5;
-	
-	aabb-&gt;min = min;
-	aabb-&gt;max = max;
-}
-	

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB/MetaInteractingGeometry2AABB.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB/MetaInteractingGeometry2AABB.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB/MetaInteractingGeometry2AABB.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,29 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#ifndef METAINTERACTINGGEOMETRY2AABB_HPP
-#define METAINTERACTINGGEOMETRY2AABB_HPP
-
-#include &quot;BoundingVolumeEngineUnit.hpp&quot;
-
-class MetaInteractingGeometry2AABB : public BoundingVolumeEngineUnit
-{
-	public :
-		void go(	  const shared_ptr&lt;InteractingGeometry&gt;&amp; cm
-				, shared_ptr&lt;BoundingVolume&gt;&amp; bv
-				, const Se3r&amp; se3
-				, const Body* );
-
-	REGISTER_CLASS_NAME(MetaInteractingGeometry2AABB);
-	REGISTER_BASE_CLASS_NAME(BoundingVolumeEngineUnit);
-};
-
-REGISTER_SERIALIZABLE(MetaInteractingGeometry2AABB,false);
-
-#endif // METAINTERACTINGGEOMETRY2AABB_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB/MetaInteractingGeometry2AABB.cpp)

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/MetaInteractingGeometry2AABB/MetaInteractingGeometry2AABB.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,51 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;NewtonsForceLaw.hpp&quot;
-#include &quot;ParticleParameters.hpp&quot;
-#include &quot;RigidBodyParameters.hpp&quot;
-#include &quot;Force.hpp&quot;
-
-
-void NewtonsForceLaw::go( const shared_ptr&lt;PhysicalAction&gt;&amp; a
-			, const shared_ptr&lt;PhysicalParameters&gt;&amp; b
-			, const Body* bb)
-{
-	Force * af = YADE_CAST&lt;Force*&gt;(a.get());
-	ParticleParameters * p = YADE_CAST&lt;ParticleParameters*&gt;(b.get());
-	
-	//FIXME : should be += and we should add an Engine that reset acceleration at the beginning
-	// if another PhysicalAction also acts on acceleration then we are overwritting it here
-	//
-	// currently this is not the case, because there is only one
-	// PhysicalAction that influences acceleration: Force
-	// 
-	// If another PhysicalAction will be added, that works on acceleration,
-	// then above will have to be fixed. And example of such action is: Acceleration
-	//
-	
-
-	// TODO: remove debugging stuff from the following
-	// normal behavior of a standalone particle or a clump itself
-	if (bb-&gt;isStandalone()) p-&gt;acceleration=af-&gt;force/p-&gt;mass;
-	else if (bb-&gt;isClump()) {
-		// accel for clump reset in Clump::moveMembers, called by ClumpMemberMover engine
-		p-&gt;acceleration+=af-&gt;force/p-&gt;mass;
-	}
-	else{ // force applied to a clump member is applied to clump itself
-		const shared_ptr&lt;Body&gt;&amp; clump(Body::byId(bb-&gt;clumpId));
-		RigidBodyParameters* clumpRBP=YADE_CAST&lt;RigidBodyParameters*&gt;(clump-&gt;physicalParameters.get());
-		// accels reset by Clump::moveMembers in last iteration
-		clumpRBP-&gt;acceleration+=af-&gt;force/clumpRBP-&gt;mass;
-		clumpRBP-&gt;angularAcceleration+=diagDiv((b-&gt;se3.position-clumpRBP-&gt;se3.position).Cross(af-&gt;force),clumpRBP-&gt;inertia); //acceleration from torque generated by the force WRT particle centroid on the clump centroid
-	}
-}
-
-

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,28 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef NEWTONSFORCELAW_HPP
-#define NEWTONSFORCELAW_HPP
-
-#include &quot;PhysicalActionApplierUnit.hpp&quot;
-
-class NewtonsForceLaw : public PhysicalActionApplierUnit
-{
-	public :
-		virtual void go( 	  const shared_ptr&lt;PhysicalAction&gt;&amp;
-					, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-					, const Body*);
-
-	REGISTER_CLASS_NAME(NewtonsForceLaw);
-	REGISTER_BASE_CLASS_NAME(PhysicalActionApplierUnit);
-};
-
-REGISTER_SERIALIZABLE(NewtonsForceLaw,false);
-
-#endif // NEWTONSFORCELAW_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.cpp)

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;NewtonsMomentumLaw.hpp&quot;
-#include &quot;RigidBodyParameters.hpp&quot;
-#include &quot;Momentum.hpp&quot;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-void NewtonsMomentumLaw::go( 	  const shared_ptr&lt;PhysicalAction&gt;&amp; a
-				, const shared_ptr&lt;PhysicalParameters&gt;&amp; b
-				, const Body* bb)
-{
-	Momentum * am = static_cast&lt;Momentum*&gt;(a.get());
-	RigidBodyParameters * rb = static_cast&lt;RigidBodyParameters*&gt;(b.get());
-	
-	//FIXME : should be += and we should add an Engine that reset acceleration at the beginning
-	if(bb-&gt;isStandalone()) rb-&gt;angularAcceleration=diagDiv(am-&gt;momentum,rb-&gt;inertia);
-	else if(bb-&gt;isClump()) rb-&gt;angularAcceleration+=diagDiv(am-&gt;momentum,rb-&gt;inertia);
-	else { // isClumpMember()
-		const shared_ptr&lt;Body&gt;&amp; clump(Body::byId(bb-&gt;clumpId));
-		RigidBodyParameters* clumpRBP=YADE_CAST&lt;RigidBodyParameters*&gt;(clump-&gt;physicalParameters.get());
-		/* angularAcceleration is reset by ClumpMemberMover engine */
-		clumpRBP-&gt;angularAcceleration+=diagDiv(am-&gt;momentum,clumpRBP-&gt;inertia);
-	}
-}
-
-

Deleted: branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,28 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef NEWTONSMOMENTUMLAW_HPP
-#define NEWTONSMOMENTUMLAW_HPP
-
-#include &quot;PhysicalActionApplierUnit.hpp&quot;
-
-class NewtonsMomentumLaw : public PhysicalActionApplierUnit
-{
-	public :
-		virtual void go( 	  const shared_ptr&lt;PhysicalAction&gt;&amp;
-					, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-					, const Body*);
-
-	REGISTER_CLASS_NAME(NewtonsMomentumLaw);
-	REGISTER_BASE_CLASS_NAME(PhysicalActionApplierUnit);
-};
-
-REGISTER_SERIALIZABLE(NewtonsMomentumLaw,false);
-
-#endif // NEWTONSMOMENTUMLAW_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.cpp)

Copied: branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.hpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeEngineUnit.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeEngineUnit.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeEngineUnit.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeEngineUnit.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeEngineUnit.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,57 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BOUNDINGVOLUMEFACTORY_HPP
-#define BOUNDINGVOLUMEFACTORY_HPP
-
-#include&lt;yade/core/BoundingVolume.hpp&gt;
-#include&lt;yade/core/InteractingGeometry.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/core/EngineUnit2D.hpp&gt;
-
-#include &lt;boost/shared_ptr.hpp&gt;
-#include &lt;string&gt;
-
-/*! \brief
-	Abstract interface for all classes that build BoundingVolume from InteractingGeometry
-
-	This is useful when it's not trivial to build the bounding volume from (some complicated) interaction model.
-	 
-	For example if you want to build an AABB from a box which is not initially aligned with the world
-	axis, it is not easy to write by hand into the configuration file the center and size of this AABB.
-	Instead you can use a BoundingVolumeEngineUnit that will compute for you the correct value.
-		
-	\param const shared_ptr&lt;InteractingGeometry&gt;&amp;	the collision model from wich we want to extract the bounding volume
-	\param Se3r&amp;					the 3D transformation to apply to the collision model before building the bounding volume
-	\param Body*					the Body inside which operation takes place
-	\return shared_ptr&lt;BoundingVolume&gt;&amp;		shared pointer to the bounding volume built (given as second argument to the function)
-	
-*/
-class BoundingVolumeEngineUnit : public EngineUnit2D
-				&lt;
-		 			void ,
-		 			TYPELIST_4(	  const shared_ptr&lt;InteractingGeometry&gt;&amp;
-							, shared_ptr&lt;BoundingVolume&gt;&amp;
-							, const Se3r&amp;	// FIXME - remove Se3r, because not everything is supposed to have it. 
-									// If some function needs Se3r it must find it through Body*
-							, const Body*	// with that - functors have all the data they may need, but it's const
-			  			  )
-				&gt;
-{	
-	REGISTER_CLASS_NAME(BoundingVolumeEngineUnit);
-	REGISTER_BASE_CLASS_NAME(EngineUnit2D);
-
-};
-
-REGISTER_SERIALIZABLE(BoundingVolumeEngineUnit,false);
-
-#endif // BOUNDINGVOLUMEFACTORY_HPP
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeMetaEngine.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeMetaEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeMetaEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;BoundingVolumeMetaEngine.hpp&quot;
-
-
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-void BoundingVolumeMetaEngine::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		if(b-&gt;interactingGeometry &amp;&amp; b-&gt;boundingVolume)
-			operator()(b-&gt;interactingGeometry,b-&gt;boundingVolume,b-&gt;physicalParameters-&gt;se3,b.get());
-	}
-		
-	operator()(body-&gt;interactingGeometry,body-&gt;boundingVolume,body-&gt;physicalParameters-&gt;se3,body);
-}
-
-
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeMetaEngine.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeMetaEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeMetaEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,45 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#ifndef BOUNDINGVOLUMEUPDATOR_HPP
-#define BOUNDINGVOLUMEUPDATOR_HPP
-
-#include &quot;BoundingVolumeEngineUnit.hpp&quot;
-
-#include&lt;yade/core/MetaDispatchingEngine2D.hpp&gt;
-#include&lt;yade/lib-multimethods/DynLibDispatcher.hpp&gt;
-#include&lt;yade/core/InteractingGeometry.hpp&gt;
-#include&lt;yade/core/BoundingVolume.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-
-class BoundingVolumeMetaEngine :	public MetaDispatchingEngine2D
-					&lt;	
-						InteractingGeometry,						// base classe for dispatch
-						BoundingVolume,							// second base classe for dispatch
-
-						BoundingVolumeEngineUnit,					// class that provides multivirtual call
-
-						void,								// return type
-						TYPELIST_4(	  const shared_ptr&lt;InteractingGeometry&gt;&amp;	// arguments
-								, shared_ptr&lt;BoundingVolume&gt;&amp;
-								, const Se3r&amp;
-								, const Body* 					// with that - functors have all the data they may need
-							  )
-					&gt;
-{
-	public :
-		virtual void action(Body* b);
-
-	REGISTER_CLASS_NAME(BoundingVolumeMetaEngine);
-	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);
-};
-
-REGISTER_SERIALIZABLE(BoundingVolumeMetaEngine,false);
-
-#endif // BOUNDINGVOLUMEUPDATOR_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeMetaEngine.cpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeMetaEngine.hpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelEngineUnit.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelEngineUnit.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelEngineUnit.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelEngineUnit.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelEngineUnit.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,53 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GEOMETRICAL_MODEL_ENGINE_UNIT_HPP
-#define GEOMETRICAL_MODEL_ENGINE_UNIT_HPP
-
-
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/EngineUnit2D.hpp&gt;
-
-
-/*! \brief
-        Abstract interface for building GeometricalModel depending on PhysicalParameters
-        (currently used for updating geometry if physics has changed and affects it).
-
-        It is used when you want to update GeometricalModel of your Body during runtime. Only Physical
-        Parameters of the Body can affect &quot;perfect geometrical representation&quot;(GeometricalModel) of
-	the Body. So it is given as first argument.
-
-
-DEPRECATED explanation (will move do BodyFactory perhaps?):
-
-	It is used for creating a geometrical model from a given set of parameters.
-	This is very useful when you want to load a file that contains geometrical data or when
-	you want to build an object with that depends on several parameters.
-	
-*/
-class GeometricalModelEngineUnit : 	public EngineUnit2D
-					&lt;
-		 				void ,
-		 				TYPELIST_3(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-								, shared_ptr&lt;GeometricalModel&gt;&amp;
-								, const Body*
-			   				  )
-					&gt;
-{	
-	REGISTER_CLASS_NAME(GeometricalModelEngineUnit);
-	REGISTER_BASE_CLASS_NAME(EngineUnit2D);
-};
-
-REGISTER_SERIALIZABLE(GeometricalModelEngineUnit,false);
-
-#endif //  GEOMETRICAL_MODEL_ENGINE_UNIT_HPP
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelMetaEngine.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelMetaEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelMetaEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,29 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GeometricalModelMetaEngine.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-void GeometricalModelMetaEngine::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		if(b-&gt;geometricalModel)
-			operator()(b-&gt;physicalParameters,b-&gt;geometricalModel,b.get());
-	}
-	
-	if(body-&gt;geometricalModel)
-	 	operator()(body-&gt;physicalParameters,body-&gt;geometricalModel,body);
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelMetaEngine.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelMetaEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelMetaEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,41 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#ifndef GEOMETRICAL_MODEL_DISPATCHER_HPP
-#define GEOMETRICAL_MODEL_DISPATCHER_HPP
-
-#include &quot;GeometricalModelEngineUnit.hpp&quot;
-#include&lt;yade/core/MetaDispatchingEngine2D.hpp&gt;
-#include&lt;yade/lib-multimethods/DynLibDispatcher.hpp&gt;
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-
-class GeometricalModelMetaEngine :	public MetaDispatchingEngine2D
-					&lt;	
-						PhysicalParameters,
-						GeometricalModel,
-						GeometricalModelEngineUnit,
-						void ,
-						TYPELIST_3(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-								, shared_ptr&lt;GeometricalModel&gt;&amp;
-								, const Body*
-				  			  )
-					&gt;
-{
-	public :
-		virtual void action(Body* b);
-
-	REGISTER_CLASS_NAME(GeometricalModelMetaEngine);
-	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);
-};
-
-REGISTER_SERIALIZABLE(GeometricalModelMetaEngine,false);
-
-#endif // GEOMETRICAL_MODEL_DISPATCHER_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelMetaEngine.cpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelMetaEngine.hpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryEngineUnit.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryEngineUnit.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryEngineUnit.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryEngineUnit.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryEngineUnit.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,52 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTING_GEOMETRY_ENGINE_UNIT_HPP
-#define INTERACTING_GEOMETRY_ENGINE_UNIT_HPP
-
-#include&lt;yade/core/InteractingGeometry.hpp&gt;
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/core/EngineUnit2D.hpp&gt;
-
-#include &lt;boost/shared_ptr.hpp&gt;
-#include &lt;string&gt;
-
-/*! \brief
-	Abstract interface for all classes that build InteractingGeometry from GeometricalModel
-
-	This is useful when it's not trivial to just write the parameters of InteractingGeometry by hand.
-	Then we can use this InteractingGeometryEngineUnit to build it from GeometricalModel.
-
-	Currently it is only used to build a PolyhedralSweptSphere from Box and from Tetrahedron
-	  
-	\param const shared_ptr&lt;GeometricalModel&gt;&amp;	exact geometry of Body
-	\param Se3r&amp;					the 3D transformation to apply to the collision model before building the bounding volume
-	\param Body*					the Body inside which operation takes place
-	\return shared_ptr&lt;InteractingGeometry&gt;&amp;	the InteractingGeometry built (given as second argument to the function)
-	
-*/
-class InteractingGeometryEngineUnit : 	public EngineUnit2D
-					&lt;
-		 				void ,
-		 				TYPELIST_4(	  const shared_ptr&lt;GeometricalModel&gt;&amp;
-								, shared_ptr&lt;InteractingGeometry&gt;&amp;
-								, const Se3r&amp; // FIXME - remove Se3r, If some function needs Se3r it must find it through Body*
-								, const Body* // with that - functors have all the data they may need
-			  				  )
-					&gt;
-{	
-	REGISTER_CLASS_NAME(InteractingGeometryEngineUnit);
-	REGISTER_BASE_CLASS_NAME(EngineUnit2D);
-};
-
-REGISTER_SERIALIZABLE(InteractingGeometryEngineUnit,false);
-
-#endif //  INTERACTING_GEOMETRY_ENGINE_UNIT_HPP
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryMetaEngine.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryMetaEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryMetaEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,31 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingGeometryMetaEngine.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-void InteractingGeometryMetaEngine::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		if(b-&gt;geometricalModel &amp;&amp; b-&gt;interactingGeometry)
-			operator()(b-&gt;geometricalModel,b-&gt;interactingGeometry,b-&gt;physicalParameters-&gt;se3,b.get());
-	}
-		
-	if(body-&gt;geometricalModel &amp;&amp; body-&gt;interactingGeometry)
-		operator()(body-&gt;geometricalModel,body-&gt;interactingGeometry,body-&gt;physicalParameters-&gt;se3,body);
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryMetaEngine.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryMetaEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryMetaEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,43 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#ifndef INTERACTINGGEOMETRYMETAENGINE_HPP
-#define INTERACTINGGEOMETRYMETAENGINE_HPP
-
-#include &quot;InteractingGeometryEngineUnit.hpp&quot;
-
-#include&lt;yade/core/MetaDispatchingEngine2D.hpp&gt;
-#include&lt;yade/lib-multimethods/DynLibDispatcher.hpp&gt;
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-#include&lt;yade/core/InteractingGeometry.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-
-class InteractingGeometryMetaEngine : 	public MetaDispatchingEngine2D
-					&lt;	
-						GeometricalModel,						// base classe for dispatch
-						InteractingGeometry,						// base classe for dispatch
-						InteractingGeometryEngineUnit,					// class that provides multivirtual call
-						void ,								// return type
-						TYPELIST_4(	  const shared_ptr&lt;GeometricalModel&gt;&amp;		// arguments
-								, shared_ptr&lt;InteractingGeometry&gt;&amp; 		// is not working when const, because functors are supposed to modify it!
-								, const Se3r&amp;
-								, const Body* 					// with that - functors have all the data they may need
-							  )
-					&gt;
-{
-	public :
-		virtual void action(Body* b);
-
-	REGISTER_CLASS_NAME(InteractingGeometryMetaEngine);
-	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);
-};
-
-REGISTER_SERIALIZABLE(InteractingGeometryMetaEngine,false);
-
-#endif //  INTERACTINGGEOMETRYMETAENGINE_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryMetaEngine.cpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryMetaEngine.hpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryEngineUnit.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryEngineUnit.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryEngineUnit.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryEngineUnit.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryEngineUnit.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,54 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTIONGEOMETRYFUNCTOR_HPP
-#define INTERACTIONGEOMETRYFUNCTOR_HPP
-
-#include&lt;yade/core/InteractingGeometry.hpp&gt;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/core/EngineUnit2D.hpp&gt;
-
-#include &lt;boost/shared_ptr.hpp&gt;
-#include &lt;string&gt;
-
-/*! \brief
-	Abstract interface for all classes that build Interaction from two interacting InteractingGeometry 'ies
-
-	This is a crucial EngineUnit used during runtime, when an interaction is detected and starts to exist between two
-	Body 'ies, a class Interaction to describe it must be created.
-	 
-	Currently we can build: SpheresContactGeometry, ErrorTolerantContact, ClosestFeatures
-
-	\param const shared_ptr&lt;InteractingGeometry&gt;&amp;	first interacting Body
-	\param const shared_ptr&lt;InteractingGeometry&gt;&amp;	second interacting Body
-	\param Se3r&amp;					first Body's 3d transformation (FIXME: should be removed)
-	\param Se3r&amp;					second Body's 3d transformation (FIXME: should be removed)
-	\return shared_ptr&lt;Interaction&gt;&amp;		it returns the Interaction to be built (given as last argument to the function)
-	
-*/
-
-class InteractionGeometryEngineUnit : 	public EngineUnit2D
-					&lt;
-		 				bool ,
-		 				TYPELIST_5(	  const shared_ptr&lt;InteractingGeometry&gt;&amp;
-								, const shared_ptr&lt;InteractingGeometry&gt;&amp;
-								, const Se3r&amp;
-								, const Se3r&amp;
-								, const shared_ptr&lt;Interaction&gt;&amp;
-			  				  ) 
-					&gt;
-{
-	REGISTER_CLASS_NAME(InteractionGeometryEngineUnit);
-	REGISTER_BASE_CLASS_NAME(EngineUnit2D);
-};
-
-REGISTER_SERIALIZABLE(InteractionGeometryEngineUnit,false);
-
-#endif // INTERACTIONGEOMETRYFUNCTOR_HPP
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryMetaEngine.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryMetaEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryMetaEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,59 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractionGeometryMetaEngine.hpp&quot;
-
-
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-void InteractionGeometryMetaEngine::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	shared_ptr&lt;InteractionContainer&gt;&amp; persistentInteractions = ncb-&gt;persistentInteractions;
-	InteractionContainer::iterator ii    = persistentInteractions-&gt;begin();
-	InteractionContainer::iterator iiEnd = persistentInteractions-&gt;end(); 
-	for( ; ii!=iiEnd ; ++ii)
-	{
-		const shared_ptr&lt;Interaction&gt; interaction = *ii;
-		
-		shared_ptr&lt;Body&gt;&amp; b1 = (*bodies)[interaction-&gt;getId1()];
-		shared_ptr&lt;Body&gt;&amp; b2 = (*bodies)[interaction-&gt;getId2()];
-		interaction-&gt;isReal = true;
-		operator()( b1-&gt;interactingGeometry , b2-&gt;interactingGeometry , b1-&gt;physicalParameters-&gt;se3 , b2-&gt;physicalParameters-&gt;se3 , interaction );
-	}
-	
-	shared_ptr&lt;InteractionContainer&gt;&amp; transientInteractions = ncb-&gt;transientInteractions;
-	ii    = transientInteractions-&gt;begin();
-	iiEnd = transientInteractions-&gt;end(); 
-	for(  ; ii!=iiEnd ; ++ii)
-	{
-		const shared_ptr&lt;Interaction&gt; interaction = *ii;
-		
-		shared_ptr&lt;Body&gt;&amp; b1 = (*bodies)[interaction-&gt;getId1()];
-		shared_ptr&lt;Body&gt;&amp; b2 = (*bodies)[interaction-&gt;getId2()];
-		
-		interaction-&gt;isReal =
-			b1-&gt;interactingGeometry &amp;&amp; b2-&gt;interactingGeometry &amp;&amp; // some bodies do not have interactingGeometry
-			// FIXME put this inside VolatileInteractionCriterion dynlib
-			( persistentInteractions-&gt;find(interaction-&gt;getId1(),interaction-&gt;getId2()) == 0 )
-		 	&amp;&amp;
-			operator()( b1-&gt;interactingGeometry , b2-&gt;interactingGeometry , b1-&gt;physicalParameters-&gt;se3 , b2-&gt;physicalParameters-&gt;se3 , interaction );
-
-		//tmp
-		if(!(b1-&gt;interactingGeometry&amp;&amp;b2-&gt;interactingGeometry)){
-			cerr&lt;&lt;__FILE__&lt;&lt;&quot;:&quot;&lt;&lt;__LINE__&lt;&lt;&quot;: no interacting geometry &quot;&lt;&lt; (b1-&gt;interactingGeometry?b1-&gt;getId():-1)&lt;&lt;&quot; &quot;&lt;&lt;(b2-&gt;interactingGeometry?b2-&gt;getId():-1)&lt;&lt;endl;
-		}
-			
-	}
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryMetaEngine.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryMetaEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryMetaEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,48 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTION_GEOMETRY_METAENGINE_HPP
-#define INTERACTION_GEOMETRY_METAENGINE_HPP
-
-#include &lt;vector&gt;
-#include &lt;list&gt;
-
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/lib-multimethods/DynLibDispatcher.hpp&gt;
-#include&lt;yade/core/MetaDispatchingEngine2D.hpp&gt;
-#include&lt;yade/core/InteractingGeometry.hpp&gt;
-#include &quot;InteractionGeometryEngineUnit.hpp&quot;
-
-class Body;
-
-class InteractionGeometryMetaEngine :	public MetaDispatchingEngine2D
-					&lt;	
-						InteractingGeometry,						// base classe for dispatch
-						InteractingGeometry,						// base classe for dispatch
-						InteractionGeometryEngineUnit,					// class that provides multivirtual call
-						bool ,								// return type
-						TYPELIST_5(	  const shared_ptr&lt;InteractingGeometry&gt;&amp;	// arguments
-								, const shared_ptr&lt;InteractingGeometry&gt;&amp;
-								, const Se3r&amp;
-								, const Se3r&amp;
-								, const shared_ptr&lt;Interaction&gt;&amp;
-							  )
-						, false								// disable auto symmetry handling
-					&gt;
-{
-	public :
-		virtual void action(Body* body);
-
-	REGISTER_CLASS_NAME(InteractionGeometryMetaEngine);
-	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);
-};
-
-REGISTER_SERIALIZABLE(InteractionGeometryMetaEngine,false);
-
-#endif //  INTERACTION_GEOMETRY_METAENGINE_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryMetaEngine.cpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryMetaEngine.hpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsEngineUnit.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsEngineUnit.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsEngineUnit.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsEngineUnit.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsEngineUnit.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,49 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTIONPHYSICS_ENGINEUNIT_HPP
-#define INTERACTIONPHYSICS_ENGINEUNIT_HPP
-
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/core/EngineUnit2D.hpp&gt;
-#include &lt;boost/shared_ptr.hpp&gt;
-#include &lt;string&gt;
-
-/*! \brief
-	Abstract interface for all classes that build InteractionPhysics from two interacting Body's PhysicalParameters
-
-	When an interaction is more complicated than its geometry, a class InteractionPhysics can be build to describe
-	the stiffness or other parmeters of this interaction.
-	 
-	Currently it is only used for MacroMicroElasticRelationships
-
-	\param const shared_ptr&lt;PhysicalParameters&gt;&amp;	first interacting Body
-	\param const shared_ptr&lt;PhysicalParameters&gt;&amp;	second interacting Body
-	\return shared_ptr&lt;Interaction&gt;&amp;		it returns the InteractionPhysic's part of Interaction (given as last argument to the function)
-	
-*/
-
-class InteractionPhysicsEngineUnit : 	public EngineUnit2D
-					&lt;
-		 				void ,
-		 				TYPELIST_3(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-								, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-								, const shared_ptr&lt;Interaction&gt;&amp;
-			   				  ) 
-					&gt;
-{
-	REGISTER_CLASS_NAME(InteractionPhysicsEngineUnit);
-	REGISTER_BASE_CLASS_NAME(EngineUnit2D);
-
-};
-
-REGISTER_SERIALIZABLE(InteractionPhysicsEngineUnit,false);
-
-#endif // INTERACTIONPHYSICS_ENGINEUNIT_HPP
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsMetaEngine.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsMetaEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsMetaEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,46 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractionPhysicsMetaEngine.hpp&quot;
-
-
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-void InteractionPhysicsMetaEngine::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	shared_ptr&lt;InteractionContainer&gt;&amp; persistentInteractions = ncb-&gt;persistentInteractions;
-	InteractionContainer::iterator ii    = persistentInteractions-&gt;begin();
-	InteractionContainer::iterator iiEnd = persistentInteractions-&gt;end(); 
-	for( ; ii!=iiEnd ; ++ii)
-	{
-		const shared_ptr&lt;Interaction&gt; interaction = *ii;
-
-		shared_ptr&lt;Body&gt;&amp; b1 = (*bodies)[interaction-&gt;getId1()];
-		shared_ptr&lt;Body&gt;&amp; b2 = (*bodies)[interaction-&gt;getId2()];
-		operator()( b1-&gt;physicalParameters , b2-&gt;physicalParameters , interaction );
-	}
-
-	shared_ptr&lt;InteractionContainer&gt;&amp; transientInteractions = ncb-&gt;transientInteractions;
-	ii    = transientInteractions-&gt;begin();
-	iiEnd = transientInteractions-&gt;end(); 
-	for( ; ii!=iiEnd ; ++ii)
-	{
-		const shared_ptr&lt;Interaction&gt; interaction = *ii;
-		
-		shared_ptr&lt;Body&gt;&amp; b1 = (*bodies)[interaction-&gt;getId1()];
-		shared_ptr&lt;Body&gt;&amp; b2 = (*bodies)[interaction-&gt;getId2()];
-
-		if (interaction-&gt;isReal)
-			operator()( b1-&gt;physicalParameters , b2-&gt;physicalParameters , interaction );
-	}
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsMetaEngine.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsMetaEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsMetaEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,42 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTIONPHYSICSMETAENGINE_HPP
-#define INTERACTIONPHYSICSMETAENGINE_HPP 
-
-
-#include&lt;yade/core/MetaDispatchingEngine2D.hpp&gt;
-#include&lt;yade/lib-multimethods/DynLibDispatcher.hpp&gt;
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include &quot;InteractionPhysicsEngineUnit.hpp&quot;
-
-class InteractionPhysicsMetaEngine : 	public MetaDispatchingEngine2D
-					&lt;	
-						PhysicalParameters,					// base classe for dispatch
-						PhysicalParameters,					// base classe for dispatch
-						InteractionPhysicsEngineUnit,				// class that provides multivirtual call
-						void,							// return type
-						TYPELIST_3(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;	// arguments
-								, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-								, const shared_ptr&lt;Interaction&gt;&amp;
-							  )
-					&gt;
-{		
-	public :
-		virtual void action(Body* body);
-
-	REGISTER_CLASS_NAME(InteractionPhysicsMetaEngine);
-	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);
-};
-
-REGISTER_SERIALIZABLE(InteractionPhysicsMetaEngine,false);
-
-#endif //  INTERACTIONPHYSICSMETAENGINE_HPP
-
-

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsMetaEngine.cpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsMetaEngine.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplier.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplier.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplier.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,28 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;PhysicalActionApplier.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-void PhysicalActionApplier::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-	PhysicalActionContainer::iterator pai    = ncb-&gt;physicalActions-&gt;begin();
-	PhysicalActionContainer::iterator paiEnd = ncb-&gt;physicalActions-&gt;end(); 
-	for( ; pai!=paiEnd ; ++pai)
-	{
-		shared_ptr&lt;PhysicalAction&gt; action = *pai;
-		int id = pai.getCurrentIndex();
-		// FIXME - solve the problem of Body's id
-		operator()( action , (*bodies)[id]-&gt;physicalParameters , (*bodies)[id].get() );
-	}
-}
-
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplier.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplier.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplier.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,45 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef PHYSICALACTIONAPPLIER_HPP
-#define PHYSICALACTIONAPPLIER_HPP
-
-
-#include&lt;yade/core/MetaDispatchingEngine2D.hpp&gt;
-#include&lt;yade/lib-multimethods/DynLibDispatcher.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-
-#include &quot;PhysicalActionApplierUnit.hpp&quot;
-
-class Body;
-
-class PhysicalActionApplier :	public MetaDispatchingEngine2D
-				&lt;
-					PhysicalAction ,					// base classe for dispatch
-					PhysicalParameters,					// base classe for dispatch
-					PhysicalActionApplierUnit,				// class that provides multivirtual call
-					void,							// return type
-					TYPELIST_3(	  const shared_ptr&lt;PhysicalAction&gt;&amp;	// function arguments
-							, const shared_ptr&lt;PhysicalParameters&gt;&amp; 
-							, const Body *
-				    		  )
-				&gt;
-{
-	public :
-		virtual void action(Body* body);
-
-	REGISTER_CLASS_NAME(PhysicalActionApplier);
-	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);
-};
-
-REGISTER_SERIALIZABLE(PhysicalActionApplier,false);
-
-#endif // PHYSICALACTIONAPPLIER_HPP
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplierUnit.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplierUnit.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplierUnit.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,33 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef PHYSICALACTIONAPPLIERUNIT_HPP
-#define PHYSICALACTIONAPPLIERUNIT_HPP
-
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/EngineUnit2D.hpp&gt;
-
-class PhysicalActionApplierUnit :	public EngineUnit2D
-					&lt;
-		 				void ,
-		 				TYPELIST_3(	  const shared_ptr&lt;PhysicalAction&gt;&amp;
-								, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-								, const Body*
-			   				)
-					&gt;
-{
-	REGISTER_CLASS_NAME(PhysicalActionApplierUnit);
-	REGISTER_BASE_CLASS_NAME(EngineUnit2D);
-};
-
-REGISTER_SERIALIZABLE(PhysicalActionApplierUnit,false);
-
-#endif // PHYSICALACTIONAPPLIERUNIT_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplier.cpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplier.hpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplierUnit.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplierUnit.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamper.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamper.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamper.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,38 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;PhysicalActionDamper.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-void PhysicalActionDamper::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	PhysicalActionContainer::iterator pai    = ncb-&gt;physicalActions-&gt;begin();
-	PhysicalActionContainer::iterator paiEnd = ncb-&gt;physicalActions-&gt;end();
-	for( ; pai!=paiEnd ; ++pai)
-	{
-		shared_ptr&lt;PhysicalAction&gt; action = *pai;
-		int id = pai.getCurrentIndex();
-		// FIXME - solve the problem of Body's id
-		operator()( action , (*bodies)[id]-&gt;physicalParameters , (*bodies)[id].get() );
-	}
-
-
-//	for( ncb-&gt;physicalActions-&gt;gotoFirst() ; ncb-&gt;physicalActions-&gt;notAtEnd() ; ncb-&gt;physicalActions-&gt;gotoNext())
-//	{
-//		shared_ptr&lt;PhysicalAction&gt;&amp; action = ncb-&gt;physicalActions-&gt;getCurrent(id);
-//		// FIXME - solve the problem of Body's id
-//		operator()( action , (*bodies)[id]-&gt;physicalParameters , (*bodies)[id].get() );
-//	}
-
-}
-
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamper.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamper.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamper.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,40 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef PHYSICALACTIONDAMPER_HPP
-#define PHYSICALACTIONDAMPER_HPP
-
-#include&lt;yade/core/MetaDispatchingEngine2D.hpp&gt;
-#include&lt;yade/lib-multimethods/DynLibDispatcher.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-#include &quot;PhysicalActionDamperUnit.hpp&quot;
-
-class Body;
-
-class PhysicalActionDamper : public MetaDispatchingEngine2D
-				&lt;	PhysicalAction,						// base classe for dispatch
-					PhysicalParameters,					// base classe for dispatch
-					PhysicalActionDamperUnit,				// class that provides multivirtual call
-					void,							// return type
-					TYPELIST_3(	  const shared_ptr&lt;PhysicalAction&gt;&amp;	// function arguments
-							, const shared_ptr&lt;PhysicalParameters&gt;&amp; 
-							, const Body *
-						  )
-				&gt;
-{
-	public :
-		virtual void action(Body* body);
-
-	REGISTER_CLASS_NAME(PhysicalActionDamper);
-	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine2D);
-};
-
-REGISTER_SERIALIZABLE(PhysicalActionDamper,false);
-
-#endif // __PHYSICALACTIONDAMPER_HPP__
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamperUnit.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamperUnit.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamperUnit.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,32 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef PHYSICALACTIONDAMPERUNIT_HPP
-#define PHYSICALACTIONDAMPERUNIT_HPP
-
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/EngineUnit2D.hpp&gt;
-
-class PhysicalActionDamperUnit : public EngineUnit2D
-				 &lt;
-		 			void ,
-		 			TYPELIST_3(	  const shared_ptr&lt;PhysicalAction&gt;&amp;
-							, const shared_ptr&lt;PhysicalParameters&gt;&amp;
-							, const Body*
-						   )
-				&gt;
-{
-	REGISTER_CLASS_NAME(PhysicalActionDamperUnit);
-	REGISTER_BASE_CLASS_NAME(EngineUnit2D);
-};
-
-REGISTER_SERIALIZABLE(PhysicalActionDamperUnit,false);
-
-#endif // __PHYSICALACTIONDAMPINGUNIT_HPP__

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamper.cpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamper.hpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamperUnit.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamperUnit.hpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersEngineUnit.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersEngineUnit.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersEngineUnit.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersEngineUnit.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersEngineUnit.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,41 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BODY_PHYSICAL_PARAMETERS_FUNCTOR_HPP
-#define BODY_PHYSICAL_PARAMETERS_FUNCTOR_HPP 
-
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/EngineUnit1D.hpp&gt;
-
-/*! \brief
-	Abstract interface for all classes that want to do something depending on PhysicalParameters (works like adding external virtual function)
-
-	Currently it is used for LeapFron integration and creating FEM
-
-	\param const shared_ptr&lt;PhysicalParameters&gt;&amp;	PhysicalParameters' index (Indexable) is used to dispatch this call
-	\param Body*					Body's pointer
-	
-*/
-
-class PhysicalParametersEngineUnit :    public EngineUnit1D
-					&lt;
-		 				void ,
-		 				TYPELIST_2(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-								, Body*
-			   				  )
-					&gt;
-{	
-	REGISTER_CLASS_NAME(PhysicalParametersEngineUnit);
-	REGISTER_BASE_CLASS_NAME(EngineUnit1D);
-};
-
-REGISTER_SERIALIZABLE(PhysicalParametersEngineUnit,false);
-
-#endif // __GEOMETRICALMODELFACTORY_H__
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersMetaEngine.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersMetaEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersMetaEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,30 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;PhysicalParametersMetaEngine.hpp&quot;
-
-
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-void PhysicalParametersMetaEngine::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		operator()(b-&gt;physicalParameters,b.get());
-	}
-	
- 	operator()(body-&gt;physicalParameters,body);
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersMetaEngine.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersMetaEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersMetaEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,39 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#ifndef BODY_PHYSICAL_PARAMETERS_DISPATCHER_HPP
-#define BODY_PHYSICAL_PARAMETERS_DISPATCHER_HPP 
-
-#include &quot;PhysicalParametersEngineUnit.hpp&quot;
-#include&lt;yade/core/MetaDispatchingEngine1D.hpp&gt;
-#include&lt;yade/lib-multimethods/DynLibDispatcher.hpp&gt;
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-
-class PhysicalParametersMetaEngine :	public MetaDispatchingEngine1D
-					&lt;	
-						PhysicalParameters ,
-						PhysicalParametersEngineUnit,
-						void ,
-						TYPELIST_2(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-								, Body*
-				  			  )
-					&gt;
-{
-	public :
-		virtual void action(Body* b);
-
-	REGISTER_CLASS_NAME(PhysicalParametersMetaEngine);
-	REGISTER_BASE_CLASS_NAME(MetaDispatchingEngine1D);
-
-};
-
-REGISTER_SERIALIZABLE(PhysicalParametersMetaEngine,false);
-
-#endif // BODY_PHYSICAL_PARAMETERS_DISPATCHER_HPP 
-

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersMetaEngine.cpp)

Copied: branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersMetaEngine.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,252 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;PersistentSAPCollider.hpp&quot;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/core/BodyContainer.hpp&gt;
-
-PersistentSAPCollider::PersistentSAPCollider() : BroadInteractor()
-{
-//	cerr &lt;&lt; &quot;PersistentSAPCollider\n&quot;;
-
-	//this-&gt;maxObject = 150000;
-	nbObjects=0;
-
-	//xBounds.resize(2*maxObject);
-	//yBounds.resize(2*maxObject);
-	//zBounds.resize(2*maxObject);
-
-	//minimums = new Real[3*maxObject];
-	//maximums = new Real[3*maxObject];
-	
-	xBounds.clear();
-	yBounds.clear();
-	zBounds.clear();
-
-	minimums.clear();
-	maximums.clear();
-}
-
-PersistentSAPCollider::~PersistentSAPCollider()
-{
-
-}
-
-void PersistentSAPCollider::action(Body* body)
-{
-
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt; bodies = ncb-&gt;bodies;
-	
-	if (2*bodies-&gt;size()!=xBounds.size())
-	{
-		xBounds.resize(2*bodies-&gt;size());
-		yBounds.resize(2*bodies-&gt;size());
-		zBounds.resize(2*bodies-&gt;size());
-
-		minimums.resize(3*bodies-&gt;size());
-		maximums.resize(3*bodies-&gt;size());
-	}
-
-	// Updates the minimums and maximums arrays according to the new center and radius of the spheres
-	int offset;
-	Vector3r min,max;
-	shared_ptr&lt;Body&gt; b;
-
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for(unsigned int i=0 ; bi!=biEnd ; ++bi,i++ )
-	{
-		b = *bi;
-		
-		offset = 3*i;
-		//FIXME: this is broken: bodies without boundingVolume are just skipped, which means that some garbage values are used later!
-		if(b-&gt;boundingVolume) // can't assume that everybody has BoundingVolume
-		{
-			min = b-&gt;boundingVolume-&gt;min;
-			max = b-&gt;boundingVolume-&gt;max;
-			minimums[offset+0] = min[0];
-			minimums[offset+1] = min[1];
-			minimums[offset+2] = min[2];
-			maximums[offset+0] = max[0];
-			maximums[offset+1] = max[1];
-			maximums[offset+2] = max[2];
-		}
-	}
-	
-	transientInteractions = ncb-&gt;transientInteractions;
-	InteractionContainer::iterator ii    = transientInteractions-&gt;begin();
-	InteractionContainer::iterator iiEnd = transientInteractions-&gt;end();
-	for( ; ii!=iiEnd ; ++ii)
-	{
-		shared_ptr&lt;Interaction&gt; interaction = *ii;
-		// FIXME : remove this isNew flag and test if interactionPhysic ?
-		if (interaction-&gt;isReal) // if a interaction was only potential then no geometry was created for it and so this time it is still a new one
-			interaction-&gt;isNew = false;
-		interaction-&gt;isReal = false;
-	}
-	
-	updateIds(bodies-&gt;size());
-	nbObjects = bodies-&gt;size();
-
-	// permutation sort of the AABBBounds along the 3 axis performed in a independant manner
-	sortBounds(xBounds, nbObjects);
-	sortBounds(yBounds, nbObjects);
-	sortBounds(zBounds, nbObjects);
-
-}
-
-
-void PersistentSAPCollider::updateIds(unsigned int nbElements)
-{
-
-	// the first time broadInteractionTest is called nbObject=0
-	if (nbElements!=nbObjects)
-	{
-		int begin,end;
-
-		end = nbElements;
-		begin = 0;
-
-		if (nbElements&gt;nbObjects)
-			begin = nbObjects;
-
-		// initialization if the xBounds, yBounds, zBounds
-		for(int i=begin;i&lt;end;i++)
-		{
-			xBounds[2*i]	= shared_ptr&lt;AABBBound&gt;(new AABBBound(i,1));
-			xBounds[2*i+1]	= shared_ptr&lt;AABBBound&gt;(new AABBBound(i,0));
-			
-			yBounds[2*i]	= shared_ptr&lt;AABBBound&gt;(new AABBBound(i,1));
-			yBounds[2*i+1]	= shared_ptr&lt;AABBBound&gt;(new AABBBound(i,0));
-			
-			zBounds[2*i]	= shared_ptr&lt;AABBBound&gt;(new AABBBound(i,1));
-			zBounds[2*i+1]	= shared_ptr&lt;AABBBound&gt;(new AABBBound(i,0));
-		}
-
-		// initialization if the field &quot;value&quot; of the xBounds, yBounds, zBounds arrays
-		updateBounds(nbElements);
-
-		// modified quick sort of the xBounds, yBounds, zBounds arrays
-		// The first time these arrays are not sorted so it is faster to use such a sort instead
-		// of the permutation we are going to use next
-		std::sort(xBounds.begin(),xBounds.begin()+2*nbElements,AABBBoundComparator());
-		std::sort(yBounds.begin(),yBounds.begin()+2*nbElements,AABBBoundComparator());
-		std::sort(zBounds.begin(),zBounds.begin()+2*nbElements,AABBBoundComparator());
-
-		// initialize the overlappingBB collection
-		//for(unsigned int j=0;j&lt;nbElements;j++)
-		//	overlappingBB[j].clear(); //attention memoire
-
-		findOverlappingBB(xBounds, nbElements);
-		findOverlappingBB(yBounds, nbElements);
-		findOverlappingBB(zBounds, nbElements);
-
-	}
-	else
-		updateBounds(nbElements);
-}
-
-
-void PersistentSAPCollider::sortBounds(vector&lt;shared_ptr&lt;AABBBound&gt; &gt;&amp; bounds, int nbElements)
-{
-	int i,j;
-	shared_ptr&lt;AABBBound&gt; tmp;
-
-	for (i=1; i&lt;2*nbElements; i++)
-	{
-		tmp = bounds[i];
-		j = i;
-		while (j&gt;0 &amp;&amp; tmp-&gt;value&lt;bounds[j-1]-&gt;value)
-		{
-			bounds[j] = bounds[j-1];
-			updateOverlapingBBSet(tmp-&gt;id,bounds[j-1]-&gt;id);
-			j--;
-		}
-		bounds[j] = tmp;
-	}
-}
-
-
-void PersistentSAPCollider::updateOverlapingBBSet(int id1,int id2)
-{
-
-// 	// look if the pair (id1,id2) already exists in the overleppingBB collection
-	bool found = (transientInteractions-&gt;find(id1,id2)!=0);
-	
-	// test if the AABBs of the spheres number &quot;id1&quot; and &quot;id2&quot; are overlapping
-	int offset1 = 3*id1;
-	int offset2 = 3*id2;
-	// FIXME: this is perhaps an expensive operation?!
-	const shared_ptr&lt;Body&gt;&amp; b1(Body::byId(id1)), b2(Body::byId(id2));
-	bool overlap =
-
-		(b1-&gt;isStandalone() || b2-&gt;isStandalone() || b1-&gt;clumpId!=b2-&gt;clumpId ) &amp;&amp; // only collide if at least one particle is standalone or they belong to different clumps
-		!b1-&gt;isClump() &amp;&amp; !b2-&gt;isClump() &amp;&amp; // do not collide clumps, since they are just containers, never interact
-
-		!(maximums[offset1]&lt;minimums[offset2] || maximums[offset2]&lt;minimums[offset1] || 
-		maximums[offset1+1]&lt;minimums[offset2+1] || maximums[offset2+1]&lt;minimums[offset1+1] || 
-		maximums[offset1+2]&lt;minimums[offset2+2] || maximums[offset2+2]&lt;minimums[offset1+2]);
-
-	// inserts the pair p=(id1,id2) if the two AABB overlaps and if p does not exists in the overlappingBB
-	if (overlap &amp;&amp; !found)
-		transientInteractions-&gt;insert(id1,id2);
-	// removes the pair p=(id1,id2) if the two AABB do not overlapp any more and if p already exists in the overlappingBB
-	else if (!overlap &amp;&amp; found)
-		transientInteractions-&gt;erase(id1,id2);
-
-}
-
-
-void PersistentSAPCollider::updateBounds(int nbElements)
-{
-
-	for(int i=0; i &lt; 2*nbElements; i++)
-	{
-		if (xBounds[i]-&gt;lower)
-			xBounds[i]-&gt;value = minimums[3*xBounds[i]-&gt;id+0];
-		else
-			xBounds[i]-&gt;value = maximums[3*xBounds[i]-&gt;id+0];
-
-		if (yBounds[i]-&gt;lower)
-			yBounds[i]-&gt;value = minimums[3*yBounds[i]-&gt;id+1];
-		else
-			yBounds[i]-&gt;value = maximums[3*yBounds[i]-&gt;id+1];
-
-		if (zBounds[i]-&gt;lower)
-			zBounds[i]-&gt;value = minimums[3*zBounds[i]-&gt;id+2];
-		else
-			zBounds[i]-&gt;value = maximums[3*zBounds[i]-&gt;id+2];
-	}
-}
-
-
-
-
-void PersistentSAPCollider::findOverlappingBB(std::vector&lt;shared_ptr&lt;AABBBound&gt; &gt;&amp; bounds, int nbElements)
-{
-
-	int i,j;
-
-	i = j = 0;
-	while (i&lt;2*nbElements)
-	{
-		while (i&lt;2*nbElements &amp;&amp; !bounds[i]-&gt;lower)
-			i++;
-		j=i+1;
-		while (j&lt;2*nbElements &amp;&amp; bounds[j]-&gt;id!=bounds[i]-&gt;id)
-		{
-			if (bounds[j]-&gt;lower)
-				updateOverlapingBBSet(bounds[i]-&gt;id,bounds[j]-&gt;id);
-			j++;
-		}
-		i++;
-	}
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,104 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef __PERSISTENTSAPCOLLIDER_HPP__
-#define __PERSISTENTSAPCOLLIDER_HPP__
-
-#include&lt;yade/core/BroadInteractor.hpp&gt;
-#include&lt;yade/core/InteractionContainer.hpp&gt;
-#include &lt;list&gt;
-#include &lt;set&gt;
-#include &lt;vector&gt;
-#include &lt;algorithm&gt;
-
-using namespace std;
-
-class PersistentSAPCollider : public BroadInteractor
-{
-	private :
-		// represent an extrmity of an Axis ALigned bounding box
-		struct AABBBound
-		{
-			AABBBound(int i, char l) : id(i),lower(l) {};
-			int		id;		// AABB of the &quot;id&quot; shpere
-			char		lower;		// is it the lower or upper bound of the AABB
-			Real		value;		// value of the bound
-		};
-		// strucuture that compare 2 AABBBounds =&gt; used in the sort algorithm
-		struct AABBBoundComparator
-		{
-			bool operator() (shared_ptr&lt;AABBBound&gt; b1, shared_ptr&lt;AABBBound&gt; b2)
-			{
-				return b1-&gt;value&lt;b2-&gt;value;
-			}
-		};
-
-	protected :
-		/// number of potential transientInteractions = number of interacting AABB
-		int nbPotentialInteractions;
-
-		/// number of AABB
-		unsigned int nbObjects;
-
-		/// AABB extremity of the sphere number &quot;id&quot; projected onto the X axis
-		vector&lt;shared_ptr&lt;AABBBound&gt; &gt; xBounds;
-
-		/// AABB extremity of the sphere number &quot;id&quot; projected onto the Y axis
-		vector&lt;shared_ptr&lt;AABBBound&gt; &gt; yBounds;
-
-		/// AABB extremity of the sphere number &quot;id&quot; projected onto the Z axis
-		vector&lt;shared_ptr&lt;AABBBound&gt; &gt; zBounds;
-
-		// collection of AABB that are in interaction
-		//protected : vector&lt; set&lt;unsigned int&gt; &gt; overlappingBB;
-		shared_ptr&lt;InteractionContainer&gt; transientInteractions;
-		/// upper right corner of the AABB of the objects =&gt;  for spheres = center[i]-radius
-		vector&lt;Real&gt; maximums;
-
-		/// lower left corner of the AABB of the objects =&gt;  for spheres = center[i]+radius
-		vector&lt;Real&gt; minimums;
-
-		/// Used the first time broadInteractionTest is called, to initialize and sort the xBounds, yBounds,
-		/// and zBounds arrays and to initialize the overlappingBB collection
-		void updateIds(unsigned int nbElements);
-
-		/// Permutation sort the xBounds, yBounds, zBounds arrays according to the &quot;value&quot; field
-		/// Calls updateOverlapingBBSet every time a permutation between 2 AABB i and j occurs
-		void sortBounds(vector&lt;shared_ptr&lt;AABBBound&gt; &gt;&amp; bounds, int nbElements);
-
-		/// Tests if the AABBi and AABBj really overlap.
-		/// If yes, adds the pair (id1,id2) to the collection of overlapping AABBs
-		/// If no, removes the (id1,id2) to the collection of overlapping AABBs if necessary
-		void updateOverlapingBBSet(int id1,int id2);
-
-		/// update the &quot;value&quot; field of the xBounds, yBounds, zBounds arrays
-		void updateBounds(int nbElements);
-
-		/// Used the first time broadInteractionTest is called
-		/// It is necessary to initialise the overlapping AABB collection because this collection is only
-		/// incrementally udated each time step
-		void findOverlappingBB(vector&lt;shared_ptr&lt;AABBBound&gt; &gt;&amp; bounds, int nbElements);
-
-	public :
-		PersistentSAPCollider();
-
-		virtual ~PersistentSAPCollider();
-
-		/// return a list &quot;transientInteractions&quot; of pairs of Body which Bounding volume are in potential interaction
-		void action(Body * body);
-
-
-	REGISTER_CLASS_NAME(PersistentSAPCollider);
-	REGISTER_BASE_CLASS_NAME(BroadInteractor);
-
-};
-
-REGISTER_SERIALIZABLE(PersistentSAPCollider,false);
-
-#endif // __PERSISTENTSAPCOLLIDER_HPP__
-

Copied: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.cpp)

Copied: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer/PhysicalActionContainerInitializer.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer/PhysicalActionContainerInitializer.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer/PhysicalActionContainerInitializer.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,46 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;PhysicalActionContainerInitializer.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/lib-factory/ClassFactory.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-
-
-PhysicalActionContainerInitializer::PhysicalActionContainerInitializer() 
-{
-	physicalActionNames.clear();
-}
-
-PhysicalActionContainerInitializer::~PhysicalActionContainerInitializer() 
-{
-}
-
-void PhysicalActionContainerInitializer::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(physicalActionNames);
-}
-
-void PhysicalActionContainerInitializer::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	
-	vector&lt;shared_ptr&lt;PhysicalAction&gt; &gt; physicalActions;
-	physicalActions.clear();
-	
-	for(unsigned int i = 0 ; i &lt; physicalActionNames.size() ; ++i )
-		physicalActions.push_back(
-			YADE_PTR_CAST&lt;PhysicalAction&gt;
-				(ClassFactory::instance().createShared(physicalActionNames[i]))
-		);
-	
-	ncb-&gt;physicalActions-&gt;prepare(physicalActions);
-	
-}
-
-

Deleted: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer/PhysicalActionContainerInitializer.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer/PhysicalActionContainerInitializer.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer/PhysicalActionContainerInitializer.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,38 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ACTION_PARAMETER_INITIALIZER_HPP
-#define ACTION_PARAMETER_INITIALIZER_HPP 
-
-#include&lt;yade/core/StandAloneEngine.hpp&gt;
-
-#include &lt;vector&gt;
-#include &lt;string&gt;
-
-class Body;
-
-class PhysicalActionContainerInitializer : public StandAloneEngine
-{
-	public :
-		std::vector&lt;std::string&gt; physicalActionNames;
-	
-		PhysicalActionContainerInitializer();
-		virtual ~PhysicalActionContainerInitializer();
-		virtual void action(Body* body);
-	
-	protected : 
-		virtual void registerAttributes();
-
-	REGISTER_CLASS_NAME(PhysicalActionContainerInitializer);
-	REGISTER_BASE_CLASS_NAME(StandAloneEngine);
-};
-
-REGISTER_SERIALIZABLE(PhysicalActionContainerInitializer,false);
-
-#endif // ACTION_PARAMETER_INITIALIZER_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer/PhysicalActionContainerInitializer.cpp)

Copied: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerInitializer/PhysicalActionContainerInitializer.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter/PhysicalActionContainerReseter.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter/PhysicalActionContainerReseter.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter/PhysicalActionContainerReseter.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,26 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;PhysicalActionContainerReseter.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-PhysicalActionContainerReseter::PhysicalActionContainerReseter() 
-{
-}
-
-PhysicalActionContainerReseter::~PhysicalActionContainerReseter() 
-{
-}
-
-void PhysicalActionContainerReseter::action(Body* body)
-{
-	(YADE_CAST&lt;MetaBody*&gt;(body))-&gt;physicalActions-&gt;reset();
-}
-
-

Deleted: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter/PhysicalActionContainerReseter.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter/PhysicalActionContainerReseter.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter/PhysicalActionContainerReseter.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,30 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ACTION_PARAMETER_RESET_HPP
-#define ACTION_PARAMETER_RESET_HPP 
-
-#include&lt;yade/core/StandAloneEngine.hpp&gt;
-
-class Body;
-
-class PhysicalActionContainerReseter : public StandAloneEngine
-{
-	public :
-		PhysicalActionContainerReseter();
-		virtual ~PhysicalActionContainerReseter();
-		virtual void action(Body* body);
-
-	REGISTER_CLASS_NAME(PhysicalActionContainerReseter);
-	REGISTER_BASE_CLASS_NAME(StandAloneEngine);
-};
-
-REGISTER_SERIALIZABLE(PhysicalActionContainerReseter,false);
-
-#endif // ACTION_PARAMETER_RESET_HPP 
-

Copied: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter/PhysicalActionContainerReseter.cpp)

Copied: branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/StandAloneEngine/PhysicalActionContainerReseter/PhysicalActionContainerReseter.hpp)

Deleted: branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider/SAPCollider.cpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider/SAPCollider.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider/SAPCollider.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,292 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;SAPCollider.hpp&quot;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/core/BodyContainer.hpp&gt;
-
-SAPCollider::SAPCollider () : BroadInteractor()
-{
-	this-&gt;maxObject = 150000;
-	nbObjects=0;
-
-	xBounds.resize(2*maxObject);
-	yBounds.resize(2*maxObject);
-	zBounds.resize(2*maxObject);
-
-	minimums = new Real[3*maxObject];
-	maximums = new Real[3*maxObject];
-
-	nbPotentialInteractions = 0;
-
-	overlappingBB.clear();
-	overlappingBB.resize(maxObject);
-
-	for(unsigned int i=0;i&lt;2*maxObject;i++)
-	{
-		xBounds[i] = new AABBBound();
-		yBounds[i] = new AABBBound();
-		zBounds[i] = new AABBBound();
-	}
-}
-
-
-SAPCollider::~SAPCollider ()
-{
-	for(unsigned int i=0;i&lt;2*maxObject;i++)
-	{
-		delete xBounds[i];
-		delete yBounds[i];
-		delete zBounds[i];
-	}
-
-	delete[] minimums;
-	delete[] maximums;
-}
-
-
-void SAPCollider::action(Body* body)
-{
-
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt; bodies = ncb-&gt;bodies;
-
-	unsigned int i;
-
-	// Updates the minimums and maximums arrays according to the new center and radius of the spheres
-	int offset;
-	Vector3r min,max;
-
-	//for(i=0; i &lt; bodies-&gt;size(); i++)
-	shared_ptr&lt;Body&gt; b;
-	i=0;
-
-	// FIXME: this will crash if body has no bounding volume
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for(; bi!=biEnd ; ++bi,i++ )
-	{
-		b = *bi;
-		
-		offset = 3*i;
-		min = b-&gt;boundingVolume-&gt;min;
-		max = b-&gt;boundingVolume-&gt;max;
-		minimums[offset+0] = min[0];
-		minimums[offset+1] = min[1];
-		minimums[offset+2] = min[2];
-		maximums[offset+0] = max[0];
-		maximums[offset+1] = max[1];
-		maximums[offset+2] = max[2];
-	}
-
-	updateIds(bodies-&gt;size());
-	nbObjects = bodies-&gt;size();
-
-	// permutation sort of the AABBBounds along the 3 axis performed in a independant manner
-	sortBounds(xBounds, nbObjects);
-	sortBounds(yBounds, nbObjects);
-	sortBounds(zBounds, nbObjects);
-
-	// just copy the structure containing overlapping AABB into a more easy to use linked list of pair of overlapping AABB
-	std::set&lt;unsigned int&gt;::iterator it;
-	std::set&lt;unsigned int&gt;::iterator itEnd;
-
-	/*std::list&lt;Interaction*&gt;::iterator ci = transientInteractions.begin();
-	std::list&lt;Interaction*&gt;::iterator ciEnd = transientInteractions.end();
-	for(;ci!=ciEnd;++ci)
-	{
-		delete (*ci)-&gt;interactionGeometry;
-		delete (*ci);
-	}*/
-
-// FIXME : correct that
-	ncb-&gt;transientInteractions-&gt;clear();
-
-	nbPotentialInteractions = 0;
-	for(i=0;i&lt;nbObjects;i++)
-	{
-		it = overlappingBB[i].begin();
-		itEnd = overlappingBB[i].end();
-		for(;it!=itEnd;++it)
-		{
-			// FIXME - this assumes that bodies are numbered from zero with one number increments, BAD!!!
-//			if (!(bodies-&gt;find(i)-&gt;isDynamic==false &amp;&amp; bodies-&gt;find(*it)-&gt;isDynamic==false))
-//			FIXME: this is broken for clumps!!!
-//			!!!!!!!!!!!!!!!!!!!!!!!!!! BROKEN !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-				if( (*bodies)[i]-&gt;isDynamic &amp;&amp; (*bodies)[*it]-&gt;isDynamic &amp;&amp; // old stuff: both bodies must be dynamic
-					( (*bodies)[i]-&gt;clumpId==Body::ID_NONE || (*bodies)[*it]-&gt;clumpId==Body::ID_NONE || ( (*bodies)[i]-&gt;clumpId != (*bodies)[*it]-&gt;clumpId )) // either (at least) one of them is not within a clump or they are not part of the same clump
-					)
-			// pre-clump code: if (!((*bodies)[i]-&gt;isDynamic==false &amp;&amp; (*bodies)[*it]-&gt;isDynamic==false))
-			{
-				nbPotentialInteractions++;
-				shared_ptr&lt;Interaction&gt; inter(new Interaction(i,*it));
-				ncb-&gt;transientInteractions-&gt;insert(inter);
-			}
-		}
-	}
-}
-
-
-void SAPCollider::updateIds(unsigned int nbElements)
-{
-
-	// the first time broadInteractionTest is called nbObject=0
-	if (nbElements!=nbObjects)
-	{
-		int begin,end;
-
-		end = nbElements;
-		begin = 0;
-
-		if (nbElements&gt;nbObjects)
-			begin = nbObjects;
-
-		// initialization if the xBounds, yBounds, zBounds
-		for(int i=begin;i&lt;end;i++)
-		{
-			xBounds[2*i]-&gt;id	= i;
-			xBounds[2*i]-&gt;lower	= 1;
-
-			xBounds[2*i+1]-&gt;id	= i;
-			xBounds[2*i+1]-&gt;lower	= 0;
-
-			yBounds[2*i]-&gt;id	= i;
-			yBounds[2*i]-&gt;lower	= 1;
-
-			yBounds[2*i+1]-&gt;id	= i;
-			yBounds[2*i+1]-&gt;lower	= 0;
-
-			zBounds[2*i]-&gt;id	= i;
-			zBounds[2*i]-&gt;lower	= 1;
-
-			zBounds[2*i+1]-&gt;id	= i;
-			zBounds[2*i+1]-&gt;lower	= 0;
-		}
-
-		// initialization if the field &quot;value&quot; of the xBounds, yBounds, zBounds arrays
-		updateBounds(nbElements);
-
-		// modified quick sort of the xBounds, yBounds, zBounds arrays
-		// The first time these arrays are not sorted so it is faster to use such a sort instead
-		// of the permutation we are going to use next
-		std::sort(xBounds.begin(),xBounds.begin()+2*nbElements,AABBBoundComparator());
-		std::sort(yBounds.begin(),yBounds.begin()+2*nbElements,AABBBoundComparator());
-		std::sort(zBounds.begin(),zBounds.begin()+2*nbElements,AABBBoundComparator());
-
-		// initialize the overlappingBB collection
-		for(unsigned int j=0;j&lt;nbElements;j++)
-			overlappingBB[j].clear(); //attention memoire
-
-		findOverlappingBB(xBounds, nbElements);
-		findOverlappingBB(yBounds, nbElements);
-		findOverlappingBB(zBounds, nbElements);
-
-	}
-	else
-		updateBounds(nbElements);
-}
-
-
-void SAPCollider::sortBounds(std::vector&lt;AABBBound*&gt;&amp; bounds, int nbElements)
-{
-	int i,j;
-	AABBBound * tmp;
-
-	for (i=1; i&lt;2*nbElements; i++)
-	{
-		tmp = bounds[i];
-		j = i;
-		while (j&gt;0 &amp;&amp; tmp-&gt;value&lt;bounds[j-1]-&gt;value)
-		{
-			bounds[j] = bounds[j-1];
-			updateOverlapingBBSet(tmp-&gt;id,bounds[j-1]-&gt;id);
-			j--;
-		}
-		bounds[j] = tmp;
-	}
-}
-
-
-void SAPCollider::updateOverlapingBBSet(int id1,int id2)
-{
-
-	if (id1&gt;id2) // beacause (i,j)==(j,i)
-	{
-		int tmp=id2;
-		id2 = id1;
-		id1=tmp;
-	}
-
-	// look if the paiur (id1,id2) already exists in the overleppingBB collection
-	std::set&lt; unsigned int&gt;::iterator it = overlappingBB[id1].find(id2);
-
-	// test if the AABBs of the spheres number &quot;id1&quot; and &quot;id2&quot; are overlapping
-	Real * min1 = minimums + 3*id1;
-	Real * max1 = maximums + 3*id1;
-	Real * min2 = minimums + 3*id2;
-	Real * max2 = maximums + 3*id2;
-
-	bool overlapp = !(max1[0]&lt;min2[0] || max2[0]&lt;min1[0] || max1[1]&lt;min2[1] || max2[1]&lt;min1[1] || max1[2]&lt;min2[2] || max2[2]&lt;min1[2]);
-
-	// inserts the pair p=(id1,id2) if the two AABB overlapps and if p does not exists in the overlappingBB
-	if (overlapp &amp;&amp; it == overlappingBB[id1].end())
-		overlappingBB[id1].insert(id2);
-	// removes the pair p=(id1,id2) if the two AABB do not overlapp any more and if p already exists in the overlappingBB
-	else if (!overlapp &amp;&amp; it != overlappingBB[id1].end())
-		overlappingBB[id1].erase(it);
-
-}
-
-
-void SAPCollider::updateBounds(int nbElements)
-{
-
-	for(int i=0; i &lt; 2*nbElements; i++)
-	{
-		if (xBounds[i]-&gt;lower)
-			xBounds[i]-&gt;value = minimums[3*xBounds[i]-&gt;id+0];
-		else
-			xBounds[i]-&gt;value = maximums[3*xBounds[i]-&gt;id+0];
-
-		if (yBounds[i]-&gt;lower)
-			yBounds[i]-&gt;value = minimums[3*yBounds[i]-&gt;id+1];
-		else
-			yBounds[i]-&gt;value = maximums[3*yBounds[i]-&gt;id+1];
-
-		if (zBounds[i]-&gt;lower)
-			zBounds[i]-&gt;value = minimums[3*zBounds[i]-&gt;id+2];
-		else
-			zBounds[i]-&gt;value = maximums[3*zBounds[i]-&gt;id+2];
-	}
-}
-
-
-
-
-void SAPCollider::findOverlappingBB(std::vector&lt;AABBBound*&gt;&amp; bounds, int nbElements)
-{
-
-	int i,j;
-
-	i = j = 0;
-	while (i&lt;2*nbElements)
-	{
-		while (i&lt;2*nbElements &amp;&amp; !bounds[i]-&gt;lower)
-			i++;
-		j=i+1;
-		while (j&lt;2*nbElements &amp;&amp; bounds[j]-&gt;id!=bounds[i]-&gt;id)
-		{
-			if (bounds[j]-&gt;lower)
-				updateOverlapingBBSet(bounds[i]-&gt;id,bounds[j]-&gt;id);
-			j++;
-		}
-		i++;
-	}
-}
-

Deleted: branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider/SAPCollider.hpp
===================================================================
--- branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider/SAPCollider.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider/SAPCollider.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,96 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SAPCOLLIDER_HPP
-#define SAPCOLLIDER_HPP
-
-#include &lt;list&gt;
-#include &lt;set&gt;
-#include &lt;vector&gt;
-#include &lt;algorithm&gt;
-#include&lt;yade/core/BroadInteractor.hpp&gt;
-
-class SAPCollider : public BroadInteractor
-{
-	private :
-		// represent an extrmity of an Axis ALigned bounding box
-		struct AABBBound
-		{
-			AABBBound() {};
-			char	lower;		// is it the lower or upper bound of the AABB
-			int	id;		// AABB of the &quot;id&quot; shpere
-			Real	value;		// value of the bound
-		};
-
-		// strucuture that compare 2 AABBBounds =&gt; used in the sort algorithm
-		struct AABBBoundComparator
-		{
-			bool operator() (AABBBound* b1, AABBBound* b2)
-			{
-				return b1-&gt;value&lt;b2-&gt;value;
-			}
-		};
-
-	protected :
-		// number of potential transientInteractions = number of colliding AABB
-		int nbPotentialInteractions;
-		// maximum number of object that that collider can handle
-		unsigned int maxObject;
-		// number of AABB
-		unsigned int nbObjects;
-		// AABB extremity of the sphere number &quot;id&quot; projected onto the X axis
-		std::vector&lt;AABBBound*&gt; xBounds;
-		// AABB extremity of the sphere number &quot;id&quot; projected onto the Y axis
-		std::vector&lt;AABBBound*&gt; yBounds;
-		// AABB extremity of the sphere number &quot;id&quot; projected onto the Z axis
-		std::vector&lt;AABBBound*&gt; zBounds;
-		// collection of AABB that are in interaction
-		std::vector&lt; std::set&lt;unsigned int&gt; &gt; overlappingBB;
-		// upper right corner of the AABB of the objects =&gt;  for spheres = center[i]-radius
-		Real * maximums;
-		// lower left corner of the AABB of the objects =&gt;  for spheres = center[i]+radius
-		Real * minimums;
-		
-		void findOverlappingBB(std::vector&lt;AABBBound*&gt;&amp; bounds, int nbElements);
-
-	public :
-		SAPCollider ();
-		~SAPCollider ();
-
-		// return a list &quot;transientInteractions&quot; of pairs of Body which Bounding volume are in potential interaction
-		void action(Body * body);
-
-
-		// Used the first time broadInteractionTest is called, to initialize and sort the xBounds, yBounds,
-		// and zBounds arrays and to initialize the overlappingBB collection
-		void updateIds(unsigned int nbElements);
-
-		// Permutation sort the xBounds, yBounds, zBounds arrays according to the &quot;value&quot; field
-		// Calls updateOverlapingBBSet every time a permutation between 2 AABB i and j occurs
-		void sortBounds(std::vector&lt;AABBBound*&gt;&amp; bounds, int nbElements);
-
-		// Tests if the AABBi and AABBj really overlap.
-		// If yes, adds the pair (id1,id2) to the collection of overlapping AABBs
-		// If no, removes the (id1,id2) to the collection of overlapping AABBs if necessary
-		void updateOverlapingBBSet(int id1,int id2);
-
-		// update the &quot;value&quot; field of the xBounds, yBounds, zBounds arrays
-		void updateBounds(int nbElements);
-
-		// Used the first time broadInteractionTest is called
-		// It is necessary to initialise the overlapping AABB collection because this collection is only
-		// incrementally udated each time step
-
-	REGISTER_CLASS_NAME(SAPCollider);
-	REGISTER_BASE_CLASS_NAME(BroadInteractor);
-};
-
-REGISTER_SERIALIZABLE(SAPCollider,false);
-
-#endif // SAPCOLLIDER_HPP
-

Copied: branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider.cpp (from rev 1105, branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider/SAPCollider.cpp)

Copied: branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider.hpp (from rev 1105, branches/scons-layout/pkg/common/Engine/StandAloneEngine/SAPCollider/SAPCollider.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB/GLDrawAABB.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB/GLDrawAABB.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB/GLDrawAABB.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,25 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawAABB.hpp&quot;
-#include &quot;AABB.hpp&quot;
-
-
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-void GLDrawAABB::go(const shared_ptr&lt;BoundingVolume&gt;&amp; bv)
-{
-	AABB * aabb = static_cast&lt;AABB*&gt;(bv.get());
-	glColor3v(bv-&gt;diffuseColor);
-	glTranslate(aabb-&gt;center[0],aabb-&gt;center[1],aabb-&gt;center[2]);
-	glScale(2*aabb-&gt;halfSize[0],2*aabb-&gt;halfSize[1],2*aabb-&gt;halfSize[2]);
-	glDisable(GL_LIGHTING);
-	glutWireCube(1);
-}
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB/GLDrawAABB.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB/GLDrawAABB.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB/GLDrawAABB.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWAABB_HPP
-#define GLDRAWAABB_HPP
-
-#include &quot;GLDrawBoundingVolumeFunctor.hpp&quot;
-
-class GLDrawAABB : public GLDrawBoundingVolumeFunctor
-{
-	public :
-		virtual void go(const shared_ptr&lt;BoundingVolume&gt;&amp;);
-
-	RENDERS(AABB);
-	REGISTER_CLASS_NAME(GLDrawAABB);
-	REGISTER_BASE_CLASS_NAME(GLDrawBoundingVolumeFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawAABB,false);
-
-#endif //  GLDRAWAABB_HPP
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB/GLDrawAABB.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawAABB/GLDrawAABB.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere/GLDrawBoundingSphere.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere/GLDrawBoundingSphere.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere/GLDrawBoundingSphere.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,20 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawBoundingSphere.hpp&quot;
-#include &quot;BoundingSphere.hpp&quot;
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-void GLDrawBoundingSphere::go(const shared_ptr&lt;BoundingVolume&gt;&amp; bv)
-{
-	BoundingSphere * s = static_cast&lt;BoundingSphere*&gt;(bv.get());
-	glColor3v(bv-&gt;diffuseColor);
-	glTranslate(s-&gt;center[0],s-&gt;center[1],s-&gt;center[2]);
-	glutWireSphere(s-&gt;radius,10,10);
-}
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere/GLDrawBoundingSphere.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere/GLDrawBoundingSphere.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere/GLDrawBoundingSphere.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWBOUNDINGSPHERE_HPP
-#define GLDRAWBOUNDINGSPHERE_HPP
-
-#include &quot;GLDrawBoundingVolumeFunctor.hpp&quot;
-
-class GLDrawBoundingSphere : public GLDrawBoundingVolumeFunctor
-{	
-	public :
-		virtual void go(const shared_ptr&lt;BoundingVolume&gt;&amp;);
-
-	RENDERS(BoundingSphere);
-	REGISTER_CLASS_NAME(GLDrawBoundingSphere);	
-	REGISTER_BASE_CLASS_NAME(GLDrawBoundingVolumeFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawBoundingSphere,false);
-
-#endif //  GLDRAWBOUNDINGSPHERE_HPP
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere/GLDrawBoundingSphere.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere/GLDrawBoundingSphere.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox/GLDrawBox.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox/GLDrawBox.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox/GLDrawBox.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,38 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawBox.hpp&quot;
-#include &quot;Box.hpp&quot;
-
-
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-void GLDrawBox::go(const shared_ptr&lt;GeometricalModel&gt;&amp; gm, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool wire)
-{
-	// FIXME : check that : one of those 2 lines are useless
-  	glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, Vector3f(gm-&gt;diffuseColor[0],gm-&gt;diffuseColor[1],gm-&gt;diffuseColor[2]));
-	glColor3v(gm-&gt;diffuseColor);
-	
-	Vector3r &amp;extents = (static_cast&lt;Box*&gt;(gm.get()))-&gt;extents;
-	
-	glScalef(2*extents[0],2*extents[1],2*extents[2]);
-
-	if (gm-&gt;wire || wire)
-	{
-		glDisable(GL_LIGHTING);
-		glutWireCube(1);
-	}
-	else
-	{
-		glEnable(GL_LIGHTING);
-		glutSolidCube(1);
-	}
-}
-
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox/GLDrawBox.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox/GLDrawBox.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox/GLDrawBox.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWBOX_HPP
-#define GLDRAWBOX_HPP
-
-#include &quot;GLDrawGeometricalModelFunctor.hpp&quot;
-
-class GLDrawBox : public GLDrawGeometricalModelFunctor
-{
-	public :
-		virtual void go(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
-
-	RENDERS(Box);
-	REGISTER_CLASS_NAME(GLDrawBox);
-	REGISTER_BASE_CLASS_NAME(GLDrawGeometricalModelFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawBox,false);
-
-#endif //  GLDRAWBOX_HPP
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox/GLDrawBox.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawBox/GLDrawBox.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D/GLDrawMesh2D.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D/GLDrawMesh2D.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D/GLDrawMesh2D.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,84 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawMesh2D.hpp&quot;
-#include &quot;Mesh2D.hpp&quot;
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-void GLDrawMesh2D::go(const shared_ptr&lt;GeometricalModel&gt;&amp; gm, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool wire)
-{
-	glColor3v(gm-&gt;diffuseColor);
-
-	if (gm-&gt;wire || wire)
-	{
-		vector&lt;Edge&gt;&amp; edges 	   = (static_cast&lt;Mesh2D*&gt;(gm.get()))-&gt;edges;
-		vector&lt;Vector3r&gt;&amp; vertices = (static_cast&lt;Mesh2D*&gt;(gm.get()))-&gt;vertices;
-		glDisable(GL_LIGHTING);
-		glBegin(GL_LINES);
-			for(unsigned int i=0;i&lt;edges.size();i++)
-			{
-				glVertex3v(vertices[edges[i].first]);
-				glVertex3v(vertices[edges[i].second]);	
-			}	
-		glEnd();
-	}
-	else
-	{
-		Mesh2D * mesh2d = static_cast&lt;Mesh2D*&gt;(gm.get());
-		vector&lt;Vector3r&gt;&amp; vertices 		= mesh2d-&gt;vertices;
-		vector&lt;vector&lt;int&gt; &gt;&amp; faces 		= mesh2d-&gt;faces;
-		vector&lt;Vector3r&gt;&amp; fNormals  		= mesh2d-&gt;fNormals;
-		vector&lt;Vector3r&gt;&amp; vNormals  		= mesh2d-&gt;vNormals;
- 		vector&lt;vector&lt;int&gt; &gt;&amp; triPerVertices	= mesh2d-&gt;triPerVertices;
-		
-		glShadeModel(GL_SMOOTH);
-		GLfloat matSpecular[] = { 1.0,1.0,1.0,1.0};
-		GLfloat matShininess[] = { 50.0};
-		glMaterialfv(GL_FRONT,GL_SPECULAR,matSpecular);
-		glMaterialfv(GL_FRONT,GL_SHININESS,matShininess);
-		
-		glEnable(GL_LIGHTING);
-		glDisable(GL_CULL_FACE);
-		
-		// Computing Normals
-		// FIXME : should we do that here or inside geometricalModelUpdator?
-		// add flag isDeformable so that is is useless to recompute normal
-		for(unsigned int i=0;i&lt;faces.size();i++)
-		{
-			Vector3r v1 = vertices[faces[i][0]];
-			Vector3r v2 = vertices[faces[i][1]];
-			Vector3r v3 = vertices[faces[i][2]];
-			fNormals[i] = -(v2-v1).Cross(v3-v1);
-		}
-		for(unsigned int i=0;i&lt;vertices.size();i++)
-		{
-			int size = triPerVertices[i].size();
-			vNormals[i] = fNormals[triPerVertices[i][0]];
-			for(int j=1;j&lt;size;j++)
-				vNormals[i] += fNormals[triPerVertices[i][j]];
-			vNormals[i] /= size;
-		}
-		
-		glBegin(GL_TRIANGLES);
-			for(unsigned int i=0;i&lt;faces.size();i++)
-			{
-				int v1 = faces[i][0];
-				int v2 = faces[i][1];
-				int v3 = faces[i][2];
-				glNormal3v(vNormals[v1]);
-				glVertex3v(vertices[v1]);
-				glNormal3v(vNormals[v2]);
-				glVertex3v(vertices[v2]);
-				glNormal3v(vNormals[v3]);
-				glVertex3v(vertices[v3]);
-			}
-		glEnd();
-	}
-}
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D/GLDrawMesh2D.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D/GLDrawMesh2D.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D/GLDrawMesh2D.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,28 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWMESH2D_HPP
-#define GLDRAWMESH2D_HPP
-
-#include &quot;GLDrawGeometricalModelFunctor.hpp&quot;
-
-class GLDrawMesh2D : public GLDrawGeometricalModelFunctor
-{	
-	public :
-		virtual void go(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
-
-	RENDERS(Mesh2D);
-	REGISTER_CLASS_NAME(GLDrawMesh2D);
-	REGISTER_BASE_CLASS_NAME(GLDrawGeometricalModelFunctor);
-
-};
-
-REGISTER_SERIALIZABLE(GLDrawMesh2D,false);
-
-#endif //  GLDRAWMESH2D_HPP
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D/GLDrawMesh2D.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D/GLDrawMesh2D.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral/GLDrawQuadrilateral.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral/GLDrawQuadrilateral.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral/GLDrawQuadrilateral.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,187 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawQuadrilateral.hpp&quot;
-#include &quot;Quadrilateral.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-Vector3r makeColor(double val,double min,double max)
-{
-	Real sc01 = ((val-min)/(max-min))*2.0-1.0;
-	if(sc01 &lt; 0) return Vector3r(0.9,0.9,1.0) + sc01 * Vector3r(0.9,0.9,0.0);
-	if(sc01 &gt; 0) return Vector3r(1.0,0.9,0.9) - sc01 * Vector3r(0.0,0.9,0.9);
-	return Vector3r(0.9,0.9,0.9);
-}
-
-void GLDrawQuadrilateral::go(const shared_ptr&lt;GeometricalModel&gt;&amp; gm, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool wire)
-{	
-	Quadrilateral* q = static_cast&lt;Quadrilateral*&gt;(gm.get());
-	MetaBody* mb = Omega::instance().getRootBody().get();
-	
-	if(   !(
-		   mb-&gt;bodies-&gt;exists(q-&gt;n1)
-		&amp;&amp; mb-&gt;bodies-&gt;exists(q-&gt;n2)
-		&amp;&amp; mb-&gt;bodies-&gt;exists(q-&gt;n3)
-		&amp;&amp; mb-&gt;bodies-&gt;exists(q-&gt;n4)))
-		return;
-
-	double ox1,oy1,ox2,oy2,ox3,oy3,ox4,oy4;
-	double nx1,ny1,nx2,ny2,nx3,ny3,nx4,ny4;
-	double e11,e22,e12,e21,x,y;
-	
-	#define Q(x) ( (*(mb-&gt;bodies))[q-&gt;x]-&gt;physicalParameters-&gt;se3.position )
-	ox1 = q-&gt;i1[0];
-	ox2 = q-&gt;i2[0];
-	ox3 = q-&gt;i3[0];
-	ox4 = q-&gt;i4[0];
-
-	oy1 = q-&gt;i1[1];
-	oy2 = q-&gt;i2[1];
-	oy3 = q-&gt;i3[1];
-	oy4 = q-&gt;i4[1];
-
-	nx1 = Q(n1)[0];
-	nx2 = Q(n2)[0];
-	nx3 = Q(n3)[0];
-	nx4 = Q(n4)[0];
-
-	ny1 = Q(n1)[1];
-	ny2 = Q(n2)[1];
-	ny3 = Q(n3)[1];
-	ny4 = Q(n4)[1];
-
-	calculateStrainQuadrilateral(ox1,oy1,ox2,oy2,ox3,oy3,ox4,oy4,nx1,ny1,nx2,ny2,nx3,ny3,nx4,ny4,0,0,e11,e22,e12,e21,x,y);
-
-	//std::cerr &lt;&lt; &quot;e11: &quot; &lt;&lt; e11 &lt;&lt; &quot; e22: &quot; &lt;&lt; e22 &lt;&lt; &quot; e12: &quot; &lt;&lt; e12 &lt;&lt; &quot; e21: &quot; &lt;&lt; e21 &lt;&lt; &quot; x: &quot; &lt;&lt; x &lt;&lt; &quot; y: &quot; &lt;&lt; y &lt;&lt; &quot;\n&quot;;
-	double m=-0.00005,M = 0.0001;
-	//M = std::max(e22,M);
-	//m = std::min(e22,m);
-	//static int zzz=0;
-	//if((++zzz%1000)==0)
-	//	std::cerr &lt;&lt; m &lt;&lt; &quot; &quot; &lt;&lt; M &lt;&lt; &quot;\n&quot;;
-	glColor3v(makeColor(e22,m,M));
-	//if(std::abs(e22) &gt; 0.0003 /*|| std::abs(e11) &gt; r*/) return;
-
-	if (gm-&gt;wire || wire)
-	{
-		glBegin(GL_LINE_LOOP);
-		glDisable(GL_LIGHTING);
-
-		glVertex3v(Q(n1));
-		glVertex3v(Q(n2));
-		glVertex3v(Q(n3));
-		glVertex3v(Q(n4));
-
-		glEnd();
-	}
-	else
-	{
-		glDisable(GL_CULL_FACE);
-		glDisable(GL_LIGHTING);
-		glBegin(GL_QUADS);
-
-		glVertex3v(Q(n1));
-		glVertex3v(Q(n2));
-		glVertex3v(Q(n3));
-		glVertex3v(Q(n4));
-
-		glEnd();
-	}
-	#undef Q
-}
-
-double H1(double r,double s)		{	return 0.25*(1-r)*(1-s);	}
-double H2(double r,double s)		{	return 0.25*(1+r)*(1-s);	}
-double H3(double r,double s)		{	return 0.25*(1+r)*(1+s);	}
-double H4(double r,double s)		{	return 0.25*(1-r)*(1+s);	}
-
-double dH1_dr(double r,double s)	{	return -0.25*(1-s);		}
-double dH1_ds(double r,double s)	{	return -0.25*(1-r);		}
-double dH2_dr(double r,double s)	{	return  0.25*(1-s);		}
-double dH2_ds(double r,double s)	{	return -0.25*(1+r);		}
-double dH3_dr(double r,double s)	{	return  0.25*(1+s);		}
-double dH3_ds(double r,double s)	{	return  0.25*(1+r);		}
-double dH4_dr(double r,double s)	{	return -0.25*(1+s);		}
-double dH4_ds(double r,double s)	{	return  0.25*(1-r);		}
-
-
-void GLDrawQuadrilateral::calculateStrainQuadrilateral(
-	 double ox1 ,double oy1 ,double ox2 ,double oy2 ,double ox3 ,double oy3 ,double ox4 ,double oy4 
-	,double nx1 ,double ny1 ,double nx2 ,double ny2 ,double nx3 ,double ny3 ,double nx4 ,double ny4 
-	,double r ,double s
-	,double&amp; e11 ,double&amp; e22 ,double&amp; e12 ,double&amp; e21,double&amp; x,double&amp; y)
-{
-	// coordinates of integration point
-	Vector3d X =	  H1(r,s) * Vector3d(ox1,oy1,0)
-			+ H2(r,s) * Vector3d(ox2,oy2,0)
-			+ H3(r,s) * Vector3d(ox3,oy3,0)
-			+ H4(r,s) * Vector3d(ox4,oy4,0);
-	
-	// displacements, delta u, delta v
-	double Du1   =    nx1 - ox1; //C(Du1);
-	double Du2   =    nx2 - ox2; //C(Du2);
-	double Du3   =    nx3 - ox3; //C(Du3);
-	double Du4   =    nx4 - ox4; //C(Du4);
-	
-	double Dv1   =    ny1 - oy1; //C(Dv1);
-	double Dv2   =    ny2 - oy2; //C(Dv2);
-	double Dv3   =    ny3 - oy3; //C(Dv3);
-	double Dv4   =    ny4 - oy4; //C(Dv4);
-
-	// Jacobian matrix components
-	double dX_dr =    dH1_dr(r,s) * nx1
-			+ dH2_dr(r,s) * nx2
-			+ dH3_dr(r,s) * nx3
-			+ dH4_dr(r,s) * nx4;
-
-	double dX_ds =    dH1_ds(r,s) * nx1
-			+ dH2_ds(r,s) * nx2
-			+ dH3_ds(r,s) * nx3
-			+ dH4_ds(r,s) * nx4;
-
-	double dY_dr =    dH1_dr(r,s) * ny1
-			+ dH2_dr(r,s) * ny2
-			+ dH3_dr(r,s) * ny3
-			+ dH4_dr(r,s) * ny4;
-
-	double dY_ds =    dH1_ds(r,s) * ny1
-			+ dH2_ds(r,s) * ny2
-			+ dH3_ds(r,s) * ny3
-			+ dH4_ds(r,s) * ny4;
-
-	// its determinant
-	double detJ  = dX_dr*dY_ds-dY_dr*dX_ds;
-
-	// componentes of inversed matrix
-	double dr_dX =  dY_ds/detJ;
-	double ds_dX = -dY_dr/detJ;
-	double dr_dY = -dX_ds/detJ;
-	double ds_dY =  dX_dr/detJ;
-
-	// derivatives of shape function
-	double dH1_dX = dH1_dr(r,s)*dr_dX + dH1_ds(r,s)*ds_dX;
-	double dH2_dX = dH2_dr(r,s)*dr_dX + dH2_ds(r,s)*ds_dX;
-	double dH3_dX = dH3_dr(r,s)*dr_dX + dH3_ds(r,s)*ds_dX;
-	double dH4_dX = dH4_dr(r,s)*dr_dX + dH4_ds(r,s)*ds_dX;
-
-	double dH1_dY = dH1_dr(r,s)*dr_dY + dH1_ds(r,s)*ds_dY;
-	double dH2_dY = dH2_dr(r,s)*dr_dY + dH2_ds(r,s)*ds_dY;
-	double dH3_dY = dH3_dr(r,s)*dr_dY + dH3_ds(r,s)*ds_dY;
-	double dH4_dY = dH4_dr(r,s)*dr_dY + dH4_ds(r,s)*ds_dY;
-
-	// calculated strian
-	e11 = dH1_dX*Du1 + dH2_dX*Du2 + dH3_dX*Du3 + dH4_dX*Du4;
-	e22 = dH1_dY*Dv1 + dH2_dY*Dv2 + dH3_dY*Dv3 + dH4_dY*Dv4;
-	e12 = dH1_dY*Du1 + dH2_dY*Du2 + dH3_dY*Du3 + dH4_dY*Du4;
-	e21 = dH1_dX*Dv1 + dH2_dX*Dv2 + dH3_dX*Dv3 + dH4_dX*Dv4;
-	
-	x = X[0];
-	y = X[1];
-};
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral/GLDrawQuadrilateral.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral/GLDrawQuadrilateral.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral/GLDrawQuadrilateral.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,34 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAW_QUADRILATERAL_HPP
-#define GLDRAW_QUADRILATERAL_HPP
-
-#include &quot;GLDrawGeometricalModelFunctor.hpp&quot;
-
-class GLDrawQuadrilateral : public GLDrawGeometricalModelFunctor
-{
-	private:
-		// FIXME - this does not belong here
-		void calculateStrainQuadrilateral(
-			double ox1 ,double oy1 ,double ox2 ,double oy2 ,double ox3 ,double oy3 ,double ox4 ,double oy4 
-			,double nx1 ,double ny1 ,double nx2 ,double ny2 ,double nx3 ,double ny3 ,double nx4 ,double ny4 
-			,double r ,double s
-			,double&amp; e11 ,double&amp; e22 ,double&amp; e12 ,double&amp; e21,double&amp; x,double&amp; y);
-	public :
-		virtual void go(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
-
-	RENDERS(Quadrilateral);
-	REGISTER_CLASS_NAME(GLDrawQuadrilateral);
-	REGISTER_BASE_CLASS_NAME(GLDrawGeometricalModelFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawQuadrilateral,false);
-
-#endif // GLDRAW_TETRAHEDRON_HPP 
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral/GLDrawQuadrilateral.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral/GLDrawQuadrilateral.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,231 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawSphere.hpp&quot;
-#include &quot;Sphere.hpp&quot;
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-//int GLDrawSphere::glSphereList=-1;
-//int GLDrawSphere::glWiredSphereList=-1;
-
-//vector&lt;Vector3r&gt; GLDrawSphere::vertices;
-//vector&lt;Vector3r&gt; GLDrawSphere::faces;
-
-//void drawString(string str,int x,int y,float * c)
-//{
-//      glPushMatrix();
-//      glRasterPos2i(x,y);
-//      glColor3fv(c);
-//      for(unsigned int i=0;i&lt;str.length();i++)
-//              glutBitmapCharacter(GLUT_BITMAP_HELVETICA_12, str[i]);
-//      glPopMatrix();
-//}
-
-GLDrawSphere::GLDrawSphere() : first(true), glWiredSphereList(-1), glSphereList(-1)
-{
-};
-
-void GLDrawSphere::go(const shared_ptr&lt;GeometricalModel&gt;&amp; gm, const shared_ptr&lt;PhysicalParameters&gt;&amp; ph,bool wire)
-{
-	if (first)
-	{
-		Real X = 0.525731112119133606;
-		Real Z = 0.850650808352039932;
-		vertices.push_back(Vector3r(-X,0,Z));
-		vertices.push_back(Vector3r(X,0,Z));
-		vertices.push_back(Vector3r(-X,0,-Z));
-		vertices.push_back(Vector3r(X,0,-Z));
-		vertices.push_back(Vector3r(0,Z,X));
-		vertices.push_back(Vector3r(0,Z,-X));
-		vertices.push_back(Vector3r(0,-Z,X));
-		vertices.push_back(Vector3r(0,-Z,-X));
-		vertices.push_back(Vector3r(Z,X,0));
-		vertices.push_back(Vector3r(-Z,X,0));
-		vertices.push_back(Vector3r(Z,-X,0));
-		vertices.push_back(Vector3r(-Z,-X,0));
-	
-		faces.push_back(Vector3r(0,4,1));
-		faces.push_back(Vector3r(0,9,4));
-		faces.push_back(Vector3r(9,5,4));
-		faces.push_back(Vector3r(4,5,8));
-		faces.push_back(Vector3r(4,8,1));
-		faces.push_back(Vector3r(8,10,1));
-		faces.push_back(Vector3r(8,3,10));
-		faces.push_back(Vector3r(5,3,8));
-		faces.push_back(Vector3r(5,2,3));
-		faces.push_back(Vector3r(2,7,3));
-		faces.push_back(Vector3r(7,10,3));
-		faces.push_back(Vector3r(7,6,10));
-		faces.push_back(Vector3r(7,11,6));
-		faces.push_back(Vector3r(11,0,6));
-		faces.push_back(Vector3r(0,1,6));
-		faces.push_back(Vector3r(6,1,10));
-		faces.push_back(Vector3r(9,0,11));
-		faces.push_back(Vector3r(9,11,2));
-		faces.push_back(Vector3r(9,2,5));
-		faces.push_back(Vector3r(7,2,11));
-		
-		glWiredSphereList = glGenLists(1);
-		glNewList(glWiredSphereList,GL_COMPILE);
-			glDisable(GL_LIGHTING);
-			drawSphere(1);
-		glEndList();
-		glSphereList = glGenLists(1);
-		glNewList(glSphereList,GL_COMPILE);
-			glEnable(GL_LIGHTING); // FIXME : remove enable/disable lighting from object
-			drawSphere(1);
-		glEndList();
-
-		
-		first = false;
-	}
-	
-	Real radius = (static_cast&lt;Sphere*&gt;(gm.get()))-&gt;radius;
-	
-	glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, Vector3f(gm-&gt;diffuseColor[0],gm-&gt;diffuseColor[1],gm-&gt;diffuseColor[2]));
-	glColor3v(gm-&gt;diffuseColor);
- 	if (gm-&gt;wire || wire)
- 	{
-		//glScalef(radius,radius,radius);
-                //glCallList(glWiredSphereList);
-
-//                glutWireSphere(radius,4,4);
-
-		///////////////////////
-		// draw a circle from a bunch of short lines
-		//
-		// FACING the camera !!
-		// FIXME: this can be done faster, by storing the circle in the buffer (similarly as the sphere)
-		///////////////////////
-		//
-			glPushMatrix();
-
-			float modelview[16];
-			int i,j;
-			glGetFloatv(GL_MODELVIEW_MATRIX , modelview);
-			// undo all rotations
-			// beware all scaling is lost as well 
-			for( i=0; i&lt;3; i++ ) 
-				for( j=0; j&lt;3; j++ ) {
-					if ( i==j )
-						modelview[i*4+j] = 1.0;
-					else
-						modelview[i*4+j] = 0.0;
-				}
-			glLoadMatrixf(modelview);
-
-
-		
-		glDisable(GL_LIGHTING);
-		float vectorY1=radius,startY=vectorY1;
-		float vectorX1=0,startX=vectorX1;
-		glBegin(GL_LINE_STRIP);			
-		for(float angle=0.0f ; angle &lt;= (2.0f*3.14159) ; angle+=0.31f)
-		{		
-			float vectorX=(radius*(float)sin((double)angle));
-			float vectorY=(radius*(float)cos((double)angle));		
-			glVertex2d(vectorX1,vectorY1);
-			vectorY1=vectorY;
-			vectorX1=vectorX;			
-		}
-		glVertex2d(startX,startY);
-		glEnd();
-
-			glPopMatrix();
-
-		/////////////////////
-		
-/////////////////////////// FIXME - display coordinates (stupid place!!)
-//              glPushMatrix();
-//              glRasterPos2i(0,0);
-//              std::string str=std::string(&quot;  (&quot;) + boost::lexical_cast&lt;std::string&gt;((float)(ph-&gt;se3.position[0])) + &quot;,&quot; + boost::lexical_cast&lt;std::string&gt;((float)(ph-&gt;se3.position[1])) + &quot;)&quot;;
-//              for(unsigned int i=0;i&lt;str.length();i++)
-//                      glutBitmapCharacter(GLUT_BITMAP_HELVETICA_12, str[i]);
-//              glPopMatrix();
-///////////////////////////
-
-        }
-        else
-        {
-		glScalef(radius,radius,radius);
-		glCallList(glSphereList);
-	}
-}
-///////////////////////////////////////////////////////////////////////////////////////////////////
-
-void GLDrawSphere::subdivideTriangle(Vector3r&amp; v1,Vector3r&amp; v2,Vector3r&amp; v3, int depth)
-{
-	Vector3r v12,v23,v31;
-
-	if (depth==0)
-	{
-		Vector3r v = (v1+v2+v3)/3.0;
-		Real angle = atan(v[2]/v[0])/v.Length();
-
-	////////////////////////////
-	//
-	// FIXME - another parameter to GLDraw* to allow to disable that stripe on the sphere
-	//
-	// BEGIN mark
-		GLfloat matAmbient[4];
-
-		if (angle&gt;-Mathr::PI/6.0 &amp;&amp; angle&lt;=Mathr::PI/6.0)
-		{
-			matAmbient[0] = 0.2;
-			matAmbient[1] = 0.2;
-			matAmbient[2] = 0.2;
-			matAmbient[3] = 0.0;
-		}
-		else
-		{
-			matAmbient[0] = 0.0;
-			matAmbient[1] = 0.0;
-			matAmbient[2] = 0.0;
-			matAmbient[3] = 0.0;
-		}
-	
-		glMaterialfv(GL_FRONT_AND_BACK,GL_SPECULAR,matAmbient);
-	// END mark
-	////////////////////////////
-	
-	
-		glBegin(GL_TRIANGLES);
-			glNormal3v(v3);
-			glVertex3v(v3);
-			glNormal3v(v2);
-			glVertex3v(v2);
-			glNormal3v(v1);
-			glVertex3v(v1);
-		glEnd();
-
-		return;
-	}
-	v12 = v1+v2;
-	v23 = v2+v3;
-	v31 = v3+v1;
-	v12.Normalize();
-	v23.Normalize();
-	v31.Normalize();
-	subdivideTriangle(v1,v12,v31,depth-1);
-	subdivideTriangle(v2,v23,v12,depth-1);
-	subdivideTriangle(v3,v31,v23,depth-1);
-	subdivideTriangle(v12,v23,v31,depth-1);
-}
-
-///////////////////////////////////////////////////////////////////////////////////////////////////
-
-void GLDrawSphere::drawSphere(int depth)
-{
-	glShadeModel(GL_SMOOTH);
-	
-	for(int i=0;i&lt;20;i++)
-		subdivideTriangle(vertices[(unsigned int)faces[i][0]],vertices[(unsigned int)faces[i][1]],vertices[(unsigned int)faces[i][2]],depth);
-}
-
-///////////////////////////////////////////////////////////////////////////////////////////////////

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWSPHERE_HPP
-#define GLDRAWSPHERE_HPP
-
-#include &quot;GLDrawGeometricalModelFunctor.hpp&quot;
-
-class GLDrawSphere : public GLDrawGeometricalModelFunctor
-{
-	private :
-		bool first;
-		vector&lt;Vector3r&gt; vertices;
-		vector&lt;Vector3r&gt; faces;
-		int glWiredSphereList;
-		int glSphereList;
-		void subdivideTriangle(Vector3r&amp; v1,Vector3r&amp; v2,Vector3r&amp; v3, int depth);
-		void drawSphere(int depth);
-	
-	public :
-		GLDrawSphere();
-		virtual void go(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
-		
-	RENDERS(Sphere);
-	REGISTER_CLASS_NAME(GLDrawSphere);
-	REGISTER_BASE_CLASS_NAME(GLDrawGeometricalModelFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawSphere,false);
-
-#endif // GLDRAWSPHERE_HPP
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron/GLDrawTetrahedron.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron/GLDrawTetrahedron.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron/GLDrawTetrahedron.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,145 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawTetrahedron.hpp&quot;
-#include &quot;Tetrahedron.hpp&quot;
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-
-void GLDrawTetrahedron::go(const shared_ptr&lt;GeometricalModel&gt;&amp; gm, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool wire)
-{
-	// FIXME : check that : one of those 2 lines are useless
-  	glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, Vector3f(gm-&gt;diffuseColor[0],gm-&gt;diffuseColor[1],gm-&gt;diffuseColor[2]));
-	glColor3v(gm-&gt;diffuseColor);
-	
-	Tetrahedron* tet = static_cast&lt;Tetrahedron*&gt;(gm.get());
-	
-	if (gm-&gt;wire || wire) // FIXME - draws only wire
-	{
-		glBegin(GL_LINES);
-			glDisable(GL_LIGHTING);
-			
-			// FIXME - stupid method to draw lines of tetrahedron
-			glVertex3v(tet-&gt;v1);
-			glVertex3v(tet-&gt;v2);
-			
-			glVertex3v(tet-&gt;v1);
-			glVertex3v(tet-&gt;v3);
-			
-			glVertex3v(tet-&gt;v1);
-			glVertex3v(tet-&gt;v4);
-			
-			glVertex3v(tet-&gt;v3);
-			glVertex3v(tet-&gt;v4);
-			
-			glVertex3v(tet-&gt;v2);
-			glVertex3v(tet-&gt;v4);
-			
-			glVertex3v(tet-&gt;v2);
-			glVertex3v(tet-&gt;v3);
-			
-		glEnd();
-	}
-	else
-	{
-// 		glBegin(GL_TRIANGLE_STRIP);
-// 			glEnable(GL_LIGHTING); 
-// 			
-// 			glNormal3v (tet-&gt;v4);
-// 			glVertex3fv(tet-&gt;v4);
-// 			
-// 			glNormal3v (tet-&gt;v1);
-// 			glVertex3fv(tet-&gt;v1);
-// 			
-// 			glNormal3v (tet-&gt;v2);
-// 			glVertex3fv(tet-&gt;v2);
-// 			
-// 			
-// 			glNormal3v (tet-&gt;v3);
-// 			glVertex3fv(tet-&gt;v3);
-// 			
-// 			glNormal3v (tet-&gt;v4);
-// 			glVertex3fv(tet-&gt;v4);
-// 			
-// 			glNormal3v (tet-&gt;v1);
-// 			glVertex3fv(tet-&gt;v1);
-// 		glEnd();
-
-/*		glDisable(GL_CULL_FACE);
-		glBegin(GL_TRIANGLE_STRIP);
-			glEnable(GL_LIGHTING); 
-		
-
-				glVertex3fv(tet-&gt;v4);
-			
-			
-				glVertex3fv(tet-&gt;v1);			
-
-			
-			Vector3r n = (tet-&gt;v1-tet-&gt;v4).unitCross(tet-&gt;v2-tet-&gt;v4);
-			glNormal3v (n);
-				glVertex3fv(tet-&gt;v2);
-			
-			n = (tet-&gt;v2-tet-&gt;v1).unitCross(tet-&gt;v3-tet-&gt;v1);
-			glNormal3v (n);
-			
-				glVertex3fv(tet-&gt;v3);
-			n = (tet-&gt;v3-tet-&gt;v2).unitCross(tet-&gt;v4-tet-&gt;v2);
-			glNormal3v (n);
-			
-				glVertex3fv(tet-&gt;v4);
-			n = (tet-&gt;v4-tet-&gt;v3).unitCross(tet-&gt;v1-tet-&gt;v3);
-			glNormal3v (n);
-				glVertex3fv(tet-&gt;v1);
-		glEnd();*/
-		glDisable(GL_CULL_FACE);
-		glEnable(GL_LIGHTING);
-
-		Vector3r center = (tet-&gt;v1+tet-&gt;v2+tet-&gt;v3+tet-&gt;v4)*.25;
-		
-		glBegin(GL_TRIANGLES);
-			Vector3r n = (tet-&gt;v1-tet-&gt;v4).UnitCross(tet-&gt;v2-tet-&gt;v4);
-			Vector3r faceCenter = (tet-&gt;v4+tet-&gt;v1+tet-&gt;v2)/3.0;
-			if ((faceCenter-center).Dot(n)&lt;0)
-				n = -n;
-			glNormal3v (n);
-			glVertex3v(tet-&gt;v4);
-			glVertex3v(tet-&gt;v1);
-			glVertex3v(tet-&gt;v2);
-			
-			n = (tet-&gt;v2-tet-&gt;v1).UnitCross(tet-&gt;v3-tet-&gt;v1);
-			faceCenter = (tet-&gt;v1+tet-&gt;v2+tet-&gt;v3)/3.0;
-			if ((faceCenter-center).Dot(n)&lt;0)
-				n = -n;
-			glNormal3v (n);
-			glVertex3v(tet-&gt;v1);
-			glVertex3v(tet-&gt;v2);
-			glVertex3v(tet-&gt;v3);
-
-			n = (tet-&gt;v3-tet-&gt;v2).UnitCross(tet-&gt;v4-tet-&gt;v2);
-			faceCenter = (tet-&gt;v2+tet-&gt;v3+tet-&gt;v4)/3.0;
-			if ((faceCenter-center).Dot(n)&lt;0)
-				n = -n;
-			glNormal3v (n);
-			glVertex3v(tet-&gt;v2);
-			glVertex3v(tet-&gt;v3);
-			glVertex3v(tet-&gt;v4);
-			
-			n = (tet-&gt;v4-tet-&gt;v3).UnitCross(tet-&gt;v1-tet-&gt;v3);
-			faceCenter = (tet-&gt;v3+tet-&gt;v4+tet-&gt;v1)/3.0;
-			if ((faceCenter-center).Dot(n)&lt;0)
-				n = -n;
-			glNormal3v (n);
-			glVertex3v(tet-&gt;v3);
-			glVertex3v(tet-&gt;v4);
-			glVertex3v(tet-&gt;v1);
-		glEnd();
-	}
-}
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron/GLDrawTetrahedron.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron/GLDrawTetrahedron.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron/GLDrawTetrahedron.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAW_TETRAHEDRON_HPP
-#define GLDRAW_TETRAHEDRON_HPP 
-
-#include &quot;GLDrawGeometricalModelFunctor.hpp&quot;
-
-class GLDrawTetrahedron : public GLDrawGeometricalModelFunctor
-{
-	public :
-		virtual void go(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
-
-	RENDERS(Tetrahedron);
-	REGISTER_CLASS_NAME(GLDrawTetrahedron);
-	REGISTER_BASE_CLASS_NAME(GLDrawGeometricalModelFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawTetrahedron,false);
-
-#endif // GLDRAW_TETRAHEDRON_HPP 
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron/GLDrawTetrahedron.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron/GLDrawTetrahedron.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,34 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawInteractingBox.hpp&quot;
-#include &quot;InteractingBox.hpp&quot;
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-void GLDrawInteractingBox::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; cg, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool)
-{
-	// FIXME : check that : one of those 2 lines are useless
-  	glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, Vector3f(cg-&gt;diffuseColor[0],cg-&gt;diffuseColor[1],cg-&gt;diffuseColor[2]));
-	glColor3v(cg-&gt;diffuseColor);
-	
-	Vector3r &amp;extents = (static_cast&lt;InteractingBox*&gt;(cg.get()))-&gt;extents;
-	
-	glScalef(2*extents[0],2*extents[1],2*extents[2]);
-
-// 	if (wire)
-// 	{
-// 		glDisable(GL_LIGHTING);
-// 		glutWireCube(1);
-// 	}
-// 	else
-// 	{
-		glEnable(GL_LIGHTING);
-		glutSolidCube(1);
-//	}
-}
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWINTERACTIONBOX_HPP
-#define GLDRAWINTERACTIONBOX_HPP
-
-#include &quot;GLDrawInteractingGeometryFunctor.hpp&quot;
-
-class GLDrawInteractingBox : public GLDrawInteractingGeometryFunctor
-{
-	public :
-		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
-
-	RENDERS(InteractingBox);
-	REGISTER_CLASS_NAME(GLDrawInteractingBox);
-	REGISTER_BASE_CLASS_NAME(GLDrawInteractingGeometryFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawInteractingBox,false);
-
-#endif //  GLDRAWINTERACTIONBOX_HPP
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,154 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawInteractingSphere.hpp&quot;
-#include &quot;InteractingSphere.hpp&quot;
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-int GLDrawInteractingSphere::glSphereList=-1;
-int GLDrawInteractingSphere::glWiredSphereList=-1;
-
-vector&lt;Vector3r&gt; GLDrawInteractingSphere::vertices;
-vector&lt;Vector3r&gt; GLDrawInteractingSphere::faces;
-
-
-void GLDrawInteractingSphere::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; cm, const shared_ptr&lt;PhysicalParameters&gt;&amp; ,bool)
-{
-	static bool first=true;
-	
-	if (first)
-	{
-		Real X = 0.525731112119133606;
-		Real Z = 0.850650808352039932;
-		vertices.push_back(Vector3r(-X,0,Z));
-		vertices.push_back(Vector3r(X,0,Z));
-		vertices.push_back(Vector3r(-X,0,-Z));
-		vertices.push_back(Vector3r(X,0,-Z));
-		vertices.push_back(Vector3r(0,Z,X));
-		vertices.push_back(Vector3r(0,Z,-X));
-		vertices.push_back(Vector3r(0,-Z,X));
-		vertices.push_back(Vector3r(0,-Z,-X));
-		vertices.push_back(Vector3r(Z,X,0));
-		vertices.push_back(Vector3r(-Z,X,0));
-		vertices.push_back(Vector3r(Z,-X,0));
-		vertices.push_back(Vector3r(-Z,-X,0));
-	
-		faces.push_back(Vector3r(0,4,1));
-		faces.push_back(Vector3r(0,9,4));
-		faces.push_back(Vector3r(9,5,4));
-		faces.push_back(Vector3r(4,5,8));
-		faces.push_back(Vector3r(4,8,1));
-		faces.push_back(Vector3r(8,10,1));
-		faces.push_back(Vector3r(8,3,10));
-		faces.push_back(Vector3r(5,3,8));
-		faces.push_back(Vector3r(5,2,3));
-		faces.push_back(Vector3r(2,7,3));
-		faces.push_back(Vector3r(7,10,3));
-		faces.push_back(Vector3r(7,6,10));
-		faces.push_back(Vector3r(7,11,6));
-		faces.push_back(Vector3r(11,0,6));
-		faces.push_back(Vector3r(0,1,6));
-		faces.push_back(Vector3r(6,1,10));
-		faces.push_back(Vector3r(9,0,11));
-		faces.push_back(Vector3r(9,11,2));
-		faces.push_back(Vector3r(9,2,5));
-		faces.push_back(Vector3r(7,2,11));
-		
-		glWiredSphereList = glGenLists(1);
-		glNewList(glWiredSphereList,GL_COMPILE);
-			glDisable(GL_LIGHTING);
-			drawSphere(1);
-		glEndList();
-		glSphereList = glGenLists(1);
-		glNewList(glSphereList,GL_COMPILE);
-			glEnable(GL_LIGHTING); // FIXME : remove enable/disable lighting from object
-			drawSphere(1);
-		glEndList();
-
-		
-		first = false;
-	}
-	
-	Real radius = (static_cast&lt;InteractingSphere*&gt;(cm.get()))-&gt;radius;
-	
-	glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, Vector3f(cm-&gt;diffuseColor[0],cm-&gt;diffuseColor[1],cm-&gt;diffuseColor[2]));
-	glColor3v(cm-&gt;diffuseColor);
-// 	if (cm-&gt;wire)
-// 	{
-// 		glScalef(radius,radius,radius);
-// 		glCallList(glWiredSphereList);
-// 	}
-// 	else
-// 	{
-		glScalef(radius,radius,radius);
-		glCallList(glSphereList);
-//	}
-}
-
-
-void GLDrawInteractingSphere::subdivideTriangle(Vector3r&amp; v1,Vector3r&amp; v2,Vector3r&amp; v3, int depth)
-{
-	Vector3r v12,v23,v31;
-
-	if (depth==0)
-	{
-		Vector3r v = (v1+v2+v3)/3.0;
-		Real angle = atan(v[2]/v[0])/v.Length();
-
-		GLfloat matAmbient[4];
-
-		if (angle&gt;-Mathr::PI/6.0 &amp;&amp; angle&lt;=Mathr::PI/6.0)
-		{
-			matAmbient[0] = 0.2;
-			matAmbient[1] = 0.2;
-			matAmbient[2] = 0.2;
-			matAmbient[3] = 0.0;
-		}
-		else
-		{
-			matAmbient[0] = 0.0;
-			matAmbient[1] = 0.0;
-			matAmbient[2] = 0.0;
-			matAmbient[3] = 0.0;
-		}
-
-		glMaterialfv(GL_FRONT_AND_BACK,GL_SPECULAR,matAmbient);
-		
-		glBegin(GL_TRIANGLES);
-			glNormal3v(v3);
-			glVertex3v(v3);
-			glNormal3v(v2);
-			glVertex3v(v2);
-			glNormal3v(v1);
-			glVertex3v(v1);
-		glEnd();
-
-		return;
-	}
-	v12 = v1+v2;
-	v23 = v2+v3;
-	v31 = v3+v1;
-	v12.Normalize();
-	v23.Normalize();
-	v31.Normalize();
-	subdivideTriangle(v1,v12,v31,depth-1);
-	subdivideTriangle(v2,v23,v12,depth-1);
-	subdivideTriangle(v3,v31,v23,depth-1);
-	subdivideTriangle(v12,v23,v31,depth-1);
-}
-
-
-void GLDrawInteractingSphere::drawSphere(int depth)
-{
-	glShadeModel(GL_SMOOTH);
-	
-	for(int i=0;i&lt;20;i++)
-		subdivideTriangle(vertices[(unsigned int)faces[i][0]],vertices[(unsigned int)faces[i][1]],vertices[(unsigned int)faces[i][2]],depth);
-}
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef __GLDRAWINTERACTIONSPHERE_HPP__
-#define __GLDRAWINTERACTIONSPHERE_HPP__
-
-#include &quot;GLDrawInteractingGeometryFunctor.hpp&quot;
-
-class GLDrawInteractingSphere : public GLDrawInteractingGeometryFunctor
-{	
-	private :
-		static vector&lt;Vector3r&gt; vertices;
-		static vector&lt;Vector3r&gt; faces;
-		static int glWiredSphereList;
-		static int glSphereList;
-		void subdivideTriangle(Vector3r&amp; v1,Vector3r&amp; v2,Vector3r&amp; v3, int depth);
-		void drawSphere(int depth);
-	
-	public :
-		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
-
-	RENDERS(InteractingSphere);
-	REGISTER_CLASS_NAME(GLDrawInteractingSphere);
-	REGISTER_BASE_CLASS_NAME(GLDrawInteractingGeometryFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawInteractingSphere,false);
-
-#endif //  GLDRAWINTERACTIONSPHERE_HPP
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,18 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawMetaInteractingGeometry.hpp&quot;
-
-
-void GLDrawMetaInteractingGeometry::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; , const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool)
-{
-
-
-}
-
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,28 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWCOLLISIONGEOMETRYSET_HPP
-#define GLDRAWCOLLISIONGEOMETRYSET_HPP
-
-#include &quot;GLDrawInteractingGeometryFunctor.hpp&quot;
-
-class GLDrawMetaInteractingGeometry : public GLDrawInteractingGeometryFunctor
-{
-	public :
-		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
-
-	RENDERS(MetaInteractingGeometry);
-	REGISTER_CLASS_NAME(GLDrawMetaInteractingGeometry);
-	REGISTER_BASE_CLASS_NAME(GLDrawInteractingGeometryFunctor);
-};
-
-REGISTER_FACTORABLE(GLDrawMetaInteractingGeometry);
-
-#endif //  GLDRAWCOLLISIONGEOMETRYSET_HPP
-
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures/GLDrawClosestFeatures.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures/GLDrawClosestFeatures.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures/GLDrawClosestFeatures.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,45 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawClosestFeatures.hpp&quot;
-#include &quot;ClosestFeatures.hpp&quot;
-
-
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-void GLDrawClosestFeatures::go(
-		const shared_ptr&lt;InteractionGeometry&gt;&amp; ig,
-		const shared_ptr&lt;Interaction&gt;&amp;,
-		const shared_ptr&lt;Body&gt;&amp; b1,
-		const shared_ptr&lt;Body&gt;&amp; b2,
-		bool wireFrame)
-{
-	ClosestFeatures* p = static_cast&lt;ClosestFeatures*&gt;(ig.get());
-//	FIXME: so there must be a way for *not* storing the color inside those classes like BodyBoundingVolume and BodyState
-//	       and simultaneously easy to set up the colors from the GUI according to some usful criterions:
-//	          - to which group it belongs
-//	          - to reflect some features of the drawed element
-//	          - according to some certaion selection
-//	          - etc...
-	//glColor3v(bv-&gt;diffuseColor);
-	glTranslatev(p-&gt;closestsPoints[0].first);
-	
-	// FIXME - another problem with scaling of stuff to be drawn
-	//
-	//glScale(2*aabb-&gt;halfSize[0],2*aabb-&gt;halfSize[1],2*aabb-&gt;halfSize[2]);
-	glDisable(GL_LIGHTING);
-
-	// too lazy to write a loop....
-	glBegin(GL_LINES);
-		glColor3(1.0,0.0,0.0);
-		glVertex3(0.0,0.0,0.0);
-		glVertex3v(p-&gt;closestsPoints[0].second-p-&gt;closestsPoints[0].first);
-	glEnd();
-}
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures/GLDrawClosestFeatures.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures/GLDrawClosestFeatures.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures/GLDrawClosestFeatures.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAW_CLOSEST_FEATURES_HPP
-#define GLDRAW_CLOSEST_FEATURES_HPP
-
-#include &quot;GLDrawInteractionGeometryFunctor.hpp&quot;
-
-class GLDrawClosestFeatures : public GLDrawInteractionGeometryFunctor
-{
-	public :
-		virtual void go(const shared_ptr&lt;InteractionGeometry&gt;&amp;,const shared_ptr&lt;Interaction&gt;&amp;,const shared_ptr&lt;Body&gt;&amp;,const shared_ptr&lt;Body&gt;&amp;,bool wireFrame);
-
-	RENDERS(ClosestFeatures);
-	REGISTER_CLASS_NAME(GLDrawClosestFeatures);
-	REGISTER_BASE_CLASS_NAME(GLDrawInteractionGeometryFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawClosestFeatures,false);
-
-#endif
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures/GLDrawClosestFeatures.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures/GLDrawClosestFeatures.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction/GLDrawSimpleElasticInteraction.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction/GLDrawSimpleElasticInteraction.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction/GLDrawSimpleElasticInteraction.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,42 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawSimpleElasticInteraction.hpp&quot;
-#include &quot;SimpleElasticInteraction.hpp&quot;
-
-
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-void GLDrawSimpleElasticInteraction::go(
-		const shared_ptr&lt;InteractionPhysics&gt;&amp; ip,
-		const shared_ptr&lt;Interaction&gt;&amp;,
-		const shared_ptr&lt;Body&gt;&amp; b1,
-		const shared_ptr&lt;Body&gt;&amp; b2,
-		bool wireFrame)
-{
-	SimpleElasticInteraction* p = static_cast&lt;SimpleElasticInteraction*&gt;(ip.get());
-//	FIXME: so there must be a way for *not* storing the color inside those classes like BodyBoundingVolume and BodyState
-//	       and simultaneously easy to set up the colors from the GUI according to some usful criterions:
-//	          - to which group it belongs
-//	          - to reflect some features of the drawed element
-//	          - according to some certaion selection
-//	          - etc...
-	//glColor3v(bv-&gt;diffuseColor);
-	Vector3r mid = 0.5*(b1-&gt;physicalParameters-&gt;se3.position+b2-&gt;physicalParameters-&gt;se3.position);
-	glTranslatev(mid);
-	glColor3(1.0,0.0,0.0);
-	
-	glPushMatrix();
-	glRasterPos2i(0,0);
-	std::string str=std::string(&quot;  kn=&quot;) + boost::lexical_cast&lt;std::string&gt;((float)(p-&gt;kn));
-	for(unsigned int i=0;i&lt;str.length();i++)
-		glutBitmapCharacter(GLUT_BITMAP_HELVETICA_12, str[i]);
-	glPopMatrix();
-}
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction/GLDrawSimpleElasticInteraction.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction/GLDrawSimpleElasticInteraction.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction/GLDrawSimpleElasticInteraction.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAW_SIMPLE_ELASTIC_INTERACTION_HPP
-#define GLDRAW_SIMPLE_ELASTIC_INTERACTION_HPP
-
-#include &quot;GLDrawInteractionPhysicsFunctor.hpp&quot;
-
-class GLDrawSimpleElasticInteraction : public GLDrawInteractionPhysicsFunctor
-{
-	public :
-		virtual void go(const shared_ptr&lt;InteractionPhysics&gt;&amp;,const shared_ptr&lt;Interaction&gt;&amp;,const shared_ptr&lt;Body&gt;&amp;,const shared_ptr&lt;Body&gt;&amp;,bool wireFrame);
-
-	RENDERS(SimpleElasticInteraction);
-	REGISTER_CLASS_NAME(GLDrawSimpleElasticInteraction);
-	REGISTER_BASE_CLASS_NAME(GLDrawInteractionPhysicsFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawSimpleElasticInteraction,false);
-
-#endif
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction/GLDrawSimpleElasticInteraction.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction/GLDrawSimpleElasticInteraction.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume/GLDrawBoxShadowVolume.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume/GLDrawBoxShadowVolume.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume/GLDrawBoxShadowVolume.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,290 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawBoxShadowVolume.hpp&quot;
-#include &quot;Box.hpp&quot;
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-void GLDrawBoxShadowVolume::go(const shared_ptr&lt;GeometricalModel&gt;&amp; gm , const shared_ptr&lt;PhysicalParameters&gt;&amp; pp, const Vector3r&amp; lightPos)
-{
-	//Se3r&amp; se3 = (static_cast&lt;RigidBodyParameters*&gt;(pp.get()))-&gt;se3;
-	Se3r&amp; se3 = pp-&gt;se3;
-	Vector3r&amp; extents = (static_cast&lt;Box*&gt;(gm.get()))-&gt;extents;
-	
-	Vector3r pos = lightPos-se3.position;
-	unsigned char zone=0; // bits 7 and 8 are always equal to 0
-	
-	if (pos[0]&gt;extents[0])
-		zone |= 0x01;
-	else if (pos[0]&lt;-extents[0])
-		zone |= 0x02;
-		
-	if (pos[1]&gt;extents[1])
-		zone |= 0x04;
-	else if (pos[1]&lt;-extents[1])
-		zone |= 0x08;
-		
-	if (pos[2]&gt;extents[2])
-		zone |= 0x10;
-	else if (pos[2]&lt;-extents[2])
-		zone |= 0x20;
-	
-	
-	vector&lt;Vector3r&gt; vertices;
-	
-	vertices.push_back(Vector3r(-extents[0],extents[1],extents[2]));
-	vertices.push_back(Vector3r(extents[0],extents[1],extents[2]));
-	vertices.push_back(Vector3r(extents[0],extents[1],-extents[2]));
-	vertices.push_back(Vector3r(-extents[0],extents[1],-extents[2]));
-	vertices.push_back(Vector3r(-extents[0],-extents[1],extents[2]));
-	vertices.push_back(Vector3r(extents[0],-extents[1],extents[2]));
-	vertices.push_back(Vector3r(extents[0],-extents[1],-extents[2]));
-	vertices.push_back(Vector3r(-extents[0],-extents[1],-extents[2]));
-	
-	vector&lt;int&gt; hull;
-	hull.clear();	
-	switch (zone)
-	{
-		// light is inside box
-		case 0x00 :
-		break;
-		
-		// light see one face : 
-		case 0x01 : // see right face
-			hull.push_back(2);
-			hull.push_back(3);
-			hull.push_back(7);
-			hull.push_back(6);
-		break;
-		case 0x02 : // see left face
-			hull.push_back(1);
-			hull.push_back(4);
-			hull.push_back(8);
-			hull.push_back(5);
-		break;		
-		case 0x04 : // see top face
-			hull.push_back(1);
-			hull.push_back(2);
-			hull.push_back(3);
-			hull.push_back(4);
-		break;
-		case 0x08 : // see bottom face
-			hull.push_back(5);
-			hull.push_back(6);
-			hull.push_back(7);
-			hull.push_back(8);
-		break;
-		case 0x10 : // see front face
-			hull.push_back(1);
-			hull.push_back(2);
-			hull.push_back(6);
-			hull.push_back(5);
-		break;
-		case 0x20 : // see back face
-			hull.push_back(3);
-			hull.push_back(4);
-			hull.push_back(8);
-			hull.push_back(7);
-		break;
-		
-		// light see one vertex : 
-		case 0x16 : // see vertex 1
-			hull.push_back(2);
-			hull.push_back(3);
-			hull.push_back(4);
-			hull.push_back(8);
-			hull.push_back(5);
-			hull.push_back(6);
-		break;
-		case 0x15 : // see vertex 2
-			hull.push_back(1);
-			hull.push_back(4);
-			hull.push_back(3);
-			hull.push_back(7);
-			hull.push_back(6);
-			hull.push_back(5);
-		break;
-		case 0x25 : // see vertex 3
-			hull.push_back(2);
-			hull.push_back(1);
-			hull.push_back(4);
-			hull.push_back(8);
-			hull.push_back(7);
-			hull.push_back(6);
-		break;
-		case 0x26 : // see vertex 4
-			hull.push_back(1);
-			hull.push_back(2);
-			hull.push_back(3);
-			hull.push_back(7);
-			hull.push_back(8);
-			hull.push_back(5);
-		break;
-		case 0x1c : // see vertex 5
-			hull.push_back(1);
-			hull.push_back(2);
-			hull.push_back(3);
-			hull.push_back(7);
-			hull.push_back(8);
-			hull.push_back(4);
-		break;
-		case 0x19 : // see vertex 6
-			hull.push_back(1);
-			hull.push_back(5);
-			hull.push_back(8);
-			hull.push_back(7);
-			hull.push_back(3);
-			hull.push_back(4);
-		break;
-		case 0x29 : // see vertex 7
-			hull.push_back(2);
-			hull.push_back(3);
-			hull.push_back(4);
-			hull.push_back(8);
-			hull.push_back(5);
-			hull.push_back(6);
-		break;
-		case 0x2c : // see vertex 8
-			hull.push_back(1);
-			hull.push_back(4);
-			hull.push_back(3);
-			hull.push_back(7);
-			hull.push_back(6);
-			hull.push_back(5);
-		break;
-
-		
-		// light see one edge	
-		case 0x14 : // see edge 1-2
-			hull.push_back(1);
-			hull.push_back(4);
-			hull.push_back(3);
-			hull.push_back(2);
-			hull.push_back(6);
-			hull.push_back(5);
-		break;
-		case 0x05 : // see edge 2-3
-			hull.push_back(2);
-			hull.push_back(1);
-			hull.push_back(4);
-			hull.push_back(3);
-			hull.push_back(7);
-			hull.push_back(6);
-		break;
-		case 0x24 : // see edge 3-4
-			hull.push_back(3);
-			hull.push_back(2);
-			hull.push_back(1);
-			hull.push_back(4);
-			hull.push_back(8);
-			hull.push_back(7);
-		break;
-		case 0x06 : // see edge 4-1
-			hull.push_back(2);
-			hull.push_back(1);
-			hull.push_back(5);
-			hull.push_back(8);
-			hull.push_back(4);
-			hull.push_back(3);
-		break;
-		case 0x18 : // see edge 5-6
-			hull.push_back(1);
-			hull.push_back(5);
-			hull.push_back(8);
-			hull.push_back(7);
-			hull.push_back(6);
-			hull.push_back(2);
-		break;
-		case 0x09 : // see edge 6-7
-			hull.push_back(5);
-			hull.push_back(6);
-			hull.push_back(2);
-			hull.push_back(3);
-			hull.push_back(7);
-			hull.push_back(8);
-		break;
-		case 0x28 : // see edge 7-8
-			hull.push_back(4);
-			hull.push_back(8);
-			hull.push_back(5);
-			hull.push_back(6);
-			hull.push_back(7);
-			hull.push_back(3);
-		break;
-		case 0x0a : // see edge 8-5
-			hull.push_back(4);
-			hull.push_back(8);
-			hull.push_back(7);
-			hull.push_back(6);
-			hull.push_back(5);
-			hull.push_back(1);
-		break;
-		case 0x12 : // see edge 1-5
-			hull.push_back(4);
-			hull.push_back(1);
-			hull.push_back(2);
-			hull.push_back(6);
-			hull.push_back(5);
-			hull.push_back(8);
-		break;
-		case 0x11 : // see edge 2-6
-			hull.push_back(1);
-			hull.push_back(2);
-			hull.push_back(3);
-			hull.push_back(7);
-			hull.push_back(6);
-			hull.push_back(5);
-		break;
-		case 0x21 : // see edge 3-7
-			hull.push_back(2);
-			hull.push_back(3);
-			hull.push_back(4);
-			hull.push_back(8);
-			hull.push_back(7);
-			hull.push_back(6);
-		break;
-		case 0x22 : // see edge 4-8
-			hull.push_back(1);
-			hull.push_back(4);
-			hull.push_back(3);
-			hull.push_back(7);
-			hull.push_back(8);
-			hull.push_back(5);
-		break;
-	}
-	
-	
-	
-	glPushMatrix();
-	
-	Real angle;
-	Vector3r axis;	
-	se3.orientation.ToAxisAngle(axis,angle);	
-	glTranslatef(se3.position[0],se3.position[1],se3.position[2]);
-	glRotatef(angle*Mathr::RAD_TO_DEG,axis[0],axis[1],axis[2]);	
-
-	Vector3r p1,p2;
-	glBegin(GL_QUAD_STRIP);
-		p1 = vertices[hull[0]-1];
-		p2 = p1 + (p1-pos)*10;
-		glVertex3v(p2);
-		glVertex3v(p1);
-		for(unsigned int i=1;i&lt;=hull.size();i++)
-		{
-			p1 = vertices[hull[i%hull.size()]-1];
-			p2 = p1 + (p1-pos)*10;
-			glVertex3v(p2);
-			glVertex3v(p1);
-		}
-	glEnd();
-	
-	glPopMatrix();
-}
-
-
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume/GLDrawBoxShadowVolume.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume/GLDrawBoxShadowVolume.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume/GLDrawBoxShadowVolume.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWBOXSHADOWVOLUME_HPP
-#define GLDRAWBOXSHADOWVOLUME_HPP
-
-#include &quot;GLDrawShadowVolumeFunctor.hpp&quot;
-
-class GLDrawBoxShadowVolume : public GLDrawShadowVolumeFunctor
-{
-	public : 
-		virtual void go(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Vector3r&amp;);
-
-	RENDERS(Box);
-	REGISTER_CLASS_NAME(GLDrawBoxShadowVolume);
-	REGISTER_BASE_CLASS_NAME(GLDrawShadowVolumeFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawBoxShadowVolume,false);
-
-#endif //  GLDRAWBOXSHADOWVOLUME_HPP
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume/GLDrawBoxShadowVolume.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume/GLDrawBoxShadowVolume.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume/GLDrawSphereShadowVolume.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume/GLDrawSphereShadowVolume.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume/GLDrawSphereShadowVolume.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,58 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawSphereShadowVolume.hpp&quot;
-#include &quot;Sphere.hpp&quot;
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-void GLDrawSphereShadowVolume::go(const shared_ptr&lt;GeometricalModel&gt;&amp; gm , const shared_ptr&lt;PhysicalParameters&gt;&amp; pp, const Vector3r&amp; lightPos)
-{
-	//FIXME : do not cast on RigidBodyParameters but use Parameters instead
-	//Vector3r center = (static_cast&lt;ParticleParameters*&gt;(pp.get()))-&gt;se3.position;
-	Vector3r center = pp-&gt;se3.position;
-	Real radius = (static_cast&lt;Sphere*&gt;(gm.get()))-&gt;radius;
-	
-	Vector3r dir = lightPos-center;
-	Vector3r normalDir(-dir[1],dir[0],0);
-	normalDir.Normalize();
-	normalDir *= radius;
-	Vector3r biNormalDir = normalDir.UnitCross(dir)*radius;
-	
-	int nbSegments = 15;
-	
-	Vector3r p1,p2;
-	glBegin(GL_QUAD_STRIP);
-		p1 = center+biNormalDir;
-		p2 = p1 + (p1-lightPos)*10;
-		glVertex3v(p1);
-		glVertex3v(p2);
-		for(int i=1;i&lt;=nbSegments;i++)
-		{
-			Real angle = Mathr::TWO_PI/(Real)nbSegments*i;
-			p1 = center+sin(angle)*normalDir+cos(angle)*biNormalDir;
-			p2 = p1 + (p1-lightPos)*10;
-			glVertex3v(p1);
-			glVertex3v(p2);
-		}
-	glEnd();
-			
-	// closing shadow volumes ??
-	// 	glColor3f(0,1,0);
-	// 	glBegin(GL_POLYGON);
-	// 	for(int i=0;i&lt;nbSegments;i++)
-	// 	{
-	// 		Real angle = Mathr::TWO_PI/(Real)nbSegments*i;
-	// 		p1 = center+sin(angle)*normalDir+cos(angle)*biNormalDir;
-	// 		p2 = p1 + (p1-lightPos)*2;
-	// 		glVertex3fv(p2);
-	// 	}
-	// 	glEnd();
-}
-
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume/GLDrawSphereShadowVolume.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume/GLDrawSphereShadowVolume.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume/GLDrawSphereShadowVolume.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWSPHERESHADOWVOLUME_HPP
-#define GLDRAWSPHERESHADOWVOLUME_HPP
-
-#include &quot;GLDrawShadowVolumeFunctor.hpp&quot;
-
-class GLDrawSphereShadowVolume : public GLDrawShadowVolumeFunctor
-{
-	public :
-		virtual void go(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Vector3r&amp;);
-
-	RENDERS(Sphere);
-	REGISTER_CLASS_NAME(GLDrawSphereShadowVolume);
-	REGISTER_BASE_CLASS_NAME(GLDrawShadowVolumeFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawSphereShadowVolume,false);
-
-#endif //  GLDRAWSPHERESHADOWVOLUME_HPP
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume/GLDrawSphereShadowVolume.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume/GLDrawSphereShadowVolume.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState/GLDrawParticleState.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState/GLDrawParticleState.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState/GLDrawParticleState.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,41 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawParticleState.hpp&quot;
-#include &quot;ParticleParameters.hpp&quot;
-
-
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-void GLDrawParticleState::go(const shared_ptr&lt;PhysicalParameters&gt;&amp; pp)
-{
-	ParticleParameters* p = static_cast&lt;ParticleParameters*&gt;(pp.get());
-//	FIXME: so there must be a way for *not* storing the color inside those classes like BodyBoundingVolume and BodyState
-//	       and simultaneously easy to set up the colors from the GUI according to some usful criterions:
-//	          - to which group it belongs
-//	          - to reflect some features of the drawed element
-//	          - according to some certaion selection
-//	          - etc...
-	//glColor3v(bv-&gt;diffuseColor);
-	glTranslatev(pp-&gt;se3.position);
-	
-	// FIXME - another problem with scaling of stuff to be drawn
-	//
-	//glScale(2*aabb-&gt;halfSize[0],2*aabb-&gt;halfSize[1],2*aabb-&gt;halfSize[2]);
-	glDisable(GL_LIGHTING);
-	glBegin(GL_LINES);
-		glColor3(0.6,0.6,1.0);
-		glVertex3(0.0,0.0,0.0);
-		glVertex3v(p-&gt;velocity);
-		glColor3(1.0,0.6,0.6);
-		glVertex3(0.0,0.0,0.0);
-		glVertex3v(p-&gt;acceleration);
-	glEnd();
-}
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState/GLDrawParticleState.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState/GLDrawParticleState.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState/GLDrawParticleState.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWPARTICLESTATE_HPP
-#define GLDRAWPARTICLESTATE_HPP
-
-#include &quot;GLDrawStateFunctor.hpp&quot;
-
-class GLDrawParticleState : public GLDrawStateFunctor
-{
-	public :
-		virtual void go(const shared_ptr&lt;PhysicalParameters&gt;&amp;); // should be: BodyState
-
-	RENDERS(ParticleParameters); // should be: ParticleState
-	REGISTER_CLASS_NAME(GLDrawParticleState);
-	REGISTER_BASE_CLASS_NAME(GLDrawStateFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawParticleState,false);
-
-#endif //  GLDRAWPARTICLESTATE_HPP
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState/GLDrawParticleState.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawParticleState/GLDrawParticleState.hpp)

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState/GLDrawRigidBodyState.cpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState/GLDrawRigidBodyState.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState/GLDrawRigidBodyState.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,50 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GLDrawRigidBodyState.hpp&quot;
-#include &quot;GLDrawParticleState.hpp&quot;
-#include &quot;RigidBodyParameters.hpp&quot;
-
-
-#include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
-
-
-void GLDrawRigidBodyState::go(const shared_ptr&lt;PhysicalParameters&gt;&amp; bst)
-{
-	// drawing RigidBodyState involves drawing ParticleState too
-	// FIXME - is this a correct place for doing that?
-	glPushMatrix();
-	GLDrawParticleState g;
-	g.go(bst);
-	glPopMatrix();
-
-	RigidBodyParameters * rb = static_cast&lt;RigidBodyParameters*&gt;(bst.get());
-//	FIXME: so there must be a way for *not* storing the color inside those classes like BodyBoundingVolume and BodyState
-//	       and simultaneously easy to set up the colors from the GUI according to some usful criterions:
-//	          - to which group it belongs
-//	          - to reflect some features of the drawed element
-//	          - according to some certaion selection
-//	          - etc...
-//	glColor3v(bst-&gt;diffuseColor);
-	glTranslatev(bst-&gt;se3.position);
-
-	// FIXME - another problem with scaling of stuff to be drawn
-	//
-	//glScale(2*aabb-&gt;halfSize[0],2*aabb-&gt;halfSize[1],2*aabb-&gt;halfSize[2]);
-	
-	glDisable(GL_LIGHTING);
-	glBegin(GL_LINES);
-		glColor3(0.0,0.0,1.0);
-		glVertex3(0.0,0.0,0.0);
-		glVertex3v(rb-&gt;angularVelocity);
-		glColor3(1.0,0.0,0.0);
-		glVertex3(0.0,0.0,0.0);
-		glVertex3v(rb-&gt;angularAcceleration);
-	glEnd();
-}
-

Deleted: branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState/GLDrawRigidBodyState.hpp
===================================================================
--- branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState/GLDrawRigidBodyState.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState/GLDrawRigidBodyState.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLDRAWRIGIDBODYSTATE_HPP
-#define GLDRAWRIGIDBODYSTATE_HPP
-
-#include &quot;GLDrawStateFunctor.hpp&quot;
-
-class GLDrawRigidBodyState : public GLDrawStateFunctor
-{
-	public :
-		virtual void go(const shared_ptr&lt;PhysicalParameters&gt;&amp;/*, draw parameters: color, scale, given from OpenGLRenderer, or sth.... */); // should be: BodyState
-
-	RENDERS(RigidBodyParameters); // should be: RigidBodyState
-	REGISTER_CLASS_NAME(GLDrawRigidBodyState);
-	REGISTER_BASE_CLASS_NAME(GLDrawStateFunctor);
-};
-
-REGISTER_SERIALIZABLE(GLDrawRigidBodyState,false);
-
-#endif //  GLDRAWAABB_HPP
-

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState.cpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState/GLDrawRigidBodyState.cpp)

Copied: branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState.hpp (from rev 1105, branches/scons-layout/pkg/common/RenderingEngine/GLDrawState/GLDrawRigidBodyState/GLDrawRigidBodyState.hpp)

Modified: branches/scons-layout/pkg/common/SConscript
===================================================================
--- branches/scons-layout/pkg/common/SConscript	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/common/SConscript	2007-03-07 14:13:16 UTC (rev 1107)
@@ -2,77 +2,77 @@
 env.Install('$PREFIX/lib/yade$POSTFIX/pkg-common',[
 
 	env.SharedLibrary('BodyAssocVector',
-		['Container/BodyContainer/BodyAssocVector/BodyAssocVector.cpp',
-			'Container/BodyContainer/BodyAssocVector/BodyAssocVectorIterator.cpp'],
+		['Container/BodyAssocVector.cpp',
+			'Container/BodyAssocVectorIterator.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Container/BodyContainer/BodyAssocVector']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Container']),
 
 	env.SharedLibrary('BodyRedirectionVector',
-		['Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVector.cpp',
-			'Container/BodyContainer/BodyRedirectionVector/BodyRedirectionVectorIterator.cpp'],
+		['Container/BodyRedirectionVector.cpp',
+			'Container/BodyRedirectionVectorIterator.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Container/BodyContainer/BodyRedirectionVector']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Container']),
 
 	env.SharedLibrary('InteractionHashMap',
-		['Container/InteractionContainer/InteractionHashMap/InteractionHashMap.cpp',
-			'Container/InteractionContainer/InteractionHashMap/InteractionHashMapIterator.cpp'],
+		['Container/InteractionHashMap.cpp',
+			'Container/InteractionHashMapIterator.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['Container/InteractionContainer/InteractionHashMap', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['Container', '$PREFIX/include']),
 
 	env.SharedLibrary('InteractionVecSet',
-		['Container/InteractionContainer/InteractionVecSet/InteractionVecSet.cpp',
-			'Container/InteractionContainer/InteractionVecSet/InteractionVecSetIterator.cpp'],
+		['Container/InteractionVecSet.cpp',
+			'Container/InteractionVecSetIterator.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Container/InteractionContainer/InteractionVecSet']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Container']),
 
 	env.SharedLibrary('PhysicalActionVectorVector',
-		['Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVector.cpp',
-			'Container/PhysicalActionContainer/PhysicalActionVectorVector/PhysicalActionVectorVectorIterator.cpp'],
+		['Container/PhysicalActionVectorVector.cpp',
+			'Container/PhysicalActionVectorVectorIterator.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Container/PhysicalActionContainer/PhysicalActionVectorVector']),
+			'Container']),
 
 	env.SharedLibrary('AABB',
-		['DataClass/BoundingVolume/AABB/AABB.cpp'],
+		['DataClass/BoundingVolume/AABB.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-serialization',
 			'yade-base',
 			'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['DataClass/BoundingVolume/AABB', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['DataClass/BoundingVolume', '$PREFIX/include']),
 
 	env.SharedLibrary('BoundingSphere',
-		['DataClass/BoundingVolume/BoundingSphere/BoundingSphere.cpp'],
+		['DataClass/BoundingVolume/BoundingSphere.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-serialization',
 			'yade-base',
 			'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/BoundingVolume/BoundingSphere']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/BoundingVolume']),
 
 	env.SharedLibrary('InteractingBox',
-		['DataClass/InteractingGeometry/InteractingBox/InteractingBox.cpp'],
+		['DataClass/InteractingGeometry/InteractingBox.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractingGeometry/InteractingBox']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractingGeometry']),
 
 	env.SharedLibrary('InteractingSphere',
-		['DataClass/InteractingGeometry/InteractingSphere/InteractingSphere.cpp'],
+		['DataClass/InteractingGeometry/InteractingSphere.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractingGeometry/InteractingSphere']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractingGeometry']),
 
 	env.SharedLibrary('MetaInteractingGeometry',
-		['DataClass/InteractingGeometry/MetaInteractingGeometry/MetaInteractingGeometry.cpp'],
+		['DataClass/InteractingGeometry/MetaInteractingGeometry.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractingGeometry/MetaInteractingGeometry']),
+			'DataClass/InteractingGeometry']),
 
 	env.SharedLibrary('ParticleParameters',
-		['DataClass/PhysicalParameters/ParticleParameters/ParticleParameters.cpp'],
+		['DataClass/PhysicalParameters/ParticleParameters.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/ParticleParameters', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters', '$PREFIX/include']),
 
 	env.SharedLibrary('RigidBodyParameters',
-		['DataClass/PhysicalParameters/RigidBodyParameters/RigidBodyParameters.cpp'],
+		['DataClass/PhysicalParameters/RigidBodyParameters.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'ParticleParameters',
@@ -80,12 +80,12 @@
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/RigidBodyParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'DataClass/PhysicalParameters/ParticleParameters']),
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('ElasticBodyParameters',
-		['DataClass/PhysicalParameters/ElasticBodyParameters/ElasticBodyParameters.cpp'],
+		['DataClass/PhysicalParameters/ElasticBodyParameters.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'RigidBodyParameters',
@@ -94,93 +94,93 @@
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/ParticleParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'DataClass/PhysicalParameters/ElasticBodyParameters',
-			'DataClass/PhysicalParameters/RigidBodyParameters']),
+			'DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('ClosestFeatures',
-		['DataClass/InteractionGeometry/ClosestFeatures/ClosestFeatures.cpp'],
+		['DataClass/InteractionGeometry/ClosestFeatures.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-serialization',
 			'yade-base',
 			'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionGeometry/ClosestFeatures']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('SimpleElasticInteraction',
-		['DataClass/InteractionPhysics/SimpleElasticInteraction/SimpleElasticInteraction.cpp'],
+		['DataClass/InteractionPhysics/SimpleElasticInteraction.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/SimpleElasticInteraction']),
+			'DataClass/InteractionPhysics']),
 
 	env.SharedLibrary('Force',
-		['DataClass/PhysicalAction/Force/Force.cpp'],
+		['DataClass/PhysicalAction/Force.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalAction/Force', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalAction', '$PREFIX/include']),
 
 	env.SharedLibrary('Momentum',
-		['DataClass/PhysicalAction/Momentum/Momentum.cpp'],
+		['DataClass/PhysicalAction/Momentum.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalAction/Momentum', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalAction', '$PREFIX/include']),
 
 	env.SharedLibrary('Box',
-		['DataClass/GeometricalModel/Box/Box.cpp'],
+		['DataClass/GeometricalModel/Box.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel/Box']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('Mesh2D',
-		['DataClass/GeometricalModel/Mesh2D/Mesh2D.cpp'],
+		['DataClass/GeometricalModel/Mesh2D.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods',
 			'yade-serialization'],
-		CPPPATH=env['CPPPATH']+['DataClass/GeometricalModel/Mesh2D', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['DataClass/GeometricalModel', '$PREFIX/include']),
 
 	env.SharedLibrary('Sphere',
-		['DataClass/GeometricalModel/Sphere/Sphere.cpp'],
+		['DataClass/GeometricalModel/Sphere.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods',
 			'yade-serialization'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel/Sphere']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('Tetrahedron',
-		['DataClass/GeometricalModel/Tetrahedron/Tetrahedron.cpp'],
+		['DataClass/GeometricalModel/Tetrahedron.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel/Tetrahedron']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('Quadrilateral',
-		['DataClass/GeometricalModel/Quadrilateral/Quadrilateral.cpp'],
+		['DataClass/GeometricalModel/Quadrilateral.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel/Quadrilateral']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('ForceEngine',
-		['Engine/DeusExMachina/ForceEngine/ForceEngine.cpp'],
+		['Engine/DeusExMachina/ForceEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'Force', 'ParticleParameters'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/ParticleParameters',
-			'Engine/DeusExMachina/ForceEngine',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
+			'Engine/DeusExMachina',
 			'$PREFIX/include',
-			'DataClass/PhysicalAction/Force']),
+			'DataClass/PhysicalAction']),
 
 	env.SharedLibrary('GravityEngine',
-		['Engine/DeusExMachina/GravityEngine/GravityEngine.cpp'],
+		['Engine/DeusExMachina/GravityEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'Force', 'ParticleParameters'],
-		CPPPATH=env['CPPPATH']+['Engine/DeusExMachina/GravityEngine',
-			'DataClass/PhysicalAction/Force',
+		CPPPATH=env['CPPPATH']+['Engine/DeusExMachina',
+			'DataClass/PhysicalAction',
 			'$PREFIX/include',
-			'DataClass/PhysicalParameters/ParticleParameters']),
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('RotationEngine',
-		['Engine/DeusExMachina/RotationEngine/RotationEngine.cpp'],
+		['Engine/DeusExMachina/RotationEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'ParticleParameters',
@@ -189,13 +189,13 @@
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['Engine/DeusExMachina/RotationEngine',
+		CPPPATH=env['CPPPATH']+['Engine/DeusExMachina',
 			'$PREFIX/include',
-			'DataClass/PhysicalParameters/RigidBodyParameters',
-			'DataClass/PhysicalParameters/ParticleParameters']),
+			'DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('TranslationEngine',
-		['Engine/DeusExMachina/TranslationEngine/TranslationEngine.cpp'],
+		['Engine/DeusExMachina/TranslationEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'ParticleParameters',
@@ -204,12 +204,12 @@
 			'Wm3Foundation',
 			'yade-serialization',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/ParticleParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'Engine/DeusExMachina/TranslationEngine']),
+			'Engine/DeusExMachina']),
 
 	env.SharedLibrary('DisplacementEngine',
-		['Engine/DeusExMachina/DisplacementEngine/DisplacementEngine.cpp'],
+		['Engine/DeusExMachina/DisplacementEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-factory',
@@ -217,50 +217,50 @@
 			'Wm3Foundation',
 			'yade-serialization',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/DeusExMachina/DisplacementEngine']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/DeusExMachina']),
 
 	env.SharedLibrary('BoundingVolumeMetaEngine',
-		['Engine/MetaEngine/BoundingVolumeMetaEngine/BoundingVolumeMetaEngine.cpp'],
+		['Engine/MetaEngine/BoundingVolumeMetaEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine/BoundingVolumeMetaEngine']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine']),
 
 	env.SharedLibrary('GeometricalModelMetaEngine',
-		['Engine/MetaEngine/GeometricalModelMetaEngine/GeometricalModelMetaEngine.cpp'],
+		['Engine/MetaEngine/GeometricalModelMetaEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine/GeometricalModelMetaEngine']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine']),
 
 	env.SharedLibrary('InteractingGeometryMetaEngine',
-		['Engine/MetaEngine/InteractingGeometryMetaEngine/InteractingGeometryMetaEngine.cpp'],
+		['Engine/MetaEngine/InteractingGeometryMetaEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine/InteractingGeometryMetaEngine']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine']),
 
 	env.SharedLibrary('PhysicalParametersMetaEngine',
-		['Engine/MetaEngine/PhysicalParametersMetaEngine/PhysicalParametersMetaEngine.cpp'],
+		['Engine/MetaEngine/PhysicalParametersMetaEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine/PhysicalParametersMetaEngine']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine']),
 
 	env.SharedLibrary('InteractionGeometryMetaEngine',
-		['Engine/MetaEngine/InteractionGeometryMetaEngine/InteractionGeometryMetaEngine.cpp'],
+		['Engine/MetaEngine/InteractionGeometryMetaEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['Engine/MetaEngine/InteractionGeometryMetaEngine', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['Engine/MetaEngine', '$PREFIX/include']),
 
 	env.SharedLibrary('InteractionPhysicsMetaEngine',
-		['Engine/MetaEngine/InteractionPhysicsMetaEngine/InteractionPhysicsMetaEngine.cpp'],
+		['Engine/MetaEngine/InteractionPhysicsMetaEngine.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine/InteractionPhysicsMetaEngine']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine']),
 
 	env.SharedLibrary('PhysicalActionApplier',
-		['Engine/MetaEngine/PhysicalActionApplier/PhysicalActionApplier.cpp'],
+		['Engine/MetaEngine/PhysicalActionApplier.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine/PhysicalActionApplier']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine']),
 
 	env.SharedLibrary('PhysicalActionDamper',
-		['Engine/MetaEngine/PhysicalActionDamper/PhysicalActionDamper.cpp'],
+		['Engine/MetaEngine/PhysicalActionDamper.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine/PhysicalActionDamper']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/MetaEngine']),
 
 	env.SharedLibrary('InteractingBox2AABB',
-		['Engine/EngineUnit/InteractingBox2AABB/InteractingBox2AABB.cpp'],
+		['Engine/EngineUnit/InteractingBox2AABB.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'BoundingVolumeMetaEngine',
@@ -270,52 +270,52 @@
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['DataClass/BoundingVolume/AABB',
-			'DataClass/InteractingGeometry/InteractingBox',
+		CPPPATH=env['CPPPATH']+['DataClass/BoundingVolume',
+			'DataClass/InteractingGeometry',
 			'$PREFIX/include',
-			'Engine/MetaEngine/BoundingVolumeMetaEngine',
-			'Engine/EngineUnit/InteractingBox2AABB']),
+			'Engine/MetaEngine',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('MetaInteractingGeometry2AABB',
-		['Engine/EngineUnit/MetaInteractingGeometry2AABB/MetaInteractingGeometry2AABB.cpp'],
+		['Engine/EngineUnit/MetaInteractingGeometry2AABB.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'BoundingVolumeMetaEngine',
 			'MetaInteractingGeometry',
 			'AABB'],
-		CPPPATH=env['CPPPATH']+['DataClass/BoundingVolume/AABB',
+		CPPPATH=env['CPPPATH']+['DataClass/BoundingVolume',
 			'$PREFIX/include',
-			'DataClass/InteractingGeometry/MetaInteractingGeometry',
-			'Engine/MetaEngine/BoundingVolumeMetaEngine',
-			'Engine/EngineUnit/MetaInteractingGeometry2AABB']),
+			'DataClass/InteractingGeometry',
+			'Engine/MetaEngine',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('LeapFrogOrientationIntegrator',
-		['Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.cpp'],
+		['Engine/EngineUnit/LeapFrogOrientationIntegrator.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'PhysicalParametersMetaEngine',
 			'ParticleParameters',
 			'RigidBodyParameters'],
-		CPPPATH=env['CPPPATH']+['Engine/EngineUnit/LeapFrogOrientationIntegrator',
+		CPPPATH=env['CPPPATH']+['Engine/EngineUnit',
 			'$PREFIX/include',
-			'DataClass/PhysicalParameters/RigidBodyParameters',
-			'Engine/MetaEngine/PhysicalParametersMetaEngine',
-			'DataClass/PhysicalParameters/ParticleParameters']),
+			'DataClass/PhysicalParameters',
+			'Engine/MetaEngine',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('LeapFrogPositionIntegrator',
-		['Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.cpp'],
+		['Engine/EngineUnit/LeapFrogPositionIntegrator.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'PhysicalParametersMetaEngine',
 			'ParticleParameters',
 			'RigidBodyParameters'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/ParticleParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'Engine/MetaEngine/PhysicalParametersMetaEngine',
-			'Engine/EngineUnit/LeapFrogPositionIntegrator']),
+			'Engine/MetaEngine',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('NewtonsForceLaw',
-		['Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.cpp'],
+		['Engine/EngineUnit/NewtonsForceLaw.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'PhysicalActionApplier',
@@ -324,14 +324,14 @@
 			'PhysicalActionApplier',
 			'RigidBodyParameters'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/PhysicalParameters/RigidBodyParameters',
-			'Engine/MetaEngine/PhysicalActionApplier',
-			'DataClass/PhysicalAction/Force',
-			'Engine/EngineUnit/NewtonsForceLaw',
-			'DataClass/PhysicalParameters/ParticleParameters']),
+			'DataClass/PhysicalParameters',
+			'Engine/MetaEngine',
+			'DataClass/PhysicalAction',
+			'Engine/EngineUnit',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('NewtonsMomentumLaw',
-		['Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.cpp'],
+		['Engine/EngineUnit/NewtonsMomentumLaw.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'PhysicalActionApplier',
@@ -339,14 +339,14 @@
 			'RigidBodyParameters',
 			'PhysicalActionApplier'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/PhysicalParameters/RigidBodyParameters',
-			'Engine/EngineUnit/NewtonsMomentumLaw',
-			'Engine/MetaEngine/PhysicalActionApplier',
-			'DataClass/PhysicalAction/Momentum',
-			'DataClass/PhysicalParameters/ParticleParameters']),
+			'DataClass/PhysicalParameters',
+			'Engine/EngineUnit',
+			'Engine/MetaEngine',
+			'DataClass/PhysicalAction',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('InteractingSphere2AABB',
-		['Engine/EngineUnit/InteractingSphere2AABB/InteractingSphere2AABB.cpp'],
+		['Engine/EngineUnit/InteractingSphere2AABB.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'BoundingVolumeMetaEngine',
@@ -354,41 +354,41 @@
 			'AABB',
 			'yade-base',
 			'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['DataClass/BoundingVolume/AABB',
+		CPPPATH=env['CPPPATH']+['DataClass/BoundingVolume',
 			'$PREFIX/include',
-			'Engine/MetaEngine/BoundingVolumeMetaEngine',
-			'Engine/EngineUnit/InteractingSphere2AABB',
-			'DataClass/InteractingGeometry/InteractingSphere']),
+			'Engine/MetaEngine',
+			'Engine/EngineUnit',
+			'DataClass/InteractingGeometry']),
 
 	env.SharedLibrary('CundallNonViscousForceDamping',
-		['Engine/EngineUnit/CundallNonViscousForceDamping/CundallNonViscousForceDamping.cpp'],
+		['Engine/EngineUnit/CundallNonViscousForceDamping.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'PhysicalActionDamper',
 			'Force',
 			'ParticleParameters'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/ParticleParameters',
-			'Engine/EngineUnit/CundallNonViscousForceDamping',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
+			'Engine/EngineUnit',
 			'$PREFIX/include',
-			'Engine/MetaEngine/PhysicalActionDamper',
-			'DataClass/PhysicalAction/Force']),
+			'Engine/MetaEngine',
+			'DataClass/PhysicalAction']),
 
 	env.SharedLibrary('CundallNonViscousMomentumDamping',
-		['Engine/EngineUnit/CundallNonViscousMomentumDamping/CundallNonViscousMomentumDamping.cpp'],
+		['Engine/EngineUnit/CundallNonViscousMomentumDamping.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'PhysicalActionDamper',
 			'Momentum',
 			'RigidBodyParameters'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/PhysicalParameters/RigidBodyParameters',
-			'Engine/EngineUnit/CundallNonViscousMomentumDamping',
-			'DataClass/PhysicalParameters/ParticleParameters',
-			'DataClass/PhysicalAction/Momentum',
-			'Engine/MetaEngine/PhysicalActionDamper']),
+			'DataClass/PhysicalParameters',
+			'Engine/EngineUnit',
+			'DataClass/PhysicalParameters',
+			'DataClass/PhysicalAction',
+			'Engine/MetaEngine']),
 
 	env.SharedLibrary('ElasticBodySimpleRelationship',
-		['Engine/EngineUnit/ElasticBodySimpleRelationship/ElasticBodySimpleRelationship.cpp'],
+		['Engine/EngineUnit/ElasticBodySimpleRelationship.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'ElasticBodyParameters',
@@ -397,122 +397,122 @@
 			'ParticleParameters',
 			'InteractionPhysicsMetaEngine'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/PhysicalParameters/RigidBodyParameters',
-			'DataClass/InteractionPhysics/SimpleElasticInteraction',
-			'Engine/MetaEngine/InteractionPhysicsMetaEngine',
-			'DataClass/PhysicalParameters/ElasticBodyParameters',
-			'Engine/EngineUnit/ElasticBodySimpleRelationship',
-			'DataClass/PhysicalParameters/ParticleParameters']),
+			'DataClass/PhysicalParameters',
+			'DataClass/InteractionPhysics',
+			'Engine/MetaEngine',
+			'DataClass/PhysicalParameters',
+			'Engine/EngineUnit',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('PersistentSAPCollider',
-		['Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.cpp'],
+		['Engine/StandAloneEngine/PersistentSAPCollider.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine/PersistentSAPCollider', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine', '$PREFIX/include']),
 
 	env.SharedLibrary('SAPCollider',
-		['Engine/StandAloneEngine/SAPCollider/SAPCollider.cpp'],
+		['Engine/StandAloneEngine/SAPCollider.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-serialization',
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/StandAloneEngine/SAPCollider']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('PhysicalActionContainerInitializer',
-		['Engine/StandAloneEngine/PhysicalActionContainerInitializer/PhysicalActionContainerInitializer.cpp'],
+		['Engine/StandAloneEngine/PhysicalActionContainerInitializer.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine/PhysicalActionContainerInitializer',
+		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine',
 			'$PREFIX/include']),
 
 	env.SharedLibrary('PhysicalActionContainerReseter',
-		['Engine/StandAloneEngine/PhysicalActionContainerReseter/PhysicalActionContainerReseter.cpp'],
+		['Engine/StandAloneEngine/PhysicalActionContainerReseter.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Engine/StandAloneEngine/PhysicalActionContainerReseter']),
+			'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('GLDrawAABB',
-		['RenderingEngine/GLDrawBoundingVolume/GLDrawAABB/GLDrawAABB.cpp'],
+		['RenderingEngine/GLDrawBoundingVolume/GLDrawAABB.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'AABB', 'yade-opengl'],
-		CPPPATH=env['CPPPATH']+['DataClass/BoundingVolume/AABB',
+		CPPPATH=env['CPPPATH']+['DataClass/BoundingVolume',
 			'$PREFIX/include',
 			'RenderingEngine/OpenGLRenderingEngine',
-			'RenderingEngine/GLDrawBoundingVolume/GLDrawAABB']),
+			'RenderingEngine/GLDrawBoundingVolume']),
 
 	env.SharedLibrary('GLDrawBoundingSphere',
-		['RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere/GLDrawBoundingSphere.cpp'],
+		['RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'BoundingSphere', 'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
 			'RenderingEngine/OpenGLRenderingEngine',
-			'RenderingEngine/GLDrawBoundingVolume/GLDrawBoundingSphere',
-			'DataClass/BoundingVolume/BoundingSphere']),
+			'RenderingEngine/GLDrawBoundingVolume',
+			'DataClass/BoundingVolume']),
 
 	env.SharedLibrary('GLDrawTetrahedron',
-		['RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron/GLDrawTetrahedron.cpp'],
+		['RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'Tetrahedron', 'yade-opengl'],
-		CPPPATH=env['CPPPATH']+['RenderingEngine/GLDrawGeometricalModel/GLDrawTetrahedron',
+		CPPPATH=env['CPPPATH']+['RenderingEngine/GLDrawGeometricalModel',
 			'$PREFIX/include',
 			'RenderingEngine/OpenGLRenderingEngine',
-			'DataClass/GeometricalModel/Tetrahedron']),
+			'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('GLDrawBox',
-		['RenderingEngine/GLDrawGeometricalModel/GLDrawBox/GLDrawBox.cpp'],
+		['RenderingEngine/GLDrawGeometricalModel/GLDrawBox.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'Box', 'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'RenderingEngine/GLDrawGeometricalModel/GLDrawBox',
+			'RenderingEngine/GLDrawGeometricalModel',
 			'RenderingEngine/OpenGLRenderingEngine',
-			'DataClass/GeometricalModel/Box']),
+			'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('GLDrawMesh2D',
-		['RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D/GLDrawMesh2D.cpp'],
+		['RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'Mesh2D', 'yade-opengl'],
-		CPPPATH=env['CPPPATH']+['DataClass/GeometricalModel/Mesh2D',
+		CPPPATH=env['CPPPATH']+['DataClass/GeometricalModel',
 			'$PREFIX/include',
 			'RenderingEngine/OpenGLRenderingEngine',
-			'RenderingEngine/GLDrawGeometricalModel/GLDrawMesh2D']),
+			'RenderingEngine/GLDrawGeometricalModel']),
 
 	env.SharedLibrary('GLDrawSphere',
-		['RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp'],
+		['RenderingEngine/GLDrawGeometricalModel/GLDrawSphere.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'Sphere', 'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['RenderingEngine/OpenGLRenderingEngine',
 			'$PREFIX/include',
-			'RenderingEngine/GLDrawGeometricalModel/GLDrawSphere',
-			'DataClass/GeometricalModel/Sphere']),
+			'RenderingEngine/GLDrawGeometricalModel',
+			'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('GLDrawQuadrilateral',
-		['RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral/GLDrawQuadrilateral.cpp'],
+		['RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'Quadrilateral', 'yade-opengl'],
-		CPPPATH=env['CPPPATH']+['RenderingEngine/GLDrawGeometricalModel/GLDrawQuadrilateral',
+		CPPPATH=env['CPPPATH']+['RenderingEngine/GLDrawGeometricalModel',
 			'$PREFIX/include',
-			'DataClass/GeometricalModel/Quadrilateral',
+			'DataClass/GeometricalModel',
 			'RenderingEngine/OpenGLRenderingEngine']),
 
 	env.SharedLibrary('GLDrawInteractingBox',
-		['RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.cpp'],
+		['RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'InteractingBox', 'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
 			'RenderingEngine/OpenGLRenderingEngine',
-			'DataClass/InteractingGeometry/InteractingBox',
-			'RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox']),
+			'DataClass/InteractingGeometry',
+			'RenderingEngine/GLDrawInteractingGeometry']),
 
 	env.SharedLibrary('GLDrawInteractingSphere',
-		['RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.cpp'],
+		['RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'InteractingSphere', 'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractingGeometry/InteractingSphere',
+			'DataClass/InteractingGeometry',
 			'RenderingEngine/OpenGLRenderingEngine',
-			'RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere']),
+			'RenderingEngine/GLDrawInteractingGeometry']),
 
 	env.SharedLibrary('GLDrawMetaInteractingGeometry',
-		['RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.cpp'],
+		['RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractingGeometry/MetaInteractingGeometry',
+			'DataClass/InteractingGeometry',
 			'RenderingEngine/OpenGLRenderingEngine',
-			'RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry']),
+			'RenderingEngine/GLDrawInteractingGeometry']),
 
 	env.SharedLibrary('GLDrawBoxShadowVolume',
-		['RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume/GLDrawBoxShadowVolume.cpp'],
+		['RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'Box',
@@ -521,50 +521,50 @@
 			'RigidBodyParameters'],
 		CPPPATH=env['CPPPATH']+['RenderingEngine/OpenGLRenderingEngine',
 			'$PREFIX/include',
-			'RenderingEngine/GLDrawShadowVolume/GLDrawBoxShadowVolume',
-			'DataClass/GeometricalModel/Box']),
+			'RenderingEngine/GLDrawShadowVolume',
+			'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('GLDrawSphereShadowVolume',
-		['RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume/GLDrawSphereShadowVolume.cpp'],
+		['RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'Sphere',
 			'ParticleParameters',
 			'yade-opengl'],
-		CPPPATH=env['CPPPATH']+['RenderingEngine/GLDrawShadowVolume/GLDrawSphereShadowVolume',
+		CPPPATH=env['CPPPATH']+['RenderingEngine/GLDrawShadowVolume',
 			'$PREFIX/include',
 			'RenderingEngine/OpenGLRenderingEngine',
-			'DataClass/GeometricalModel/Sphere']),
+			'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('GLDrawClosestFeatures',
-		['RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures/GLDrawClosestFeatures.cpp'],
+		['RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'ClosestFeatures', 'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
 			'RenderingEngine/OpenGLRenderingEngine',
-			'DataClass/InteractionGeometry/ClosestFeatures',
-			'RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures']),
+			'DataClass/InteractionGeometry',
+			'RenderingEngine/GLDrawInteractionGeometry']),
 
 	env.SharedLibrary('GLDrawSimpleElasticInteraction',
-		['RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction/GLDrawSimpleElasticInteraction.cpp'],
+		['RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'SimpleElasticInteraction',
 			'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['RenderingEngine/OpenGLRenderingEngine',
 			'$PREFIX/include',
-			'DataClass/InteractionPhysics/SimpleElasticInteraction',
-			'RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction']),
+			'DataClass/InteractionPhysics',
+			'RenderingEngine/GLDrawInteractionPhysics']),
 
 	env.SharedLibrary('GLDrawParticleState',
-		['RenderingEngine/GLDrawState/GLDrawParticleState/GLDrawParticleState.cpp'],
+		['RenderingEngine/GLDrawState/GLDrawParticleState.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'ParticleParameters', 'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['RenderingEngine/OpenGLRenderingEngine',
-			'DataClass/PhysicalParameters/ParticleParameters',
+			'DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'RenderingEngine/GLDrawState/GLDrawParticleState']),
+			'RenderingEngine/GLDrawState']),
 
 	env.SharedLibrary('GLDrawRigidBodyState',
-		['RenderingEngine/GLDrawState/GLDrawRigidBodyState/GLDrawRigidBodyState.cpp'],
+		['RenderingEngine/GLDrawState/GLDrawRigidBodyState.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'ParticleParameters',
@@ -572,11 +572,11 @@
 			'GLDrawParticleState',
 			'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'RenderingEngine/GLDrawState/GLDrawRigidBodyState',
-			'DataClass/PhysicalParameters/RigidBodyParameters',
-			'RenderingEngine/GLDrawState/GLDrawParticleState',
+			'RenderingEngine/GLDrawState',
+			'DataClass/PhysicalParameters',
+			'RenderingEngine/GLDrawState',
 			'RenderingEngine/OpenGLRenderingEngine',
-			'DataClass/PhysicalParameters/ParticleParameters']),
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('OpenGLRenderingEngine',
 		['RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp'],

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron/InteractingMyTetrahedron.cpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron/InteractingMyTetrahedron.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron/InteractingMyTetrahedron.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,34 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingMyTetrahedron.hpp&quot;
-
-InteractingMyTetrahedron::InteractingMyTetrahedron () : InteractingGeometry()
-{
-	createIndex();
-	c1=c2=c3=c4=Vector3r(0,0,0);
-	r1=r2=r3=r4=0;
-}
-
-InteractingMyTetrahedron::~InteractingMyTetrahedron ()
-{
-}
-
-void InteractingMyTetrahedron::registerAttributes()
-{
-	InteractingGeometry::registerAttributes();
-	REGISTER_ATTRIBUTE(c1);
-	REGISTER_ATTRIBUTE(c2);
-	REGISTER_ATTRIBUTE(c3);
-	REGISTER_ATTRIBUTE(c4);
-	REGISTER_ATTRIBUTE(r1);
-	REGISTER_ATTRIBUTE(r2);
-	REGISTER_ATTRIBUTE(r3);
-	REGISTER_ATTRIBUTE(r4);
-}
-
-

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron/InteractingMyTetrahedron.hpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron/InteractingMyTetrahedron.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron/InteractingMyTetrahedron.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,61 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTING_MY_TETRAHEDRON_HPP
-#define INTERACTING_MY_TETRAHEDRON_HPP
-
-#include&lt;yade/core/InteractingGeometry.hpp&gt;
-#include &lt;Wm3Math.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-/*! 
- * \brief This class stores an information about geometry for tetrahedron which
- * is used for calculation of interactions between other bodies's
- * InteractingGeometry.
- *
- * In this particular representation, the tertahedron is represented as four spheres
- * where each sphere is created using following method:
- *  - each sphere's center is a midpoint between the tetrahedron's node and tetrahedron's center
- *  - each sphere's radius is equal to the distance from this midpoint to the tetrahedron's center (and node)
- *
- *  
- *  Vaclav: you are supposed to change this class completely according to your
- *  decision, how you want to calculate interactions between objects. You may
- *  as well want to use just a Tetrahedron (four node's coordinates). In that
- *  case this class will be a mere duplication of class Tetrahedron
- *
- *  Spheres are just simpler so I prepared this example for you, using sphres.
- *  If you want to calculate forces between true tetrahedrons (not four
- *  spheres), then you can do that :)
- *
- *  When changing this class remember to update .cpp as well ;)
- *
-*/
-
-class InteractingMyTetrahedron : public InteractingGeometry
-{
-	public :
-		Real		r1,r2,r3,r4; // radius of four spheres
-		Vector3r	c1,c2,c3,c4; // centers of four spheres, relative to this Tetrahedron's center (physicalParameters-&gt;se3.position)
-
-		InteractingMyTetrahedron ();
-		virtual ~InteractingMyTetrahedron ();
-
-/// Serialization
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(InteractingMyTetrahedron);
-	REGISTER_BASE_CLASS_NAME(InteractingGeometry);
-
-/// Indexable
-	REGISTER_CLASS_INDEX(InteractingMyTetrahedron,InteractingGeometry);
-};
-
-REGISTER_SERIALIZABLE(InteractingMyTetrahedron,false);
-
-#endif // INTERACTING_MY_TETRAHEDRON_HPP
-

Copied: branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron.cpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron/InteractingMyTetrahedron.cpp)

Copied: branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron.hpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractingGeometry/InteractingMyTetrahedron/InteractingMyTetrahedron.hpp)

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron/InteractionOfMyTetrahedron.cpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron/InteractionOfMyTetrahedron.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron/InteractionOfMyTetrahedron.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,20 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractionOfMyTetrahedron.hpp&quot;
-
-
-InteractionOfMyTetrahedron::InteractionOfMyTetrahedron() : InteractionGeometry()
-{
-	createIndex();
-}
-
-
-InteractionOfMyTetrahedron::~InteractionOfMyTetrahedron ()
-{
-}
-

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron/InteractionOfMyTetrahedron.hpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron/InteractionOfMyTetrahedron.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron/InteractionOfMyTetrahedron.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,85 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTIONOFMYTETRAHEDRON_HPP
-#define INTERACTIONOFMYTETRAHEDRON_HPP
-
-#include &lt;vector&gt;
-
-#include&lt;yade/core/InteractionGeometry.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-/*! 
- * \brief This class stores an information about current collision/interaction of two bodies
- * that can talk with the InteractingMyTetrahedron.
- *
- * &quot;can talk&quot; means that an EngineUnit is written for this pair of bodies, in this example I have written:
- *
- * InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron
- * InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron
- *
- * Following table shows currently plssible interactions:
- *
- *                           |  InteractingMyTetrahedron   InteractingBox   InteractingSphere
- * --------------------------+----------------------------------------------------------
- * InteractingMyTetrahedron  |             +                     +                 -
- * InteractingBox            |             +                     -                 -
- * InteractingSphere         |             -                     -                 -
- *
- * 
- * If you will write class
- *
- * InteractingMyTetrahedron2InteractingSphere4InteractionOfMyTetrahedron
- *
- * Then this interaction will become possible too. Just remember to register it
- * inside TetrahedronsTest in function createActors. And that's - your
- * tetrahedrons will be able to collide with spheres :)
- *
- *
- *
- *
- * Information about current interaction is here very simplified, so that I can
- * make this example quickly.
- *
- * In this example I am assuming that in general this interaction is
- * represented as a collision of two four-sphered bodies. Therefore I will
- * store here penetration depth for each of the spheres. Since in each body
- * four spheres are assumed to exist then I will have a 4x4 matrix of
- * penetration depths, a 4x4 matrix of normal directions of each penetration,
- * and a 4x4 matrix of contact points.
- *
- * So here you can see that the example interaction with InteractingBox will be
- * in fact emulating that the box contains four spheres. You can check that in
- * InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron
- *
-*/
-
-class InteractionOfMyTetrahedron : public InteractionGeometry
-{
-	public :
-		// if serialization was needed (REGISTER_ATTRIBUTE),
-		// then I should use std::vector, because serialization is currently not working for C arrays
-		// (will be fixed soon :)
-		Real penetrationDepths[4][4];
-		Vector3r contactPoints[4][4];
-		Vector3r normals[4][4];
-		
-		InteractionOfMyTetrahedron();
-		virtual ~InteractionOfMyTetrahedron();
-
-	REGISTER_CLASS_NAME(InteractionOfMyTetrahedron);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometry);
-
-	REGISTER_CLASS_INDEX(InteractionOfMyTetrahedron,InteractionGeometry);
-
-};
-
-REGISTER_SERIALIZABLE(InteractionOfMyTetrahedron,false);
-
-#endif // INTERACTIONOFMYTETRAHEDRON_HPP
-

Copied: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron.cpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron/InteractionOfMyTetrahedron.cpp)

Copied: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron.hpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/InteractionOfMyTetrahedron/InteractionOfMyTetrahedron.hpp)

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry/SDECLinkGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry/SDECLinkGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry/SDECLinkGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,27 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;SDECLinkGeometry.hpp&quot;
-
-SDECLinkGeometry::SDECLinkGeometry()
-{
-	createIndex();
-}
-
-SDECLinkGeometry::~SDECLinkGeometry()
-{
-}
-
-void SDECLinkGeometry::registerAttributes()
-{
-	InteractionGeometry::registerAttributes();
-	REGISTER_ATTRIBUTE(radius1);
-	REGISTER_ATTRIBUTE(radius2);
-}

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry/SDECLinkGeometry.hpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry/SDECLinkGeometry.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry/SDECLinkGeometry.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,41 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SDECLINKGEOMETRY_HPP
-#define SDECLINKGEOMETRY_HPP
-
-#include &lt;vector&gt;
-#include&lt;yade/core/InteractionGeometry.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-#include &lt;Wm3Quaternion.h&gt;
-
-class SDECLinkGeometry : public InteractionGeometry
-{
-	public :
-		SDECLinkGeometry();
-		virtual ~SDECLinkGeometry();
-
-		Real		 radius1 // FIXME : lots of stuff is the same as in SpheresContactGeometry, so it should inherit from it.
-				,radius2;
-
-		Vector3r	normal;			// new unit normal of the contact plane.
-
-	protected :
-		void registerAttributes();
-
-	REGISTER_CLASS_NAME(SDECLinkGeometry);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometry);
-
-	REGISTER_CLASS_INDEX(SDECLinkGeometry,InteractionGeometry);
-};
-
-REGISTER_SERIALIZABLE(SDECLinkGeometry,false);
-
-#endif // SDECCPERMANENTLINK_HPP
-

Copied: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry.cpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry/SDECLinkGeometry.cpp)

Copied: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry.hpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SDECLinkGeometry/SDECLinkGeometry.hpp)

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry/SpheresContactGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry/SpheresContactGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry/SpheresContactGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,33 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;SpheresContactGeometry.hpp&quot;
-
-SpheresContactGeometry::SpheresContactGeometry() : InteractionGeometry()
-{
-	createIndex();
-}
- 
- 
-SpheresContactGeometry::~SpheresContactGeometry ()
-{
-}
-// 
-// void SpheresContactGeometry::postProcessAttributes(bool)
-// {
-// 
-// }
-// 
-void SpheresContactGeometry::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(radius1);
-	REGISTER_ATTRIBUTE(radius2);
-}
-

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry/SpheresContactGeometry.hpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry/SpheresContactGeometry.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry/SpheresContactGeometry.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,41 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SPHERESCONTACTGEOMETRY_HPP
-#define SPHERESCONTACTGEOMETRY_HPP
-
-#include &lt;vector&gt;
-#include&lt;yade/core/InteractionGeometry.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class SpheresContactGeometry : public InteractionGeometry
-{
-	public :
-		Vector3r	 normal			// new unit normal of the contact plane.
-				,contactPoint;	
-
-		Real		 radius1
-				,radius2
-				,penetrationDepth;
-
-		SpheresContactGeometry();
-		virtual ~SpheresContactGeometry();
-
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(SpheresContactGeometry);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometry);
-
-	REGISTER_CLASS_INDEX(SpheresContactGeometry,InteractionGeometry);
-};
-
-REGISTER_SERIALIZABLE(SpheresContactGeometry,false);
-
-#endif // SPHERESCONTACTGEOMETRY_HPP
-

Copied: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.cpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry/SpheresContactGeometry.cpp)

Copied: branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry.hpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractionGeometry/SpheresContactGeometry/SpheresContactGeometry.hpp)

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction/ElasticContactInteraction.cpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction/ElasticContactInteraction.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction/ElasticContactInteraction.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,47 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ElasticContactInteraction.hpp&quot;
-
-
-ElasticContactInteraction::ElasticContactInteraction()
-{
-	createIndex();
-}
-
-ElasticContactInteraction::~ElasticContactInteraction()
-{
-}
-
-// void ElasticContactInteraction::postProcessAttributes(bool)
-// {
-// 
-// }
-
-
-void ElasticContactInteraction::registerAttributes()
-{
-	SimpleElasticInteraction::registerAttributes();
-	REGISTER_ATTRIBUTE(prevNormal);
-	REGISTER_ATTRIBUTE(shearForce);
-	REGISTER_ATTRIBUTE(initialKn);
-	REGISTER_ATTRIBUTE(initialKs);
-	REGISTER_ATTRIBUTE(tangensOfFrictionAngle);
-//		Real		 kn				// normal elastic constant.
-//				,ks				// shear elastic constant.
-//				,initialKn			// initial normal elastic constant.
-//				,initialKs			// initial shear elastic constant.
-//				,equilibriumDistance		// equilibrium distance
-//				,initialEquilibriumDistance	// initial equilibrium distance
-//				,frictionAngle 			// angle of friction, according to Coulumb criterion
-//				,tangensOfFrictionAngle;
-//	
-//		Vector3r	prevNormal			// unit normal of the contact plane.
-//				,normalForce			// normal force applied on a DE
-//				,shearForce;			// shear force applied on a DE
-}

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction/ElasticContactInteraction.hpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction/ElasticContactInteraction.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction/ElasticContactInteraction.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,45 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ELASTIC_CONTACT_PARAMETERS_HPP
-#define ELASTIC_CONTACT_PARAMETERS_HPP
-
-#include&lt;yade/pkg-common/SimpleElasticInteraction.hpp&gt;
-
-class ElasticContactInteraction : public SimpleElasticInteraction
-{
-	public :
-		Real		// kn				// normal elastic constant. (inside SimpleElasticInteraction)
-				 ks				// shear elastic constant.
-				,initialKn			// initial normal elastic constant.
-				,initialKs			// initial shear elastic constant.
-				,equilibriumDistance		// equilibrium distance
-				,initialEquilibriumDistance	// initial equilibrium distance
-				,frictionAngle 			// angle of friction, according to Coulumb criterion
-				,tangensOfFrictionAngle;
-	
-		Vector3r	prevNormal			// unit normal of the contact plane.
-				,normalForce			// normal force applied on a DE
-				,shearForce;			// shear force applied on a DE
-
-		ElasticContactInteraction();
-		virtual ~ElasticContactInteraction();
-	protected :
-		virtual void registerAttributes();
-
-	REGISTER_CLASS_NAME(ElasticContactInteraction);
-	REGISTER_BASE_CLASS_NAME(SimpleElasticInteraction);
-
-	REGISTER_CLASS_INDEX(ElasticContactInteraction,SimpleElasticInteraction);
-
-};
-
-REGISTER_SERIALIZABLE(ElasticContactInteraction,false);
-
-#endif // ELASTIC_CONTACT_PARAMETERS_HPP
-

Copied: branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction.cpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction/ElasticContactInteraction.cpp)

Copied: branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction.hpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/ElasticContactInteraction/ElasticContactInteraction.hpp)

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics/SDECLinkPhysics.cpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics/SDECLinkPhysics.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics/SDECLinkPhysics.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,43 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;SDECLinkPhysics.hpp&quot;
-
-
-SDECLinkPhysics::SDECLinkPhysics()
-{
-	createIndex();
-}
-
-SDECLinkPhysics::~SDECLinkPhysics()
-{
-}
-
-void SDECLinkPhysics::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-		shearForce = Vector3r(0,0,0);
-		thetar = Vector3r(0,0,0);
-	}
-}
-
-
-void SDECLinkPhysics::registerAttributes()
-{
-	InteractionPhysics::registerAttributes();
-	REGISTER_ATTRIBUTE(initialKn);
-	REGISTER_ATTRIBUTE(initialKs);
-	REGISTER_ATTRIBUTE(initialEquilibriumDistance);
-	REGISTER_ATTRIBUTE(knMax);
-	REGISTER_ATTRIBUTE(ksMax);
-	REGISTER_ATTRIBUTE(heta);
-}
-

Deleted: branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics/SDECLinkPhysics.hpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics/SDECLinkPhysics.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics/SDECLinkPhysics.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,56 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SDECLINKPHYSICS_HPP
-#define SDECLINKPHYSICS_HPP
-
-#include&lt;yade/core/InteractionPhysics.hpp&gt;
-
-class SDECLinkPhysics : public InteractionPhysics
-{
-	public :	
-		Real		 kn				// normal elastic constant.
-				,ks				// shear elastic constant.
-
-				,knMax
-				,ksMax
-				,heta
-				,averageRadius
-				,kr
-
-				,initialKn			// initial normal elastic constant.
-				,initialKs			// initial shear elastic constant.
-				,equilibriumDistance		// equilibrium distance
-				,initialEquilibriumDistance;	// initial equilibrium distance
-
-		Vector3r	 prevNormal			// unit normal of the contact plane.
-				,normalForce			// normal force applied on a DE
-				,shearForce			// shear force applied on a DE
-				,thetar;
-
-		Quaternionr	 prevRotation1
-				,prevRotation2;
-		
-		
-		SDECLinkPhysics();
-		virtual ~SDECLinkPhysics();
-
-/// Serialization
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-		void registerAttributes();
-	REGISTER_CLASS_NAME(SDECLinkPhysics);
-	REGISTER_BASE_CLASS_NAME(InteractionPhysics);
-
-	REGISTER_CLASS_INDEX(SDECLinkPhysics,InteractionPhysics);
-};
-
-REGISTER_SERIALIZABLE(SDECLinkPhysics,false);
-
-#endif // SDECLINKPHYSICS_HPP
-

Copied: branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics.cpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics/SDECLinkPhysics.cpp)

Copied: branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics.hpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/InteractionPhysics/SDECLinkPhysics/SDECLinkPhysics.hpp)

Deleted: branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness/GlobalStiffness.cpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness/GlobalStiffness.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness/GlobalStiffness.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,50 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GlobalStiffness.hpp&quot;
-
-
-GlobalStiffness::GlobalStiffness() : PhysicalAction()
-{
-	createIndex();
-}
-
-
-
-GlobalStiffness::~GlobalStiffness()
-{
-}
-
-/* FIXME - not used
-void Momentum::add(const shared_ptr&lt;PhysicalAction&gt;&amp; a)
-{
-	Momentum * m = static_cast&lt;Momentum*&gt;(a.get());
-	momentum += m-&gt;momentum;
-}
-
-
-void Momentum::sub(const shared_ptr&lt;PhysicalAction&gt;&amp; a)
-{
-	Momentum * m = static_cast&lt;Momentum*&gt;(a.get());
-	momentum -= m-&gt;momentum;
-}
-*/
-
-void GlobalStiffness::reset()
-{
-	//stiffness = Matrix3r::ZERO; //old style
-	stiffness = Vector3r::ZERO;
-	Rstiffness = Vector3r::ZERO;
-}
-
-
-shared_ptr&lt;PhysicalAction&gt; GlobalStiffness::clone()
-{
-	return shared_ptr&lt;GlobalStiffness&gt;(new GlobalStiffness(*this));
-}
-

Deleted: branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness/GlobalStiffness.hpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness/GlobalStiffness.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness/GlobalStiffness.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,55 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GLOBALSTIFFNESSMATRIX_HPP
-#define GLOBALSTIFFNESSMATRIX_HPP
-
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-//#include &lt;Wm3Matrix3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-/**
<A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">- at author</A> Bruno Chareyre 
-*/
-
-
-/*! \brief Data class for storage of the global stiffness of the contacts around one body
-
-	The minimum eignen-period in a collection of contacting bodies can be computed from the eigen values &quot;ei&quot; of the global stiffness matrix. An acceptable approximation of max(ei) may be obtained using the diagonal terms of the non-diagonalised matrix. This class contains two Vector3r where the components of the vector are the diagonal terms of the matrix Mk (3 components for translation + 3 components for rotation).
-*/
-
-class GlobalStiffness : public PhysicalAction
-{
-	public :
-		//full matrix, not required in the current simplified calculation of critical dt which uses only the diagonal terms
-		//! translational stiffness
-		Vector3r stiffness; 
-		//! rotational stiffness
-		Vector3r Rstiffness; 
-		GlobalStiffness();
-		virtual ~GlobalStiffness();
-
-//		virtual void add(const shared_ptr&lt;PhysicalAction&gt;&amp; a); // FIXME - not used
-//		virtual void sub(const shared_ptr&lt;PhysicalAction&gt;&amp; a); // FIXME - not used
-
-		virtual void reset();
-		virtual shared_ptr&lt;PhysicalAction&gt; clone();
-	
-/// Serialization
-	REGISTER_CLASS_NAME(GlobalStiffness);
-	REGISTER_BASE_CLASS_NAME(PhysicalAction);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(GlobalStiffness,PhysicalAction);
-};
-
-REGISTER_SERIALIZABLE(GlobalStiffness,false);
-
-#endif // GLOBALSTIFFNESSMATRIX_HPP

Copied: branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness.cpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness/GlobalStiffness.cpp)

Copied: branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness.hpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/PhysicalAction/GlobalStiffness/GlobalStiffness.hpp)

Deleted: branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters/BodyMacroParameters.cpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters/BodyMacroParameters.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters/BodyMacroParameters.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,26 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;BodyMacroParameters.hpp&quot;
-
-BodyMacroParameters::BodyMacroParameters () : ElasticBodyParameters()
-{
-	createIndex();
-}
-
-BodyMacroParameters::~BodyMacroParameters()
-{
-}
-
-void BodyMacroParameters::registerAttributes()
-{
-	ElasticBodyParameters::registerAttributes();
-	REGISTER_ATTRIBUTE(poisson);
-	REGISTER_ATTRIBUTE(frictionAngle);
-}
-

Deleted: branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters/BodyMacroParameters.hpp
===================================================================
--- branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters/BodyMacroParameters.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters/BodyMacroParameters.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,41 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-#ifndef BODYMACROPARAMETERS_HPP
-#define BODYMACROPARAMETERS_HPP
-
-
-#include&lt;yade/pkg-common/ElasticBodyParameters.hpp&gt;
-
-
-class BodyMacroParameters : public ElasticBodyParameters
-{
-	public :
-		Real		 poisson
-				,frictionAngle;
-
-		BodyMacroParameters ();
-		virtual ~BodyMacroParameters ();
-
-/// Serialization
-	REGISTER_CLASS_NAME(BodyMacroParameters);
-	REGISTER_BASE_CLASS_NAME(ElasticBodyParameters);
-
-	public : void registerAttributes();
-
-/// Indexable
-	REGISTER_CLASS_INDEX(BodyMacroParameters,ElasticBodyParameters);
-};
-
-REGISTER_SERIALIZABLE(BodyMacroParameters,false);
-
-#endif // __SDECDISCRETEELEMENT_H__
-

Copied: branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters.cpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters/BodyMacroParameters.cpp)

Copied: branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters.hpp (from rev 1105, branches/scons-layout/pkg/dem/DataClass/PhysicalParameters/BodyMacroParameters/BodyMacroParameters.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine/ResultantForceEngine.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine/ResultantForceEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine/ResultantForceEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,97 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-#include&quot;ResultantForceEngine.hpp&quot;
-#include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&quot;GlobalStiffness.hpp&quot;
-#include&lt;Wm3Math.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-ResultantForceEngine::ResultantForceEngine() : actionParameterGlobalStiffness(new GlobalStiffness), actionParameterForce(new Force)
-{
-	interval =1;
-	damping = 0.1;
-	force = Vector3r::ZERO;
-	previoustranslation = Vector3r::ZERO;
-	stiffness = Vector3r::ZERO;
-	max_vel = 0.001;
-}
-
-ResultantForceEngine::~ResultantForceEngine()
-{
-}
-
-
-void ResultantForceEngine::registerAttributes()
-{
-	DeusExMachina::registerAttributes();
-	REGISTER_ATTRIBUTE(interval);
-	REGISTER_ATTRIBUTE(damping);
-	REGISTER_ATTRIBUTE(force);
-	REGISTER_ATTRIBUTE(previoustranslation);
-	REGISTER_ATTRIBUTE(stiffness);
-	REGISTER_ATTRIBUTE(max_vel);
-}
-
-
-
-void ResultantForceEngine::applyCondition(Body* body)
-{
-	//cerr &lt;&lt; &quot;void ResultantForceEngine::applyCondition(Body* body)&quot; &lt;&lt; std::endl;
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	std::vector&lt;int&gt;::const_iterator ii = subscribedBodies.begin();
-	std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();
-	
-	//cerr &lt;&lt; &quot;std::vector&lt;int&gt;::const_iterator iiEnd = subscribedBodies.end();&quot; &lt;&lt; Omega::instance().getCurrentIteration() &lt;&lt; std::endl;
-	
-	
-	
-	for(;ii!=iiEnd;++ii)
-	{
-	//cerr &lt;&lt; &quot;for(;ii!=iiEnd;++ii)&quot; &lt;&lt; std::endl;
-	//if( bodies-&gt;exists(*ii) ) 
-	//{
-		//Update stiffness only if it has been computed by StiffnessCounter (see &quot;interval&quot;)
-		if (Omega::instance().getCurrentIteration() % interval == 0)	stiffness =
-		(static_cast&lt;GlobalStiffness*&gt;( ncb-&gt;physicalActions-&gt;find (*ii, actionParameterGlobalStiffness-&gt;getClassIndex() ).get() ))-&gt;stiffness;
-	
-		//cerr &lt;&lt; &quot;static_cast&lt;GlobalStiffness*&gt;( ncb-&gt;physicalActions-&gt;find (*ii, actionParameterGlobalStiffness-&gt;getClassIndex() ).get() ))-&gt;stiffness&quot; &lt;&lt; std::endl;
-		
-		if(PhysicalParameters* p = dynamic_cast&lt;PhysicalParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get()))
-		{
-			//cerr &lt;&lt; &quot;dynamic_cast&lt;PhysicalParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get()&quot; &lt;&lt; std::endl;
-			GlobalStiffness* sm = static_cast&lt;GlobalStiffness*&gt;( ncb-&gt;physicalActions-&gt;find (*ii, actionParameterGlobalStiffness-&gt;getClassIndex() ).get() );
-			
-			Vector3r effectiveforce =
-			 	static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find( *ii,actionParameterForce-&gt;getClassIndex() ).get() )-&gt;force; 
-			Vector3r deltaf (effectiveforce - force);
-			Vector3r translation 
-				(stiffness.X()==0 ? Mathr::Sign(deltaf.X())*max_vel : Mathr::Sign(deltaf.X())*std::min( abs(deltaf.X()/stiffness.X()), max_vel),
-				stiffness.Y()==0 ? Mathr::Sign(deltaf.Y())*max_vel : Mathr::Sign(deltaf.Y())*std::min( abs(deltaf.Y()/stiffness.Y()), max_vel),
-				stiffness.Z()==0 ? Mathr::Sign(deltaf.Z())*max_vel : Mathr::Sign(deltaf.Z())*std::min( abs(deltaf.Z()/stiffness.Z()), max_vel) );
-			previoustranslation = (1-damping)*translation + 0.9*previoustranslation;// formula for &quot;steady-flow&quot; evolution with fluctuations
-			p-&gt;se3.position	+= previoustranslation;
-			//p-&gt;velocity		=  previoustranslation/dt;//FIXME : useless???	
-		}		
-	//}
-	}
-}
-
-

Deleted: branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine/ResultantForceEngine.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine/ResultantForceEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine/ResultantForceEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,61 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-
-
-#ifndef RESULTANT_FORCE_ENGINE_HPP
-#define RESULTANT_FORCE_ENGINE_HPP
-
-#include&lt;yade/core/DeusExMachina.hpp&gt;
-#include &lt;Wm3Math.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class PhysicalAction;
-
-class ResultantForceEngine : public DeusExMachina 
-{
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionParameterGlobalStiffness;
-		shared_ptr&lt;PhysicalAction&gt; actionParameterForce;
-		
-			
-	public :
-		//! CAUTION : interval must be equal to the interval of the StiffnessCounter, it is used here to check if stiffness has been computed 
-		unsigned int interval;
-		//! Defines the prescibed resultant force 
-		Vector3r		force;	
-		//! Stores the value of the translation at the previous time step
-		Vector3r 		previoustranslation;
-		//! The value of stiffness (updated according to interval) 
-		Vector3r		stiffness;
-		//! damping coefficient - damping=1 implies a &quot;perfect&quot; control of the resultant force
-		Real			damping;
-		//! maximum velocity (usefull to prevent explosions when stiffness is very low...) 
-		Real			max_vel;
-
-		ResultantForceEngine();
-		virtual ~ResultantForceEngine();
-	
-		virtual void applyCondition(Body*);
-		
-	
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(ResultantForceEngine);
-	REGISTER_BASE_CLASS_NAME(DeusExMachina);
-};
-
-REGISTER_SERIALIZABLE(ResultantForceEngine,false);
-
-#endif // FORCE_ENGINE_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine/ResultantForceEngine.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/DeusExMachina/ResultantForceEngine/ResultantForceEngine.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine/TriaxialCompressionEngine.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine/TriaxialCompressionEngine.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine/TriaxialCompressionEngine.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,210 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;TriaxialCompressionEngine.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include &quot;ElasticContactInteraction.hpp&quot;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-#include &lt;boost/lexical_cast.hpp&gt;
-
-
-TriaxialCompressionEngine::TriaxialCompressionEngine() : actionForce(new Force)
-{
-	translationAxis=TriaxialStressController::normal[wall_bottom_id];
-	strainRate=0;
-	currentStrainRate=0;
-	StabilityCriterion=0.001;
-	Phase1=false;
-	Phase1End = &quot;Phase1End&quot;;
-	FinalIterationPhase1 = 0;
-// 	Phase2End = &quot;Phase2End&quot;;
-	compressionActivated=false;
-	autoCompressionActivation=true;
-	for (int i=0; i&lt;3; ++i) strain[i]=0;
-	
-	
-}
-
-TriaxialCompressionEngine::~TriaxialCompressionEngine()
-{	
-}
-
-
-void TriaxialCompressionEngine::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-        translationAxis.Normalize();
-}
-
-
-void TriaxialCompressionEngine::registerAttributes()
-{
-	TriaxialStressController::registerAttributes();
-	REGISTER_ATTRIBUTE(strainRate);
-	REGISTER_ATTRIBUTE(currentStrainRate);
-	REGISTER_ATTRIBUTE(strain);
-	REGISTER_ATTRIBUTE(UnbalancedForce);
-	REGISTER_ATTRIBUTE(StabilityCriterion);
-	REGISTER_ATTRIBUTE(translationAxis);
-	REGISTER_ATTRIBUTE(compressionActivated);
-	REGISTER_ATTRIBUTE(autoCompressionActivation);
-}
-
-
-
-void TriaxialCompressionEngine::updateParameters(Body * body)
-{
-	
-	UnbalancedForce=ComputeUnbalancedForce(body);
-	if (Omega::instance().getCurrentIteration() % 100 == 0) cerr &lt;&lt; &quot;UnbalancedForce=&quot; &lt;&lt; UnbalancedForce &lt;&lt; endl;
-	
-	// new test
-	//cerr &lt;&lt; &quot;1&quot; &lt;&lt; endl;
-	if (!Phase1 &amp;&amp; autoCompressionActivation &amp;&amp;
-	UnbalancedForce&lt;=StabilityCriterion)		//Start 
-	{	
-// 		// saving snapshot.xml
-// 	string fileName = &quot;../data/&quot; + Phase1End + &quot;_&quot; + 
-// 	lexical_cast&lt;string&gt;(Omega::instance().getCurrentIteration()) + &quot;.xml&quot;;
-// 	cerr &lt;&lt; &quot;saving snapshot: &quot; &lt;&lt; fileName &lt;&lt; &quot; ...&quot;;
-// 	Omega::instance().saveSimulation(fileName);
-		
-		internalCompaction = false;
-		Phase1 = true;
-		FinalIterationPhase1 =
-		Omega::instance().getCurrentIteration();
-	}
-	
-	if (autoCompressionActivation &amp;&amp; Phase1
-	&amp;&amp; ((Omega::instance().getCurrentIteration()) &gt;=
-	(FinalIterationPhase1+1000)))
-	
-	{
-		if (UnbalancedForce&lt;=StabilityCriterion)
-		{
-		// saving snapshot.xml
-	string fileName = &quot;../data/&quot; + Phase1End + &quot;_&quot; + 
-	lexical_cast&lt;string&gt;(Omega::instance().getCurrentIteration()) + &quot;.xml&quot;;
-	cerr &lt;&lt; &quot;saving snapshot: &quot; &lt;&lt; fileName &lt;&lt; &quot; ...&quot;;
-	Omega::instance().saveSimulation(fileName);
-	
-	compressionActivated = true;
-		}
-	
-	}
-
-	if (compressionActivated)
-	{
-		wall_bottom_activated=false;
-		wall_top_activated=false;
-		autoCompressionActivation = false;
-	}
-		
-}
-
-
-void TriaxialCompressionEngine::applyCondition(Body * body)
-{
-	//cerr &lt;&lt; &quot;TriaxialCompressionEngine::applyCondition(Body * body)&quot; &lt;&lt; endl;
-	if (Omega::instance().getCurrentIteration() % interval == 0)//FIXME should never be executed here bu only when a data recorder requires it
-                updateParameters(body);
-
-        TriaxialStressController::applyCondition(body);
-        MetaBody * ncb2 = static_cast&lt;MetaBody*&gt;(body);
-        //cerr &lt;&lt; computeStress(ncb2)  &lt;&lt; endl;
-
-        if (compressionActivated)
-        {
-		if (Omega::instance().getCurrentIteration() % 50 == 0) 
- 		cerr &lt;&lt; &quot;Compression started!!&quot; &lt;&lt; endl;
-        	Real dt = Omega::instance().getTimeStep();
-                  MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
-                  shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-                  
-                  if (currentStrainRate &lt; strainRate) currentStrainRate
-			+= strainRate*0.0003;	// !!! si d&#233;charge
-                
-                  PhysicalParameters* p =
-		static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_bottom_id]-&gt;
-		physicalParameters. get());
-                  p-&gt;se3.position += 0.5*strainRate*height*translationAxis*dt;
-//                 cerr &lt;&lt; &quot;deplacmt = &quot; &lt;&lt;
-// 		0.5*strainRate*height*translationAxis*dt &lt;&lt; endl;
-//                 cerr &lt;&lt; &quot;wall_bottom : p-&gt;se3.position = &quot; &lt;&lt; p-&gt;se3.position
-// 		&lt;&lt; endl;
-		
-		  p =
-		static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_top_id]-&gt;	
-		physicalParameters.get( ));
-                  p-&gt;se3.position -= 0.5*strainRate*height*translationAxis*dt;
-//                 cerr &lt;&lt; &quot;wall_top : p-&gt;se3.position = &quot; &lt;&lt; p-&gt;se3.position
-// 		&lt;&lt; endl;
-
-        }
-}
-
-
-/*!
-    \fn TriaxialCompressionEngine::ComputeUnbalancedForce()
- */
-Real TriaxialCompressionEngine::ComputeUnbalancedForce(Body * body, bool maxUnbalanced)
-{
-        //compute the mean contact force
-        Real MeanForce=0;
-        long nForce = 0;
-
-        MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
-        shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-        InteractionContainer::iterator ii    = ncb-&gt;transientInteractions-&gt;begin();
-        InteractionContainer::iterator iiEnd = ncb-&gt;transientInteractions-&gt;end();
-        for(  ; ii!=iiEnd ; ++ii ) {
-                if ((*ii)-&gt;isReal) {
-                        const shared_ptr&lt;Interaction&gt;&amp; contact = *ii;
-                        Real fn = (static_cast&lt;ElasticContactInteraction*&gt; (contact-&gt;interactionPhysics.get()))-&gt;normalForce.Length();
-                        if (fn!=0)
-                        {
-                        MeanForce += (static_cast&lt;ElasticContactInteraction*&gt; (contact-&gt;interactionPhysics.get()))-&gt;normalForce.Length();
-                        ++nForce;
-                        }
-                }
-        }
-        if (MeanForce!=0) MeanForce /= nForce;
-
-        int actionForceIndex = actionForce-&gt;getClassIndex();
-
-        if (!maxUnbalanced) {
-                //compute mean Unbalanced Force
-                Real MeanUnbalanced=0;
-                long nBodies = 0;
-                BodyContainer::iterator bi    = bodies-&gt;begin();
-                BodyContainer::iterator biEnd = bodies-&gt;end();
-                Real f;
-                for(  ; bi!=biEnd ; ++bi ) {
-                        if ((*bi)-&gt;isDynamic) {
-                                f= (static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( (*bi)-&gt;getId() , actionForceIndex).get() )-&gt;force).Length();
-                                MeanUnbalanced += f;
-                                if (f!=0) ++nBodies;
-                        }
-                }
-                return MeanUnbalanced/nBodies/MeanForce;
-        } else {
-                //compute max Unbalanced Force
-                Real MaxUnbalanced=0;
-                BodyContainer::iterator bi    = bodies-&gt;begin();
-                BodyContainer::iterator biEnd = bodies-&gt;end();
-                for(  ; bi!=biEnd ; ++bi ) {
-                        if ((*bi)-&gt;isDynamic) {
-                                MaxUnbalanced = std::max((static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( (*bi)-&gt;getId() , actionForceIndex).get() )-&gt;force).Length(), MaxUnbalanced);
-                        }
-                }
-                return MaxUnbalanced/MeanForce;
-        }
-}

Deleted: branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine/TriaxialCompressionEngine.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine/TriaxialCompressionEngine.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine/TriaxialCompressionEngine.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,67 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef TRIAXIALCOMPRESSIONENGINE_HPP
-#define TRIAXIALCOMPRESSIONENGINE_HPP
-
-#include&lt;yade/core/DeusExMachina.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-#include &quot;TriaxialStressController.hpp&quot;
-#include &lt;string&gt;
-
-/*! \brief Isotropic compression + uniaxial compression test
-
-	detailed description...
- */
-
-class PhysicalAction;
-
-class TriaxialCompressionEngine : public TriaxialStressController
-{
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		
-	public :
-		TriaxialCompressionEngine();
-		virtual ~TriaxialCompressionEngine();
-		
-		//! Strain velocity (./s)
-		Real strainRate;
-		Real currentStrainRate;
-		//! Max ratio of resultant forces on mean contact force
-		Real UnbalancedForce;
-		//! Value of UnbalancedForce for which the system is considered stable
-		Real StabilityCriterion;
-		Vector3r strain;
-		Vector3r translationAxis;
-		//! is isotropicInternalCompactionFinished?
-		bool Phase1;
-		int FinalIterationPhase1;
-		std::string Phase1End; //,Phase2End;
-		//! Is uniaxial compression currently activated?
-		bool compressionActivated;
-		//! Auto-switch between isotropic and uniaxial compression?
-		bool autoCompressionActivation;
-				
-		virtual void applyCondition(Body * body);
-		void updateParameters(Body * body);
-		//! Compute the mean/max unbalanced force in the assembly (normalized by mean contact force)
-    		Real ComputeUnbalancedForce(Body * body, bool maxUnbalanced=false);
-
-	protected :
-		virtual void postProcessAttributes(bool);
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(TriaxialCompressionEngine);
-	REGISTER_BASE_CLASS_NAME(TriaxialStressController);
-};
-
-REGISTER_SERIALIZABLE(TriaxialCompressionEngine,false);
-
-#endif //  TRIAXIALCOMPRESSIONENGINE_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine/TriaxialCompressionEngine.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialCompressionEngine/TriaxialCompressionEngine.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController/TriaxialStressController.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController/TriaxialStressController.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController/TriaxialStressController.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,387 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include&quot;TriaxialStressController.hpp&quot;
-#include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include&quot;SpheresContactGeometry.hpp&quot;
-#include&quot;ElasticContactInteraction.hpp&quot;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-//#include &quot;StiffnessMatrix.hpp&quot;
-//#include&lt;yade/lib-wm3-math/Math.hpp&gt;
-
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-
-
-
-TriaxialStressController::TriaxialStressController() : actionParameterForce(new Force), wall_bottom_id(wall_id[0]), wall_top_id(wall_id[1]), wall_left_id(wall_id[2]), wall_right_id(wall_id[3]), wall_front_id(wall_id[4]), wall_back_id(wall_id[5])
-{
-	//cerr &lt;&lt; &quot;constructor of TriaxialStressController&quot; &lt;&lt; std::endl;
-	//StiffnessMatrixClassIndex = actionParameterStiffnessMatrix-&gt;getClassIndex();
-	ForceClassIndex = actionParameterForce-&gt;getClassIndex();
-	previousStress = 0;
-	previousMultiplier = 1;
-	wall_bottom = 0;
-	wall_top = 1;
-	wall_left = 2;
-	wall_right = 3;
-	wall_front = 4;
-	wall_back = 5;
-	
-	
-	interval =10;
-	radiusControlInterval =10;
-	wallDamping = 0.25;
-	force = Vector3r::ZERO;
-	for (int i=0; i&lt;6; ++i)
-	{
-		wall_id[i] = 0;
-		previousTranslation[i] = Vector3r::ZERO;
-		stiffness[i] = 0;
-		normal[i] = Vector3r::ZERO;
-	}
-	normal[wall_bottom].Y()=1;
-	normal[wall_top].Y()=-1;
-	normal[wall_left].X()=1;
-	normal[wall_right].X()=-1;
-	normal[wall_front].Z()=-1;
-	normal[wall_back].Z()=1;
-	
-// 	wall_bottom_id = wall_id[0];
-// 	wall_top_id = wall_id[1];
-// 	wall_left_id = wall_id[2];
-// 	wall_right_id = wall_id[3];
-// 	wall_front_id = wall_id[4];
-// 	wall_back_id = wall_id[5];
-	
-	//stiffness = Vector3r::ZERO;
-	max_vel = 0.001;
-	maxMultiplier = 1.001;
-	finalMaxMultiplier = 1.00001;
-	internalCompaction = true;
-	
-	//StiffnessMatrixClassIndex = actionParameterStiffnessMatrix-&gt;getClassIndex();
-	ForceClassIndex = actionParameterForce-&gt;getClassIndex();
-			
-	wall_bottom_activated = true;
-	wall_top_activated = true;
-	wall_left_activated = true;
-	wall_right_activated = true;
-	wall_front_activated = true;
-	wall_back_activated = true;
-	
-	height = 0;
-	width = 0;
-	depth = 0;
-	thickness = 0;
-	
-	//UnbalancedForce = 0;
-	
-	sigma_iso = 0;
-	//cerr &lt;&lt; &quot;end of TriaxialStressController constructor&quot; &lt;&lt; std::endl;
-}
-
-TriaxialStressController::~TriaxialStressController()
-{	
-}
-
-void TriaxialStressController::registerAttributes()
-{
-	//cerr &lt;&lt; &quot;TriaxialStressController::registerAttributes()&quot; &lt;&lt; std::endl;
-	DeusExMachina::registerAttributes();
-	REGISTER_ATTRIBUTE(interval);
-	REGISTER_ATTRIBUTE(radiusControlInterval);
-	REGISTER_ATTRIBUTE(wallDamping);
-	REGISTER_ATTRIBUTE(force);
-	
-	//REGISTER_ATTRIBUTE(UnbalancedForce);
-	
-	//REGISTER_ATTRIBUTE(stiffness);
- 	REGISTER_ATTRIBUTE(wall_bottom_id);
- 	REGISTER_ATTRIBUTE(wall_top_id);
- 	REGISTER_ATTRIBUTE(wall_left_id);
- 	REGISTER_ATTRIBUTE(wall_right_id);
- 	REGISTER_ATTRIBUTE(wall_front_id);
- 	REGISTER_ATTRIBUTE(wall_back_id);
-//	REGISTER_ATTRIBUTE(wall_id);
-	
-	REGISTER_ATTRIBUTE(wall_bottom_activated);
-	REGISTER_ATTRIBUTE(wall_top_activated);
-	REGISTER_ATTRIBUTE(wall_left_activated);
-	REGISTER_ATTRIBUTE(wall_right_activated);
-	REGISTER_ATTRIBUTE(wall_front_activated);
-	REGISTER_ATTRIBUTE(wall_back_activated);
-	
-	REGISTER_ATTRIBUTE(height);
-	REGISTER_ATTRIBUTE(width);
-	REGISTER_ATTRIBUTE(depth);
-	REGISTER_ATTRIBUTE(thickness);
-	
-	
-	REGISTER_ATTRIBUTE(sigma_iso);
-	REGISTER_ATTRIBUTE(maxMultiplier);
-	REGISTER_ATTRIBUTE(finalMaxMultiplier);
-	REGISTER_ATTRIBUTE(max_vel);
-	REGISTER_ATTRIBUTE(previousStress);
-	REGISTER_ATTRIBUTE(previousMultiplier);
-	REGISTER_ATTRIBUTE(internalCompaction);
-	//cerr &lt;&lt; &quot;fin de TriaxialStressController::registerAttributes()&quot; &lt;&lt; std::endl;
-}
-
-void TriaxialStressController::updateStiffness (MetaBody * ncb)
-{
-	//cerr &lt;&lt; &quot;updateStiffness&quot; &lt;&lt; endl;
-	
-	//shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-	//Real dt = Omega::instance().getTimeStep();
-
-	for (int i=0; i&lt;6; ++i)
-	{		
-		stiffness[i] = 0;
-	}									
-
-
-	InteractionContainer::iterator ii    = ncb-&gt;transientInteractions-&gt;begin();
-	InteractionContainer::iterator iiEnd = ncb-&gt;transientInteractions-&gt;end();
-	for(  ; ii!=iiEnd ; ++ii )
-	{
-		if ((*ii)-&gt;isReal)
-		{
-			const shared_ptr&lt;Interaction&gt;&amp; contact = *ii;
-			
-			Real fn = (static_cast&lt;ElasticContactInteraction*&gt;	
-	(contact-&gt;interactionPhysics.get()))-&gt;normalForce.Length();
-
-			if (fn!=0)
-			{
-				int id1 = contact-&gt;getId1();
-				int id2 = contact-&gt;getId2();
-				
-				for (int index=0; index&lt;6; ++index)
-				{
-				if ( wall_id[index]==id1 || wall_id[index]==id2 )
-				{
-					ElasticContactInteraction* currentContactPhysics =
-					static_cast&lt;ElasticContactInteraction*&gt; ( contact-&gt;interactionPhysics.get() );
-					stiffness[index]  += currentContactPhysics-&gt;kn;
-				}
-				}
-			}
-		}
-	}
-	
-	{		
-		//cerr &lt;&lt; &quot;stiffness 1 = &quot; &lt;&lt; stiffness[1] &lt;&lt; endl;
-	}
-	
-	//cerr &lt;&lt; &quot;fin updateStiffness&quot; &lt;&lt; endl;
-	
-}
-
-void TriaxialStressController::controlExternalStress(int wall, MetaBody* ncb, int id, Vector3r resultantForce, PhysicalParameters* p, Real wall_max_vel) //FIXME remove parameter &quot;id&quot;
-{
-	//cerr &lt;&lt; &quot;controlExternalStress&quot; &lt;&lt; endl;
-    //Update stiffness only if it has been computed by StiffnessCounter (see &quot;interval&quot;)
-    //if (Omega::instance().getCurrentIteration() % interval == 0)	stiffness =
-    //(static_cast&lt;StiffnessMatrix*&gt;( ncb-&gt;physicalActions-&gt;find (id, StiffnessMatrixClassIndex).get()))-&gt;stiffness;
-    // 		Vector3r effectiveforce =
-    // 		 	static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_id[wall],ForceClassIndex).get() )-&gt;force;
-    //Vector3r deltaf (effectiveforce - resultantForce);
-    
-        Real translation= normal[wall].Dot(static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_id[wall],ForceClassIndex).get() )-&gt;force - resultantForce);
-        if (translation!=0)
-        {
-        //cerr &lt;&lt; &quot;translation!=0&quot; &lt;&lt; endl;
-            if (stiffness[wall]!=0)
-            {
-            //cerr &lt;&lt; &quot;stiffness[wall]!=0&quot; &lt;&lt; endl;
-                translation /= stiffness[wall];
-                translation = std::min( abs(translation), max_vel ) * Mathr::Sign(translation);
-            	//cerr &lt;&lt; &quot;translation=&quot; &lt;&lt; translation &lt;&lt; endl;
-            }
-            else
-                translation = wall_max_vel * Mathr::Sign(translation);
-                
-        }
-
-
-        // 		cerr &lt;&lt; &quot;dint wall = &quot; &lt;&lt;  wall ;
-        // 		cerr &lt;&lt; &quot; deltaf.X() = &quot; &lt;&lt;  deltaf.X() ;
-        // 		if  (deltaf.X()!=0) translation.X() =
-        // 		Mathr::Sign(deltaf.X())*(stiffness.X()==0 ? wall_max_vel : std::min( abs(deltaf.X()/stiffness.X()), wall_max_vel));
-        // 		else translation.X() = 0;
-        // 		cerr &lt;&lt; &quot; deltaf.Y() = &quot; &lt;&lt;  deltaf.Y() ;
-        // 		cerr &lt;&lt; &quot; deltaf.Z() = &quot; &lt;&lt;  deltaf.Z() &lt;&lt; endl;
-        //
-        // 		if  (deltaf.Y()!=0) translation.Y() =
-        // 		Mathr::Sign(deltaf.Y())*(stiffness.Y()==0 ? wall_max_vel : std::min( abs(deltaf.Y()/stiffness.Y()), wall_max_vel));
-        // 		else translation.Y() = 0;
-        // 		if  (deltaf.Z()!=0) translation.Z() =
-        // 		Mathr::Sign(deltaf.Z())*(stiffness.Z()==0 ? wall_max_vel : std::min( abs(deltaf.Z()/stiffness.Z()), wall_max_vel));
-        // 		else translation.Z() = 0;
-
-        // 			(stiffness.X()==0 ? Mathr::Sign(deltaf.X())*wall_max_vel : Mathr::Sign(deltaf.X())*std::min( abs(deltaf.X()/stiffness.X()), wall_max_vel),
-        // 			stiffness.Y()==0 ? Mathr::Sign(deltaf.Y())*wall_max_vel : Mathr::Sign(deltaf.Y())*std::min( abs(deltaf.Y()/stiffness.Y()), wall_max_vel),
-        // 			stiffness.Z()==0 ? Mathr::Sign(deltaf.Z())*wall_max_vel : Mathr::Sign(deltaf.Z())*std::min( abs(deltaf.Z()/stiffness.Z()), wall_max_vel) );
-
-        previousTranslation[wall] = (1-wallDamping)*translation*normal[wall];// + 0.7*previousTranslation[wall];// formula for &quot;steady-flow&quot; evolution with fluctuations
-        p-&gt;se3.position	+= previousTranslation[wall];
-    
-    //if (wall==1) cerr &lt;&lt; &quot;Force=&quot; &lt;&lt; normal[wall].Dot(static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_id[wall],ForceClassIndex).get() )-&gt;force) &lt;&lt; &quot; -&gt; &quot; &lt;&lt; resultantForce &lt;&lt; &quot;Translation[wall]=&quot; &lt;&lt; previousTranslation[wall] &lt;&lt; endl;
-    //p-&gt;velocity		=  previousTranslation/dt;//FIXME : useless???
-    //}
-
-}
-
-
-
-
-void TriaxialStressController::applyCondition(Body* body)
-{
-	//cerr &lt;&lt; &quot;TriaxialStressController::applyCondition&quot; &lt;&lt; endl;
-        MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-
-        //Update stiffness only if it has been computed by StiffnessCounter (see &quot;interval&quot;)
-        if (Omega::instance().getCurrentIteration() % interval == 0 || Omega::instance().getCurrentIteration()&lt;1000)
-                updateStiffness(ncb);
-                
-//                cerr &lt;&lt; &quot;Sm = &quot; &lt;&lt; computeStress(ncb);
-
-
-        shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-        //if(PhysicalParameters* p = dynamic_cast&lt;PhysicalParameters*&gt;((*bodies)[*ii]-&gt;physicalParameters.get()))
-
-        // 	if(PhysicalParameters* p_bottom = static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_bottom_id]-&gt;physicalParameters.get()) &amp;&amp;
-        // 	PhysicalParameters* p_top   =	 static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_top_id]-&gt;physicalParameters.get()) &amp;&amp;
-        // 	PhysicalParameters* p_left 	= static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_left_id]-&gt;physicalParameters.get()) &amp;&amp;
-        // 	PhysicalParameters* p_right = static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_right_id]-&gt;physicalParameters.get()) &amp;&amp;
-        // 	PhysicalParameters* p_front = static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_front_id]-&gt;physicalParameters.get()) &amp;&amp;
-        // 	PhysicalParameters* p_back 	= static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_back_id]-&gt;physicalParameters.get()))
-
-
-
-        PhysicalParameters* p_bottom = static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_bottom_id]-&gt;physicalParameters.get());
-        PhysicalParameters* p_top   =	 static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_top_id]-&gt;physicalParameters.get());
-        PhysicalParameters* p_left 	= static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_left_id]-&gt;physicalParameters.get());
-        PhysicalParameters* p_right = static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_right_id]-&gt;physicalParameters.get());
-        PhysicalParameters* p_front = static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_front_id]-&gt;physicalParameters.get());
-        PhysicalParameters* p_back 	= static_cast&lt;PhysicalParameters*&gt;((*bodies)[wall_back_id]-&gt;physicalParameters.get());
-
-
-        height = p_top-&gt;se3.position.Y() - p_bottom-&gt;se3.position.Y() - thickness;
-        width = p_right-&gt;se3.position.X() - p_left-&gt;se3.position.X() - thickness;
-        depth = p_front-&gt;se3.position.Z() - p_back-&gt;se3.position.Z() - thickness;
-
-        if (!internalCompaction) {
-                Vector3r wallForce (0, sigma_iso*width*depth, 0);
-                if (wall_bottom_activated)
-                        controlExternalStress(wall_bottom, ncb, wall_bottom_id, -wallForce, p_bottom, max_vel);
-                if (wall_top_activated)
-                        controlExternalStress(wall_top, ncb, wall_top_id, wallForce, p_top, max_vel);
-
-                wallForce = Vector3r(sigma_iso*height*depth, 0, 0);
-                if (wall_left_activated)
-                        controlExternalStress(wall_left, ncb, wall_left_id,
-                                              -wallForce, p_left, max_vel*width/height);
-
-                if (wall_right_activated)
-                        controlExternalStress(wall_right, ncb, wall_right_id,
-                                              wallForce, p_right, max_vel*width/height);
-
-                wallForce = Vector3r(0, 0, sigma_iso*height*depth);
-                if (wall_back_activated)
-                        controlExternalStress(wall_back, ncb, wall_back_id,
-                                              -wallForce, p_back, max_vel*depth/height);
-
-                if (wall_front_activated)
-                        controlExternalStress(wall_front, ncb, wall_front_id,
-                                              wallForce, p_front, max_vel*depth/height);
-
-        }
-        else //if internal compaction
-        {
-                if (Omega::instance().getCurrentIteration() % radiusControlInterval == 0) {
-                        Real s = computeStress(ncb);
-                        if (sigma_iso&lt;=s) maxMultiplier = finalMaxMultiplier;
-                        if (s==0)
-                                previousMultiplier = maxMultiplier;
-                        else {
-                                //     		previousMultiplier = 1+0.7*(sigma_iso-s)*(previousMultiplier-1.f)/(s-previousStress); // = (Dsigma/apparentModulus)*0.7
-                                //     		previousMultiplier = std::max(2-maxMultiplier, std::min(previousMultiplier, maxMultiplier));
-                                previousMultiplier = 1.f+(sigma_iso-s)/sigma_iso*(maxMultiplier-1.f); // = (Dsigma/apparentModulus)*0.7
-                        }
-                        previousStress = s;
-                        //cerr &lt;&lt; &quot; s= &quot; &lt;&lt; s &lt;&lt; &quot; &quot;;
-                        //Real apparentModulus = (s-previousStress)/(previousMultiplier-1.f);
-                        controlInternalStress(ncb, previousMultiplier);
-                }
-        }
-}
-
-
-Real TriaxialStressController::computeStress(MetaBody* ncb)
-{
-	
-// 	height = p_top-&gt;se3.position.Y() - p_bottom-&gt;se3.position.Y() - thickness;
-// 	width = p_right-&gt;se3.position.X() - p_left-&gt;se3.position.X() - thickness;
-// 	depth = p_front-&gt;se3.position.Z() - p_back-&gt;se3.position.Z() - thickness;
-	
-	Real meanStress = 0;
-	
-	Real invXSurface = 1.f/(height*depth);
-	Real invYSurface = 1.f/(width*depth);
-	Real invZSurface = 1.f/(width*height);
-		
-	stress[wall_bottom] = ( static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_id[wall_bottom],ForceClassIndex).get() )-&gt;force ) * invYSurface;
-	stress[wall_top] = static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_id[wall_top],ForceClassIndex).get() )-&gt;force * invYSurface;
-	stress[wall_left] = ( static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_id[wall_left],ForceClassIndex).get() )-&gt;force ) * invXSurface;
-	stress[wall_right] = ( static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_id[wall_right],ForceClassIndex).get() )-&gt;force ) * invXSurface;
-	stress[wall_front] = ( static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_id[wall_front],ForceClassIndex).get() )-&gt;force ) * invZSurface;
-	stress[wall_back] = ( static_cast&lt;Force*&gt;( ncb-&gt;physicalActions-&gt;find(wall_id[wall_back],ForceClassIndex).get() )-&gt;force ) * invZSurface;	
-		
- 	//cerr &lt;&lt; &quot;stresses : &quot; &lt;&lt;  stress[wall_bottom] &lt;&lt; &quot; &quot; &lt;&lt;
- //stress[wall_top]&lt;&lt; &quot; &quot; &lt;&lt; stress[wall_left]&lt;&lt; &quot; &quot; &lt;&lt; stress[wall_right]&lt;&lt; &quot; &quot;
- //&lt;&lt; stress[wall_front] &lt;&lt; &quot; &quot; &lt;&lt; stress[wall_back] &lt;&lt; endl;
-
-	for (int i=0; i&lt;6; i++) meanStress-= stress[i].Dot(normal[i]);
-	return meanStress*0.16666666666;
-	
-}
-
-void TriaxialStressController::controlInternalStress(MetaBody* ncb, Real multiplier)
-{
-	BodyContainer::iterator bi    = ncb-&gt;bodies-&gt;begin();
-        BodyContainer::iterator biEnd = ncb-&gt;bodies-&gt;end();
-        Real f;
-        //cerr &lt;&lt; &quot;meanstress = &quot;radius = &quot; &lt;&lt; endl;
-        //cerr &lt;&lt; &quot;bouclesurBodies&quot; &lt;&lt; endl;
-        for(  ; bi!=biEnd ; ++bi ) {
-                if ((*bi)-&gt;isDynamic) {
-                        (static_cast&lt;InteractingSphere*&gt; ((*bi)-&gt;interactingGeometry.get()))-&gt;radius *= multiplier;
-                        (static_cast&lt;Sphere*&gt;((*bi)-&gt;geometricalModel.get()))-&gt;radius *= multiplier;}
-        }
-	//cerr &lt;&lt; &quot;bouclesurInteraction&quot; &lt;&lt; endl;
-        InteractionContainer::iterator ii    = ncb-&gt;transientInteractions-&gt;begin();
-        InteractionContainer::iterator iiEnd = ncb-&gt;transientInteractions-&gt;end();
-        for(  ; ii!=iiEnd ; ++ii ) 
-        {
-                if ((*ii)-&gt;isReal) 
-                
-                {
-                        SpheresContactGeometry* contact = static_cast&lt;SpheresContactGeometry*&gt; ((*ii)-&gt;interactionGeometry.get());
-                        if ((*(ncb-&gt;bodies))[(*ii)-&gt;getId1()]-&gt;isDynamic)
-                                contact-&gt;radius1 *= multiplier;
-                        if ((*(ncb-&gt;bodies))[(*ii)-&gt;getId2()]-&gt;isDynamic)
-                                contact-&gt;radius2 *= multiplier;
-
-                }
-        }
-}

Deleted: branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController/TriaxialStressController.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController/TriaxialStressController.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController/TriaxialStressController.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,87 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef TRIAXIAL_STRESS_CONTROLLER_HPP
-#define TRIAXIAL_STRESS_CONTROLLER_HPP
-
-#include&lt;yade/core/DeusExMachina.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-
-class PhysicalAction;
-class MetaBody;
-class PhysicalParameters;
-
-
-/*! \brief Controls the stress on the boundaries of a box
-
-	detailed description...
-*/
-
-class TriaxialStressController : public DeusExMachina 
-{
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionParameterForce;
-		int ForceClassIndex;
-		Real previousStress, previousMultiplier; //previous mean stress and size multiplier		
-		
-			
-	public :
-		unsigned int interval, radiusControlInterval;
-		//! index values for retrieving walls
-		int wall_bottom, wall_top, wall_left, wall_right, wall_front, wall_back;
-		//! Defines the prescibed resultant force 
-		Vector3r		force;	
-		//! Stores the value of the translation at the previous time step, stiffness, and normal
-		Vector3r	previousTranslation [6];
-		//! The value of stiffness (updated according to interval) 
-		Real		stiffness [6];
-		Vector3r	normal [6];
-		Vector3r	stress [6];
-		int 		wall_id [6];
-		
-		//Real UnbalancedForce;		
-				
-		//! wallDamping coefficient - wallDamping=0 implies a &quot;perfect&quot; control of the resultant force, wallDamping=1 means no movement
-		Real			wallDamping;
-		//! maximum displacement/cycle (usefull to prevent explosions when stiffness is very low...) 
-
-		Real			maxMultiplier;
-		Real			finalMaxMultiplier;
-		//! switch between &quot;external&quot; (walls) and &quot;internal&quot; (growth of particles) compaction 
-		bool internalCompaction; 
-		
-		
-		int &amp;wall_bottom_id, &amp;wall_top_id, &amp;wall_left_id, &amp;wall_right_id, &amp;wall_front_id, &amp;wall_back_id;
-		bool wall_bottom_activated, wall_top_activated, wall_left_activated, wall_right_activated, wall_front_activated, wall_back_activated;
-		Real height, width, depth;
-		Real thickness; // FIXME should retrieve &quot;extents&quot; of a InteractingBox
-		Real sigma_iso;
-		Real max_vel;
-
-		TriaxialStressController();
-		virtual ~TriaxialStressController();
-	
-		virtual void applyCondition(Body*);
-		void controlExternalStress(int wall, MetaBody* ncb, int id, Vector3r resultantForce, PhysicalParameters* p, Real wall_max_vel);
-		void controlInternalStress(MetaBody* ncb, Real multiplier);
-		void updateStiffness(MetaBody* ncb);
-		Real computeStress(MetaBody* ncb); //Compute stresses on walls and store the values in &quot;Vector3r stress[6]&quot;, return mean stress
-		
-	
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(TriaxialStressController);
-	REGISTER_BASE_CLASS_NAME(DeusExMachina);
-};
-
-REGISTER_SERIALIZABLE(TriaxialStressController,false);
-
-#endif // TRIAXIAL_STRESS_CONTROLLER_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController/TriaxialStressController.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/DeusExMachina/TriaxialStressController/TriaxialStressController.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,173 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingBox2InteractingSphere4SpheresContactGeometry.hpp&quot;
-#include &quot;SpheresContactGeometry.hpp&quot;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-bool InteractingBox2InteractingSphere4SpheresContactGeometry::go(
-		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-		const Se3r&amp; se31,
-		const Se3r&amp; se32,
-		const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	Vector3r l,t,p,q,r;
-	bool onborder = false;
-	Vector3r pt1,pt2,normal;
-	Matrix3r axisT,axis;
-	Real depth;
-
-	InteractingSphere* s = static_cast&lt;InteractingSphere*&gt;(cm2.get());
-	InteractingBox* obb = static_cast&lt;InteractingBox*&gt;(cm1.get());
-	
-	Vector3r extents = obb-&gt;extents;
-
-	se31.orientation.ToRotationMatrix(axisT);
-	axis = axisT.Transpose();
-	
-	p = se32.position-se31.position;
-	
-	l[0] = extents[0];
-	t[0] = axis.GetRow(0).Dot(p); 
-	if (t[0] &lt; -l[0]) { t[0] = -l[0]; onborder = true; }
-	if (t[0] &gt;  l[0]) { t[0] =  l[0]; onborder = true; }
-
-	l[1] = extents[1];
-	t[1] = axis.GetRow(1).Dot(p);
-	if (t[1] &lt; -l[1]) { t[1] = -l[1]; onborder = true; }
-	if (t[1] &gt;  l[1]) { t[1] =  l[1]; onborder = true; }
-
-	l[2] = extents[2];
-	t[2] = axis.GetRow(2).Dot(p);
-	if (t[2] &lt; -l[2]) { t[2] = -l[2]; onborder = true; }
-	if (t[2] &gt;  l[2]) { t[2] =  l[2]; onborder = true; }
-	
-	if (!onborder) 
-	{
-		// sphere center inside box. find largest `t' value
-		Real min = l[0]-fabs(t[0]);
-		int mini = 0;
-		for (int i=1; i&lt;3; i++) 
-		{
-			Real tt = l[i]-fabs(t[i]);
-			if (tt &lt; min) 
-			{
-				min = tt;
-				mini = i;
-			}
-		}
-		
-		// contact normal aligned with box edge along largest `t' value
-		Vector3r tmp = Vector3r(0,0,0);
-
-		tmp[mini] = (t[mini] &gt; 0) ? 1.0 : -1.0;
-		
-		normal = axisT*tmp;
-		
-		normal.Normalize();
-		
-		pt1 = se32.position + normal*min;
-		pt2 = se32.position - normal*s-&gt;radius;	
-
-		// FIXME : remove those uncommented lines
-		shared_ptr&lt;SpheresContactGeometry&gt; scm;
-		if (c-&gt;isNew)
-			scm = shared_ptr&lt;SpheresContactGeometry&gt;(new SpheresContactGeometry());
-		else
-			scm = YADE_PTR_CAST&lt;SpheresContactGeometry&gt;(c-&gt;interactionGeometry);
-			
-		scm-&gt;contactPoint = 0.5*(pt1+pt2);
-		scm-&gt;normal = pt1-pt2;
-		scm-&gt;penetrationDepth = scm-&gt;normal.Normalize();
-		scm-&gt;radius1 = s-&gt;radius*2;
-		scm-&gt;radius2 = s-&gt;radius;
-		c-&gt;interactionGeometry = scm;
-		
-// FIXME : uncommente those lines	
-/////////////////////////////////////////////////
-// 		shared_ptr&lt;SpheresContactGeometry&gt; scm = shared_ptr&lt;SpheresContactGeometry&gt;(new SpheresContactGeometry());
-// 		scm-&gt;contactPoint = 0.5*(pt1+pt2);
-// 		scm-&gt;normal = pt1-pt2;
-// 		scm-&gt;penetrationDepth = scm-&gt;normal.normalize();
-// 		scm-&gt;radius1 = s-&gt;radius*2;
-// 		scm-&gt;radius2 = s-&gt;radius;
-// 		c-&gt;interactionGeometry = scm;
-		
-		return true;	
-	}
-	//FIXME : use else instead and signle return
-	
-	q = axisT*t;
-	r = p - q;
-	
-	depth = s-&gt;radius-sqrt(r.Dot(r));
-	
-	if (depth &lt; 0) 
-		return false;
-
-	pt1 = q + se31.position;
-
-	normal = r;
-	normal.Normalize();
-
-	pt2 = se32.position - normal * s-&gt;radius;
-	
-	// FIXME : remove those uncommented lines
-	shared_ptr&lt;SpheresContactGeometry&gt; scm;
-	if (c-&gt;isNew)
-		scm = shared_ptr&lt;SpheresContactGeometry&gt;(new SpheresContactGeometry());
-	else
-		scm = YADE_PTR_CAST&lt;SpheresContactGeometry&gt;(c-&gt;interactionGeometry);	
-	scm-&gt;contactPoint = 0.5*(pt1+pt2);
-	scm-&gt;normal = pt1-pt2;
-	scm-&gt;penetrationDepth = scm-&gt;normal.Normalize();
-	scm-&gt;radius1 = s-&gt;radius*2;
-	scm-&gt;radius2 = s-&gt;radius;
-	c-&gt;interactionGeometry = scm;
-// FIXME : uncommente those lines	
-/////////////////////////////////////////////////	
-// 	shared_ptr&lt;SpheresContactGeometry&gt; scm = shared_ptr&lt;SpheresContactGeometry&gt;(new SpheresContactGeometry());
-// 	scm-&gt;contactPoint = 0.5*(pt1+pt2);
-// 	scm-&gt;normal = pt1-pt2;
-// 	scm-&gt;penetrationDepth = scm-&gt;normal.normalize();
-// 	scm-&gt;radius1 = s-&gt;radius*2;
-// 	scm-&gt;radius2 = s-&gt;radius;
-// 	c-&gt;interactionGeometry = scm;
-	
-	return true;
-}
-
-
-bool InteractingBox2InteractingSphere4SpheresContactGeometry::goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	bool isInteracting = go(cm2,cm1,se32,se31,c);
-	if (isInteracting)
-	{
-		SpheresContactGeometry* scm = static_cast&lt;SpheresContactGeometry*&gt;(c-&gt;interactionGeometry.get());
-		//Vector3r tmp = scm-&gt;closestsPoints[0].first;		
-		//scm-&gt;closestsPoints[0].first = scm-&gt;closestsPoints[0].second;
-		//scm-&gt;closestsPoints[0].second = tmp;
-		scm-&gt;normal = -scm-&gt;normal;
-		Real tmpR  = scm-&gt;radius1;
-		scm-&gt;radius1 = scm-&gt;radius2;
-		scm-&gt;radius2 = tmpR;
-	}
-	return isInteracting;
-}
-

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,40 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BOX2SPHERE4SDECCONTACTMODEL_HPP
-#define BOX2SPHERE4SDECCONTACTMODEL_HPP
-
-#include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
-
-class InteractingBox2InteractingSphere4SpheresContactGeometry : public InteractionGeometryEngineUnit
-{
-	public :
-		virtual bool go(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-		virtual bool goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-	REGISTER_CLASS_NAME(InteractingBox2InteractingSphere4SpheresContactGeometry);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
-
-	DEFINE_FUNCTOR_ORDER_2D(InteractingBox,InteractingSphere);
-};
-
-REGISTER_SERIALIZABLE(InteractingBox2InteractingSphere4SpheresContactGeometry,false);
-
-#endif // __BOX2SPHERE4SDECCONTACTMODEL_H__
-

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB/InteractingMyTetrahedron2AABB.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB/InteractingMyTetrahedron2AABB.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB/InteractingMyTetrahedron2AABB.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,45 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#include &quot;InteractingMyTetrahedron2AABB.hpp&quot;
-#include &quot;InteractingMyTetrahedron.hpp&quot;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-void InteractingMyTetrahedron2AABB::go(	  const shared_ptr&lt;InteractingGeometry&gt;&amp; cm
-				, shared_ptr&lt;BoundingVolume&gt;&amp; bv
-				, const Se3r&amp; se3
-				, const Body*	)
-{
-	InteractingMyTetrahedron* myTet = static_cast&lt;InteractingMyTetrahedron*&gt;(cm.get());
-	AABB* aabb = static_cast&lt;AABB*&gt;(bv.get());
-
-	// create a bounding volume from four spheres ( InteractingMyTetrahedron )
-	Vector3r min = Vector3r(0,0,0);
-	min = componentMinVector(min,se3.orientation*myTet-&gt;c1 - Vector3r(myTet-&gt;r1,myTet-&gt;r1,myTet-&gt;r1));
-	min = componentMinVector(min,se3.orientation*myTet-&gt;c2 - Vector3r(myTet-&gt;r2,myTet-&gt;r2,myTet-&gt;r2));
-	min = componentMinVector(min,se3.orientation*myTet-&gt;c3 - Vector3r(myTet-&gt;r3,myTet-&gt;r3,myTet-&gt;r3));
-	min = componentMinVector(min,se3.orientation*myTet-&gt;c4 - Vector3r(myTet-&gt;r4,myTet-&gt;r4,myTet-&gt;r4));
-	min += se3.position;
-
-	Vector3r max = Vector3r(0,0,0);
-	max = componentMaxVector(min,se3.orientation*myTet-&gt;c1 + Vector3r(myTet-&gt;r1,myTet-&gt;r1,myTet-&gt;r1));
-	max = componentMaxVector(min,se3.orientation*myTet-&gt;c2 + Vector3r(myTet-&gt;r2,myTet-&gt;r2,myTet-&gt;r2));
-	max = componentMaxVector(min,se3.orientation*myTet-&gt;c3 + Vector3r(myTet-&gt;r3,myTet-&gt;r3,myTet-&gt;r3));
-	max = componentMaxVector(min,se3.orientation*myTet-&gt;c4 + Vector3r(myTet-&gt;r4,myTet-&gt;r4,myTet-&gt;r4));
-	max += se3.position;
-
-	// AABB
-	aabb-&gt;center = (min+max)*0.5;
-	aabb-&gt;halfSize = (max-min)*0.5;
-	
-	// BoundingVolume
-	aabb-&gt;min = min;
-	aabb-&gt;max = max;	
-}
-	

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB/InteractingMyTetrahedron2AABB.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB/InteractingMyTetrahedron2AABB.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB/InteractingMyTetrahedron2AABB.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,39 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
- 
-#ifndef INTERACTING_MY_TETRAHEDRON_2AABB_HPP
-#define INTERACTING_MY_TETRAHEDRON_2AABB_HPP
-
-#include&lt;yade/pkg-common/BoundingVolumeEngineUnit.hpp&gt;
-
-/*! 
- * \brief This class exists for the sole purpose of creating AABB
- * (AxisAligneBoundingBox) from class InteractingMyTetrahedron
- *
- * AABB is used by class PersistentSAPCollider to detect possible interaction between two
- * bodies. Once you write this class for your InteractingGeometry, interactions
- * will be automatically detected and created for you.
- *
- * See also the explanation in TetrahedronsTest
- *
-*/
-
-class InteractingMyTetrahedron2AABB : public BoundingVolumeEngineUnit
-{
-	public :
-		void go(	  const shared_ptr&lt;InteractingGeometry&gt;&amp; cm
-				, shared_ptr&lt;BoundingVolume&gt;&amp; bv
-				, const Se3r&amp; se3
-				, const Body*	);
-	REGISTER_CLASS_NAME(InteractingMyTetrahedron2AABB);
-	REGISTER_BASE_CLASS_NAME(BoundingVolumeEngineUnit);
-};
-
-REGISTER_SERIALIZABLE(InteractingMyTetrahedron2AABB,false);
-
-#endif // INTERACTING_MY_TETRAHEDRON_2AABB_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB/InteractingMyTetrahedron2AABB.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2AABB/InteractingMyTetrahedron2AABB.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,133 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.hpp&quot;
-#include &quot;InteractionOfMyTetrahedron.hpp&quot;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include &quot;InteractingMyTetrahedron.hpp&quot;
-#include &quot;../InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.hpp&quot;
-#include &lt;boost/shared_ptr.hpp&gt;
-#include &quot;SpheresContactGeometry.hpp&quot;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-void InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron::calcSphereAndBox(
-		Vector3r c1,
-		Real r1,
-		Vector3r&amp; extents,
-		const Se3r&amp; se3Box,
-		Real&amp; penetrationDepth,
-		Vector3r&amp; normal,
-		Vector3r&amp; contactPoint)
-{
-	// I will call here a function InteractingBox2InteractingSphere4SpheresContactGeometry::go()
-	// and extract results from it, because it's a lengty calculation.
-	//
-	// to do this I must link with this class inside .pro file, otherwise it will compile, but linker will fail
-	
-	InteractingBox2InteractingSphere4SpheresContactGeometry worker;
-
-	// Box
-	boost::shared_ptr&lt;InteractingGeometry&gt;	box(new InteractingBox);
-	static_cast&lt;InteractingBox*&gt;(box.get())-&gt;extents = extents;
-
-	// Sphere
-	boost::shared_ptr&lt;InteractingGeometry&gt;	sphere(new InteractingSphere);
-	static_cast&lt;InteractingSphere*&gt;(sphere.get())-&gt;radius = r1;
-	Se3r seSphere;
-	seSphere.position = c1;
-	//seSphere.orientation = ; // left uninitalized with random numbers, because is not used
-
-	// empty interaction
-	boost::shared_ptr&lt;Interaction&gt;		interaction(new Interaction);
-	
-	// do the work. Note that box is before sphere (**), just like the lenghty class name indicates.
-	bool isInteracting = worker.go(box,sphere,se3Box,seSphere,interaction);
-
-	SpheresContactGeometry* result = dynamic_cast&lt;SpheresContactGeometry*&gt;(interaction-&gt;interactionGeometry.get());
-
-	if(isInteracting)
-	{
-		penetrationDepth	= result-&gt;penetrationDepth;
-		normal			= -1.0*(result-&gt;normal); // -1.0 because of different order: tetrahedron before box (**)
-		contactPoint		= result-&gt;contactPoint;
-	}
-	else
-		penetrationDepth	= -1.0;
-
-}
-
-bool InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron::go(	
-		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-		const Se3r&amp; se31,
-		const Se3r&amp; se32,
-		const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	InteractingMyTetrahedron* t = static_cast&lt;InteractingMyTetrahedron*&gt;(cm1.get());
-	InteractingBox*	b = static_cast&lt;InteractingBox*&gt;(cm2.get());
-
-	shared_ptr&lt;InteractionOfMyTetrahedron&gt; imt;
-	// depending whether it's a new interaction: create new one, or use the existing one.
-	if (c-&gt;isNew)
-		imt = shared_ptr&lt;InteractionOfMyTetrahedron&gt;(new InteractionOfMyTetrahedron());
-	else
-		imt = YADE_PTR_CAST&lt;InteractionOfMyTetrahedron&gt;(c-&gt;interactionGeometry);	
-
-
-
-	bool isInteracting = false;
-	for(int i=0 ; i&lt;4 ; ++i )
-	{
-		// both sphere and a box must be calculated in global coordinate system
-		calcSphereAndBox(	
-			se31.orientation*(&amp;(t-&gt;c1))[i]+se31.position,
-			(&amp;(t-&gt;r1))[i],
-
-			b-&gt;extents,
-			se32,
-
-			imt-&gt;penetrationDepths[i][0], imt-&gt;normals[i][0], imt-&gt;contactPoints[i][0] );
-
-		if( imt-&gt;penetrationDepths[i][0] &gt; 0 )
-			isInteracting = true;
-
-		imt-&gt;penetrationDepths[i][0] /= 4.0; // scatter this penetration along four emulated spheres.
-		for(int j=1 ; j&lt;4 ; ++j )
-		{
-			imt-&gt;penetrationDepths[i][j]	= imt-&gt;penetrationDepths[i][0];
-			imt-&gt;normals[i][j]		= imt-&gt;normals[i][0];
-			imt-&gt;contactPoints[i][j]	= imt-&gt;contactPoints[i][0];
-		}
-	}
-
-	c-&gt;interactionGeometry = imt;
-	return isInteracting;
-
-}
-
-bool InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron::goReverse(
-		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-		const Se3r&amp; se31,
-		const Se3r&amp; se32,
-		const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	bool isInteracting = go(cm2,cm1,se32,se31,c);
-	if (isInteracting)
-	{
-		InteractionOfMyTetrahedron* itm = static_cast&lt;InteractionOfMyTetrahedron*&gt;(c-&gt;interactionGeometry.get());
-		// reverse direction of normals
-		for(int i=0 ; i&lt;4 ; ++i )
-			for(int j=0 ; j&lt;4 ; ++j)
-				itm-&gt;normals[i][j] =  -1.0*( itm-&gt;normals[i][j] );
-	}
-	return isInteracting;
-}
-

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,49 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTINGMYTETRAHEDRON2INTERACTINGBOX4INTERACTIONOFMYTETRAHEDRON_HPP
-#define INTERACTINGMYTETRAHEDRON2INTERACTINGBOX4INTERACTIONOFMYTETRAHEDRON_HPP
-
-#include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
-
-/*! 
- * \brief This class exists for the sole purpose of creating InteractionOfMyTetrahedron
- * from colliding InteractingMyTetrahedron with InteractingBox
- *
- * so it must loop through four spheres and calculate for each of them a
- * penetration depth and normal direction of interaction with a box.
- * I will have to fill 4x4 matrix, so I need to emulate that box has four spheres.
- *
-*/
-
-class InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron : public InteractionGeometryEngineUnit
-{
-	public :
-		virtual bool go(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-		virtual bool goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-		
-		void calcSphereAndBox(	Vector3r c1, Real r1, Vector3r&amp; extents, const Se3r&amp; se3Box, Real&amp; penetrationDepth, Vector3r&amp; normal, Vector3r&amp; cp);
-
-	REGISTER_CLASS_NAME(InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
-
-	DEFINE_FUNCTOR_ORDER_2D(InteractingMyTetrahedron,InteractingBox);
-};
-
-REGISTER_SERIALIZABLE(InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron,false);
-
-#endif // INTERACTINGMYTETRAHEDRON2INTERACTINGBOX4INTERACTIONOFMYTETRAHEDRON_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.cpp)
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.cpp	2007-03-07 12:02:48 UTC (rev 1105)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -0,0 +1,133 @@
+/*************************************************************************
+*  Copyright (C) 2004 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include &quot;InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.hpp&quot;
+#include &quot;InteractionOfMyTetrahedron.hpp&quot;
+#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
+#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
+#include &quot;InteractingMyTetrahedron.hpp&quot;
+#include&lt;yade/pkg-dem/InteractingBox2InteractingSphere4SpheresContactGeometry.hpp&gt;
+#include &lt;boost/shared_ptr.hpp&gt;
+#include &quot;SpheresContactGeometry.hpp&quot;
+#include&lt;yade/core/Interaction.hpp&gt;
+#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
+
+void InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron::calcSphereAndBox(
+		Vector3r c1,
+		Real r1,
+		Vector3r&amp; extents,
+		const Se3r&amp; se3Box,
+		Real&amp; penetrationDepth,
+		Vector3r&amp; normal,
+		Vector3r&amp; contactPoint)
+{
+	// I will call here a function InteractingBox2InteractingSphere4SpheresContactGeometry::go()
+	// and extract results from it, because it's a lengty calculation.
+	//
+	// to do this I must link with this class inside .pro file, otherwise it will compile, but linker will fail
+	
+	InteractingBox2InteractingSphere4SpheresContactGeometry worker;
+
+	// Box
+	boost::shared_ptr&lt;InteractingGeometry&gt;	box(new InteractingBox);
+	static_cast&lt;InteractingBox*&gt;(box.get())-&gt;extents = extents;
+
+	// Sphere
+	boost::shared_ptr&lt;InteractingGeometry&gt;	sphere(new InteractingSphere);
+	static_cast&lt;InteractingSphere*&gt;(sphere.get())-&gt;radius = r1;
+	Se3r seSphere;
+	seSphere.position = c1;
+	//seSphere.orientation = ; // left uninitalized with random numbers, because is not used
+
+	// empty interaction
+	boost::shared_ptr&lt;Interaction&gt;		interaction(new Interaction);
+	
+	// do the work. Note that box is before sphere (**), just like the lenghty class name indicates.
+	bool isInteracting = worker.go(box,sphere,se3Box,seSphere,interaction);
+
+	SpheresContactGeometry* result = dynamic_cast&lt;SpheresContactGeometry*&gt;(interaction-&gt;interactionGeometry.get());
+
+	if(isInteracting)
+	{
+		penetrationDepth	= result-&gt;penetrationDepth;
+		normal			= -1.0*(result-&gt;normal); // -1.0 because of different order: tetrahedron before box (**)
+		contactPoint		= result-&gt;contactPoint;
+	}
+	else
+		penetrationDepth	= -1.0;
+
+}
+
+bool InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron::go(	
+		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
+		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
+		const Se3r&amp; se31,
+		const Se3r&amp; se32,
+		const shared_ptr&lt;Interaction&gt;&amp; c)
+{
+	InteractingMyTetrahedron* t = static_cast&lt;InteractingMyTetrahedron*&gt;(cm1.get());
+	InteractingBox*	b = static_cast&lt;InteractingBox*&gt;(cm2.get());
+
+	shared_ptr&lt;InteractionOfMyTetrahedron&gt; imt;
+	// depending whether it's a new interaction: create new one, or use the existing one.
+	if (c-&gt;isNew)
+		imt = shared_ptr&lt;InteractionOfMyTetrahedron&gt;(new InteractionOfMyTetrahedron());
+	else
+		imt = YADE_PTR_CAST&lt;InteractionOfMyTetrahedron&gt;(c-&gt;interactionGeometry);	
+
+
+
+	bool isInteracting = false;
+	for(int i=0 ; i&lt;4 ; ++i )
+	{
+		// both sphere and a box must be calculated in global coordinate system
+		calcSphereAndBox(	
+			se31.orientation*(&amp;(t-&gt;c1))[i]+se31.position,
+			(&amp;(t-&gt;r1))[i],
+
+			b-&gt;extents,
+			se32,
+
+			imt-&gt;penetrationDepths[i][0], imt-&gt;normals[i][0], imt-&gt;contactPoints[i][0] );
+
+		if( imt-&gt;penetrationDepths[i][0] &gt; 0 )
+			isInteracting = true;
+
+		imt-&gt;penetrationDepths[i][0] /= 4.0; // scatter this penetration along four emulated spheres.
+		for(int j=1 ; j&lt;4 ; ++j )
+		{
+			imt-&gt;penetrationDepths[i][j]	= imt-&gt;penetrationDepths[i][0];
+			imt-&gt;normals[i][j]		= imt-&gt;normals[i][0];
+			imt-&gt;contactPoints[i][j]	= imt-&gt;contactPoints[i][0];
+		}
+	}
+
+	c-&gt;interactionGeometry = imt;
+	return isInteracting;
+
+}
+
+bool InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron::goReverse(
+		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
+		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
+		const Se3r&amp; se31,
+		const Se3r&amp; se32,
+		const shared_ptr&lt;Interaction&gt;&amp; c)
+{
+	bool isInteracting = go(cm2,cm1,se32,se31,c);
+	if (isInteracting)
+	{
+		InteractionOfMyTetrahedron* itm = static_cast&lt;InteractionOfMyTetrahedron*&gt;(c-&gt;interactionGeometry.get());
+		// reverse direction of normals
+		for(int i=0 ; i&lt;4 ; ++i )
+			for(int j=0 ; j&lt;4 ; ++j)
+				itm-&gt;normals[i][j] =  -1.0*( itm-&gt;normals[i][j] );
+	}
+	return isInteracting;
+}
+

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,93 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.hpp&quot;
-#include &quot;InteractionOfMyTetrahedron.hpp&quot;
-#include &quot;InteractingMyTetrahedron.hpp&quot;
-
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-void InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron::calcTwoSpheres(
-		Vector3r c1, Real r1, Vector3r c2, Real r2, Real&amp; penetrationDepth, Vector3r&amp; normal, Vector3r&amp; contactPoint)
-{
-	// I could call here a function in InteractingSphere2InteractingSphere4SpheresContactGeometry::go()
-	// and extract results from it, but those three lines are much shorter :)
-	normal = c2 - c1;
-	contactPoint = (c1 + c2)*0.5;
-	Real length = normal.Normalize();
-	penetrationDepth = ( r2 + r1 ) - length; // positive: penetration exists
-}
-
-bool InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron::go(	
-		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-		const Se3r&amp; se31,
-		const Se3r&amp; se32,
-		const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	InteractingMyTetrahedron* t1 = static_cast&lt;InteractingMyTetrahedron*&gt;(cm1.get());
-	InteractingMyTetrahedron* t2 = static_cast&lt;InteractingMyTetrahedron*&gt;(cm2.get());
-	
-	shared_ptr&lt;InteractionOfMyTetrahedron&gt; imt;
-	// depending whether it's a new interaction: create new one, or use the existing one.
-	if (c-&gt;isNew)
-		imt = shared_ptr&lt;InteractionOfMyTetrahedron&gt;(new InteractionOfMyTetrahedron());
-	else
-		imt = YADE_PTR_CAST&lt;InteractionOfMyTetrahedron&gt;(c-&gt;interactionGeometry);	
-
-	bool isInteracting = false;
-	for(int i=0 ; i&lt;4 ; ++i )
-		for(int j=0 ; j&lt;4 ; ++j)
-		{
-			// both spheres must be calculated in global coordinate system
-			//
-			// c1,c2,c3,c4 are sphere centers in local coordinate system of tetrahedron,
-			//             they must by rotated, so that they have the rotation of tetrahedron
-			//             they must be translated, so that they have global coordinates of tetrahedron
-			calcTwoSpheres(	
-				// (Quaternionr)orientation * (Vector3r)(c1)     : rotates the sphere center from local into global coordinate system.
-				//                             + se31.position   : translates it, to stay in the x,y,z in global coordinate system
-				se31.orientation*(&amp;(t1-&gt;c1))[i]+se31.position,
-
-				(&amp;(t1-&gt;r1))[i], // radius of sphere from first InteractingMyTetrahedron
-
-				se32.orientation*(&amp;(t2-&gt;c1))[j]+se32.position,
-				(&amp;(t2-&gt;r1))[j],
-
-				imt-&gt;penetrationDepths[i][j], imt-&gt;normals[i][j], imt-&gt;contactPoints[i][j] );
-
-			if( imt-&gt;penetrationDepths[i][j] &gt; 0 )
-				isInteracting = true;
-		}
-
-
-	c-&gt;interactionGeometry = imt;
-	return isInteracting;
-}
-
-
-bool InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron::goReverse(
-		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-		const Se3r&amp; se31,
-		const Se3r&amp; se32,
-		const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	bool isInteracting = go(cm2,cm1,se32,se31,c);
-	if (isInteracting)
-	{
-		InteractionOfMyTetrahedron* itm = static_cast&lt;InteractionOfMyTetrahedron*&gt;(c-&gt;interactionGeometry.get());
-		// reverse direction of normals
-		for(int i=0 ; i&lt;4 ; ++i )
-			for(int j=0 ; j&lt;4 ; ++j)
-				itm-&gt;normals[i][j] =  -1.0*( itm-&gt;normals[i][j] );
-	}
-	return isInteracting;
-}
-

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,52 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef INTERACTINGMYTETRAHEDRON2INTERACTINGMYTETRAHEDRON4INTERACTIONOFMYTETRAHEDRON_HPP
-#define INTERACTINGMYTETRAHEDRON2INTERACTINGMYTETRAHEDRON4INTERACTIONOFMYTETRAHEDRON_HPP
-
-#include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
-
-/*! 
- * \brief This class exists for the sole purpose of creating InteractionOfMyTetrahedron
- * from two colliding InteractingMyTetrahedron(s)
- *
- * so it must loop through all four x four spheres, and calculate for each of them a
- * penetration depth and normal direction. Thus filling 4x4 matrix.
- *
- * Vaclav: For example if you decide that InteractingMyTetrahedron is a real
- * tetrahedron, then maybe instead of calculating penetrationDepths you will
- * want to calculate the overlapping volume.
- *
-*/
-
-class InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron : public InteractionGeometryEngineUnit
-{
-	public :
-		virtual bool go(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-		virtual bool goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-		
-		void calcTwoSpheres(	Vector3r c1, Real r1, Vector3r c2, Real r2, Real&amp; penetrationDepth, Vector3r&amp; normal, Vector3r&amp; cp);
-
-	REGISTER_CLASS_NAME(InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
-
-	DEFINE_FUNCTOR_ORDER_2D(InteractingMyTetrahedron,InteractingMyTetrahedron);
-};
-
-REGISTER_SERIALIZABLE(InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron,false);
-
-#endif // INTERACTINGMYTETRAHEDRON2INTERACTINGMYTETRAHEDRON4INTERACTIONOFMYTETRAHEDRON_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,93 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp&quot;
-#include &quot;SpheresContactGeometry.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-InteractingSphere2InteractingSphere4SpheresContactGeometry::InteractingSphere2InteractingSphere4SpheresContactGeometry()
-{
-	InteractionDetectionFactor = 1;
-}
-
-void InteractingSphere2InteractingSphere4SpheresContactGeometry::registerAttributes()
-{	
-	REGISTER_ATTRIBUTE(InteractionDetectionFactor);
-}
-
-bool InteractingSphere2InteractingSphere4SpheresContactGeometry::go(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-							const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-							const Se3r&amp; se31,
-							const Se3r&amp; se32,
-							const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	InteractingSphere* s1 = static_cast&lt;InteractingSphere*&gt;(cm1.get());
-	InteractingSphere* s2 = static_cast&lt;InteractingSphere*&gt;(cm2.get());
-
-	Vector3r normal = se32.position-se31.position;
-	Real penetrationDepth = pow(InteractionDetectionFactor*(s1-&gt;radius+s2-&gt;radius), 2) - normal.SquaredLength();// Compute a wrong value just to check sign - faster than computing distances
-	//Real penetrationDepth = s1-&gt;radius+s2-&gt;radius-normal.Normalize();
-
-	shared_ptr&lt;SpheresContactGeometry&gt; scm;
-	if (c-&gt;interactionGeometry)
-	{
-		//scm = YADE_PTR_CAST&lt;SpheresContactGeometry&gt;(c-&gt;interactionGeometry);
-		scm = static_pointer_cast&lt;SpheresContactGeometry&gt;(c-&gt;interactionGeometry);
-	// BEGIN .......  FIXME FIXME	- wrong hack, to make cohesion work.
-		if(! scm) // this is not SpheresContactGeometry, so it is SDECLinkGeometry, dispatcher should do this job.
-		{
-			shared_ptr&lt;SDECLinkGeometry&gt; linkGeometry = dynamic_pointer_cast&lt;SDECLinkGeometry&gt;(c-&gt;interactionGeometry);
-//			cerr &lt;&lt; &quot;it is SpringGeometry ???: &quot; &lt;&lt; c-&gt;interactionGeometry-&gt;getClassName() &lt;&lt; endl;
-//			assert(linkGeometry);
-			if(linkGeometry)
-			{
-				linkGeometry-&gt;normal 			= se32.position-se31.position;
-				linkGeometry-&gt;normal.Normalize();
-				return true;
-			}
-			else
-				return false; // SpringGeometry !!!???????
-		}
-	// END
-	}
-	else
-		scm = shared_ptr&lt;SpheresContactGeometry&gt;(new SpheresContactGeometry());
-		
-	if (penetrationDepth&gt;0)
-	{
-		penetrationDepth = s1-&gt;radius+s2-&gt;radius-normal.Normalize();
-		scm-&gt;contactPoint = se31.position+(s1-&gt;radius-0.5*penetrationDepth)*normal;//0.5*(pt1+pt2);
-		scm-&gt;normal = normal;
-		scm-&gt;penetrationDepth = penetrationDepth;
-		scm-&gt;radius1 = s1-&gt;radius;
-		scm-&gt;radius2 = s2-&gt;radius;
-				
-		if (!c-&gt;interactionGeometry)
-			c-&gt;interactionGeometry = scm;
-	
-		return true;
-	}
-	else return false;
-}
-
-
-bool InteractingSphere2InteractingSphere4SpheresContactGeometry::goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-								const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-								const Se3r&amp; se31,
-								const Se3r&amp; se32,
-								const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	return go(cm1,cm2,se31,se32,c);
-}
-

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,45 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SPHERE2SPHERE4MACROMICROCONTACTGEOMETRY_HPP
-#define SPHERE2SPHERE4MACROMICROCONTACTGEOMETRY_HPP
-
-#include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
-
-class InteractingSphere2InteractingSphere4SpheresContactGeometry : public InteractionGeometryEngineUnit
-{
-	public :
-		virtual bool go(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-		virtual bool goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-					
-		InteractingSphere2InteractingSphere4SpheresContactGeometry();		
-					
-		double InteractionDetectionFactor;// InteractionGeometry will be computed when InteractionDetectionFactor*(rad1+rad2) &gt; distance 		
-	
-
-	REGISTER_CLASS_NAME(InteractingSphere2InteractingSphere4SpheresContactGeometry);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
-
-	DEFINE_FUNCTOR_ORDER_2D(InteractingSphere,InteractingSphere);
-	
-	protected :
-		virtual void registerAttributes();
-};
-
-REGISTER_SERIALIZABLE(InteractingSphere2InteractingSphere4SpheresContactGeometry,false);
-
-#endif // SPHERE2SPHERE4MACROMICROCONTACTGEOMETRY_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry/InteractingSphere2InteractingSphere4SpheresContactGeometry.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships/MacroMicroElasticRelationships.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships/MacroMicroElasticRelationships.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships/MacroMicroElasticRelationships.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,128 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;MacroMicroElasticRelationships.hpp&quot;
-#include &quot;SpheresContactGeometry.hpp&quot;
-#include &quot;ElasticContactInteraction.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot; // FIXME - I can't dispatch by SDECLinkGeometry &lt;-&gt; SpheresContactGeometry !!?
-#include &quot;SDECLinkPhysics.hpp&quot; // FIXME
-#include &quot;BodyMacroParameters.hpp&quot;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-MacroMicroElasticRelationships::MacroMicroElasticRelationships()
-{
-	alpha 	= 2.5;
-	beta 	= 2.0;
-	gamma 	= 2.65;
-}
-
-
-void MacroMicroElasticRelationships::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(alpha);
-	REGISTER_ATTRIBUTE(beta);
-	REGISTER_ATTRIBUTE(gamma);
-}
-
-
-void MacroMicroElasticRelationships::go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp; b1 // BodyMacroParameters
-					, const shared_ptr&lt;PhysicalParameters&gt;&amp; b2 // BodyMacroParameters
-					, const shared_ptr&lt;Interaction&gt;&amp; interaction)
-{
-	BodyMacroParameters* sdec1 = static_cast&lt;BodyMacroParameters*&gt;(b1.get());
-	BodyMacroParameters* sdec2 = static_cast&lt;BodyMacroParameters*&gt;(b2.get());
-	SpheresContactGeometry* interactionGeometry = dynamic_cast&lt;SpheresContactGeometry*&gt;(interaction-&gt;interactionGeometry.get());
-	
-	if(interactionGeometry) // so it is SpheresContactGeometry  - NON PERMANENT LINK
-	{
-
-/* OLD VERSION  this is a LinearContactModel, different class, model different that MicroMacroElasticRelationships
-another would be HerzMindlinContactModel
-
-		shared_ptr&lt;ElasticContactInteraction&gt; contactPhysics;
-		
-		if ( interaction-&gt;isNew)
-		{
-			interaction-&gt;interactionPhysics = shared_ptr&lt;ElasticContactInteraction&gt;(new ElasticContactInteraction());
-			contactPhysics = YADE_PTR_CAST&lt;ElasticContactInteraction&gt;(interaction-&gt;interactionPhysics);
-			
-			contactPhysics-&gt;initialKn			= 2*(sdec1-&gt;kn*sdec2-&gt;kn)/(sdec1-&gt;kn+sdec2-&gt;kn);
-			contactPhysics-&gt;initialKs			= 2*(sdec1-&gt;ks*sdec2-&gt;ks)/(sdec1-&gt;ks+sdec2-&gt;ks);
-			contactPhysics-&gt;prevNormal 			= interactionGeometry-&gt;normal;
-			contactPhysics-&gt;initialEquilibriumDistance	= interactionGeometry-&gt;radius1+interactionGeometry-&gt;radius2;
-		}
-		else
-			contactPhysics = YADE_PTR_CAST&lt;ElasticContactInteraction&gt;(interaction-&gt;interactionPhysics);
-		
-		contactPhysics-&gt;kn = contactPhysics-&gt;initialKn;
-		contactPhysics-&gt;ks = contactPhysics-&gt;initialKs;
-		contactPhysics-&gt;equilibriumDistance = contactPhysics-&gt;initialEquilibriumDistance;
-*/
-		if( interaction-&gt;isNew)
-		{
-			interaction-&gt;interactionPhysics = shared_ptr&lt;ElasticContactInteraction&gt;(new ElasticContactInteraction());
-			ElasticContactInteraction* contactPhysics = YADE_CAST&lt;ElasticContactInteraction*&gt;(interaction-&gt;interactionPhysics.get());
-
-			Real Ea 	= sdec1-&gt;young;
-			Real Eb 	= sdec2-&gt;young;
-			Real Va 	= sdec1-&gt;poisson;
-			Real Vb 	= sdec2-&gt;poisson;
-			Real Da 	= interactionGeometry-&gt;radius1; // FIXME - multiply by factor of sphere interaction distance (so sphere intaracts at bigger range that its geometrical size)
-			Real Db 	= interactionGeometry-&gt;radius2; // FIXME - as above
-			Real fa 	= sdec1-&gt;frictionAngle;
-			Real fb 	= sdec2-&gt;frictionAngle;
-
-			Real Eab	= 2*Ea*Eb/(Ea+Eb);
-			Real Vab	= 2*Va*Vb/(Va+Vb);
-
-			Real Dinit 	= Da+Db; 			// FIXME - is it just a sum?
-			Real Sinit 	= Mathr::PI * std::pow( std::min(Da,Db) , 2);
-
-			Real Kn						= (Eab*Sinit/Dinit)*( (1+alpha)/(beta*(1+Vab) + gamma*(1-alpha*Vab) ) );
-//cerr &lt;&lt; &quot;Kn: &quot; &lt;&lt; Kn &lt;&lt; endl;
-			contactPhysics-&gt;initialKn			= Kn;
-			contactPhysics-&gt;initialKs			= Kn*(1-alpha*Vab)/(1+Vab);
-//cerr &lt;&lt; &quot;Ks: &quot; &lt;&lt;       contactPhysics-&gt;initialKs			&lt;&lt; endl;
-			contactPhysics-&gt;frictionAngle			= (fa+fb)*0.5; // FIXME - this is actually a waste of memory space, just like initialKs and initialKn
-			contactPhysics-&gt;tangensOfFrictionAngle		= std::tan(contactPhysics-&gt;frictionAngle); 
-
-			contactPhysics-&gt;prevNormal 			= interactionGeometry-&gt;normal;
-			contactPhysics-&gt;initialEquilibriumDistance	= Dinit;			
-
-			contactPhysics-&gt;kn = contactPhysics-&gt;initialKn;
-			contactPhysics-&gt;ks = contactPhysics-&gt;initialKs;
-			contactPhysics-&gt;equilibriumDistance = contactPhysics-&gt;initialEquilibriumDistance;
-
-		}
-		else
-		{	// FIXME - are those lines necessary ???? what they are doing in fact ???
-			ElasticContactInteraction* contactPhysics = YADE_CAST&lt;ElasticContactInteraction*&gt;(interaction-&gt;interactionPhysics.get());
-
-			contactPhysics-&gt;kn = contactPhysics-&gt;initialKn;
-			contactPhysics-&gt;ks = contactPhysics-&gt;initialKs;
-			contactPhysics-&gt;equilibriumDistance = contactPhysics-&gt;initialEquilibriumDistance;
-		}	
-		
-	}
-	else   // this is PERMANENT LINK because previous dynamic_cast failed, dispatcher should do this job
-	{
-		SDECLinkGeometry* sdecLinkGeometry =  dynamic_cast&lt;SDECLinkGeometry*&gt;(interaction-&gt;interactionGeometry.get());
-		if (sdecLinkGeometry)
-		{		
-			SDECLinkPhysics* linkPhysics = static_cast&lt;SDECLinkPhysics*&gt;(interaction-&gt;interactionPhysics.get());
-	//		linkPhysics-&gt;frictionAngle 		= ?? //FIXME - uninitialized 
-			linkPhysics-&gt;kn 			= linkPhysics-&gt;initialKn;
-			linkPhysics-&gt;ks 			= linkPhysics-&gt;initialKs;
-			linkPhysics-&gt;equilibriumDistance 	= linkPhysics-&gt;initialEquilibriumDistance;
-		}
-	}
-};

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships/MacroMicroElasticRelationships.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships/MacroMicroElasticRelationships.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships/MacroMicroElasticRelationships.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SDECLINEARCONTACTMODEL_HPP
-#define SDECLINEARCONTACTMODEL_HPP
-
-#include&lt;yade/pkg-common/InteractionPhysicsEngineUnit.hpp&gt;
-
-class MacroMicroElasticRelationships : public InteractionPhysicsEngineUnit
-{
-	public :
-		Real		 alpha
-				,beta
-				,gamma;
-
-		MacroMicroElasticRelationships();
-
-		virtual void go(	const shared_ptr&lt;PhysicalParameters&gt;&amp; b1,
-					const shared_ptr&lt;PhysicalParameters&gt;&amp; b2,
-					const shared_ptr&lt;Interaction&gt;&amp; interaction);
-
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(MacroMicroElasticRelationships);
-	REGISTER_BASE_CLASS_NAME(InteractionPhysicsEngineUnit);
-
-};
-
-REGISTER_SERIALIZABLE(MacroMicroElasticRelationships,false);
-
-#endif // __SDECLINEARCONTACTMODEL_HPP__
-

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships/MacroMicroElasticRelationships.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/MacroMicroElasticRelationships/MacroMicroElasticRelationships.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships/SimpleElasticRelationships.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships/SimpleElasticRelationships.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships/SimpleElasticRelationships.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,100 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2007 by Bruno CHAREYRE                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">bruno.chareyre at hmg.inpg.fr</A>                                        *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;SimpleElasticRelationships.hpp&quot;
-#include &quot;SpheresContactGeometry.hpp&quot;
-#include &quot;ElasticContactInteraction.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot; // FIXME - I can't dispatch by SDECLinkGeometry &lt;-&gt; SpheresContactGeometry !!?
-#include &quot;SDECLinkPhysics.hpp&quot; // FIXME
-#include &quot;BodyMacroParameters.hpp&quot;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-SimpleElasticRelationships::SimpleElasticRelationships()
-{
-
-}
-
-
-void SimpleElasticRelationships::registerAttributes()
-{
-	
-}
-
-
-void SimpleElasticRelationships::go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp; b1 // BodyMacroParameters
-					, const shared_ptr&lt;PhysicalParameters&gt;&amp; b2 // BodyMacroParameters
-					, const shared_ptr&lt;Interaction&gt;&amp; interaction)
-{
-	BodyMacroParameters* sdec1 = static_cast&lt;BodyMacroParameters*&gt;(b1.get());
-	BodyMacroParameters* sdec2 = static_cast&lt;BodyMacroParameters*&gt;(b2.get());
-	SpheresContactGeometry* interactionGeometry = dynamic_cast&lt;SpheresContactGeometry*&gt;(interaction-&gt;interactionGeometry.get());
-	
-	if(interactionGeometry) // so it is SpheresContactGeometry  - NON PERMANENT LINK
-	{
-		if( interaction-&gt;isNew)
-		{
-			interaction-&gt;interactionPhysics = shared_ptr&lt;ElasticContactInteraction&gt;(new ElasticContactInteraction());
-			ElasticContactInteraction* contactPhysics = YADE_CAST&lt;ElasticContactInteraction*&gt;(interaction-&gt;interactionPhysics.get());
-
-			Real Ea 	= sdec1-&gt;young;
-			Real Eb 	= sdec2-&gt;young;
-			Real Va 	= sdec1-&gt;poisson;
-			Real Vb 	= sdec2-&gt;poisson;
-			Real Da 	= interactionGeometry-&gt;radius1; // FIXME - multiply by factor of sphere interaction distance (so sphere interacts at bigger range that its geometrical size)
-			Real Db 	= interactionGeometry-&gt;radius2; // FIXME - as above
-			Real fa 	= sdec1-&gt;frictionAngle;
-			Real fb 	= sdec2-&gt;frictionAngle;
-
-			//Real Eab	= 2*Ea*Eb/(Ea+Eb);
-			//Real Vab	= 2*Va*Vb/(Va+Vb);
-
-			Real Dinit 	= Da+Db; 			// FIXME - is it just a sum?
-			//Real Sinit 	= Mathr::PI * std::pow( std::min(Da,Db) , 2);
-
-			Real Kn = 2*Ea*Da*Eb*Db/(Ea*Da+Eb*Db);//harmonic average of two stiffnesses
-			Real Ks = 2*Ea*Da*Va*Eb*Db*Vb/(Ea*Da*Va+Eb*Db*Va);//harmonic average of two stiffnesses with ks=V*kn for each sphere
-
-			contactPhysics-&gt;initialKn			= Kn;
-			contactPhysics-&gt;initialKs			= Ks;
-//cerr &lt;&lt; &quot;Ks: &quot; &lt;&lt;       contactPhysics-&gt;initialKs			&lt;&lt; endl;
-			contactPhysics-&gt;frictionAngle			= std::min(fa,fb); // FIXME - this is actually a waste of memory space, just like initialKs and initialKn
-			contactPhysics-&gt;tangensOfFrictionAngle		= std::tan(contactPhysics-&gt;frictionAngle); 
-
-			contactPhysics-&gt;prevNormal 			= interactionGeometry-&gt;normal;
-			contactPhysics-&gt;initialEquilibriumDistance	= Dinit;			
-
-			contactPhysics-&gt;kn = contactPhysics-&gt;initialKn;
-			contactPhysics-&gt;ks = contactPhysics-&gt;initialKs;
-			contactPhysics-&gt;equilibriumDistance = contactPhysics-&gt;initialEquilibriumDistance;
-
-		}
-		else
-		{	// FIXME - are those lines necessary ???? what they are doing in fact ???
-			ElasticContactInteraction* contactPhysics = YADE_CAST&lt;ElasticContactInteraction*&gt;(interaction-&gt;interactionPhysics.get());
-
-			contactPhysics-&gt;kn = contactPhysics-&gt;initialKn;
-			contactPhysics-&gt;ks = contactPhysics-&gt;initialKs;
-			contactPhysics-&gt;equilibriumDistance = contactPhysics-&gt;initialEquilibriumDistance;
-		}	
-		
-	}
-	else   // this is PERMANENT LINK because previous dynamic_cast failed, dispatcher should do this job
-	{
-		SDECLinkGeometry* sdecLinkGeometry =  dynamic_cast&lt;SDECLinkGeometry*&gt;(interaction-&gt;interactionGeometry.get());
-		if (sdecLinkGeometry)
-		{		
-			SDECLinkPhysics* linkPhysics = static_cast&lt;SDECLinkPhysics*&gt;(interaction-&gt;interactionPhysics.get());
-	//		linkPhysics-&gt;frictionAngle 		= ?? //FIXME - uninitialized 
-			linkPhysics-&gt;kn 			= linkPhysics-&gt;initialKn;
-			linkPhysics-&gt;ks 			= linkPhysics-&gt;initialKs;
-			linkPhysics-&gt;equilibriumDistance 	= linkPhysics-&gt;initialEquilibriumDistance;
-		}
-	}
-};

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships/SimpleElasticRelationships.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships/SimpleElasticRelationships.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships/SimpleElasticRelationships.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,33 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2007 by Bruno CHAREYRE                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">bruno.chareyre at hmg.inpg.fr</A>                                        *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SIMPLECONTACTMODEL_HPP
-#define SIMPLECONTACTMODEL_HPP
-
-#include&lt;yade/pkg-common/InteractionPhysicsEngineUnit.hpp&gt;
-
-class SimpleElasticRelationships : public InteractionPhysicsEngineUnit
-{
-	public :
-		SimpleElasticRelationships();
-
-		virtual void go(	const shared_ptr&lt;PhysicalParameters&gt;&amp; b1,
-					const shared_ptr&lt;PhysicalParameters&gt;&amp; b2,
-					const shared_ptr&lt;Interaction&gt;&amp; interaction);
-
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(SimpleElasticRelationships);
-	REGISTER_BASE_CLASS_NAME(InteractionPhysicsEngineUnit);
-
-};
-
-REGISTER_SERIALIZABLE(SimpleElasticRelationships,false);
-
-#endif // SIMPLECONTACTMODEL_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships/SimpleElasticRelationships.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/SimpleElasticRelationships/SimpleElasticRelationships.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron/Tetrahedron2InteractingMyTetrahedron.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron/Tetrahedron2InteractingMyTetrahedron.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron/Tetrahedron2InteractingMyTetrahedron.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,34 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;Tetrahedron2InteractingMyTetrahedron.hpp&quot;
-#include &quot;InteractingMyTetrahedron.hpp&quot;
-#include&lt;yade/pkg-common/Tetrahedron.hpp&gt;
-
-
-void Tetrahedron2InteractingMyTetrahedron::go(	const shared_ptr&lt;GeometricalModel&gt;&amp; gm,
-				shared_ptr&lt;InteractingGeometry&gt;&amp; ig,
-				const Se3r&amp; se3,
-				const Body*	)
-{
-	Tetrahedron* tet = static_cast&lt;Tetrahedron*&gt;(gm.get());
-	if(ig == 0)
-		ig = boost::shared_ptr&lt;InteractingGeometry&gt;(new InteractingMyTetrahedron);
-
-	InteractingMyTetrahedron* it = YADE_CAST&lt;InteractingMyTetrahedron*&gt;(ig.get());
-	
-	it-&gt;c1 = tet-&gt;v1*0.5;
-	it-&gt;c2 = tet-&gt;v2*0.5;
-	it-&gt;c3 = tet-&gt;v3*0.5;
-	it-&gt;c4 = tet-&gt;v4*0.5;
-
-	it-&gt;r1 = it-&gt;c1.Length();
-	it-&gt;r2 = it-&gt;c2.Length();
-	it-&gt;r3 = it-&gt;c3.Length();
-	it-&gt;r4 = it-&gt;c4.Length();
-}
-	

Deleted: branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron/Tetrahedron2InteractingMyTetrahedron.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron/Tetrahedron2InteractingMyTetrahedron.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron/Tetrahedron2InteractingMyTetrahedron.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,48 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef TETRAHEDRON2INTERACTINGMYTETRAHEDRON_HPP
-#define TETRAHEDRON2INTERACTINGMYTETRAHEDRON_HPP
-
-#include&lt;yade/pkg-common/InteractingGeometryEngineUnit.hpp&gt;
-
-/*! 
- * \brief This class exists to create an InteractingMyTetrahedron from Tetrahedron
- *
- * Vaclav: here you will create a representation of tetrahedron that you want to use
- * for calculating interactions. The simplest example is to use four spheres.
- *  - each sphere's center is a midpoint between the tetrahedron's node and tetrahedron's center
- *  - each sphere's radius is equal to the distance from this midpoint to the tetrahedron's center (and node)
- *
- * You may want to use any other representation. Even a tetrahedron, but then
- * be catious when you calculate forces when collision is with the edge. Maybe
- * you will have to compute not penetrationDepth of the collision, but the
- * overlapping volume. Becasue the colliding force will be linear proportional
- * not to the penetrationDepth but to the amount of volume?
- *
- * it's your choince :)
- *
-*/
-
-class Tetrahedron2InteractingMyTetrahedron : public InteractingGeometryEngineUnit
-{
-	public :
-		void go(	  const shared_ptr&lt;GeometricalModel&gt;&amp; gm
-				, shared_ptr&lt;InteractingGeometry&gt;&amp; ig
-				, const Se3r&amp; se3
-				, const Body*	);
-	REGISTER_CLASS_NAME(Tetrahedron2InteractingMyTetrahedron);
-	REGISTER_BASE_CLASS_NAME(InteractingGeometryEngineUnit);
-	
-	DEFINE_FUNCTOR_ORDER_2D(Tetrahedron,InteractingMyTetrahedron);
-};
-
-REGISTER_SERIALIZABLE(Tetrahedron2InteractingMyTetrahedron,false);
-
-#endif // TETRAHEDRON2POLYHEDRALSWEPTSPHERE_HPP
-
-

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron/Tetrahedron2InteractingMyTetrahedron.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron/Tetrahedron2InteractingMyTetrahedron.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder/AveragePositionRecorder.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder/AveragePositionRecorder.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder/AveragePositionRecorder.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,89 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;AveragePositionRecorder.hpp&quot;
-
-
-#include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-#include &lt;boost/lexical_cast.hpp&gt;
-
-
-AveragePositionRecorder::AveragePositionRecorder () : DataRecorder()
-{
-	outputFile = &quot;&quot;;
-	interval = 50;
-	bigBallId = 0;
-}
-
-
-void AveragePositionRecorder::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-		ofile.open(outputFile.c_str());
-	}
-}
-
-
-void AveragePositionRecorder::registerAttributes()
-{
-	DataRecorder::registerAttributes();
-	REGISTER_ATTRIBUTE(outputFile);
-	REGISTER_ATTRIBUTE(interval);
-	REGISTER_ATTRIBUTE(bigBallId);
-}
-
-
-bool AveragePositionRecorder::isActivated()
-{
-	return ((Omega::instance().getCurrentIteration() % interval == 0) &amp;&amp; (ofile));
-}
-
-
-void AveragePositionRecorder::action(Body * body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	Real x=0, y=0, z=0, size=0;
-	
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for(  ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; body = *bi;
-		if( body-&gt;isDynamic &amp;&amp; body-&gt;getId() != bigBallId )
-		{ 
-			size+=1.0;
-			x+=body-&gt;physicalParameters-&gt;se3.position[0];
-			y+=body-&gt;physicalParameters-&gt;se3.position[1];
-			z+=body-&gt;physicalParameters-&gt;se3.position[2];
-		}
-	}
-
-	x /= size;
-	y /= size;
-	z /= size;
-	
-	ofile &lt;&lt; lexical_cast&lt;string&gt;(Omega::instance().getSimulationTime()) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(x) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(y) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(z) &lt;&lt; &quot; &quot;
-
-		&lt;&lt; lexical_cast&lt;string&gt;((*bodies)[bigBallId]-&gt;physicalParameters-&gt;se3.position[0]) &lt;&lt; &quot; &quot; // big ball
-		&lt;&lt; lexical_cast&lt;string&gt;((*bodies)[bigBallId]-&gt;physicalParameters-&gt;se3.position[1]) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;((*bodies)[bigBallId]-&gt;physicalParameters-&gt;se3.position[2]) &lt;&lt; endl;
-}
-
-

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder/AveragePositionRecorder.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder/AveragePositionRecorder.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder/AveragePositionRecorder.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,46 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef AVERAGE_POSISTION_RECORDER_HPP
-#define AVERAGE_POSISTION_RECORDER_HPP
-
-#include&lt;yade/core/DataRecorder.hpp&gt;
-
-#include &lt;string&gt;
-#include &lt;fstream&gt;
-
-class AveragePositionRecorder : public DataRecorder
-{
-	public :
-		AveragePositionRecorder ();
-		
-		virtual void action(Body* b);
-		virtual bool isActivated();
-	
-		virtual void registerAttributes();
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-
-
-	public : 
-		std::string outputFile;
-		unsigned int interval;
-		unsigned int bigBallId;
-	private : 
-		std::ofstream ofile;
-	
-	REGISTER_CLASS_NAME(AveragePositionRecorder);
-	REGISTER_BASE_CLASS_NAME(DataRecorder);
-
-};
-
-REGISTER_SERIALIZABLE(AveragePositionRecorder,false);
-
-#endif // AVERAGE_POSISTION_RECORDER_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder/AveragePositionRecorder.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/AveragePositionRecorder/AveragePositionRecorder.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,287 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ElasticCohesiveLaw.hpp&quot;
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;SpheresContactGeometry.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include &quot;ElasticContactInteraction.hpp&quot;
-#include &quot;SDECLinkPhysics.hpp&quot;
-
-
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-
-ElasticCohesiveLaw::ElasticCohesiveLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
-{
-	sdecGroupMask=1;
-	first=true;
-	momentRotationLaw = true;
-}
-
-
-void ElasticCohesiveLaw::registerAttributes()
-{
-	InteractionSolver::registerAttributes();
-	REGISTER_ATTRIBUTE(sdecGroupMask);
-	REGISTER_ATTRIBUTE(momentRotationLaw);
-}
-
-
-//FIXME : remove bool first !!!!!
-void ElasticCohesiveLaw::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-	Real dt = Omega::instance().getTimeStep();
-
-/// Permanents Links													///
-
-	InteractionContainer::iterator ii    = ncb-&gt;persistentInteractions-&gt;begin();
-	InteractionContainer::iterator iiEnd = ncb-&gt;persistentInteractions-&gt;end();
-	for(  ; ii!=iiEnd ; ++ii )
-	{
-		if ((*ii)-&gt;isReal)
-		{
-			const shared_ptr&lt;Interaction&gt; contact2 = *ii;
-	
-			unsigned int id1 = contact2-&gt;getId1();
-			unsigned int id2 = contact2-&gt;getId2();
-			
-			if( !( (*bodies)[id1]-&gt;getGroupMask() &amp; (*bodies)[id2]-&gt;getGroupMask() &amp; sdecGroupMask) )
-				continue; // skip other groups, BTW: this is example of a good usage of 'continue' keyword
-	
-			BodyMacroParameters* de1			= YADE_CAST&lt;BodyMacroParameters*&gt;((*bodies)[id1]-&gt;physicalParameters.get());
-			BodyMacroParameters* de2			= YADE_CAST&lt;BodyMacroParameters*&gt;((*bodies)[id2]-&gt;physicalParameters.get());
-			SDECLinkPhysics* currentContactPhysics		= YADE_CAST&lt;SDECLinkPhysics*&gt;(contact2-&gt;interactionPhysics.get());
-			SDECLinkGeometry* currentContactGeometry	= YADE_CAST&lt;SDECLinkGeometry*&gt;(contact2-&gt;interactionGeometry.get());
-	
-			Real un 					= currentContactPhysics-&gt;equilibriumDistance-(de2-&gt;se3.position-de1-&gt;se3.position).Length();
-			currentContactPhysics-&gt;normalForce		= currentContactPhysics-&gt;kn*un*currentContactGeometry-&gt;normal;
-	
-			if (first)
-				currentContactPhysics-&gt;prevNormal 	= currentContactGeometry-&gt;normal;
-			
-			Vector3r axis;
-			Real angle;
-	
-	/// Here is the code with approximated rotations 	 ///
-	
-			axis = currentContactPhysics-&gt;prevNormal.Cross(currentContactGeometry-&gt;normal);
-			currentContactPhysics-&gt;shearForce	       -= currentContactPhysics-&gt;shearForce.Cross(axis);
-			angle	 					= dt*0.5*currentContactGeometry-&gt;normal.Dot(de1-&gt;angularVelocity+de2-&gt;angularVelocity);
-			axis 						= angle*currentContactGeometry-&gt;normal;
-			currentContactPhysics-&gt;shearForce     	       -= currentContactPhysics-&gt;shearForce.Cross(axis);
-	
-	/// Here is the code without approximated rotations 	 ///
-	
-	// 		Quaternionr q;
-	//
-	// 		axis				= currentContactPhysics-&gt;prevNormal.cross(currentContactGeometry-&gt;normal);
-	// 		angle				= acos(currentContactGeometry-&gt;normal.dot(currentContactPhysics-&gt;prevNormal));
-	// 		q.fromAngleAxis(angle,axis);
-	//
-	// 		currentContactPhysics-&gt;shearForce	= q*currentContactPhysics-&gt;shearForce;
-	//
-	// 		angle				= dt*0.5*currentContactGeometry-&gt;normal.dot(de1-&gt;angularVelocity+de2-&gt;angularVelocity);
-	// 		axis				= currentContactGeometry-&gt;normal;
-	// 		q.fromAngleAxis(angle,axis);
-	// 		currentContactPhysics-&gt;shearForce	= q*currentContactPhysics-&gt;shearForce;
-	
-	/// 							 ///
-	
-			Vector3r x				= de1-&gt;se3.position+(currentContactGeometry-&gt;radius1-0.5*un)*currentContactGeometry-&gt;normal;
-			//Vector3r x				= (de1-&gt;se3.position+de2-&gt;se3.position)*0.5;
-			//cout &lt;&lt; currentContact-&gt;contactPoint &lt;&lt; &quot; || &quot; &lt;&lt; (de1-&gt;se3.position+de2-&gt;se3.position)*0.5 &lt;&lt; endl;
-			Vector3r c1x				= (x - de1-&gt;se3.position);
-			Vector3r c2x				= (x - de2-&gt;se3.position);
-	
-			Vector3r relativeVelocity 		= (de2-&gt;velocity+de2-&gt;angularVelocity.Cross(c2x)) - (de1-&gt;velocity+de1-&gt;angularVelocity.Cross(c1x));
-			Vector3r shearVelocity			= relativeVelocity-currentContactGeometry-&gt;normal.Dot(relativeVelocity)*currentContactGeometry-&gt;normal;
-			Vector3r shearDisplacement		= shearVelocity*dt;
-			currentContactPhysics-&gt;shearForce      -= currentContactPhysics-&gt;ks*shearDisplacement;
-	
-			Vector3r f = currentContactPhysics-&gt;normalForce + currentContactPhysics-&gt;shearForce;
-	
-			static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    -= f;
-			static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    += f;
-			
-			static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= c1x.Cross(f);
-			static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += c2x.Cross(f);
-	
-	
-	
-	/// Moment law					 	 ///
-		if(momentRotationLaw)
-		{
-	
-			if (first)
-			{
-				currentContactPhysics-&gt;prevRotation1 = de1-&gt;se3.orientation;
-				currentContactPhysics-&gt;prevRotation2 = de2-&gt;se3.orientation;
-				currentContactPhysics-&gt;averageRadius = (currentContactGeometry-&gt;radius1+currentContactGeometry-&gt;radius2)*0.5;
-				currentContactPhysics-&gt;kr = currentContactPhysics-&gt;ks * currentContactPhysics-&gt;averageRadius * currentContactPhysics-&gt;averageRadius;
-			}
-	
-			Vector3r n	= currentContactGeometry-&gt;normal;
-			Vector3r prevN	= currentContactPhysics-&gt;prevNormal;
-			Vector3r t1	= currentContactPhysics-&gt;shearForce;
-			t1.Normalize();
-			Vector3r t2	= n.UnitCross(t1);
-	
-	// 		if (n[0]!=0 &amp;&amp; n[1]!=0 &amp;&amp; n[2]!=0)
-	// 		{
-	// 			t1 = Vector3r(0,0,sqrt(1.0/(1+(n[2]*n[2]/(n[1]*n[1])))));
-	// 			t1[1] = -n[2]/n[1]*t1[2];
-	// 			t1.normalize();
-	// 			t2 = n.unitCross(t1);
-	// 		}
-	// 		else
-	// 		{
-	// 			if (n[0]==0 &amp;&amp; n[1]!=0 &amp;&amp; n[2]!=0)
-	// 			{
-	// 				t1 = Vector3r(1,0,0);
-	// 				t2 = n.unitCross(t1);
-	// 			}
-	// 			else if (n[0]!=0 &amp;&amp; n[1]==0 &amp;&amp; n[2]!=0)
-	// 			{
-	// 				t1 = Vector3r(0,1,0);
-	// 				t2 = n.unitCross(t1);
-	// 			}
-	// 			else if (n[0]!=0 &amp;&amp; n[1]!=0 &amp;&amp; n[2]==0)
-	// 			{
-	// 				t1 = Vector3r(0,0,1);
-	// 				t2 = n.unitCross(t1);
-	// 			}
-	// 			else if (n[0]==0 &amp;&amp; n[1]==0 &amp;&amp; n[2]!=0)
-	// 			{
-	// 				t1 = Vector3r(1,0,0);
-	// 				t2 = Vector3r(0,1,0);
-	// 			}
-	// 			else if (n[0]==0 &amp;&amp; n[1]!=0 &amp;&amp; n[2]==0)
-	// 			{
-	// 				t1 = Vector3r(0,0,1);
-	// 				t2 = Vector3r(1,0,0);
-	// 			}
-	// 			else if (n[0]!=0 &amp;&amp; n[1]==0 &amp;&amp; n[2]==0)
-	// 			{
-	// 				t1 = Vector3r(0,1,0);
-	// 				t2 = Vector3r(0,0,1);
-	// 			}
-	// 		}
-	
-			Quaternionr q_i_n,q_n_i;
-	
-			q_i_n=quaternionFromAxes(n,t1,t2);
-			q_i_n=quaternionFromAxes(Vector3r(1,0,0),Vector3r(0,1,0),Vector3r(0,0,1)); // use identity matrix
-			q_n_i = q_i_n.Inverse();
-	
-	/// Using Euler angle				 	 ///
-	
-	// 		Vector3r dBeta;
-	// 		Vector3r orientation_Nc,orientation_Nc_old;
-	// 		for(int i=0;i&lt;3;i++)
-	// 		{
-	// 			int j = (i+1)%3;
-	// 			int k = (i+2)%3;
-	//
-	// 			if (n[j]&gt;=0)
-	// 				orientation_Nc[k] = acos(n[i]); // what is Nc_new
-	// 			else
-	// 				orientation_Nc[k] = -acos(n[i]);
-	//
-	// 			if (prevN[j]&gt;=0)
-	// 				orientation_Nc_old[k] = acos(prevN[i]);
-	// 			else
-	// 				orientation_Nc_old[k] = -acos(prevN[i]);
-	// 		}
-	//
-	// 		dBeta = orientation_Nc - orientation_Nc_old;
-	//
-	//
-	// 		Vector3r dRotationA,dRotationB,da,db;
-	// 		de1-&gt;se3.orientation.toEulerAngles(dRotationA);
-	// 		de2-&gt;se3.orientation.toEulerAngles(dRotationB);
-	//
-	// 		currentContactPhysics-&gt;prevRotation1.toEulerAngles(da);
-	// 		currentContactPhysics-&gt;prevRotation2.toEulerAngles(db);
-	//
-	// 		dRotationA -= da;
-	// 		dRotationB -= db;
-	//
-	// 		Vector3r dUr = 	( currentContactGeometry-&gt;radius1*(  dRotationA  -  dBeta)
-	// 				- currentContactGeometry-&gt;radius2*(  dRotationB  -  dBeta) ) * 0.5;
-	
-	/// Ending of use of eurler angle		 	 ///
-	
-	/// Using Quaternionr				 	 ///
-	
-			Quaternionr q,q1,q2;
-			Vector3r dRotationAMinusDBeta,dRotationBMinusDBeta;
-	
-			q.Align(n,prevN);
-			q1 = (de1-&gt;se3.orientation*currentContactPhysics-&gt;prevRotation1.Inverse())*q.Inverse();
-			q2 = (de2-&gt;se3.orientation*currentContactPhysics-&gt;prevRotation2.Inverse())*q.Inverse();
-			quaternionToEulerAngles(q1,dRotationAMinusDBeta);
-			quaternionToEulerAngles(q2,dRotationBMinusDBeta);
-			Vector3r dUr = ( currentContactGeometry-&gt;radius1*dRotationAMinusDBeta - currentContactGeometry-&gt;radius2*dRotationBMinusDBeta ) * 0.5;
-	
-	/// Ending of use of Quaternionr			 	 ///
-	
-			Vector3r dThetar = dUr/currentContactPhysics-&gt;averageRadius;
-			currentContactPhysics-&gt;thetar += dThetar;
-	
-			Real fNormal = currentContactPhysics-&gt;normalForce.Length();
-			Real normMPlastic = currentContactPhysics-&gt;heta*fNormal;
-			Vector3r thetarn = q_i_n*currentContactPhysics-&gt;thetar; // rolling angle
-			Vector3r mElastic = currentContactPhysics-&gt;kr * thetarn;
-	
-			//mElastic[0] = 0;  // No moment around normal direction
-	
-			Real normElastic = mElastic.Length();
-	
-	
-			//if (normElastic&lt;=normMPlastic)
-			//{
-			static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= q_n_i*mElastic;
-			static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += q_n_i*mElastic;
-	
-			//}  
-			//else
-			//{
-			//	Vector3r mPlastic = mElastic;
-			//	mPlastic.normalize();
-			//	mPlastic *= normMPlastic;
-			//	moments[id1]	-= q_n_i*mPlastic;
-			//	moments[id2]	+= q_n_i*mPlastic;
-			//	thetarn = mPlastic/currentContactPhysics-&gt;kr;
-			//	currentContactPhysics-&gt;thetar = q_n_i*thetarn;
-			//}
-	
-			currentContactPhysics-&gt;prevRotation1 = de1-&gt;se3.orientation;
-			currentContactPhysics-&gt;prevRotation2 = de2-&gt;se3.orientation;
-	
-	/// Moment law	END				 	 ///
-		}
-	
-			currentContactPhysics-&gt;prevNormal = currentContactGeometry-&gt;normal;
-		}	
-	}
-
-	first = false; 
-}
-
-

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,43 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ELASTICCOHESIVELAW_HPP
-#define ELASTICCOHESIVELAW_HPP
-
-#include&lt;yade/core/InteractionSolver.hpp&gt;
-
-#include &lt;set&gt;
-#include &lt;boost/tuple/tuple.hpp&gt;
-
-class PhysicalAction;
-
-class ElasticCohesiveLaw : public InteractionSolver
-{
-	private :
-		bool first; // FIXME - remove that!
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
-	public :
-		int sdecGroupMask;
-		bool momentRotationLaw;
-		
-		ElasticCohesiveLaw();
-		void action(Body* body);
-
-	protected : 
-		void registerAttributes();
-	REGISTER_CLASS_NAME(ElasticCohesiveLaw);
-	REGISTER_BASE_CLASS_NAME(InteractionSolver);
-
-};
-
-REGISTER_SERIALIZABLE(ElasticCohesiveLaw,false);
-
-#endif // ELASTICCOHESIVELAW_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw/ElasticContactLaw.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw/ElasticContactLaw.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw/ElasticContactLaw.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,133 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ElasticContactLaw.hpp&quot;
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;SpheresContactGeometry.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include &quot;ElasticContactInteraction.hpp&quot;
-#include &quot;SDECLinkPhysics.hpp&quot;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-
-
-ElasticContactLaw::ElasticContactLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
-{
-	sdecGroupMask=1;
-	momentRotationLaw = true;
-}
-
-
-void ElasticContactLaw::registerAttributes()
-{
-	InteractionSolver::registerAttributes();
-	REGISTER_ATTRIBUTE(sdecGroupMask);
-	REGISTER_ATTRIBUTE(momentRotationLaw);
-}
-
-
-//FIXME : remove bool first !!!!!
-void ElasticContactLaw::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-	Real dt = Omega::instance().getTimeStep();
-
-/// Non Permanents Links												///
-
-	InteractionContainer::iterator ii    = ncb-&gt;transientInteractions-&gt;begin();
-	InteractionContainer::iterator iiEnd = ncb-&gt;transientInteractions-&gt;end();
-	for(  ; ii!=iiEnd ; ++ii )
-	{
-		if ((*ii)-&gt;isReal)
-		{
-			const shared_ptr&lt;Interaction&gt;&amp; contact = *ii;
-			int id1 = contact-&gt;getId1();
-			int id2 = contact-&gt;getId2();
-			
-			if( !( (*bodies)[id1]-&gt;getGroupMask() &amp; (*bodies)[id2]-&gt;getGroupMask() &amp; sdecGroupMask)  )
-				continue; // skip other groups, BTW: this is example of a good usage of 'continue' keyword
-	
-			BodyMacroParameters* de1 				= YADE_CAST&lt;BodyMacroParameters*&gt;((*bodies)[id1]-&gt;physicalParameters.get());
-			BodyMacroParameters* de2 				= YADE_CAST&lt;BodyMacroParameters*&gt;((*bodies)[id2]-&gt;physicalParameters.get());
-			SpheresContactGeometry* currentContactGeometry 	= YADE_CAST&lt;SpheresContactGeometry*&gt;(contact-&gt;interactionGeometry.get());
-			ElasticContactInteraction* currentContactPhysics   	= YADE_CAST&lt;ElasticContactInteraction*&gt; (contact-&gt;interactionPhysics.get());
-			
-			Vector3r&amp; shearForce 			= currentContactPhysics-&gt;shearForce;
-	
-			if ( contact-&gt;isNew)
-				shearForce			= Vector3r(0,0,0);
-					
-			Real un 				= currentContactGeometry-&gt;penetrationDepth;
-			currentContactPhysics-&gt;normalForce	= currentContactPhysics-&gt;kn*un*currentContactGeometry-&gt;normal;
-	
-			Vector3r axis;
-			Real angle;
-	
-	/// Here is the code with approximated rotations 	 ///
-			
-			axis	 		= currentContactPhysics-&gt;prevNormal.Cross(currentContactGeometry-&gt;normal);
-			shearForce 	       -= shearForce.Cross(axis);
-			angle 			= dt*0.5*currentContactGeometry-&gt;normal.Dot(de1-&gt;angularVelocity+de2-&gt;angularVelocity);
-			axis 			= angle*currentContactGeometry-&gt;normal;
-			shearForce 	       -= shearForce.Cross(axis);
-		
-	/// Here is the code with exact rotations 		 ///
-	
-	// 		Quaternionr q;
-	//
-	// 		axis					= currentContactPhysics-&gt;prevNormal.cross(currentContactGeometry-&gt;normal);
-	// 		angle					= acos(currentContactGeometry-&gt;normal.dot(currentContactPhysics-&gt;prevNormal));
-	// 		q.fromAngleAxis(angle,axis);
-	//
-	// 		currentContactPhysics-&gt;shearForce	= currentContactPhysics-&gt;shearForce*q;
-	//
-	// 		angle					= dt*0.5*currentContactGeometry-&gt;normal.dot(de1-&gt;angularVelocity+de2-&gt;angularVelocity);
-	// 		axis					= currentContactGeometry-&gt;normal;
-	// 		q.fromAngleAxis(angle,axis);
-	// 		currentContactPhysics-&gt;shearForce	= q*currentContactPhysics-&gt;shearForce;
-	
-	/// 							 ///
-	
-			Vector3r x				= currentContactGeometry-&gt;contactPoint;
-			Vector3r c1x				= (x - de1-&gt;se3.position);
-			Vector3r c2x				= (x - de2-&gt;se3.position);
-			Vector3r relativeVelocity		= (de2-&gt;velocity+de2-&gt;angularVelocity.Cross(c2x)) - (de1-&gt;velocity+de1-&gt;angularVelocity.Cross(c1x));
-			Vector3r shearVelocity			= relativeVelocity-currentContactGeometry-&gt;normal.Dot(relativeVelocity)*currentContactGeometry-&gt;normal;
-			Vector3r shearDisplacement		= shearVelocity*dt;
-			shearForce 			       -= currentContactPhysics-&gt;ks*shearDisplacement;
-	
-	// PFC3d SlipModel, is using friction angle. CoulombCriterion
-			Real maxFs = currentContactPhysics-&gt;normalForce.SquaredLength() * std::pow(currentContactPhysics-&gt;tangensOfFrictionAngle,2);
-			if( shearForce.SquaredLength() &gt; maxFs )
-			{
-				maxFs = Mathr::Sqrt(maxFs) / shearForce.Length();
-				shearForce *= maxFs;
-			}
-	////////// PFC3d SlipModel
-	
-			Vector3r f				= currentContactPhysics-&gt;normalForce + shearForce;
-			
-	// it will be some macro(	body-&gt;physicalActions,	ActionType , bodyId )
-			static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    -= f;
-			static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    += f;
-			
-			static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= c1x.Cross(f);
-			static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += c2x.Cross(f);
-			
-			currentContactPhysics-&gt;prevNormal = currentContactGeometry-&gt;normal;
-		}
-	}
-
-}
-
-

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw/ElasticContactLaw.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw/ElasticContactLaw.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw/ElasticContactLaw.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,42 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ELASTIC_CONTACT_LAW_HPP
-#define ELASTIC_CONTACT_LAW_HPP
-
-#include&lt;yade/core/InteractionSolver.hpp&gt;
-
-#include &lt;set&gt;
-#include &lt;boost/tuple/tuple.hpp&gt;
-
-class PhysicalAction;
-
-class ElasticContactLaw : public InteractionSolver
-{
-/// Attributes
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
-	public :
-		int sdecGroupMask;
-		bool momentRotationLaw;
-	
-		ElasticContactLaw();
-		void action(Body* body);
-
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(ElasticContactLaw);
-	REGISTER_BASE_CLASS_NAME(InteractionSolver);
-};
-
-REGISTER_SERIALIZABLE(ElasticContactLaw,false);
-
-#endif // ELASTIC_CONTACT_LAW_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw/ElasticContactLaw.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticContactLaw/ElasticContactLaw.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper/ElasticCriterionTimeStepper.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper/ElasticCriterionTimeStepper.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper/ElasticCriterionTimeStepper.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,148 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ElasticCriterionTimeStepper.hpp&quot;
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;ElasticContactInteraction.hpp&quot;
-#include &quot;SpheresContactGeometry.hpp&quot;
-#include &quot;MacroMicroElasticRelationships.hpp&quot;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-
-
-ElasticCriterionTimeStepper::ElasticCriterionTimeStepper() : TimeStepper() , sdecContactModel(new MacroMicroElasticRelationships)
-{
-	sdecGroupMask = 1;
-}
-
-
-ElasticCriterionTimeStepper::~ElasticCriterionTimeStepper()
-{
-
-}
-
-
-void ElasticCriterionTimeStepper::registerAttributes()
-{
-	TimeStepper::registerAttributes();
-	REGISTER_ATTRIBUTE(sdecGroupMask);
-}
-
-
-void ElasticCriterionTimeStepper::findTimeStepFromBody(const shared_ptr&lt;Body&gt;&amp; body)
-{
-	BodyMacroParameters * sdec	= dynamic_cast&lt;BodyMacroParameters*&gt;(body-&gt;physicalParameters.get());
-	Sphere* sphere 		= dynamic_cast&lt;Sphere*&gt;(body-&gt;geometricalModel.get());
-
-	if(! (sphere &amp;&amp; sdec) )
-		return; // not possible to compute!
-
-	Real Dab  	= sphere-&gt;radius;
-	Real rad3 	= std::pow(Dab,2); // radius to the power of 2, from sphere
-
-	Real Eab 	= sdec-&gt;young;
-	Real Vab 	= sdec-&gt;poisson;
-	Real Dinit 	= 2*Dab; // assuming thet sphere is in contact with itself
-	Real Sinit 	= Mathr::PI * std::pow( Dab , 2);
-
-	Real alpha 	= sdecContactModel-&gt;alpha;
-	Real beta 	= sdecContactModel-&gt;beta;
-	Real gamma 	= sdecContactModel-&gt;gamma;
-
-	Real Kn		= abs((Eab*Sinit/Dinit)*( (1+alpha)/(beta*(1+Vab) + gamma*(1-alpha*Dab) ) ));
-	Real Ks		= abs(Kn*(1-alpha*Vab)/(1+Vab));
-
-	Real dt = 0.1*min(
-			  sqrt( sdec-&gt;mass       /  Kn       )
-			, sqrt( sdec-&gt;inertia[0] / (Ks*rad3) )
-		  );
-
-	newDt = std::min(dt,newDt);
-	computedSomething = true;
-}
-
-
-void ElasticCriterionTimeStepper::findTimeStepFromInteraction(const shared_ptr&lt;Interaction&gt;&amp; interaction, shared_ptr&lt;BodyContainer&gt;&amp; bodies)
-{
-	unsigned int id1 = interaction-&gt;getId1();
-	unsigned int id2 = interaction-&gt;getId2();
-		
-	if( !( (*bodies)[id1]-&gt;getGroupMask() &amp; (*bodies)[id2]-&gt;getGroupMask() &amp; sdecGroupMask) )
-		return; // skip other groups
-
-	ElasticContactInteraction* sdecContact = dynamic_cast&lt;ElasticContactInteraction*&gt;(interaction-&gt;interactionPhysics.get());
-	SpheresContactGeometry* interactionGeometry = dynamic_cast&lt;SpheresContactGeometry*&gt;(interaction-&gt;interactionGeometry.get());
-	BodyMacroParameters * body1	= dynamic_cast&lt;BodyMacroParameters*&gt;((*bodies)[id1]-&gt;physicalParameters.get());
-	BodyMacroParameters * body2	= dynamic_cast&lt;BodyMacroParameters*&gt;((*bodies)[id2]-&gt;physicalParameters.get());
-
-	if(! (sdecContact &amp;&amp; interactionGeometry &amp;&amp; body1 &amp;&amp; body2))
-		return;
-	
-	Real mass 	= std::min( body1-&gt;mass                   , body2-&gt;mass               );
-//	if(mass == 0) 			// FIXME - remove that comment: zero mass and zero inertia are too stupid to waste time checking that.
-//		mass 	= std::max( body1-&gt;mass                   , body2-&gt;mass               );
-//	if(mass == 0)
-//		return; // not possible to compute
-	Real inertia 	= std::min( body1-&gt;inertia[0]             , body2-&gt;inertia[0]         );
-//	if( inertia == 0)
-//		inertia = std::max( body1-&gt;inertia[0]             , body2-&gt;inertia[0]         );
-//	if( inertia == 0)
-//		return;
-	Real rad3 	= std::pow( std::max(interactionGeometry-&gt;radius1 , interactionGeometry-&gt;radius2 ) , 2); // radius to the power of 2, from sphere
-
-	Real dt = 0.1*min(
-			  sqrt( mass     / abs(sdecContact-&gt;initialKn)      )
-			, sqrt( inertia  / abs(sdecContact-&gt;initialKs*rad3) )
-		  );
-
-	newDt = std::min(dt,newDt);
-	computedSomething = true;
-}
-
-
-void ElasticCriterionTimeStepper::computeTimeStep(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	shared_ptr&lt;InteractionContainer&gt;&amp; persistentInteractions = ncb-&gt;persistentInteractions;
-	shared_ptr&lt;InteractionContainer&gt;&amp; transientInteractions = ncb-&gt;transientInteractions;
-
-	newDt = Mathr::MAX_REAL;
-	computedSomething = false; // this flag is to avoid setting timestep to MAX_REAL :)
-
-	InteractionContainer::iterator ii    = persistentInteractions-&gt;begin();
-	InteractionContainer::iterator iiEnd = persistentInteractions-&gt;end();
-	for(  ; ii!=iiEnd ; ++ii )
-		findTimeStepFromInteraction(*ii , bodies);
-
-	ii    = transientInteractions-&gt;begin();
-	iiEnd = transientInteractions-&gt;end();
-	for(  ; ii!=iiEnd ; ++ii )
-		findTimeStepFromInteraction(*ii , bodies);
-
-	if(! computedSomething)
-	{
-// no transientInteractions at all? so let's try to estimate timestep by investigating bodies,
-// simulating that a body in contact with itself. this happens only when there were not transientInteractions at all.
-		BodyContainer::iterator bi    = bodies-&gt;begin();
-		BodyContainer::iterator biEnd = bodies-&gt;end();
-		for(  ; bi!=biEnd ; ++bi )
-		{
-			shared_ptr&lt;Body&gt; b = *bi;
-			if( b-&gt;getGroupMask() &amp; sdecGroupMask)
-				findTimeStepFromBody(b);
-		}
-	}	
-	if(computedSomething)
-	{
-		Omega::instance().setTimeStep(newDt);		
-		//cerr &lt;&lt; &quot;ElasticCriterionTimeStepper, timestep chosen is:&quot; &lt;&lt; Omega::instance().getTimeStep() &lt;&lt; endl;
-	}
-}
-

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper/ElasticCriterionTimeStepper.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper/ElasticCriterionTimeStepper.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper/ElasticCriterionTimeStepper.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,46 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ELASTIC_CRITERION_TIME_STEPPER_HPP
-#define ELASTIC_CRITERION_TIME_STEPPER_HPP
-
-#include&lt;yade/core/TimeStepper.hpp&gt;
-
-class Interaction;
-class BodyContainer;
-class MacroMicroElasticRelationships;
-
-class ElasticCriterionTimeStepper : public TimeStepper
-{
-	private :
-		Real		newDt;
-		bool		computedSomething;
-		shared_ptr&lt;MacroMicroElasticRelationships&gt; sdecContactModel;
-
-		void findTimeStepFromBody(const shared_ptr&lt;Body&gt;&amp;);
-		void findTimeStepFromInteraction(const shared_ptr&lt;Interaction&gt;&amp; , shared_ptr&lt;BodyContainer&gt;&amp;);
-
-	public :
-		int sdecGroupMask; // FIXME - we should find a way to clean groupmask stuff
-
-		ElasticCriterionTimeStepper();
-		virtual ~ElasticCriterionTimeStepper();
-	
-		virtual void computeTimeStep(Body* body);
-
-	protected :
-		virtual void registerAttributes();
-
-	REGISTER_CLASS_NAME(ElasticCriterionTimeStepper);
-	REGISTER_BASE_CLASS_NAME(TimeStepper);
-};
-
-REGISTER_SERIALIZABLE(ElasticCriterionTimeStepper,false);
-
-#endif //  ELASTIC_CRITERION_TIME_STEPPER_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper/ElasticCriterionTimeStepper.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ElasticCriterionTimeStepper/ElasticCriterionTimeStepper.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder/ForceRecorder.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder/ForceRecorder.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder/ForceRecorder.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,84 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ForceRecorder.hpp&quot;
-#include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include &lt;boost/lexical_cast.hpp&gt;
-
-
-ForceRecorder::ForceRecorder () : DataRecorder(), actionForce(new Force)
-{
-	outputFile = &quot;&quot;;
-	interval = 50;
-	startId = 0;
-	endId = 1;
-	changed = false;
-}
-
-
-void ForceRecorder::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-		ofile.open(outputFile.c_str());
-	}
-}
-
-
-void ForceRecorder::registerAttributes()
-{
-	DataRecorder::registerAttributes();
-	REGISTER_ATTRIBUTE(outputFile);
-	REGISTER_ATTRIBUTE(interval);
-	REGISTER_ATTRIBUTE(startId);
-	REGISTER_ATTRIBUTE(endId);
-	REGISTER_ATTRIBUTE(bigBallId);
-	REGISTER_ATTRIBUTE(bigBallReleaseTime);
-}
-
-
-bool ForceRecorder::isActivated()
-{
-	return ((Omega::instance().getCurrentIteration() % interval == 0) &amp;&amp; (ofile));
-}
-
-
-void ForceRecorder::action(Body * body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	Real x=0, y=0, z=0;
-	
-	for( unsigned int i = startId ; i &lt;= endId ; ++i )
-	{
-		Vector3r force = YADE_CAST&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find( i , actionForce-&gt;getClassIndex() ) . get() )-&gt;force;
-		
-		x+=force[0];
-		y+=force[1];
-		z+=force[2];
-	}
-	//cerr &lt;&lt; &quot;record force&quot; &lt;&lt; endl;
-	ofile &lt;&lt; lexical_cast&lt;string&gt;(Omega::instance().getSimulationTime()) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(x) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(y) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(z) &lt;&lt; endl;
-		
-
-		
-// 	// FIXME all that lines do not belong to ForceRecorder
-// 	if( bigBallReleaseTime &lt; Omega::instance().getSimulationTime() &amp;&amp; (!changed) )
-// 	{
-// 		changed = true;
-// 		(*(ncb-&gt;bodies))[bigBallId]-&gt;isDynamic = true;
-// 	}
-}
-

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder/ForceRecorder.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder/ForceRecorder.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder/ForceRecorder.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,51 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FORCE_RECORDER_HPP
-#define FORCE_RECORDER_HPP
-
-#include&lt;yade/core/DataRecorder.hpp&gt;
-
-#include &lt;string&gt;
-#include &lt;fstream&gt;
-
-class PhysicalAction;
-
-class ForceRecorder : public DataRecorder
-{
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		std::ofstream ofile; 
-
-		bool changed;
-	
-	public :
-		std::string	 outputFile;
-		unsigned int	 interval
-				,startId
-				,endId;
-
-		int		bigBallId; // FIXME !!!!!!!!!!
-		Real		bigBallReleaseTime; // FIXME !!!!!!!!!!
-
-		ForceRecorder ();
-
-		virtual void registerAttributes();
-		virtual void action(Body* b);
-		virtual bool isActivated();
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-	REGISTER_CLASS_NAME(ForceRecorder);
-	REGISTER_BASE_CLASS_NAME(DataRecorder);
-};
-
-REGISTER_SERIALIZABLE(ForceRecorder,false);
-
-#endif // FORCE_RECORDER_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder/ForceRecorder.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/ForceRecorder/ForceRecorder.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,85 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GeometricalModelForceColorizer.hpp&quot;
-#include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include &lt;boost/lexical_cast.hpp&gt;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-//#include &lt;Wm3Vector3r.hpp&gt;
-
-
-GeometricalModelForceColorizer::GeometricalModelForceColorizer () : StandAloneEngine(), actionForce(new Force)
-{
-}
-
-
-bool GeometricalModelForceColorizer::isActivated()
-{
-	return true;
-//	return ((Omega::instance().getCurrentIteration() % interval == 0) &amp;&amp; (ofile));
-}
-
-
-void GeometricalModelForceColorizer::action(Body * body)
-{
-	// FIXME the same in GLDrawLatticeBeamState.cpp
-
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	BodyContainer* bodies = ncb-&gt;bodies.get();
-	
-	Real min=10000,max=-10000;
-
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi ) // first loop to calculate min/max
-	{
-		Body* body = (*bi).get();
-		if(body-&gt;isDynamic)
-		{
-			unsigned int i = body -&gt; getId();
-			Vector3r force = YADE_CAST&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find( i , actionForce-&gt;getClassIndex() ) . get() )-&gt;force;
-			min = std::min( force[0] , std::min( force[1] , std::min( force[2], min ) ) );
-			max = std::max( force[0] , std::max( force[1] , std::max( force[2], max ) ) );
-		}
-
-	}
-	
-	bi    = bodies-&gt;begin();
-	biEnd = bodies-&gt;end();
-	for( ; bi!=biEnd ; ++bi ) // second loop to assign correct color
-	{
-		Body* body = (*bi).get();
-		if(body-&gt;isDynamic)
-		{
-			GeometricalModel* gm = body-&gt;geometricalModel.get();
-			unsigned int i = body -&gt; getId();
-			Vector3r force = YADE_CAST&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find( i , actionForce-&gt;getClassIndex() ) . get() )-&gt;force;
-
-			gm-&gt;diffuseColor[0] = (force[2]-min)/(max-min);
-			gm-&gt;diffuseColor[1] = (force[2]-min)/(max-min);
-			gm-&gt;diffuseColor[2] = (force[2]-min)/(max-min);
-
-		/*
-			//Real val = std::sqrt(force[0]*force[0]+force[1]*force[1]+force[2]*force[2]);
-			Real val = force[2];
-			//Real val = force.squaredLength();
-			//min=0;
-			gm-&gt;diffuseColor[0] = (val-min)/(max-min);
-			gm-&gt;diffuseColor[1] = (val-min)/(max-min);
-			gm-&gt;diffuseColor[2] = (val-min)/(max-min);
-		*/
-
-		}
-
-	}
-		
-}
-

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,34 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef GEOMETRICAL_MODEL_FORCE_COLORIZER_HPP
-#define GEOMETRICAL_MODEL_FORCE_COLORIZER_HPP
-
-#include&lt;yade/core/StandAloneEngine.hpp&gt;
-
-class PhysicalAction;
-
-class GeometricalModelForceColorizer : public StandAloneEngine
-{
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-	
-	public :
-		GeometricalModelForceColorizer ();
-
-		virtual void action(Body* b);
-		virtual bool isActivated();
-
-	REGISTER_CLASS_NAME(GeometricalModelForceColorizer);
-	REGISTER_BASE_CLASS_NAME(StandAloneEngine);
-};
-
-REGISTER_SERIALIZABLE(GeometricalModelForceColorizer,false);
-
-#endif // FORCE_RECORDER_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter/GlobalStiffnessCounter.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter/GlobalStiffnessCounter.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter/GlobalStiffnessCounter.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,110 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;SpheresContactGeometry.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include &quot;ElasticContactInteraction.hpp&quot;
-#include &quot;SDECLinkPhysics.hpp&quot;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-#include &quot;GlobalStiffness.hpp&quot;
-#include &quot;GlobalStiffnessCounter.hpp&quot;
-
-GlobalStiffnessCounter::GlobalStiffnessCounter() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum), actionStiffness(new GlobalStiffness)
-{
-	interval=1;//FIXME very high frequency - not required 
-	sdecGroupMask=1;
-	momentRotationLaw = true;
-	actionForceIndex = actionForce-&gt;getClassIndex();
-	actionMomentumIndex = actionMomentum-&gt;getClassIndex();
-	actionStiffnessIndex = actionStiffness-&gt;getClassIndex();
-}
-
-
-void GlobalStiffnessCounter::registerAttributes()
-{
-	InteractionSolver::registerAttributes();
-	REGISTER_ATTRIBUTE(interval);
-	REGISTER_ATTRIBUTE(sdecGroupMask);
-	REGISTER_ATTRIBUTE(momentRotationLaw);
-}
-
-bool GlobalStiffnessCounter::isActivated()
-{
-	return ((Omega::instance().getCurrentIteration() % interval == 0) );
-}
-
-void GlobalStiffnessCounter::action(Body* body)
-{
-        MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-        shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-        Real dt = Omega::instance().getTimeStep();
-
-        /// Non Permanents Links												///
-
-        InteractionContainer::iterator ii    = ncb-&gt;transientInteractions-&gt;begin();
-        InteractionContainer::iterator iiEnd = ncb-&gt;transientInteractions-&gt;end();
-        //cerr &lt;&lt; &quot;#############################################################################################&quot; &lt;&lt; endl;
-        for(  ; ii!=iiEnd ; ++ii ) {
-                if ((*ii)-&gt;isReal) {
-                        const shared_ptr&lt;Interaction&gt;&amp; contact = *ii;
-                        int id1 = contact-&gt;getId1();
-                        int id2 = contact-&gt;getId2();
-
-                        //if( !( (*bodies)[id1]-&gt;getGroupMask() &amp; (*bodies)[id2]-&gt;getGroupMask() &amp; sdecGroupMask)  )
-                        //continue; // skip other groups, BTW: this is example of a good usage of 'continue' keyword
-
-                        SpheresContactGeometry* currentContactGeometry 	= static_cast&lt;SpheresContactGeometry*&gt;(contact-&gt;interactionGeometry.get());
-                        ElasticContactInteraction * currentContactPhysics = static_cast&lt;ElasticContactInteraction *&gt; (contact-&gt;interactionPhysics.get());
-
-
-                        Real fn = (static_cast&lt;ElasticContactInteraction *&gt; (contact-&gt;interactionPhysics.get()))-&gt;normalForce.Length();
-
-                        if (fn!=0) {
-                                //Diagonal terms of the translational stiffness matrix
-                                Vector3r diag_stiffness = Vector3r( 	std::pow(currentContactGeometry-&gt;normal.X(),2),
-                                                                     std::pow(currentContactGeometry-&gt;normal.Y(),2),
-                                                                     std::pow(currentContactGeometry-&gt;normal.Z(),2) )
-                                                          ;
-                                diag_stiffness *= currentContactPhysics-&gt;kn-currentContactPhysics-&gt;ks;
-                                diag_stiffness = diag_stiffness + Vector3r(1,1,1)*currentContactPhysics-&gt;ks;
-
-                                //diagonal terms of the rotational stiffness matrix
-                                Vector3r branch1 = currentContactGeometry-&gt;normal*currentContactGeometry-&gt;radius1;
-                                Vector3r branch2 = currentContactGeometry-&gt;normal*currentContactGeometry-&gt;radius2;
-                                Vector3r diag_Rstiffness =
-                                        Vector3r( std::pow(currentContactGeometry-&gt;normal.Y(),2) + std::pow(currentContactGeometry-&gt;normal.Z(),2),
-                                                  std::pow(currentContactGeometry-&gt;normal.X(),2) + std::pow(currentContactGeometry-&gt;normal.Z(),2),
-                                                  std::pow(currentContactGeometry-&gt;normal.Y(),2) + std::pow(currentContactGeometry-&gt;normal.Y(),2) );
-                                diag_Rstiffness *= currentContactPhysics-&gt;ks;
-                                //cerr &lt;&lt; &quot;diag_Rstifness=&quot; &lt;&lt; diag_Rstiffness &lt;&lt; endl;
-
-
-                                PhysicalAction* st = ncb-&gt;physicalActions-&gt;find(id1,actionStiffness-&gt;getClassIndex()).get();
-                                GlobalStiffness* s = static_cast&lt;GlobalStiffness*&gt;(st);
-                                s-&gt;stiffness += diag_stiffness;
-                                s-&gt;Rstiffness += diag_Rstiffness;
-                                st = ncb-&gt;physicalActions-&gt;find(id2,actionStiffness-&gt;getClassIndex()).get();
-                                s = static_cast&lt;GlobalStiffness*&gt;(st);
-                                s-&gt;stiffness += diag_stiffness;
-                                s-&gt;Rstiffness += diag_Rstiffness;
-                                //____________________________
-                        }
-                }
-        }
-}
-
-
-

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter/GlobalStiffnessCounter.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter/GlobalStiffnessCounter.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter/GlobalStiffnessCounter.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,55 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-
-#ifndef GLOBALSTIFFNESSCOUNTER_HPP
-#define GLOBALSTIFFNESSCOUNTER_HPP
-
-#include&lt;yade/core/InteractionSolver.hpp&gt;
-
-#include &lt;set&gt;
-#include &lt;boost/tuple/tuple.hpp&gt;
-
-class PhysicalAction;
-
-
-class GlobalStiffnessCounter : public InteractionSolver
-{
-/// Attributes
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-		shared_ptr&lt;PhysicalAction&gt; actionStiffness;
-		int actionForceIndex;
-		int actionMomentumIndex;
-		int actionStiffnessIndex;
-		
-		
-
-	public :
-		unsigned int interval;
-		int sdecGroupMask;
-		bool momentRotationLaw;
-	
-		GlobalStiffnessCounter();
-		void action(Body* body);
-		virtual bool isActivated();
-
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(GlobalStiffnessCounter);
-	REGISTER_BASE_CLASS_NAME(InteractionSolver);
-};
-
-REGISTER_SERIALIZABLE(GlobalStiffnessCounter,false);
-
-#endif // GLOBALSTIFFNESSCOUNTER_HPP
-
-
-

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter/GlobalStiffnessCounter.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessCounter/GlobalStiffnessCounter.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper/GlobalStiffnessTimeStepper.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper/GlobalStiffnessTimeStepper.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper/GlobalStiffnessTimeStepper.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,158 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;GlobalStiffnessTimeStepper.hpp&quot;
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;ElasticContactInteraction.hpp&quot;
-#include &quot;SpheresContactGeometry.hpp&quot;
-#include &quot;MacroMicroElasticRelationships.hpp&quot;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include &lt;GlobalStiffness.hpp&gt;
-
-
-GlobalStiffnessTimeStepper::GlobalStiffnessTimeStepper() : TimeStepper() , sdecContactModel(new MacroMicroElasticRelationships), actionParameterGlobalStiffness(new GlobalStiffness)
-{
-//cerr &lt;&lt; &quot;GlobalStiffnessTimeStepper()&quot;  &lt;&lt; endl;
-	globalStiffnessClassIndex = actionParameterGlobalStiffness-&gt;getClassIndex();
-	sdecGroupMask = 1;
-	timestepSafetyCoefficient = 0.4;
-	computedOnce = false;
-	defaultDt = 1;
-	
-}
-
-
-GlobalStiffnessTimeStepper::~GlobalStiffnessTimeStepper()
-{
-
-}
-
-
-void GlobalStiffnessTimeStepper::registerAttributes()
-{
-	TimeStepper::registerAttributes();
-	REGISTER_ATTRIBUTE(sdecGroupMask);
-	REGISTER_ATTRIBUTE(defaultDt);
-}
-
-
-void GlobalStiffnessTimeStepper::findTimeStepFromBody(const shared_ptr&lt;Body&gt;&amp; body, MetaBody * ncb)
-{
-	RigidBodyParameters * sdec	= static_cast&lt;RigidBodyParameters*&gt;(body-&gt;physicalParameters.get());
-	
-	Sphere* sphere = static_cast&lt;Sphere*&gt;(body-&gt;geometricalModel.get());
-	
-	Vector3r&amp; stiffness = (static_cast&lt;GlobalStiffness*&gt;( ncb-&gt;physicalActions-&gt;find (body-&gt;getId(), globalStiffnessClassIndex).get()))-&gt;stiffness;
-	Vector3r&amp; Rstiffness = (static_cast&lt;GlobalStiffness*&gt;( ncb-&gt;physicalActions-&gt;find (body-&gt;getId(), globalStiffnessClassIndex).get()))-&gt;Rstiffness;
-
-
-	//cerr &lt;&lt; &quot;Vector3r&amp; stiffness = (static_cast&lt;GlobalStiffness*&gt;( ncb&quot; &lt;&lt; endl;
-	if(! (sphere &amp;&amp; sdec &amp;&amp; stiffness) )
-		return; // not possible to compute!
-	//cerr &lt;&lt; &quot;return; // not possible to compute!&quot; &lt;&lt; endl;
-// 	Real Dab  	= sphere-&gt;radius;
-// 	Real rad3 	= std::pow(Dab,2); // radius to the power of 2, from sphere
-// 
-// 	Real Eab 	= sdec-&gt;young;
-// 	Real Vab 	= sdec-&gt;poisson;
-// 	Real Dinit 	= 2*Dab; // assuming thet sphere is in contact with itself
-// 	Real Sinit 	= Mathr::PI * std::pow( Dab , 2);
-// 
-// 	Real alpha 	= sdecContactModel-&gt;alpha;
-// 	Real beta 	= sdecContactModel-&gt;beta;
-// 	Real gamma 	= sdecContactModel-&gt;gamma;
-// 
-// 	Real Kn		= abs((Eab*Sinit/Dinit)*( (1+alpha)/(beta*(1+Vab) + gamma*(1-alpha*Dab) ) ));
-// 	Real Ks		= abs(Kn*(1-alpha*Vab)/(1+Vab));
-
-	
-// 	Real dt = min (sqrt( sdec-&gt;mass  /  stiffness.x()) ,sqrt( sdec-&gt;mass  /  stiffness.y() ) );
-// 	dt = 0.5 * min (sqrt( sdec-&gt;mass  /  stiffness.z()), dt);
-	
-	Real dt = max( max (stiffness.X(), stiffness.Y()), stiffness.Z() );
-	dt = (dt!=0 ? sqrt(sdec-&gt;mass/dt) : Mathr::MAX_REAL);	
-		
-	Real dtx = (Rstiffness.X()!=0 ? sdec-&gt;inertia.X()/Rstiffness.X() : Mathr::MAX_REAL);
-	Real dty = (Rstiffness.Y()!=0 ? sdec-&gt;inertia.Y()/Rstiffness.Y() : Mathr::MAX_REAL);
-	Real dtz = (Rstiffness.Z()!=0 ? sdec-&gt;inertia.Z()/Rstiffness.Z() : Mathr::MAX_REAL);
-	Real Rdt = sqrt( min( min (dtx, dty), dtz ) );
-	
-	//cerr &lt;&lt; &quot;Rstiffness.x()=&quot; &lt;&lt; Rstiffness.x() &lt;&lt; &quot;  &quot; &lt;&lt; Rstiffness.y() &lt;&lt; &quot;  &quot; &lt;&lt; Rstiffness.z() &lt;&lt; endl;
-	//cerr &lt;&lt; &quot;sdec-&gt;inertia=&quot; &lt;&lt; sdec-&gt;inertia.x() &lt;&lt; &quot; &quot; &lt;&lt; sdec-&gt;inertia.x() &lt;&lt; &quot; &quot; &lt;&lt; sdec-&gt;inertia.x() &lt;&lt; endl;
-	//cerr &lt;&lt; &quot;timesteps : dt=&quot; &lt;&lt; dt &lt;&lt; &quot; / Rdt=&quot; &lt;&lt; Rdt &lt;&lt; endl;
-	
-	dt = 0.709*timestepSafetyCoefficient*std::min(dt,Rdt);//0.709 = 1/sqrt(2)
-	
-	newDt = std::min(dt,newDt);
-	computedSomething = true;
-	
-}
-
-
-void GlobalStiffnessTimeStepper::findTimeStepFromInteraction(const shared_ptr&lt;Interaction&gt;&amp; interaction, shared_ptr&lt;BodyContainer&gt;&amp; bodies)
-{
-
-
-}
-
-bool GlobalStiffnessTimeStepper::isActivated()
-{
-	return (active &amp;&amp; (!computedOnce || (Omega::instance().getCurrentIteration() % timeStepUpdateInterval == 0)));
-}
-
-
-void GlobalStiffnessTimeStepper::computeTimeStep(Body* body)
-{
-
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-// 	shared_ptr&lt;InteractionContainer&gt;&amp; persistentInteractions = ncb-&gt;persistentInteractions;
-// 	shared_ptr&lt;InteractionContainer&gt;&amp; transientInteractions = ncb-&gt;transientInteractions;
-
-	newDt = Mathr::MAX_REAL;
-	//Real defaultDt = 0.0003;
-	
-	computedSomething = false; // this flag is to avoid setting timestep to MAX_REAL :)
-/*
-	InteractionContainer::iterator ii    = persistentInteractions-&gt;begin();
-	InteractionContainer::iterator iiEnd = persistentInteractions-&gt;end();
-	for(  ; ii!=iiEnd ; ++ii )
-		findTimeStepFromInteraction(*ii , bodies);
-
-	ii    = transientInteractions-&gt;begin();
-	iiEnd = transientInteractions-&gt;end();
-	for(  ; ii!=iiEnd ; ++ii )
-		findTimeStepFromInteraction(*ii , bodies);*/
-
-	if(!computedSomething)
-	{
-		BodyContainer::iterator bi    = bodies-&gt;begin();
-		BodyContainer::iterator biEnd = bodies-&gt;end();
-		for(  ; bi!=biEnd ; ++bi )
-		{
-		//cerr &lt;&lt; &quot;for(  ; bi!=biEnd ; ++bi )&quot; &lt;&lt; endl;
-			shared_ptr&lt;Body&gt; b = *bi;
-			if (b-&gt;isDynamic) {
-			//cerr &lt;&lt; &quot;if (body-&gt;isDynamic) {&quot; &lt;&lt; endl;
-			if( b-&gt;getGroupMask() &amp; sdecGroupMask)
-			//cerr &lt;&lt; &quot;if( b-&gt;getGroupMask() &amp; sdecGroupMask)&quot; &lt;&lt; computedSomething &lt;&lt; endl;
-				findTimeStepFromBody(b, ncb); }
-		}
-	}	
-		
-	if(computedSomething)
-	{
-		Omega::instance().setTimeStep(min(newDt , defaultDt));
-		computedOnce = true;		
-		//cerr &lt;&lt; &quot;GlobalStiffnessTimeStepper, timestep chosen is:&quot; &lt;&lt; Omega::instance().getTimeStep() &lt;&lt; endl;
-	}
-	cerr &lt;&lt; &quot;new timestep is:&quot; &lt;&lt; Omega::instance().getTimeStep() &lt;&lt; endl;
-}
-

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper/GlobalStiffnessTimeStepper.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper/GlobalStiffnessTimeStepper.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper/GlobalStiffnessTimeStepper.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,55 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Bruno Chareyre                                  *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef STIFFNESS_MATRIX_TIME_STEPPER_HPP
-#define STIFFNESS_MATRIX_TIME_STEPPER_HPP
-
-#include&lt;yade/core/TimeStepper.hpp&gt;
-
-class Interaction;
-class BodyContainer;
-class MacroMicroElasticRelationships;
-class MetaBody;
-class PhysicalAction;
-
-class GlobalStiffnessTimeStepper : public TimeStepper
-{
-	private :
-		Real		newDt;
-		bool		computedSomething,
-				computedOnce;
-		shared_ptr&lt;MacroMicroElasticRelationships&gt; sdecContactModel;
-		shared_ptr&lt;PhysicalAction&gt; actionParameterGlobalStiffness;
-		int globalStiffnessClassIndex;
-
-		void findTimeStepFromBody(const shared_ptr&lt;Body&gt;&amp; body, MetaBody * ncb);
-		void findTimeStepFromInteraction(const shared_ptr&lt;Interaction&gt;&amp; , shared_ptr&lt;BodyContainer&gt;&amp;);
-
-	public :
-		int sdecGroupMask; // FIXME - we should find a way to clean groupmask stuff
-		Real defaultDt;
-		Real timestepSafetyCoefficient;
-
-		GlobalStiffnessTimeStepper();
-		virtual ~GlobalStiffnessTimeStepper();
-	
-		virtual void computeTimeStep(Body* body);
-		virtual bool isActivated();
-
-
-	protected :
-		virtual void registerAttributes();
-
-	REGISTER_CLASS_NAME(GlobalStiffnessTimeStepper);
-	REGISTER_BASE_CLASS_NAME(TimeStepper);
-};
-
-REGISTER_SERIALIZABLE(GlobalStiffnessTimeStepper,false);
-
-#endif //  GLOBAL_STIFFNESS_TIME_STEPPER_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper/GlobalStiffnessTimeStepper.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/GlobalStiffnessTimeStepper/GlobalStiffnessTimeStepper.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw/MyTetrahedronLaw.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw/MyTetrahedronLaw.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw/MyTetrahedronLaw.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,91 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;MyTetrahedronLaw.hpp&quot;
-#include &quot;InteractionOfMyTetrahedron.hpp&quot;
-#include&lt;yade/pkg-common/ElasticBodyParameters.hpp&gt;
-#include&lt;yade/pkg-common/SimpleElasticInteraction.hpp&gt;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-
-
-MyTetrahedronLaw::MyTetrahedronLaw() : InteractionSolver() , actionForce(new Force) , actionMomentum(new Momentum)
-{
-}
-
-
-void MyTetrahedronLaw::registerAttributes()
-{
-	InteractionSolver::registerAttributes();
-	// ...
-}
-
-
-void MyTetrahedronLaw::action(Body* body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-	Real dt = Omega::instance().getTimeStep();
-
-	InteractionContainer::iterator ii    = ncb-&gt;transientInteractions-&gt;begin();
-	InteractionContainer::iterator iiEnd = ncb-&gt;transientInteractions-&gt;end();
-	for(  ; ii!=iiEnd ; ++ii )
-	{
-		if ((*ii)-&gt;isReal)	// isReal means that InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron returned true
-					//                or InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron           returned true
-		{
-			const shared_ptr&lt;Interaction&gt;&amp; contact = *ii;
-			int id1 = contact-&gt;getId1();
-			int id2 = contact-&gt;getId2();
-			
-// you can use groups if you want for example a simulation that has different
-// types of InteractionSolvers that talk with different bodies, for example
-// if you want together MyTetrahedronLaw (solving tetrahedrons) and ElasticContactLaw (solving spheres)
-//
-// I already have a better solution for that, so you will not need to check
-// groups inside this function, but they will be checked outside. I just need
-// time to implement this :)
-//
-//			if( !( (*bodies)[id1]-&gt;getGroupMask() &amp; (*bodies)[id2]-&gt;getGroupMask() &amp; sdecGroupMask)  )
-//				continue;
-	
-			ElasticBodyParameters* de1 				= YADE_CAST&lt;ElasticBodyParameters*&gt;((*bodies)[id1]-&gt;physicalParameters.get());
-			ElasticBodyParameters* de2 				= YADE_CAST&lt;ElasticBodyParameters*&gt;((*bodies)[id2]-&gt;physicalParameters.get());
-			InteractionOfMyTetrahedron* currentContactGeometry	= YADE_CAST&lt;InteractionOfMyTetrahedron*&gt;(contact-&gt;interactionGeometry.get());
-			SimpleElasticInteraction* currentContactPhysics		= YADE_CAST&lt;SimpleElasticInteraction*&gt;(contact-&gt;interactionPhysics.get());
-
-			for(int i=0 ; i&lt;4 ; ++i )
-				for(int j=0 ; j&lt;4 ; ++j)
-				{
-					Real un					= currentContactGeometry-&gt;penetrationDepths[i][j];
-					if(un &gt; 0)
-					{
-						Vector3r force			= currentContactPhysics-&gt;kn*un*currentContactGeometry-&gt;normals[i][j];
-
-						Vector3r x			= currentContactGeometry-&gt;contactPoints[i][j];
-						Vector3r c1x			= (x - de1-&gt;se3.position);
-						Vector3r c2x			= (x - de2-&gt;se3.position);
-
-						// it will be some macro(	body-&gt;physicalActions,	ActionType , bodyId )
-						static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    -= force;
-						static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    += force;
-
-						static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= c1x.Cross(force);
-						static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += c2x.Cross(force);
-					}
-				}
-
-		}
-	}
-}
-
-

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw/MyTetrahedronLaw.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw/MyTetrahedronLaw.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw/MyTetrahedronLaw.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,59 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef MYTETRAHEDRONLAW_HPP
-#define MYTETRAHEDRONLAW_HPP
-
-#include&lt;yade/core/InteractionSolver.hpp&gt;
-
-/*! 
- * \brief This class exists for the sole purpose of calculating force and
- * momentum acting on two interacting tetrahedrons, where interaction data is
- * stored inside InteractionOfMyTetrahedron
- *
- * Those example calculations are very simple:
- *
- *  - the force is just a sum of all normals multiplied by penetrationDepth
- *    multiplied by stiffness (Hooke's Law ;)
- *
- *  - the momentum is just a force multiplied by the arm's length of the acting
- *    force. Arm's length is a projection of distance of contact point to the
- *    tetrahedron's center on direction perpendicular to the acting force.
-*/
-
-class PhysicalAction;
-
-class MyTetrahedronLaw : public InteractionSolver
-{
-	private :
-		/// those two are here only because this class needs to access
-		/// the ID number of Force and Momentum
-		///
-		/// those variables are actually not used to store a value of
-		/// Force and Momentum, just to get ID, although normally they are
-		/// used to store this value. 
-		/// 
-		/// I already have a better solution for that.
-		///
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
-	public :
-		MyTetrahedronLaw();
-		void action(Body* body);
-
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(MyTetrahedronLaw);
-	REGISTER_BASE_CLASS_NAME(InteractionSolver);
-};
-
-REGISTER_SERIALIZABLE(MyTetrahedronLaw,false);
-
-#endif // ELASTIC_CONTACT_LAW_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw/MyTetrahedronLaw.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/MyTetrahedronLaw/MyTetrahedronLaw.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder/PositionOrientationRecorder.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder/PositionOrientationRecorder.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder/PositionOrientationRecorder.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,84 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;PositionOrientationRecorder.hpp&quot;
-#include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include &lt;boost/lexical_cast.hpp&gt;
-
-
-PositionOrientationRecorder::PositionOrientationRecorder () : DataRecorder()//, ofile(&quot;&quot;)
-{
-	outputFile = &quot;positionorientation&quot;;
-	interval = 50;
-}
-
-
-PositionOrientationRecorder::~PositionOrientationRecorder ()
-{
-
-}
-
-
-void PositionOrientationRecorder::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-	//	ofile.open(outputFile.c_str());
-	}
-}
-
-
-void PositionOrientationRecorder::registerAttributes()
-{
-	DataRecorder::registerAttributes();
-	REGISTER_ATTRIBUTE(outputFile);
-	REGISTER_ATTRIBUTE(interval);
-}
-
-
-void PositionOrientationRecorder::action(Body * body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	
-	if( Omega::instance().getCurrentIteration() % interval == 0 /*&amp;&amp; ofile*/ )
-	{
-		ofile.open( string(outputFile+&quot;_&quot;+lexical_cast&lt;string&gt;( Omega::instance().getCurrentIteration() )).c_str() );
-	
-		Real tx=0, ty=0, tz=0, rw=0, rx=0, ry=0, rz=0;
-			
-		BodyContainer::iterator bi    = ncb-&gt;bodies-&gt;begin();
-		BodyContainer::iterator biEnd = ncb-&gt;bodies-&gt;end();
-		for(  ; bi!=biEnd ; ++bi )
-		{
-			shared_ptr&lt;Body&gt; b = *bi;
-			tx = b-&gt;physicalParameters-&gt;se3.position[0];
-			ty = b-&gt;physicalParameters-&gt;se3.position[1];
-			tz = b-&gt;physicalParameters-&gt;se3.position[2];
-		
-			rw = b-&gt;physicalParameters-&gt;se3.orientation[0];
-			rx = b-&gt;physicalParameters-&gt;se3.orientation[1];
-			ry = b-&gt;physicalParameters-&gt;se3.orientation[2];
-			rz = b-&gt;physicalParameters-&gt;se3.orientation[3];
-			
-			ofile &lt;&lt;	lexical_cast&lt;string&gt;(tx) &lt;&lt; &quot; &quot; 
-					&lt;&lt; lexical_cast&lt;string&gt;(ty) &lt;&lt; &quot; &quot; 
-					&lt;&lt; lexical_cast&lt;string&gt;(tz) &lt;&lt; &quot; &quot;
-					&lt;&lt; lexical_cast&lt;string&gt;(rw) &lt;&lt; &quot; &quot;
-					&lt;&lt; lexical_cast&lt;string&gt;(rx) &lt;&lt; &quot; &quot;
-					&lt;&lt; lexical_cast&lt;string&gt;(ry) &lt;&lt; &quot; &quot;
-					&lt;&lt; lexical_cast&lt;string&gt;(rz) &lt;&lt; endl;
-		}
-		ofile.close();
-	}
-}
-
-

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder/PositionOrientationRecorder.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder/PositionOrientationRecorder.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder/PositionOrientationRecorder.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,38 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef POSITIONORIENTATIONRECORDER_HPP
-#define POSITIONORIENTATIONRECORDER_HPP
-
-#include&lt;yade/core/DataRecorder.hpp&gt;
-#include &lt;string&gt;
-#include &lt;fstream&gt;
-
-class PositionOrientationRecorder : public DataRecorder
-{
-	public :
-		std::string outputFile;
-		unsigned int interval;
-	
-		std::ofstream ofile;
-
-		PositionOrientationRecorder ();
-		~PositionOrientationRecorder ();
-		virtual void action(Body* b);
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-		void registerAttributes();
-	REGISTER_CLASS_NAME(PositionOrientationRecorder);
-	REGISTER_BASE_CLASS_NAME(DataRecorder);
-};
-
-REGISTER_SERIALIZABLE(PositionOrientationRecorder,false);
-
-#endif // POSITIONORIENTATIONRECORDER_HPP
-

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder/PositionOrientationRecorder.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/PositionOrientationRecorder/PositionOrientationRecorder.hpp)

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder/VelocityRecorder.cpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder/VelocityRecorder.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder/VelocityRecorder.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,90 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;VelocityRecorder.hpp&quot;
-#include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include &lt;boost/lexical_cast.hpp&gt;
-
-
-VelocityRecorder::VelocityRecorder () : DataRecorder()
-{
-	outputFile = &quot;&quot;;
-	interval = 50;
-	bigBallId = 0;
-}
-
-
-void VelocityRecorder::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-		ofile.open(outputFile.c_str());
-	}
-}
-
-
-void VelocityRecorder::registerAttributes()
-{
-	DataRecorder::registerAttributes();
-	REGISTER_ATTRIBUTE(outputFile);
-	REGISTER_ATTRIBUTE(interval);
-	REGISTER_ATTRIBUTE(bigBallId);
-}
-
-
-bool VelocityRecorder::isActivated()
-{
-	return ((Omega::instance().getCurrentIteration() % interval == 0) &amp;&amp; (ofile));
-}
-
-
-void VelocityRecorder::action(Body * body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-	Real x=0, y=0, z=0, size=0;//, totalMass=0; FIXME- how many recorders/Actors to make simple stuff?
-	
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for(  ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; body = *bi;
-		if( body-&gt;isDynamic &amp;&amp; body-&gt;getId() != bigBallId )
-		{ 
-			size+=1.0;
-			ParticleParameters* pp = YADE_CAST&lt;ParticleParameters*&gt;(body-&gt;physicalParameters.get());
-			x+=pp-&gt;velocity[0];
-			y+=pp-&gt;velocity[1];
-			z+=pp-&gt;velocity[2];
-			
-//			totalMass += pp-&gt;mass;
-		}
-	}
-
-	x /= size;
-	y /= size;
-	z /= size;
-//	cerr &lt;&lt; totalMass &lt;&lt; endl;
-	ParticleParameters* bigBall = YADE_CAST&lt;ParticleParameters*&gt;((*bodies)[bigBallId]-&gt;physicalParameters.get());
-	
-	ofile &lt;&lt; lexical_cast&lt;string&gt;(Omega::instance().getSimulationTime()) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(x) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(y) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(z) &lt;&lt; &quot; &quot;
-
-		&lt;&lt; lexical_cast&lt;string&gt;(bigBall-&gt;velocity[0]) &lt;&lt; &quot; &quot; // big ball
-		&lt;&lt; lexical_cast&lt;string&gt;(bigBall-&gt;velocity[1]) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(bigBall-&gt;velocity[2]) &lt;&lt; endl;
-}
-
-

Deleted: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder/VelocityRecorder.hpp
===================================================================
--- branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder/VelocityRecorder.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder/VelocityRecorder.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,42 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef VELOCITY_RECORDER_HPP
-#define VELOCITY_RECORDER_HPP
-
-#include&lt;yade/core/DataRecorder.hpp&gt;
-#include &lt;string&gt;
-#include &lt;fstream&gt;
-
-class VelocityRecorder : public DataRecorder
-{
-	private :
-		std::ofstream ofile;
-
-	public :
-		std::string outputFile;
-		unsigned int interval;
-		unsigned int bigBallId;
-		VelocityRecorder ();
-		virtual void registerAttributes();
-		virtual void action(Body* b);
-		virtual bool isActivated();
-	
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-	REGISTER_CLASS_NAME(VelocityRecorder);
-	REGISTER_BASE_CLASS_NAME(DataRecorder);
-};
-
-REGISTER_SERIALIZABLE(VelocityRecorder,false);
-
-#endif // VELOCITY_RECORDER_HPP 
-
-

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.cpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder/VelocityRecorder.cpp)

Copied: branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder.hpp (from rev 1105, branches/scons-layout/pkg/dem/Engine/StandAloneEngine/VelocityRecorder/VelocityRecorder.hpp)

Deleted: branches/scons-layout/pkg/dem/PreProcessor/Funnel/Funnel.cpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/Funnel/Funnel.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/Funnel/Funnel.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,358 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;Funnel.hpp&quot;
-
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;ElasticContactLaw.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include &quot;MacroMicroElasticRelationships.hpp&quot;
-#include &quot;ElasticCriterionTimeStepper.hpp&quot;
-
-
-#include&lt;yade/pkg-common/Box.hpp&gt;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/SAPCollider.hpp&gt;
-#include&lt;yade/pkg-common/PersistentSAPCollider.hpp&gt;
-#include&lt;yade/lib-serialization/IOFormatManager.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionPhysicsMetaEngine.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-
-Funnel::Funnel () : FileGenerator()
-{
-	nbSpheres = Vector3r(2,3,2);
-	minRadius = 5;
-	maxRadius = 5;
-	groundSize = Vector3r(200,5,200);
-	dampingForce = 0.3;
-	dampingMomentum = 0.3;
-	timeStepUpdateInterval = 300;
-	sphereYoungModulus   = 15000000.0;
-	//sphereYoungModulus   = 10000;
-	spherePoissonRatio  = 0.2;
-	sphereFrictionDeg   = 18.0;
-	density = 2600;
-	rotationBlocked = false;
-	gravity = Vector3r(0,-9.81,0);
-	disorder = 0.2;
-}
-
-
-Funnel::~Funnel ()
-{
-
-}
-
-
-void Funnel::postProcessAttributes(bool)
-{
-}
-
-
-void Funnel::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	REGISTER_ATTRIBUTE(nbSpheres);
-	REGISTER_ATTRIBUTE(minRadius);
-	REGISTER_ATTRIBUTE(maxRadius);
-	REGISTER_ATTRIBUTE(sphereYoungModulus);
-	REGISTER_ATTRIBUTE(spherePoissonRatio);
-	REGISTER_ATTRIBUTE(sphereFrictionDeg);
-	REGISTER_ATTRIBUTE(gravity);
-	REGISTER_ATTRIBUTE(density);
-	REGISTER_ATTRIBUTE(disorder);
-	REGISTER_ATTRIBUTE(groundSize);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum);
-	REGISTER_ATTRIBUTE(rotationBlocked);
-	REGISTER_ATTRIBUTE(timeStepUpdateInterval);
-}
-
-
-string Funnel::generate()
-{
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-	createActors(rootBody);
-	positionRootBody(rootBody);
-
-////////////////////////////////////
-///////// Container
-	
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-		
-////////////////////////////////////
-///////// ground
-////////////////////////////////////
-
-	shared_ptr&lt;Body&gt; ground;
-	createBox(ground, Vector3r(0,0,0), groundSize);
-	rootBody-&gt;bodies-&gt;insert(ground);
-
-////////////////////////////////////
-///////// funnel
-////////////////////////////////////
-	
-	shared_ptr&lt;Body&gt; north;
-	shared_ptr&lt;Body&gt; south;
-	shared_ptr&lt;Body&gt; east;
-	shared_ptr&lt;Body&gt; west;
-
-	Vector3r funnelSize = Vector3r(50,5,50);
-	Real angle = 45*Mathr::DEG_TO_RAD;
-	Real holeSize = 20;
-	Real height = 40;
-	
-	Real translation = (funnelSize[0]+funnelSize[1])*Mathr::Cos(angle)+holeSize/2.0;	
-	Real translationY = (funnelSize[0]+funnelSize[1]*2)*Mathr::Sin(angle)+height;
-	
-	createBox(north, Vector3r(0,translationY,translation), funnelSize);
-	createBox(south, Vector3r(0,translationY,-translation), funnelSize);
-	createBox(east, Vector3r(translation,translationY,0), funnelSize);
-	createBox(west, Vector3r(-translation,translationY,0), funnelSize);
-	
-	north-&gt;physicalParameters-&gt;se3.orientation.FromAxisAngle(Vector3r(1,0,0),-angle);
-	south-&gt;physicalParameters-&gt;se3.orientation.FromAxisAngle(Vector3r(1,0,0),angle);
-	east-&gt;physicalParameters-&gt;se3.orientation.FromAxisAngle(Vector3r(0,0,1),angle);
-	west-&gt;physicalParameters-&gt;se3.orientation.FromAxisAngle(Vector3r(0,0,1),-angle);
-
-	north-&gt;geometricalModel-&gt;wire = true;
-	north-&gt;geometricalModel-&gt;shadowCaster = false;
-	
-	rootBody-&gt;bodies-&gt;insert(north);
-	rootBody-&gt;bodies-&gt;insert(south);
-	rootBody-&gt;bodies-&gt;insert(east);
-	rootBody-&gt;bodies-&gt;insert(west);
-	
-////////////////////////////////////
-///////// spheres
-////////////////////////////////////
-	for(int i=0;i&lt;nbSpheres[0];i++)
-		for(int j=0;j&lt;nbSpheres[1];j++)
-			for(int k=0;k&lt;nbSpheres[2];k++)
-			{
-				shared_ptr&lt;Body&gt; sphere;
-				createSphere(sphere,i,j,k);
-				sphere-&gt;physicalParameters-&gt;se3.position[1] += translationY;
-				rootBody-&gt;bodies-&gt;insert(sphere);
-			}
-	
-	return &quot;&quot;;
-}
-
-
-void Funnel::createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	
-	Vector3r position		= Vector3r(i,j,k)*(2*maxRadius*1.1) // this formula is crazy !!
-					  - Vector3r( nbSpheres[0]/2*(2*maxRadius*1.1) , -7-maxRadius*2 , nbSpheres[2]/2*(2*maxRadius*1.1) )
-					  + Vector3r(Mathr::SymmetricRandom(),Mathr::SymmetricRandom(),Mathr::SymmetricRandom())*disorder*maxRadius;
-	
-	Real radius 			= (Mathr::IntervalRandom(minRadius,maxRadius));
-	
-	body-&gt;isDynamic			= true;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 4.0/3.0*Mathr::PI*radius*radius*radius*density;
-	physics-&gt;inertia		= Vector3r(2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius); //
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	iSphere-&gt;radius			= radius;
-	iSphere-&gt;diffuseColor		= Vector3r(0.8,0.3,0.3);
-
-	body-&gt;interactingGeometry	= iSphere;
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void Funnel::createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= extents[0]*extents[1]*extents[2]*density*2; 
-	physics-&gt;inertia		= Vector3r(
-							  physics-&gt;mass*(extents[1]*extents[1]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[0]*extents[0]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[1]*extents[1]+extents[0]*extents[0])/3
-						);
-	//physics-&gt;mass			= 0;
-	//physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
-
-	gBox-&gt;extents			= extents;
-	gBox-&gt;diffuseColor		= Vector3r(1,1,1);
-	gBox-&gt;wire			= false;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= true;
-	
-	iBox-&gt;extents			= extents;
-	iBox-&gt;diffuseColor		= Vector3r(1,1,1);
-
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void Funnel::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
-	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingSphere&quot;,&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
-
-	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
-	interactionPhysicsDispatcher-&gt;add(&quot;BodyMacroParameters&quot;,&quot;BodyMacroParameters&quot;,&quot;MacroMicroElasticRelationships&quot;);
-		
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-	
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping-&gt;damping = dampingForce;
-	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping-&gt;damping = dampingMomentum;
-	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
-	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
-	
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
- 	
-
-	shared_ptr&lt;ElasticCriterionTimeStepper&gt; sdecTimeStepper(new ElasticCriterionTimeStepper);
-	sdecTimeStepper-&gt;sdecGroupMask = 1;
-	sdecTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	rootBody-&gt;engines.push_back(sdecTimeStepper);
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);	
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
-	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-	rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new ElasticContactLaw));
-	rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(actionDampingDispatcher);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-	if(!rotationBlocked)
-		rootBody-&gt;engines.push_back(orientationIntegrator);
-	
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-}
-
-
-void Funnel::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	rootBody-&gt;isDynamic		= false;
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters); // FIXME : fix indexable class PhysicalParameters
-	physics-&gt;se3				= Se3r(Vector3r(0,0,0),q);
-	physics-&gt;mass				= 0;
-	physics-&gt;velocity			= Vector3r(0,0,0);
-	physics-&gt;acceleration			= Vector3r::ZERO;
-		
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	set-&gt;diffuseColor			= Vector3r(0,0,1);
-	
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor			= Vector3r(0,0,1);
-	
-	rootBody-&gt;interactingGeometry		= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume		= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;physicalParameters 		= physics;
-}
-
-

Deleted: branches/scons-layout/pkg/dem/PreProcessor/Funnel/Funnel.hpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/Funnel/Funnel.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/Funnel/Funnel.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,55 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FUNNEL_HPP
-#define FUNNEL_HPP
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-
-class Funnel : public FileGenerator
-{
-	private :
-		Vector3r	 nbSpheres
-				,groundSize
-				,gravity;
-		
-		Real		 minRadius
-				,density
-				,maxRadius
-				,dampingForce
-				,disorder
-				,dampingMomentum
-				,sphereYoungModulus
-				,spherePoissonRatio
-				,sphereFrictionDeg;
-		
-		int		timeStepUpdateInterval;
-		bool		rotationBlocked;
-	
-		void createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents);
-		void createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k);
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-
-	public :
-		Funnel ();
-		~Funnel ();
-		string generate();
-
-	protected :
-		void registerAttributes();
-		virtual void postProcessAttributes(bool deserializing);
-	REGISTER_CLASS_NAME(Funnel);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-
-};
-
-REGISTER_SERIALIZABLE(Funnel,false);
-
-#endif //  FUNNEL_HPP
-

Copied: branches/scons-layout/pkg/dem/PreProcessor/Funnel.cpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/Funnel/Funnel.cpp)

Copied: branches/scons-layout/pkg/dem/PreProcessor/Funnel.hpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/Funnel/Funnel.hpp)

Deleted: branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest/SDECImpactTest.cpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest/SDECImpactTest.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest/SDECImpactTest.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,565 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;SDECImpactTest.hpp&quot;
-
-#include &quot;ElasticContactLaw.hpp&quot;
-#include &quot;MacroMicroElasticRelationships.hpp&quot;
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include &quot;SDECLinkPhysics.hpp&quot;
-#include &quot;ElasticCriterionTimeStepper.hpp&quot;
-
-#include &quot;AveragePositionRecorder.hpp&quot;
-#include &quot;ForceRecorder.hpp&quot;
-#include &quot;VelocityRecorder.hpp&quot;
-
-#include&lt;yade/pkg-common/Box.hpp&gt;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/SAPCollider.hpp&gt;
-#include&lt;yade/pkg-common/PersistentSAPCollider.hpp&gt;
-#include&lt;yade/lib-serialization/IOFormatManager.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionPhysicsMetaEngine.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-
-#include &lt;boost/filesystem/convenience.hpp&gt;
-#include &lt;boost/lexical_cast.hpp&gt;
-#include &lt;boost/numeric/conversion/bounds.hpp&gt;
-#include &lt;boost/limits.hpp&gt;
-
-
-using namespace boost;
-using namespace std;
-
-
-SDECImpactTest::SDECImpactTest () : FileGenerator()
-{
-	lowerCorner 		= Vector3r(1000,1000,1000);
-	upperCorner 		= Vector3r(-1000,-1000,-1000);
-	thickness 		= 0.01;
-	importFilename 		= &quot;../data/small.sdec.xyz&quot;;
-	wall_top 		= true;
-	wall_bottom 		= true;
-	wall_1			= true;
-	wall_2			= true;
-	wall_3			= true;
-	wall_4			= true;
-	wall_top_wire 		= true;
-	wall_bottom_wire	= true;
-	wall_1_wire		= true;
-	wall_2_wire		= true;
-	wall_3_wire		= true;
-	wall_4_wire		= true;
-	spheresColor		= Vector3r(0.8,0.3,0.3);
-	spheresRandomColor	= false;
-	recordBottomForce	= true;
-	forceRecordFile		= &quot;../data/force&quot;;
-	recordAveragePositions	= true;
-	positionRecordFile	= &quot;../data/position&quot;;
-	recordIntervalIter	= 100;
-	velocityRecordFile 	= &quot;../data/velocities&quot;;
-	rotationBlocked = true;
-	
-//	boxWalls 		= false;
-	boxWalls 		= true;
-
-//	bigBall 		= true;
-	bigBall 		= false;
-	bigBallRadius		= 0.075;
-	bigBallPoissonRatio 	= 0.3;
-	bigBallYoungModulus 	= 40000000000.0;
-	bigBallFrictDeg 	= 60;
-//	bigBallCohesion 	= 10000000000;
-//	bigBallTensionStr 	= 10000000000;
-	bigBallDensity		= 7800;
-	bigBallDropTimeSeconds	= 30;
-	bigBallDropHeight 	= 3.04776;
-	
-	dampingForce = 0.7;
-	dampingMomentum = 0.7;
-	timeStepUpdateInterval = 300;
-	
-	sphereYoungModulus  = 15000000.0;
-	spherePoissonRatio  = 0.2;
-	sphereFrictionDeg   = 18.0;
-	density			= 2600;
-	
-	boxYoungModulus   = 15000000.0;
-	boxPoissonRatio  = 0.2;
-	boxFrictionDeg   = -18.0;
-	gravity 	= Vector3r(0,-9.81,0);
-}
-
-
-SDECImpactTest::~SDECImpactTest ()
-{
-
-}
-
-
-void SDECImpactTest::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-//	REGISTER_ATTRIBUTE(lowerCorner);
-//	REGISTER_ATTRIBUTE(upperCorner);
-//	REGISTER_ATTRIBUTE(thickness);
-	REGISTER_ATTRIBUTE(importFilename);
-	REGISTER_ATTRIBUTE(boxWalls);
-
-	REGISTER_ATTRIBUTE(sphereYoungModulus);
-	REGISTER_ATTRIBUTE(spherePoissonRatio);
-	REGISTER_ATTRIBUTE(sphereFrictionDeg);
-
-	REGISTER_ATTRIBUTE(boxYoungModulus);
-	REGISTER_ATTRIBUTE(boxPoissonRatio);
-	REGISTER_ATTRIBUTE(boxFrictionDeg);
-
-	REGISTER_ATTRIBUTE(density);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum);
-	REGISTER_ATTRIBUTE(rotationBlocked);
-	REGISTER_ATTRIBUTE(timeStepUpdateInterval);
-//	REGISTER_ATTRIBUTE(wall_top);
-//	REGISTER_ATTRIBUTE(wall_bottom);
-//	REGISTER_ATTRIBUTE(wall_1);
-//	REGISTER_ATTRIBUTE(wall_2);
-//	REGISTER_ATTRIBUTE(wall_3);
-//	REGISTER_ATTRIBUTE(wall_4);
-//	REGISTER_ATTRIBUTE(wall_top_wire);
-//	REGISTER_ATTRIBUTE(wall_bottom_wire);
-//	REGISTER_ATTRIBUTE(wall_1_wire);
-//	REGISTER_ATTRIBUTE(wall_2_wire);
-//	REGISTER_ATTRIBUTE(wall_3_wire);
-//	REGISTER_ATTRIBUTE(wall_4_wire);
-//	REGISTER_ATTRIBUTE(spheresColor);
-//	REGISTER_ATTRIBUTE(spheresRandomColor);
-//	REGISTER_ATTRIBUTE(recordBottomForce);
-	REGISTER_ATTRIBUTE(forceRecordFile);
-//	REGISTER_ATTRIBUTE(recordAveragePositions);
-	REGISTER_ATTRIBUTE(positionRecordFile);
-	REGISTER_ATTRIBUTE(velocityRecordFile)
-	REGISTER_ATTRIBUTE(recordIntervalIter);
-
-//	REGISTER_ATTRIBUTE(gravity);
-	
-	REGISTER_ATTRIBUTE(bigBall);
-	REGISTER_ATTRIBUTE(bigBallRadius);
-	REGISTER_ATTRIBUTE(bigBallDensity);
-	REGISTER_ATTRIBUTE(bigBallDropTimeSeconds);
-	REGISTER_ATTRIBUTE(bigBallFrictDeg);
-	REGISTER_ATTRIBUTE(bigBallYoungModulus);
-	REGISTER_ATTRIBUTE(bigBallPoissonRatio);
-	REGISTER_ATTRIBUTE(bigBallDropHeight);
-
-}
-
-
-string SDECImpactTest::generate()
-{
-	unsigned int startId=boost::numeric::bounds&lt;unsigned int&gt;::highest(), endId=0; // record forces from group 2
-	
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-	createActors(rootBody);
-	positionRootBody(rootBody);
-
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-
-	shared_ptr&lt;Body&gt; body;
-	if(importFilename.size() != 0 &amp;&amp; filesystem::exists(importFilename) )
-	{
-		ifstream loadFile(importFilename.c_str());
-		long int i=0;
-		Real f,g,x,y,z,radius;
-		while( ! loadFile.eof() )
-		{
-			++i;
-			loadFile &gt;&gt; x;
-			loadFile &gt;&gt; y;
-			loadFile &gt;&gt; z;
-			Vector3r position = Vector3r(x,z,y);
-			loadFile &gt;&gt; radius;
-		
-			loadFile &gt;&gt; f;
-			loadFile &gt;&gt; g;
-			if( boxWalls ? f&gt;1 : false ) // skip loading of SDEC walls
-				continue;
-			if(f==8)
-				continue;
-
-	//		if( i % 100 == 0 ) // FIXME - should display a progress BAR !!
-	//			cout &lt;&lt; &quot;loaded: &quot; &lt;&lt; i &lt;&lt; endl;
-			if(f==1)
-			{
-				lowerCorner[0] = min(position[0]-radius , lowerCorner[0]);
-				lowerCorner[1] = min(position[1]-radius , lowerCorner[1]);
-				lowerCorner[2] = min(position[2]-radius , lowerCorner[2]);
-				upperCorner[0] = max(position[0]+radius , upperCorner[0]);
-				upperCorner[1] = max(position[1]+radius , upperCorner[1]);
-				upperCorner[2] = max(position[2]+radius , upperCorner[2]);
-			}
-			createSphere(body,position,radius,false,f==1);
-			rootBody-&gt;bodies-&gt;insert(body);
-			if(f == 2)
-			{
-				startId = std::min(body-&gt;getId() , startId);
-				endId   = std::max(body-&gt;getId() , endId);
-			}
-				
-		}
-	}
-
-// create bigBall
-	Vector3r position = (upperCorner+lowerCorner)*0.5 + Vector3r(0,bigBallDropHeight,0);
-	createSphere(body,position,bigBallRadius,true,false);	
-	int bigId = 0;
-	if(bigBall)
-		rootBody-&gt;bodies-&gt;insert(body);
-	bigId = body-&gt;getId();
-	forcerec-&gt;bigBallId = bigId;
-	forcerec-&gt;bigBallReleaseTime = bigBallDropTimeSeconds;
-	forcerec-&gt;startId = startId;
-	forcerec-&gt;endId   = endId;
-	averagePositionRecorder-&gt;bigBallId = bigId;
-	velocityRecorder-&gt;bigBallId = bigId;
-
-	if(boxWalls)
-	{
-	// bottom box
-	 	Vector3r center		= Vector3r(
-	 						(lowerCorner[0]+upperCorner[0])/2,
-	 						lowerCorner[1]-thickness/2.0,
-	 						(lowerCorner[2]+upperCorner[2])/2);
-	 	Vector3r halfSize	= Vector3r(
-	 						fabs(lowerCorner[0]-upperCorner[0])/2+thickness,
-							thickness/2.0,
-	 						fabs(lowerCorner[2]-upperCorner[2])/2+thickness);
-	
-		createBox(body,center,halfSize,wall_bottom_wire);
-	 	if(wall_bottom)
-			rootBody-&gt;bodies-&gt;insert(body);
-//		forcerec-&gt;id = body-&gt;getId();
-	
-	// top box
-	 	center			= Vector3r(
-	 						(lowerCorner[0]+upperCorner[0])/2,
-	 						upperCorner[1]+thickness/2.0,
-	 						(lowerCorner[2]+upperCorner[2])/2);
-	 	halfSize		= Vector3r(
-	 						fabs(lowerCorner[0]-upperCorner[0])/2+thickness,
-	 						thickness/2.0,
-	 						fabs(lowerCorner[2]-upperCorner[2])/2+thickness);
-	
-		createBox(body,center,halfSize,wall_top_wire);
-	 	if(wall_top)
-			rootBody-&gt;bodies-&gt;insert(body);
-	// box 1
-	
-	 	center			= Vector3r(
-	 						lowerCorner[0]-thickness/2.0,
-	 						(lowerCorner[1]+upperCorner[1])/2,
-	 						(lowerCorner[2]+upperCorner[2])/2);
-		halfSize		= Vector3r(
-							thickness/2.0,
-	 						fabs(lowerCorner[1]-upperCorner[1])/2+thickness,
-	 						fabs(lowerCorner[2]-upperCorner[2])/2+thickness);
-		createBox(body,center,halfSize,wall_1_wire);
-	 	if(wall_1)
-			rootBody-&gt;bodies-&gt;insert(body);
-	// box 2
-	 	center			= Vector3r(
-	 						upperCorner[0]+thickness/2.0,
-	 						(lowerCorner[1]+upperCorner[1])/2,
-							(lowerCorner[2]+upperCorner[2])/2);
-	 	halfSize		= Vector3r(
-	 						thickness/2.0,
-	 						fabs(lowerCorner[1]-upperCorner[1])/2+thickness,
-	 						fabs(lowerCorner[2]-upperCorner[2])/2+thickness);
-	 	
-		createBox(body,center,halfSize,wall_2_wire);
-	 	if(wall_2)
-			rootBody-&gt;bodies-&gt;insert(body);
-	// box 3
-	 	center			= Vector3r(
-	 						(lowerCorner[0]+upperCorner[0])/2,
-	 						(lowerCorner[1]+upperCorner[1])/2,
-	 						lowerCorner[2]-thickness/2.0);
-	 	halfSize		= Vector3r(
-	 						fabs(lowerCorner[0]-upperCorner[0])/2+thickness,
-	 						fabs(lowerCorner[1]-upperCorner[1])/2+thickness,
-	 						thickness/2.0);
-		createBox(body,center,halfSize,wall_3_wire);
-	 	if(wall_3)
-	 		rootBody-&gt;bodies-&gt;insert(body);
-	
-	// box 4
-	 	center			= Vector3r(
-	 						(lowerCorner[0]+upperCorner[0])/2,
-	 						(lowerCorner[1]+upperCorner[1])/2,
-	 						upperCorner[2]+thickness/2.0);
-	 	halfSize		= Vector3r(
-	 						fabs(lowerCorner[0]-upperCorner[0])/2+thickness,
-	 						fabs(lowerCorner[1]-upperCorner[1])/2+thickness,
-	 						thickness/2.0);
-		createBox(body,center,halfSize,wall_3_wire);
-	 	if(wall_4)
-	 		rootBody-&gt;bodies-&gt;insert(body);
-			 
-	}
-
- 	return &quot;Generated a sample inside box of dimensions: (&quot; 
- 		+ lexical_cast&lt;string&gt;(lowerCorner[0]) + &quot;,&quot; 
- 		+ lexical_cast&lt;string&gt;(lowerCorner[1]) + &quot;,&quot; 
- 		+ lexical_cast&lt;string&gt;(lowerCorner[2]) + &quot;) and (&quot; 
- 		+ lexical_cast&lt;string&gt;(upperCorner[0]) + &quot;,&quot; 
- 		+ lexical_cast&lt;string&gt;(upperCorner[1]) + &quot;,&quot; 
- 		+ lexical_cast&lt;string&gt;(upperCorner[2]) + &quot;).&quot;;
-
-}
-
-
-void SDECImpactTest::createSphere(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Real radius, bool big, bool dynamic )
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,2));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	
-	body-&gt;isDynamic			= dynamic;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 4.0/3.0*Mathr::PI*radius*radius*radius*(big ? bigBallDensity : density);
-	
-	physics-&gt;inertia		= Vector3r( 	2.0/5.0*physics-&gt;mass*radius*radius,
-							2.0/5.0*physics-&gt;mass*radius*radius,
-							2.0/5.0*physics-&gt;mass*radius*radius);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= big ? bigBallYoungModulus : sphereYoungModulus;
-	physics-&gt;poisson		= big ? bigBallPoissonRatio : spherePoissonRatio;
-	physics-&gt;frictionAngle		= (big ? bigBallFrictDeg : sphereFrictionDeg ) * Mathr::PI/180.0;
-
-	if((!big) &amp;&amp; (!dynamic) &amp;&amp; (!boxWalls))
-	{
-		physics-&gt;young			= boxYoungModulus;
-		physics-&gt;poisson		= boxPoissonRatio;
-		physics-&gt;frictionAngle		= boxFrictionDeg * Mathr::PI/180.0;
-	}
-	
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-
-
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= spheresColor;
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	iSphere-&gt;radius			= radius;
-	iSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-
-	body-&gt;interactingGeometry	= iSphere;
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void SDECImpactTest::createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents, bool wire)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,2));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= extents[0]*extents[1]*extents[2]*density*2; 
-	physics-&gt;inertia		= Vector3r(
-							  physics-&gt;mass*(extents[1]*extents[1]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[0]*extents[0]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[1]*extents[1]+extents[0]*extents[0])/3
-						);
-//	physics-&gt;mass			= 0;
-//	physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-
-	physics-&gt;young			= boxYoungModulus;
-	physics-&gt;poisson		= boxPoissonRatio;
-	physics-&gt;frictionAngle		= boxFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
-
-	gBox-&gt;extents			= extents;
-	gBox-&gt;diffuseColor		= Vector3r(1,1,1);
-	gBox-&gt;wire			= wire;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= false;
-	
-	iBox-&gt;extents			= extents;
-	iBox-&gt;diffuseColor		= Vector3r(1,1,1);
-
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void SDECImpactTest::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-// recording average positions
-	averagePositionRecorder = shared_ptr&lt;AveragePositionRecorder&gt;(new AveragePositionRecorder);
-	averagePositionRecorder -&gt; outputFile 		= positionRecordFile;
-	averagePositionRecorder -&gt; interval 		= recordIntervalIter;
-// recording forces
-	forcerec = shared_ptr&lt;ForceRecorder&gt;(new ForceRecorder);
-	forcerec -&gt; outputFile 	= forceRecordFile;
-	forcerec -&gt; interval 	= recordIntervalIter;
-// recording velocities
-	velocityRecorder = shared_ptr&lt;VelocityRecorder&gt;(new VelocityRecorder);
-	velocityRecorder-&gt; outputFile 	= velocityRecordFile;
-	velocityRecorder-&gt; interval 	= recordIntervalIter;
-
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
-	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingSphere&quot;,&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
-
-	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
-	interactionPhysicsDispatcher-&gt;add(&quot;BodyMacroParameters&quot;,&quot;BodyMacroParameters&quot;,&quot;MacroMicroElasticRelationships&quot;);
-		
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-
-	
-
-		
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping-&gt;damping = dampingForce;
-	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping-&gt;damping = dampingMomentum;
-	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
-	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
-	
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
-
-	shared_ptr&lt;ElasticCriterionTimeStepper&gt; sdecTimeStepper(new ElasticCriterionTimeStepper);
-	sdecTimeStepper-&gt;sdecGroupMask = 2;
-	sdecTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-	
-	
-	shared_ptr&lt;ElasticContactLaw&gt; elasticContactLaw(new ElasticContactLaw);
-	elasticContactLaw-&gt;sdecGroupMask = 2;
-	
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	rootBody-&gt;engines.push_back(sdecTimeStepper);
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
-	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-	rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
-	rootBody-&gt;engines.push_back(elasticContactLaw);
-	rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(actionDampingDispatcher);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-	if(!rotationBlocked)
-		rootBody-&gt;engines.push_back(orientationIntegrator);
-	rootBody-&gt;engines.push_back(averagePositionRecorder);
-	rootBody-&gt;engines.push_back(velocityRecorder);
-	rootBody-&gt;engines.push_back(forcerec);
-	
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-	
-}
-
-
-void SDECImpactTest::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	rootBody-&gt;isDynamic		= false;
-
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters); // FIXME : fix indexable class PhysicalParameters
-	physics-&gt;se3			= Se3r(Vector3r(0,0,0),q);
-	physics-&gt;mass			= 0;
-	physics-&gt;velocity		= Vector3r::ZERO;
-	physics-&gt;acceleration		= Vector3r::ZERO;
-	
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	
-	set-&gt;diffuseColor		= Vector3r(0,0,1);
-
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor		= Vector3r(0,0,1);
-	
-	rootBody-&gt;interactingGeometry	= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume	= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;physicalParameters 	= physics;
-	
-}
-

Deleted: branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest/SDECImpactTest.hpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest/SDECImpactTest.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest/SDECImpactTest.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,98 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SDECIMPORT_HPP
-#define SDECIMPORT_HPP
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class ForceRecorder;
-class AveragePositionRecorder;
-class VelocityRecorder;
-
-class SDECImpactTest : public FileGenerator
-{
-	private	:
-		Vector3r	 gravity
-				,lowerCorner
-				,upperCorner;
-
-		Vector3r	 spheresColor;
-
-		Real		 thickness
-				,sphereYoungModulus
-				,spherePoissonRatio
-				,sphereFrictionDeg
-				,boxYoungModulus
-				,boxPoissonRatio
-				,boxFrictionDeg
-				,density
-				,dampingForce
-				,dampingMomentum
-
-				,bigBallRadius
-				,bigBallDensity
-				,bigBallDropTimeSeconds
-				,bigBallPoissonRatio
-				,bigBallYoungModulus
-				,bigBallFrictDeg
-				,bigBallDropHeight;
-
-		bool		 wall_top
-				,wall_bottom
-				,wall_1
-				,wall_2
-				,wall_3
-				,wall_4
-				,wall_top_wire
-				,wall_bottom_wire
-				,wall_1_wire
-				,wall_2_wire
-				,wall_3_wire
-				,wall_4_wire
-				,bigBall
-				,rotationBlocked
-				,spheresRandomColor
-				,recordBottomForce
-				,recordAveragePositions
-				,boxWalls;
-
-		int		 recordIntervalIter
-				,timeStepUpdateInterval;
-		
-		string		 forceRecordFile
-				,positionRecordFile
-				,velocityRecordFile
-				,importFilename;
-	
-		shared_ptr&lt;ForceRecorder&gt; forcerec;
-		shared_ptr&lt;VelocityRecorder&gt; velocityRecorder;
-		shared_ptr&lt;AveragePositionRecorder&gt; averagePositionRecorder;
-	
-		void createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents,bool wire);
-		void createSphere(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Real radius,bool big,bool dynamic);
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-	
-	public : 
-		SDECImpactTest ();
-		~SDECImpactTest ();
-		string generate();
-	
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(SDECImpactTest);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-};
-
-REGISTER_SERIALIZABLE(SDECImpactTest,false);
-
-#endif // SDECIMPORT_HPP
-

Copied: branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest.cpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest/SDECImpactTest.cpp)

Copied: branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest.hpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/SDECImpactTest/SDECImpactTest.hpp)

Deleted: branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres/SDECLinkedSpheres.cpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres/SDECLinkedSpheres.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres/SDECLinkedSpheres.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,410 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-///
-// FIXME : add CohesiveContactLaw engine to make it work
-///
-
-
-#include &quot;SDECLinkedSpheres.hpp&quot;
-
-#include &quot;ElasticContactLaw.hpp&quot;
-#include &quot;ElasticCohesiveLaw.hpp&quot;
-#include &quot;MacroMicroElasticRelationships.hpp&quot;
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include &quot;SDECLinkPhysics.hpp&quot;
-#include &quot;ElasticCriterionTimeStepper.hpp&quot;
-
-
-#include&lt;yade/pkg-common/Box.hpp&gt;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/SAPCollider.hpp&gt;
-#include&lt;yade/pkg-common/PersistentSAPCollider.hpp&gt;
-#include&lt;yade/lib-serialization/IOFormatManager.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionPhysicsMetaEngine.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-
-SDECLinkedSpheres::SDECLinkedSpheres () : FileGenerator()
-{
-	nbSpheres = Vector3r(2,2,20);
-	minRadius = 5.01;
-	maxRadius = 5.01;
-	disorder = 0;
-	spacing = 10;
-	supportSize = 0.5;
-	support1 = 1;
-	support2 = 1;
-	dampingForce = 0.2;
-	dampingMomentum = 0.2;
-	timeStepUpdateInterval = 300;
-	//sphereYoungModulus  = 15000000.0;
-	sphereYoungModulus  =   10000000;
-	spherePoissonRatio  = 0.2;
-	sphereFrictionDeg   = 18.0;
-	density = 2.6;
-	momentRotationLaw = true;
-	gravity = Vector3r(0,-9.81,0);
-}
-
-
-SDECLinkedSpheres::~SDECLinkedSpheres ()
-{
-
-}
-
-
-void SDECLinkedSpheres::postProcessAttributes(bool)
-{
-}
-
-
-void SDECLinkedSpheres::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	REGISTER_ATTRIBUTE(nbSpheres);
-	REGISTER_ATTRIBUTE(minRadius);
-	REGISTER_ATTRIBUTE(maxRadius);
-	REGISTER_ATTRIBUTE(density);
-	REGISTER_ATTRIBUTE(sphereYoungModulus);
-	REGISTER_ATTRIBUTE(spherePoissonRatio);
-	REGISTER_ATTRIBUTE(sphereFrictionDeg);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum);
-	REGISTER_ATTRIBUTE(momentRotationLaw);
-	REGISTER_ATTRIBUTE(gravity);
-	REGISTER_ATTRIBUTE(disorder);
-	REGISTER_ATTRIBUTE(spacing);
-	REGISTER_ATTRIBUTE(supportSize);
-	REGISTER_ATTRIBUTE(support1);
-	REGISTER_ATTRIBUTE(support2);
-	REGISTER_ATTRIBUTE(timeStepUpdateInterval);
-}
-
-
-string SDECLinkedSpheres::generate()
-{
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-	createActors(rootBody);
-	positionRootBody(rootBody);
-
-////////////////////////////////////
-	
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-
-////////////////////////////////////
-
-	shared_ptr&lt;Body&gt; ground;
-	shared_ptr&lt;Body&gt; supportBox1;
-	shared_ptr&lt;Body&gt; supportBox2;
-	
-	createBox(ground, Vector3r(0,0,0), Vector3r(200,5,200));
-	createBox(supportBox1, Vector3r(0,0,((Real)(nbSpheres[2])/2.0-supportSize+1.5)*spacing), Vector3r(20,50,20));
-	createBox(supportBox2, Vector3r(0,0,-((Real)(nbSpheres[2])/2.0-supportSize+2.5)*spacing), Vector3r(20,50,20));
-			
-	rootBody-&gt;bodies-&gt;insert(ground);
-	if (support1)
-		rootBody-&gt;bodies-&gt;insert(supportBox1);
-	if (support2)
-		rootBody-&gt;bodies-&gt;insert(supportBox2);
-
-/////////////////////////////////////
-
-	for(int i=0;i&lt;nbSpheres[0];i++)
-		for(int j=0;j&lt;nbSpheres[1];j++)
-			for(int k=0;k&lt;nbSpheres[2];k++)
-			{
-				shared_ptr&lt;Body&gt; sphere;
-				createSphere(sphere,i,j,k);
-				rootBody-&gt;bodies-&gt;insert(sphere);
-			}
-	
-/////////////////////////////////////
-
-	rootBody-&gt;persistentInteractions-&gt;clear();
-	
-	shared_ptr&lt;Body&gt; bodyA;
-
-	BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-	BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-	BodyContainer::iterator bi2;
-
-	++bi; // skips ground
-	if (support1)
-		++bi; // skips supportBox1
-	if (support2)
-		++bi; // skips supportBox2
-		
-		
-	for( ; bi!=biEnd ; ++bi )
-	{
-		bodyA =*bi;
-		bi2=bi;
-		++bi2;
-		for( ; bi2!=biEnd ; ++bi2 )
-		{
-			shared_ptr&lt;Body&gt; bodyB = *bi2;
-
-			shared_ptr&lt;BodyMacroParameters&gt; a = YADE_PTR_CAST&lt;BodyMacroParameters&gt;(bodyA-&gt;physicalParameters);
-			shared_ptr&lt;BodyMacroParameters&gt; b = YADE_PTR_CAST&lt;BodyMacroParameters&gt;(bodyB-&gt;physicalParameters);
-			shared_ptr&lt;InteractingSphere&gt;	as = YADE_PTR_CAST&lt;InteractingSphere&gt;(bodyA-&gt;interactingGeometry);
-			shared_ptr&lt;InteractingSphere&gt;	bs = YADE_PTR_CAST&lt;InteractingSphere&gt;(bodyB-&gt;interactingGeometry);
-
-			if ((a-&gt;se3.position - b-&gt;se3.position).Length() &lt; (as-&gt;radius + bs-&gt;radius))  
-			{
-				shared_ptr&lt;Interaction&gt; 		link(new Interaction( bodyA-&gt;getId() , bodyB-&gt;getId() ));
-				shared_ptr&lt;SDECLinkGeometry&gt;		geometry(new SDECLinkGeometry);
-				shared_ptr&lt;SDECLinkPhysics&gt;	physics(new SDECLinkPhysics);
-				
-				geometry-&gt;radius1			= as-&gt;radius - fabs(as-&gt;radius - bs-&gt;radius)*0.5;
-				geometry-&gt;radius2			= bs-&gt;radius - fabs(as-&gt;radius - bs-&gt;radius)*0.5;
-
-				physics-&gt;initialKn			= 50000000; // FIXME - BIG problem here.
-				physics-&gt;initialKs			= 5000000;
-				physics-&gt;heta				= 1;
-				physics-&gt;initialEquilibriumDistance	= (a-&gt;se3.position - b-&gt;se3.position).Length();
-				physics-&gt;knMax				= 5500000;
-				physics-&gt;ksMax				= 550000;
-
-				link-&gt;interactionGeometry 		= geometry;
-				link-&gt;interactionPhysics 		= physics;
-				link-&gt;isReal 				= true;
-				link-&gt;isNew 				= false;
-				
-				rootBody-&gt;persistentInteractions-&gt;insert(link);
-			}
-		}
-	}
-	
-	return &quot;total number of permament links created: &quot; 
-		+ lexical_cast&lt;string&gt;(rootBody-&gt;persistentInteractions-&gt;size()) 
-		+ &quot;\nWARNING: link bonds are nearly working, but the formulas are waiting for total rewrite!&quot;;
-}
-
-
-void SDECLinkedSpheres::createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,55));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	
-		
-	Vector3r position 		= Vector3r(i,j,k)*spacing
-					  - Vector3r(nbSpheres[0]/2*spacing,nbSpheres[1]/2*spacing-90,nbSpheres[2]/2*spacing) 
-					  + Vector3r(Mathr::SymmetricRandom()*disorder,Mathr::SymmetricRandom()*disorder,Mathr::SymmetricRandom()*disorder);
-
-	Real radius 			= (Mathr::IntervalRandom(minRadius,maxRadius));
-	
-	body-&gt;isDynamic			= true;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 4.0/3.0*Mathr::PI*radius*radius*radius*density;
-	physics-&gt;inertia		= Vector3r(2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius); //
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-
-
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	iSphere-&gt;radius			= radius;
-	iSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-
-	body-&gt;interactingGeometry	= iSphere;
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void SDECLinkedSpheres::createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,55));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= extents[0]*extents[1]*extents[2]*density*2; 
-	physics-&gt;inertia		= Vector3r(
-							  physics-&gt;mass*(extents[1]*extents[1]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[0]*extents[0]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[1]*extents[1]+extents[0]*extents[0])/3
-						);
-//	physics-&gt;mass			= 0;
-//	physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
-
-	gBox-&gt;extents			= extents;
-	gBox-&gt;diffuseColor		= Vector3r(1,1,1);
-	gBox-&gt;wire			= false;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= true;
-	
-	iBox-&gt;extents			= extents;
-	iBox-&gt;diffuseColor		= Vector3r(1,1,1);
-
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void SDECLinkedSpheres::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
-	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingSphere&quot;,&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
-
-	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
-	interactionPhysicsDispatcher-&gt;add(&quot;BodyMacroParameters&quot;,&quot;BodyMacroParameters&quot;,&quot;MacroMicroElasticRelationships&quot;);
-		
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-		
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping-&gt;damping = dampingForce;
-	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping-&gt;damping = dampingMomentum;
-	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
-	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
-	
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
- 	
-	shared_ptr&lt;ElasticCriterionTimeStepper&gt; sdecTimeStepper(new ElasticCriterionTimeStepper);
-	sdecTimeStepper-&gt;sdecGroupMask = 55;
-	sdecTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-
-	
-	shared_ptr&lt;ElasticContactLaw&gt; constitutiveLaw(new ElasticContactLaw);
-	constitutiveLaw-&gt;sdecGroupMask = 55;
-	constitutiveLaw-&gt;momentRotationLaw = momentRotationLaw;
-// FIXME FIXME FIXME ....	
-	shared_ptr&lt;ElasticCohesiveLaw&gt; constitutiveLaw2(new ElasticCohesiveLaw);
-	constitutiveLaw2-&gt;sdecGroupMask = 55;
-	constitutiveLaw2-&gt;momentRotationLaw = momentRotationLaw;
-	
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(sdecTimeStepper);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
-	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-	rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
-	rootBody-&gt;engines.push_back(constitutiveLaw);
-	rootBody-&gt;engines.push_back(constitutiveLaw2);
-	rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(actionDampingDispatcher);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-	rootBody-&gt;engines.push_back(orientationIntegrator);
-
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-}
-	
-
-void SDECLinkedSpheres::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	rootBody-&gt;isDynamic		= false;
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	
-	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters); // FIXME : fix indexable class PhysicalParameters
-	physics-&gt;se3			= Se3r(Vector3r(0,0,0),q);
-	physics-&gt;mass			= 0;
-	physics-&gt;velocity		= Vector3r::ZERO;
-	physics-&gt;acceleration		= Vector3r::ZERO;
-	
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	set-&gt;diffuseColor		= Vector3r(0,0,1);
-
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor		= Vector3r(0,0,1);
-	
-	rootBody-&gt;interactingGeometry	= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume	= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;physicalParameters 	= physics;
-	
-}
-

Deleted: branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres/SDECLinkedSpheres.hpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres/SDECLinkedSpheres.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres/SDECLinkedSpheres.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,63 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LINKEDSPHERES_HPP
-#define LINKEDSPHERES_HPP
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-
-class SDECLinkedSpheres : public FileGenerator
-{
-	private	:
-		Vector3r	 nbSpheres
-				,gravity;
-
-		Real		 minRadius
-				,density
-				,maxRadius
-				,disorder
-				,spacing
-				,supportSize
-				,dampingForce
-				,dampingMomentum
-				,sphereYoungModulus
-				,spherePoissonRatio
-				,sphereFrictionDeg;
-
-		int		 timeStepUpdateInterval;
-
-		bool		 momentRotationLaw
-				,support1
-				,support2;
-	
-		void createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents);
-		void createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k);
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-	
-	public :
-		SDECLinkedSpheres ();
-		~SDECLinkedSpheres ();
-		string generate();
-	
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-		void registerAttributes();
-	REGISTER_CLASS_NAME(SDECLinkedSpheres);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-};
-
-REGISTER_SERIALIZABLE(SDECLinkedSpheres,false);
-
-#endif // LINKEDSPHERES_HPP
-

Copied: branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres.cpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres/SDECLinkedSpheres.cpp)

Copied: branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres.hpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/SDECLinkedSpheres/SDECLinkedSpheres.hpp)

Deleted: branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall/SDECMovingWall.cpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall/SDECMovingWall.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall/SDECMovingWall.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,453 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2005 by Andreas Plesch                                  *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-#include &quot;SDECMovingWall.hpp&quot;
-
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;ElasticContactLaw.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include &quot;MacroMicroElasticRelationships.hpp&quot;
-#include &quot;ElasticCriterionTimeStepper.hpp&quot;
-#include &quot;PositionOrientationRecorder.hpp&quot;
-
-
-#include&lt;yade/pkg-common/Box.hpp&gt;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/SAPCollider.hpp&gt;
-#include&lt;yade/pkg-common/PersistentSAPCollider.hpp&gt;
-#include&lt;yade/lib-serialization/IOFormatManager.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/TranslationEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionPhysicsMetaEngine.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-
-SDECMovingWall::SDECMovingWall () : FileGenerator()
-{
-	nbSpheres = Vector3r(40,4,4);
-	minRadius = 3;
-	maxRadius = 4;
-	groundSize = Vector3r(200,5,200);
-	groundPosition = Vector3r(0,0,0);
-	wallSize = Vector3r(5,200,200);
-	wallPosition = Vector3r(-200,205,0);
-	wallVelocity = 5;
-	wallTranslationAxis = Vector3r(1,0,0);
-	side1Size = Vector3r(5,200,200);
-	side1Position = Vector3r(200,205,0);
-	side1wire = false;
-	side2Size = Vector3r(200,200,5);
-	side2Position = Vector3r(0,205,-30);
-	side2wire = true;
-	side3Size = Vector3r(200,200,5);
-	side3Position = Vector3r(0,205,30);
-	side3wire = true;
-	dampingForce = 0.3;
-	dampingMomentum = 0.3;
-	timeStepUpdateInterval = 300;
-	sphereYoungModulus   = 15000000.0;
-	//sphereYoungModulus   = 10000;
-	spherePoissonRatio  = 0.2;
-	sphereFrictionDeg   = 18.0;
-	density = 2600;
-	rotationBlocked = false;
-	gravity = Vector3r(0,-9.81,0);
-	disorder = 0.2;
-       	useSpheresAsGround = false;
-	spheresHeight = 0;
-}
-
-
-SDECMovingWall::~SDECMovingWall ()
-{
-
-}
-
-
-void SDECMovingWall::postProcessAttributes(bool)
-{
-
-}
-
-
-void SDECMovingWall::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	REGISTER_ATTRIBUTE(nbSpheres);
-	REGISTER_ATTRIBUTE(minRadius);
-	REGISTER_ATTRIBUTE(maxRadius);
-	REGISTER_ATTRIBUTE(spheresHeight);
-	REGISTER_ATTRIBUTE(sphereYoungModulus);
-	REGISTER_ATTRIBUTE(spherePoissonRatio);
-	REGISTER_ATTRIBUTE(sphereFrictionDeg);
-	REGISTER_ATTRIBUTE(gravity);
-	REGISTER_ATTRIBUTE(density);
-	REGISTER_ATTRIBUTE(disorder);
-	REGISTER_ATTRIBUTE(groundSize);
-	REGISTER_ATTRIBUTE(groundPosition);
-	REGISTER_ATTRIBUTE(wallSize);
-	REGISTER_ATTRIBUTE(wallPosition);
-	REGISTER_ATTRIBUTE(wallVelocity);
-	REGISTER_ATTRIBUTE(wallTranslationAxis);
-	REGISTER_ATTRIBUTE(side1Size);
-	REGISTER_ATTRIBUTE(side1Position);
-	REGISTER_ATTRIBUTE(side1wire);
-	REGISTER_ATTRIBUTE(side2Size);
-	REGISTER_ATTRIBUTE(side2Position);
-	REGISTER_ATTRIBUTE(side2wire);
-	REGISTER_ATTRIBUTE(side3Size);
-	REGISTER_ATTRIBUTE(side3Position);
-	REGISTER_ATTRIBUTE(side3wire);
-       	REGISTER_ATTRIBUTE(useSpheresAsGround);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum);
-	REGISTER_ATTRIBUTE(rotationBlocked);
-	REGISTER_ATTRIBUTE(timeStepUpdateInterval);
-}
-
-
-string SDECMovingWall::generate()
-{
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-	createActors(rootBody);
-	positionRootBody(rootBody);
-
-////////////////////////////////////
-///////// Container
-	
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-		
-////////////////////////////////////
-///////// ground
-
-	if (!useSpheresAsGround)
-	{
-		shared_ptr&lt;Body&gt; ground;
-		shared_ptr&lt;Body&gt; wall;
-		shared_ptr&lt;Body&gt; side1;
-		shared_ptr&lt;Body&gt; side2;
-		shared_ptr&lt;Body&gt; side3;
-		createBox(ground, groundPosition, groundSize, false);
-		createBox(wall, wallPosition, wallSize, false);
-		createBox(side1, side1Position, side1Size, side1wire);
-		createBox(side2, side2Position, side2Size, side2wire);
-		createBox(side3, side3Position, side3Size, side3wire);
-		rootBody-&gt;bodies-&gt;insert(ground);
-		rootBody-&gt;bodies-&gt;insert(wall);
-		rootBody-&gt;bodies-&gt;insert(side1);
-		rootBody-&gt;bodies-&gt;insert(side2);
-		rootBody-&gt;bodies-&gt;insert(side3);
-	}
-	else
-	{
-		int nbSpheresi,nbSpheresj,nbSpheresk;
-		Real radius = groundSize[0];
-
-		if (groundSize[1]&lt;radius)
-			radius = groundSize[1];
-		if (groundSize[2]&lt;radius)
-			radius = groundSize[2];
-
-		nbSpheresi = (int)(groundSize[0]/radius);
-		nbSpheresj = (int)(groundSize[1]/radius);
-		nbSpheresk = (int)(groundSize[2]/radius);
-
-		for(int i=0;i&lt;nbSpheresi;i++)
-			for(int j=0;j&lt;nbSpheresj;j++)
-				for(int k=0;k&lt;nbSpheresk;k++)
-				{
-					shared_ptr&lt;Body&gt; sphere;
-					createGroundSphere(sphere,radius,radius*(i-nbSpheresi*0.5+0.5),radius*(j-nbSpheresj*0.5+0.5),radius*(k-nbSpheresk*0.5+0.5));
-					rootBody-&gt;bodies-&gt;insert(sphere);
-				}
-	}
-
-///////// spheres
-
-	for(int i=0;i&lt;nbSpheres[0];i++)
-		for(int j=0;j&lt;nbSpheres[1];j++)
-			for(int k=0;k&lt;nbSpheres[2];k++)
-			{
-				shared_ptr&lt;Body&gt; sphere;
-				createSphere(sphere,i,j,k);
-				rootBody-&gt;bodies-&gt;insert(sphere);
-			}
-	
-	return &quot;&quot;;
-}
-
-
-void SDECMovingWall::createGroundSphere(shared_ptr&lt;Body&gt;&amp; body,Real radius, Real i, Real j, Real k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	
-	Vector3r position		= Vector3r(i,j,k);
-	
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 0;
-	physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= Vector3r(0.7,0.7,0.7);
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	iSphere-&gt;radius			= radius;
-	iSphere-&gt;diffuseColor		= Vector3r(0.8,0.3,0.3);
-
-	body-&gt;interactingGeometry	= iSphere;
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void SDECMovingWall::createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	
-	Vector3r position		= Vector3r(i,j+spheresHeight,k)*(2*maxRadius*1.1) // this formula is crazy !!
-					  - Vector3r( nbSpheres[0]/2*(2*maxRadius*1.1) , -7-maxRadius*2 , nbSpheres[2]/2*(2*maxRadius*1.1) )
-					  + Vector3r(Mathr::SymmetricRandom(),Mathr::SymmetricRandom(),Mathr::SymmetricRandom())*disorder*maxRadius;
-	Real radius 			= (Mathr::IntervalRandom(minRadius,maxRadius));
-	
-	body-&gt;isDynamic			= true;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 4.0/3.0*Mathr::PI*radius*radius*radius*density;
-	physics-&gt;inertia		= Vector3r(2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius); //
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-
-	gSphere-&gt;radius			= radius;
-// this gives a pretty nice radial color effect
-//	position.normalize();
-//	gSphere-&gt;diffuseColor		= position;
-// a simple way to have alternating colors per layer
-	gSphere-&gt;diffuseColor		= Vector3r(std::sin((float)j),std::cos((float)j),j/nbSpheres[1]);
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	iSphere-&gt;radius			= radius;
-	iSphere-&gt;diffuseColor		= Vector3r(0.8,0.3,0.3);
-
-	body-&gt;interactingGeometry	= iSphere;
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void SDECMovingWall::createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents, bool wire)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= extents[0]*extents[1]*extents[2]*density*2; 
-	physics-&gt;inertia		= Vector3r(
-							  physics-&gt;mass*(extents[1]*extents[1]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[0]*extents[0]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[1]*extents[1]+extents[0]*extents[0])/3
-						);
-	//physics-&gt;mass			= 0;
-	//physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
-
-	gBox-&gt;extents			= extents;
-	gBox-&gt;diffuseColor		= Vector3r(1,1,1);
-	gBox-&gt;wire			= wire;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= true;
-	
-	iBox-&gt;extents			= extents;
-	iBox-&gt;diffuseColor		= Vector3r(1,1,1);
-
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void SDECMovingWall::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
-	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingSphere&quot;,&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
-
-	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
-	interactionPhysicsDispatcher-&gt;add(&quot;BodyMacroParameters&quot;,&quot;BodyMacroParameters&quot;,&quot;MacroMicroElasticRelationships&quot;);
-		
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-	
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping-&gt;damping = dampingForce;
-	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping-&gt;damping = dampingMomentum;
-	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
-	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
-	
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
-// moving wall
-	shared_ptr&lt;TranslationEngine&gt; kinematic = shared_ptr&lt;TranslationEngine&gt;(new TranslationEngine);
-	kinematic-&gt;velocity  = wallVelocity;
-	wallTranslationAxis.Normalize();
-	kinematic-&gt;translationAxis  = wallTranslationAxis;
-
-	kinematic-&gt;subscribedBodies.push_back(1); //wall should be second inserted body, id=1
-
-	shared_ptr&lt;ElasticCriterionTimeStepper&gt; sdecTimeStepper(new ElasticCriterionTimeStepper);
-	sdecTimeStepper-&gt;sdecGroupMask = 1;
-	sdecTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-	
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	rootBody-&gt;engines.push_back(sdecTimeStepper);
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);	
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
-	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-	rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new ElasticContactLaw));
-	rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(actionDampingDispatcher);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-
-	if(!rotationBlocked)
-		rootBody-&gt;engines.push_back(orientationIntegrator);
-
-	shared_ptr&lt;PositionOrientationRecorder&gt; positionOrientationRecorder(new PositionOrientationRecorder);
-	rootBody-&gt;engines.push_back(positionOrientationRecorder);
-
-	rootBody-&gt;engines.push_back(kinematic);
-	
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-}
-
-
-void SDECMovingWall::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody) 
-{
-	rootBody-&gt;isDynamic		= false;
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters); // FIXME : fix indexable class PhysicalParameters
-	physics-&gt;se3				= Se3r(Vector3r(0,0,0),q);
-	physics-&gt;mass				= 0;
-	physics-&gt;velocity			= Vector3r(0,0,0);
-	physics-&gt;acceleration			= Vector3r::ZERO;
-		
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	set-&gt;diffuseColor			= Vector3r(0,0,1);
-	
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor			= Vector3r(0,0,1);
-	
-	rootBody-&gt;interactingGeometry		= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume		= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;physicalParameters 		= physics;
-}
-
-

Deleted: branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall/SDECMovingWall.hpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall/SDECMovingWall.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall/SDECMovingWall.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,75 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2005 by Andreas Plesch                                  *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SDEC_MOVING_WALL_HPP
-#define SDEC_MOVING_WALL_HPP
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-
-class SDECMovingWall : public FileGenerator
-{
-	private :
-		Vector3r	 nbSpheres
-				,groundSize
-				,groundPosition
-				,wallSize
-				,wallPosition
-				,wallTranslationAxis
-				,gravity
-				,side1Size
-				,side1Position
-				,side2Size
-				,side2Position
-				,side3Size
-				,side3Position;
-		
-		bool		 useSpheresAsGround
-				,side1wire
-				,side2wire
-				,side3wire;
-
-		bool		rotationBlocked;
-		
-		Real		 minRadius
-				,density
-				,maxRadius
-				,wallVelocity
-				,dampingForce
-				,disorder
-				,dampingMomentum
-				,spheresHeight
-				,sphereYoungModulus
-				,spherePoissonRatio
-				,sphereFrictionDeg;
-
-		int timeStepUpdateInterval;
-		
-		void createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents, bool wire);
-		void createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k);
-		void createGroundSphere(shared_ptr&lt;Body&gt;&amp; body,Real radius, Real i, Real j, Real k);
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-
-	public :
-		SDECMovingWall ();
-		~SDECMovingWall ();
-		string generate();
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-		void registerAttributes();
-
-	REGISTER_CLASS_NAME(SDECMovingWall);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-};
-
-REGISTER_SERIALIZABLE(SDECMovingWall,false);
-
-#endif // SDEC_MOVING_WALL_HPP 
-

Copied: branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall.cpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall/SDECMovingWall.cpp)

Copied: branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall.hpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/SDECMovingWall/SDECMovingWall.hpp)

Deleted: branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane/SDECSpheresPlane.cpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane/SDECSpheresPlane.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane/SDECSpheresPlane.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,415 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-#include &quot;SDECSpheresPlane.hpp&quot;
-
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;ElasticContactLaw.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include &quot;MacroMicroElasticRelationships.hpp&quot;
-#include &quot;ElasticCriterionTimeStepper.hpp&quot;
-#include &quot;PositionOrientationRecorder.hpp&quot;
-
-
-#include&lt;yade/pkg-common/Box.hpp&gt;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/SAPCollider.hpp&gt;
-#include&lt;yade/pkg-common/PersistentSAPCollider.hpp&gt;
-#include&lt;yade/lib-serialization/IOFormatManager.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionPhysicsMetaEngine.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-
-SDECSpheresPlane::SDECSpheresPlane () : FileGenerator()
-{
-	nbSpheres = Vector3r(2,3,2);
-	minRadius = 5;
-	maxRadius = 5;
-	groundSize = Vector3r(200,5,200);
-	dampingForce = 0.3;
-	dampingMomentum = 0.3;
-	timeStepUpdateInterval = 300;
-	sphereYoungModulus   = 15000000.0;
-	//sphereYoungModulus   = 10000;
-	spherePoissonRatio  = 0.2;
-	sphereFrictionDeg   = 18.0;
-	density = 2600;
-	rotationBlocked = false;
-	gravity = Vector3r(0,-9.81,0);
-	disorder = Vector3r(0.2,0.2,0.2);
-	useSpheresAsGround = false;
-	spheresHeight = 0;
-}
-
-
-SDECSpheresPlane::~SDECSpheresPlane ()
-{
-
-}
-
-
-void SDECSpheresPlane::postProcessAttributes(bool)
-{
-
-}
-
-
-void SDECSpheresPlane::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	REGISTER_ATTRIBUTE(nbSpheres);
-	REGISTER_ATTRIBUTE(minRadius);
-	REGISTER_ATTRIBUTE(maxRadius);
-	REGISTER_ATTRIBUTE(spheresHeight);
-	REGISTER_ATTRIBUTE(sphereYoungModulus);
-	REGISTER_ATTRIBUTE(spherePoissonRatio);
-	REGISTER_ATTRIBUTE(sphereFrictionDeg);
-	REGISTER_ATTRIBUTE(gravity);
-	REGISTER_ATTRIBUTE(density);
-	REGISTER_ATTRIBUTE(disorder);
-	REGISTER_ATTRIBUTE(groundSize);
-	REGISTER_ATTRIBUTE(useSpheresAsGround);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum);
-	REGISTER_ATTRIBUTE(rotationBlocked);
-	REGISTER_ATTRIBUTE(timeStepUpdateInterval);
-}
-
-
-string SDECSpheresPlane::generate()
-{
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-	createActors(rootBody);
-	positionRootBody(rootBody);
-
-////////////////////////////////////
-///////// Container
-	
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-		
-////////////////////////////////////
-///////// ground
-
-	if (!useSpheresAsGround)
-	{
-		shared_ptr&lt;Body&gt; ground;
-		createBox(ground, Vector3r(0,0,0), groundSize);
-		rootBody-&gt;bodies-&gt;insert(ground);
-	}
-	else
-	{
-		int nbSpheresi,nbSpheresj,nbSpheresk;
-		Real radius = groundSize[0];
-
-		if (groundSize[1]&lt;radius)
-			radius = groundSize[1];
-		if (groundSize[2]&lt;radius)
-			radius = groundSize[2];
-
-		nbSpheresi = (int)(groundSize[0]/radius);
-		nbSpheresj = (int)(groundSize[1]/radius);
-		nbSpheresk = (int)(groundSize[2]/radius);
-
-		for(int i=0;i&lt;nbSpheresi;i++)
-		{
-			if(shouldTerminate()) return &quot;&quot;;
-
-			for(int j=0;j&lt;nbSpheresj;j++)
-				for(int k=0;k&lt;nbSpheresk;k++)
-				{
-					shared_ptr&lt;Body&gt; sphere;
-					createGroundSphere(sphere,radius,radius*(i-nbSpheresi*0.5+0.5),radius*(j-nbSpheresj*0.5+0.5),radius*(k-nbSpheresk*0.5+0.5));
-					rootBody-&gt;bodies-&gt;insert(sphere);
-				}
-		}
-	}
-
-///////// spheres
-	float all = nbSpheres[0]*nbSpheres[1]*nbSpheres[2];
-	float current = 0.0;
-
-	for(int i=0;i&lt;nbSpheres[0];i++)
-	{
-		if(shouldTerminate()) return &quot;&quot;;
-
-		for(int j=0;j&lt;nbSpheres[1];j++)
-			for(int k=0;k&lt;nbSpheres[2];k++)
-			{
-				shared_ptr&lt;Body&gt; sphere;
-				createSphere(sphere,i,j,k);
-				rootBody-&gt;bodies-&gt;insert(sphere);
-
-				setProgress(current++/all);
-			}
-	}
-	
-	return &quot;&quot;;
-}
-
-
-void SDECSpheresPlane::createGroundSphere(shared_ptr&lt;Body&gt;&amp; body,Real radius, Real i, Real j, Real k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	
-	Vector3r position		= Vector3r(i,j,k);
-	
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 0;
-	physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= Vector3r(0.7,0.7,0.7);
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	iSphere-&gt;radius			= radius;
-	iSphere-&gt;diffuseColor		= Vector3r(0.8,0.3,0.3);
-
-	body-&gt;interactingGeometry	= iSphere;
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void SDECSpheresPlane::createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	
-	Vector3r position		= Vector3r(i,j+spheresHeight,k)*(2*maxRadius*1.1) // this formula is crazy !!
-					  - Vector3r( nbSpheres[0]/2*(2*maxRadius*1.1) , -7-maxRadius*2 , nbSpheres[2]/2*(2*maxRadius*1.1) )
-					  + Vector3r( 	 Mathr::SymmetricRandom()*disorder[0]
-					  		,Mathr::SymmetricRandom()*disorder[1]
-							,Mathr::SymmetricRandom()*disorder[2])*maxRadius;
-	
-	Real radius 			= (Mathr::IntervalRandom(minRadius,maxRadius));
-	
-	body-&gt;isDynamic			= true;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 4.0/3.0*Mathr::PI*radius*radius*radius*density;
-	physics-&gt;inertia		= Vector3r(2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius); //
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	iSphere-&gt;radius			= radius;
-	iSphere-&gt;diffuseColor		= Vector3r(0.8,0.3,0.3);
-
-	body-&gt;interactingGeometry	= iSphere;
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void SDECSpheresPlane::createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= extents[0]*extents[1]*extents[2]*density*2; 
-	physics-&gt;inertia		= Vector3r(
-							  physics-&gt;mass*(extents[1]*extents[1]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[0]*extents[0]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[1]*extents[1]+extents[0]*extents[0])/3
-						);
-	//physics-&gt;mass			= 0;
-	//physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
-
-	gBox-&gt;extents			= extents;
-	gBox-&gt;diffuseColor		= Vector3r(1,1,1);
-	gBox-&gt;wire			= false;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= true;
-	
-	iBox-&gt;extents			= extents;
-	iBox-&gt;diffuseColor		= Vector3r(1,1,1);
-
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void SDECSpheresPlane::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
-	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingSphere&quot;,&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
-
-	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
-	interactionPhysicsDispatcher-&gt;add(&quot;BodyMacroParameters&quot;,&quot;BodyMacroParameters&quot;,&quot;MacroMicroElasticRelationships&quot;);
-		
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-	
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping-&gt;damping = dampingForce;
-	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping-&gt;damping = dampingMomentum;
-	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
-	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
-	
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
- 	
-
-	shared_ptr&lt;ElasticCriterionTimeStepper&gt; sdecTimeStepper(new ElasticCriterionTimeStepper);
-	sdecTimeStepper-&gt;sdecGroupMask = 1;
-	sdecTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	rootBody-&gt;engines.push_back(sdecTimeStepper);
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);	
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
-	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-	rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new ElasticContactLaw));
-	rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(actionDampingDispatcher);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-
-	if(!rotationBlocked)
-		rootBody-&gt;engines.push_back(orientationIntegrator);
-
-	shared_ptr&lt;PositionOrientationRecorder&gt; positionOrientationRecorder(new PositionOrientationRecorder);
-	rootBody-&gt;engines.push_back(positionOrientationRecorder);
-
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-}
-
-
-void SDECSpheresPlane::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody) 
-{
-	rootBody-&gt;isDynamic		= false;
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters); // FIXME : fix indexable class PhysicalParameters
-	physics-&gt;se3				= Se3r(Vector3r(0,0,0),q);
-	physics-&gt;mass				= 0;
-	physics-&gt;velocity			= Vector3r(0,0,0);
-	physics-&gt;acceleration			= Vector3r::ZERO;
-		
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	set-&gt;diffuseColor			= Vector3r(0,0,1);
-	
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor			= Vector3r(0,0,1);
-	
-	rootBody-&gt;interactingGeometry		= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume		= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;physicalParameters 		= physics;
-}
-
-

Deleted: branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane/SDECSpheresPlane.hpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane/SDECSpheresPlane.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane/SDECSpheresPlane.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,60 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SDEC_SPHERES_PLANE_HPP
-#define SDEC_SPHERES_PLANE_HPP
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-
-class SDECSpheresPlane : public FileGenerator
-{
-	private :
-		Vector3r	 nbSpheres
-				,disorder
-				,groundSize
-				,gravity;
-
-		bool		 useSpheresAsGround
-				,rotationBlocked;
-
-		Real		 minRadius
-				,density
-				,maxRadius
-				,dampingForce
-				,dampingMomentum
-				,spheresHeight
-				,sphereYoungModulus
-				,spherePoissonRatio
-				,sphereFrictionDeg;
-
-		int		 timeStepUpdateInterval;
-	
-		void createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents);
-		void createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k);
-		void createGroundSphere(shared_ptr&lt;Body&gt;&amp; body,Real radius, Real i, Real j, Real k);
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-
-	// construction
-	public :
-		SDECSpheresPlane ();
-		~SDECSpheresPlane ();
-		string generate();
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-		void registerAttributes();
-	REGISTER_CLASS_NAME(SDECSpheresPlane);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-};
-
-REGISTER_SERIALIZABLE(SDECSpheresPlane,false);
-
-#endif // SDEC_SPHERES_PLANE_HPP 
-
-

Copied: branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane.cpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane/SDECSpheresPlane.cpp)

Copied: branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane.hpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/SDECSpheresPlane/SDECSpheresPlane.hpp)

Deleted: branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest/TetrahedronsTest.cpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest/TetrahedronsTest.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest/TetrahedronsTest.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,429 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at mail.berlios.de</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &lt;boost/lexical_cast.hpp&gt;
-
-#include &quot;TetrahedronsTest.hpp&quot;
-
-#include&lt;yade/pkg-common/ElasticBodyParameters.hpp&gt;
-#include &quot;ElasticCriterionTimeStepper.hpp&quot;
-#include &quot;InteractingMyTetrahedron.hpp&quot;
-#include &quot;MyTetrahedronLaw.hpp&quot;
-
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-#include&lt;yade/pkg-common/Box.hpp&gt;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/SAPCollider.hpp&gt;
-#include&lt;yade/pkg-common/PersistentSAPCollider.hpp&gt;
-#include&lt;yade/lib-serialization/IOFormatManager.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/InteractingGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionPhysicsMetaEngine.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-
-TetrahedronsTest::TetrahedronsTest () : FileGenerator()
-{
-	nbTetrahedrons		= Vector3r(5,6,7);
-	minSize			= 5;
-	maxSize			= 6;
-
-	groundSize		= Vector3r(100,5,100);
-
-	/*
-	 *
-	 * Vaclav,
-	 *
-	 * damping has so huge values, because this example calculation has no
-	 * shering force in the contact, therefore there cannot be fricion
-	 * simulated. To make a good simulation (with tetrahedrons too) you
-	 * should add shearing force. It is not possible to have friction
-	 * without shearing :)
-	 *
-	 * You can see into ElasticContactLaw (press here ctrl-] , then ctrl-O ;)
-	 * how shearing force is used. You may even want to use
-	 * BodyMacroParameters and sth. like ElasticContactInteraction to
-	 * calculate friction, and incremental between iterations shearing
-	 * force
-	 *
-	 * Also you can check how the simulation behaves with damping equal to zero.
-	 *
-	 */
-	dampingForce		= 0.9;
-	dampingMomentum		= 0.9;
-
-	timeStepUpdateInterval	= 300;
-
-	youngModulus		= 80000000.0;
-
-	density			= 2600;
-	rotationBlocked		= false;
-	gravity			= Vector3r(0,-9.81,0);
-	disorder		= 0.2;
-}
-
-
-TetrahedronsTest::~TetrahedronsTest ()
-{
-
-}
-
-
-void TetrahedronsTest::postProcessAttributes(bool)
-{
-}
-
-
-void TetrahedronsTest::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	REGISTER_ATTRIBUTE(nbTetrahedrons);
-	REGISTER_ATTRIBUTE(minSize);
-	REGISTER_ATTRIBUTE(maxSize);
-	REGISTER_ATTRIBUTE(youngModulus);
-	REGISTER_ATTRIBUTE(gravity);
-	REGISTER_ATTRIBUTE(density);
-	REGISTER_ATTRIBUTE(disorder);
-	REGISTER_ATTRIBUTE(groundSize);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum);
-	REGISTER_ATTRIBUTE(rotationBlocked);
-	//REGISTER_ATTRIBUTE(timeStepUpdateInterval); // not used. But you may want to use it....
-}
-
-
-string TetrahedronsTest::generate()
-{
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-	createActors(rootBody);
-	positionRootBody(rootBody);
-
-////////////////////////////////////
-///////// Container
-	
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-		
-////////////////////////////////////
-///////// ground
-
-	shared_ptr&lt;Body&gt; ground;
-	createBox(ground, Vector3r(0,0,0), groundSize);
-	rootBody-&gt;bodies-&gt;insert(ground);
-
-///////// tetrahedrons
-	float all = nbTetrahedrons[0]*nbTetrahedrons[1]*nbTetrahedrons[2];
-	float current = 0.0;
-
-	setMessage(&quot;generating tetrahedrons...&quot;);
-	for(int i=0;i&lt;nbTetrahedrons[0];i++)
-	{
-		if(shouldTerminate()) return &quot;&quot;;
-
-		for(int j=0;j&lt;nbTetrahedrons[1];j++)
-			for(int k=0;k&lt;nbTetrahedrons[2];k++)
-			{
-				shared_ptr&lt;Body&gt; tet;
-				createTetrahedron(tet,i,j,k);
-				rootBody-&gt;bodies-&gt;insert(tet);
-				
-				setProgress(current++/all);
-			}
-	}
-	
-	return &quot;foo bar &quot;+boost::lexical_cast&lt;std::string&gt;(42);
-}
-
-
-void TetrahedronsTest::createTetrahedron(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;ElasticBodyParameters&gt; physics(new ElasticBodyParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Tetrahedron&gt; tet(new Tetrahedron);
-	
-	Quaternionr q;// = Quaternionr::IDENTITY;
-	// random orientation
-	q.FromAxisAngle( Vector3r(Mathr::SymmetricRandom(),Mathr::SymmetricRandom(),Mathr::SymmetricRandom()),Mathr::SymmetricRandom());
-	q.Normalize();
-
-	// semi-random position in the space
-	Vector3r position		= Vector3r(i,j,k)*(2*maxSize*1.1) // this formula is crazy !!
-					  - Vector3r( nbTetrahedrons[0]/2*(2*maxSize*1.1) , -7-maxSize*2 , nbTetrahedrons[2]/2*(2*maxSize*1.1) )
-					  + Vector3r( 	 Mathr::SymmetricRandom()
-					  		,Mathr::SymmetricRandom()
-							,Mathr::SymmetricRandom())*maxSize*disorder;
-	
-	Real radius 			= (Mathr::IntervalRandom(minSize,maxSize));
-	
-	body-&gt;isDynamic			= true;
-
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-
-	makeTet(tet,radius);
-	tet-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-	tet-&gt;wire			= false;
-	tet-&gt;visible			= true;
-	tet-&gt;shadowCaster		= false;
-
-	// Vaclav,
-	//
-	// Here mass and inertia are totally wrong, because the formulas are for sphere, not for tetrahedron.
-	// I should put here correct formulas to get scientific results. But this is a quick example.
-	//
-	// So it's your job to write good formulas here.
-	//
-	// They are used at the end of each interation calculation, and it's important that they are correct, because:
-	//
-	// class NewtonsForceLaw               uses mass                to calculate body acceleration        from given force
-	// class NewtonsMomentumLaw            uses inertia             to calculate body angularAcceleration from given momentum
-	//
-	// class LeapFrogPositionIntegrator    uses acceleration        to calculate body translation
-	// class LeapFrogOrientationIntegrator uses angularAcceleration to calculate body rotation
-	//
-	// (those four classes cannot be modifed, they do their job just fine :)
-	// (also this exact information written above, is explicitly defined in createActors, this file, line 314)
-	//
-	// So currently these numbers are wrong, so tetrahedrons will rotate unrealistically (as you can see yourself :)
-	//
-	physics-&gt;mass			= 4.0/3.0*Mathr::PI*radius*radius*radius*density;
-	//
-	// in fact I'm curious to see how this example behaves with correct inertia and mass.
-	// Before you do anything else you can try to write a good formula here. I belive that
-	// tetrahedrons will behave much more correctly.
-	physics-&gt;inertia		= Vector3r(2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius);
-	////////////////////////////////////////////////////////////////////////////////////
-
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= youngModulus;
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-
-	// interactingGeometry is filled with data by Tetrahedron2InteractingMyTetrahedron
-	shared_ptr&lt;InteractingGeometry&gt; imt(new InteractingMyTetrahedron);
-	imt-&gt;diffuseColor               = Vector3r(0.5,0.5,1.0);
-	body-&gt;interactingGeometry	= imt;
-
-	body-&gt;geometricalModel		= tet;
-	body-&gt;boundingVolume		= aabb;
-
-	// Vaclav,
-	//
-	// Here I use ElasticBodyParameters for physics, because this very simple example
-	// of four spheres in a tetrahedron needs only young modulus. (stiffness)
-	// and nothing more.
-	//
-	// if you need some other physical data about tetrahedron (not just stiffness)
-	// then you will need to make a new class.
-	//
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void TetrahedronsTest::createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents)
-{
-	// this is just the bottom surface on which all is lying
-	// we could even make a box (or even RotatingBox) by making several boxes, as
-	// in the RotatingBox example FileGenerator
-
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;ElasticBodyParameters&gt; physics(new ElasticBodyParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= extents[0]*extents[1]*extents[2]*density*2; 
-	physics-&gt;inertia		= Vector3r(
-							  physics-&gt;mass*(extents[1]*extents[1]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[0]*extents[0]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[1]*extents[1]+extents[0]*extents[0])/3
-						);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= youngModulus;
-
-	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
-
-	gBox-&gt;extents			= extents;
-	gBox-&gt;diffuseColor		= Vector3r(1,1,1);
-	gBox-&gt;wire			= false;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= true;
-	
-	iBox-&gt;extents			= extents;
-	iBox-&gt;diffuseColor		= Vector3r(1,1,1);
-
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void TetrahedronsTest::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-
-	// all the strings here are just class names
-	// those class names in each class are registered with REGISTER_CLASS_NAME(SomeClass);
-	//
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
-	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
-	// so for this simple example I use  ElasticBodyParameters           : to store young modulus,
-	// and                               ElasticBodySimpleRelationship   : to calculate the stiffnes of current interaction
-	//                                                                     using the young modulus of two bodies, it creates
-	//                                                                     a class SimpleElasticInteraction
-	//
-	// Vaclav, it is very likely that you will need some other physical representation of interaction than SimpleElasticInteraction
-	//
-	interactionPhysicsDispatcher-&gt;add(&quot;ElasticBodyParameters&quot;,&quot;ElasticBodyParameters&quot;,&quot;ElasticBodySimpleRelationship&quot;);
-		
-	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingMyTetrahedron&quot;,&quot;InteractingMyTetrahedron&quot;,&quot;InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingMyTetrahedron&quot;,&quot;InteractingBox&quot;,&quot;InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron&quot;);
-
-	shared_ptr&lt;InteractingGeometryMetaEngine&gt; interactingGeometryDispatcher	= shared_ptr&lt;InteractingGeometryMetaEngine&gt;(new InteractingGeometryMetaEngine);
-	interactingGeometryDispatcher-&gt;add(&quot;Tetrahedron&quot;,&quot;InteractingMyTetrahedron&quot;,&quot;Tetrahedron2InteractingMyTetrahedron&quot;);
-	
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingMyTetrahedron&quot;,&quot;AABB&quot;,&quot;InteractingMyTetrahedron2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-	
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping-&gt;damping = dampingForce;
-
-	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping-&gt;damping = dampingMomentum;
-
-	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
-	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
-
-	// 
-	// they must be separate, because for each body both of those integrators must perform the necessary work.
-	// if they were in a single MetaEngine then LeapFrogOrientationIntegrator would &quot;win&quot; the competition
-	// because it is closer polymorphically to RigidBodyParameters (and
-	// ElasticBodyParameters derives directly from RigidBodyParameters). 
-	//
-	// And the bodies would ONLY rotate...
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-
-	// so another separate MetaEngine
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
-	//////////////////
- 	
-/*
- * updating timestep is not used in this simplified example. But you may decide to use it later.
- *
-	shared_ptr&lt;ElasticCriterionTimeStepper&gt; sdecTimeStepper(new ElasticCriterionTimeStepper);
-	sdecTimeStepper-&gt;sdecGroupMask = 1;
-	sdecTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-*/
-
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	//rootBody-&gt;engines.push_back(sdecTimeStepper);
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);	
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
-	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-	rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new MyTetrahedronLaw));
-	rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(actionDampingDispatcher);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-	if(!rotationBlocked)
-		rootBody-&gt;engines.push_back(orientationIntegrator);
-	
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	rootBody-&gt;initializers.push_back(interactingGeometryDispatcher);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-}
-
-
-void TetrahedronsTest::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody) 
-{
-	rootBody-&gt;isDynamic		= false;
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters); // FIXME : fix indexable class PhysicalParameters
-	physics-&gt;se3				= Se3r(Vector3r(0,0,0),q);
-	physics-&gt;mass				= 0;
-	physics-&gt;velocity			= Vector3r(0,0,0);
-	physics-&gt;acceleration			= Vector3r::ZERO;
-		
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	set-&gt;diffuseColor			= Vector3r(0,0,1);
-	
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor			= Vector3r(0,0,1);
-	
-	rootBody-&gt;interactingGeometry		= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume		= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;physicalParameters 		= physics;
-}
-
-
-void TetrahedronsTest::makeTet(shared_ptr&lt;Tetrahedron&gt;&amp; tet, Real size)
-{
-	tet-&gt;v1=size*(Mathr::UnitRandom()*0.7+1.0)*Vector3r(0,0,1);
-	tet-&gt;v2=size*(Mathr::UnitRandom()*0.7+1.0)*Vector3r(0.73,-0.6,-0.33);
-	tet-&gt;v3=size*(Mathr::UnitRandom()*0.7+1.0)*Vector3r(-0.88,-0.33,-0.33);
-	tet-&gt;v4=size*(Mathr::UnitRandom()*0.7+1.0)*Vector3r(0.16,0.93,-0.33);
-}
-

Deleted: branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest/TetrahedronsTest.hpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest/TetrahedronsTest.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest/TetrahedronsTest.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,112 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2006 by Janek Kozicki                                   *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef TETRAHEDRONSTEST_HPP
-#define TETRAHEDRONSTEST_HPP
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-#include&lt;yade/pkg-common/Tetrahedron.hpp&gt;
-
-/*! 
- * \brief This class derived from FileGenerator is what can be called an 
- *
- *    int main(argc, argv**);
- *
- *  of the simulation. This is where the execution flow control, and the data
- *  are put together to make a sensible, working simulation.
- *
- *
- * So the main loop, Body-&gt;engines:
- *
- *  - with class InteractingMyTetrahedron2AABB registered in TetrahedronsTest inside an MetaEngine called
- *     boundigVolumeDispatcher yade will automatically create AABB from InteractingMyTetrahedron
- *
- *  - with AABB available, the PersistentSAPCollider will be able to detect that two bodies are interacting
- *
- *  - if interaction is detected, an appropriate EngineUnit will be called, in
- *    this small example I have just two of them:
- *
- *        InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron
- *        InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron
- *
- *    depending on between what kind of body there is an interaction.
- *
- *    They will create for us a class InteractionOfMyTetrahedron
- *
- *  - For any interaction we need to calculate the physics of interaction,
- *    class SimpleElasticInteraction. It is created by ElasticBodySimpleRelationship
- *    inside MetaEngine interactionPhysicsDispatcher
- *
- *  - with all that info available it is possibel to calculate PhysicalActions: a Force and a Momentum,
- *    class MyTetrahedronLaw is doing the job
- *
- *  - then we can apply gravityCondition (an additional force directed downwards)
- *
- *  - apply damping on Force and Momentum (you can remove that part, because a
- *    realistic scientific calculation should not need to use damping ;)
- *    this is done by actionDampingDispatcher
- *
- *  - then we can apply those PhysicalActions on the Body, thus calculate new
- *    body's acceleration and angularAcceleration using NewtonsLaw. class applyActionDispatcher does just that
- *
- *  - and finally the new body's position is integrated using leapfrog integration
- *
- *
- *
- * There is also a secondary loop Body-&gt;initializers, which is called only for the first time, before the simulation.
- * It is used to build BoundingVolume of bodies and InteractingMyTetrahedron from the GeometricalModel (Tetrahedron)\
- *
- *
- * additionally physicalActionInitializer and PhysicalActionContainerReseter
- * are used on each iteration to reset calculated forces and momentums back to
- * zero (otherwise they could accumulate from one iteration to another, a thing
- * we don't want to happen :)
- *
- *
- */
-
-class TetrahedronsTest : public FileGenerator
-{
-	private :
-		Vector3r	 nbTetrahedrons
-				,groundSize
-				,gravity;
-
-		Real		 minSize
-				,density
-				,maxSize
-				,dampingForce
-				,disorder
-				,dampingMomentum
-				,youngModulus;
-
-		int		 timeStepUpdateInterval;
-		bool		 rotationBlocked;
-
-		void createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents);
-		void createTetrahedron(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k);
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		
-		void makeTet(shared_ptr&lt;Tetrahedron&gt;&amp; tet, Real radius);
-
-	public :
-		TetrahedronsTest ();
-		~TetrahedronsTest ();
-		string generate();
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-		void registerAttributes();
-	REGISTER_CLASS_NAME(TetrahedronsTest);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-};
-
-REGISTER_SERIALIZABLE(TetrahedronsTest,false);
-
-#endif // TETRAHEDRONSTEST_HPP
-

Copied: branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest.cpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest/TetrahedronsTest.cpp)

Copied: branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest.hpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/TetrahedronsTest/TetrahedronsTest.hpp)

Deleted: branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending/ThreePointBending.cpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending/ThreePointBending.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending/ThreePointBending.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,435 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2007 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-///
-// FIXME : add CohesiveContactLaw engine to make it work
-///
-
-
-#include &quot;ThreePointBending.hpp&quot;
-
-#include &quot;ElasticContactLaw.hpp&quot;
-#include &quot;ElasticCohesiveLaw.hpp&quot;
-#include &quot;MacroMicroElasticRelationships.hpp&quot;
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include &quot;SDECLinkPhysics.hpp&quot;
-#include &quot;ElasticCriterionTimeStepper.hpp&quot;
-
-
-#include&lt;yade/core/yadeExceptions.hpp&gt;
-#include&lt;yade/pkg-common/Box.hpp&gt;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/SAPCollider.hpp&gt;
-#include&lt;yade/pkg-common/PersistentSAPCollider.hpp&gt;
-#include&lt;yade/lib-serialization/IOFormatManager.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionPhysicsMetaEngine.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-#include&lt;yade/pkg-common/TranslationEngine.hpp&gt;
-
-#include &lt;boost/filesystem/operations.hpp&gt;
-#include &lt;boost/filesystem/convenience.hpp&gt;
-
-
-ThreePointBending::ThreePointBending () : FileGenerator()
-{
-	yadeFileWithSpheres	=&quot;../data/someFileFromTriaxial.yade&quot;;
-	gravity			= Vector3r(0,-9.81,0);
-
-	supportDepth		= 10;
-	pistonWidth		= 5;
-	pistonVelocity		= 0.1;
-	dampingForce		= 0.2;
-	dampingMomentum		= 0.2;
-	
-	timeStepUpdateInterval	= 300;
-	momentRotationLaw       = true;
-	
-	//sphereYoungModulus	= 10000000;
-	sphereYoungModulus	= 30000000;
-	spherePoissonRatio	= 0.2;
-	sphereFrictionDeg       = 18.0;
-	
-	linkKn			= 50000000;
-	linkKs			= 5000000;
-	linkMaxNormalForce	= 5500000;
-	linkMaxShearForce       = 550000;
-}
-
-
-ThreePointBending::~ThreePointBending ()
-{
-
-}
-
-
-void ThreePointBending::postProcessAttributes(bool)
-{
-}
-
-
-void ThreePointBending::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	
-	REGISTER_ATTRIBUTE(yadeFileWithSpheres);
-	REGISTER_ATTRIBUTE(gravity);
-
-	REGISTER_ATTRIBUTE(pistonWidth);
-	REGISTER_ATTRIBUTE(supportDepth);
-	REGISTER_ATTRIBUTE(pistonVelocity);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum);
-
-	REGISTER_ATTRIBUTE(timeStepUpdateInterval);
-	REGISTER_ATTRIBUTE(momentRotationLaw);
-	
-	REGISTER_ATTRIBUTE(sphereYoungModulus);
-	REGISTER_ATTRIBUTE(spherePoissonRatio);
-	REGISTER_ATTRIBUTE(sphereFrictionDeg);
-	
-	REGISTER_ATTRIBUTE(linkKn);
-	REGISTER_ATTRIBUTE(linkKs);
-	REGISTER_ATTRIBUTE(linkMaxNormalForce);
-	REGISTER_ATTRIBUTE(linkMaxShearForce);
-}
-
-
-string ThreePointBending::generate()
-{
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-	createActors(rootBody);
-	positionRootBody(rootBody);
-
-////////////////////////////////////
-	
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-
-/////////////////////////////////////
-/////////////////////////////////////
-	// load file
-	
-	shared_ptr&lt;MetaBody&gt; metaBodyWithSpheres;
-
-	if ( 	   yadeFileWithSpheres.size()!=0 
-		&amp;&amp; filesystem::exists(yadeFileWithSpheres) 
-		&amp;&amp; (filesystem::extension(yadeFileWithSpheres)==&quot;.xml&quot; || filesystem::extension(yadeFileWithSpheres)==&quot;.yade&quot;))
-	{
-		try
-		{
-			if(filesystem::extension(yadeFileWithSpheres)==&quot;.xml&quot;)
-				IOFormatManager::loadFromFile(&quot;XMLFormatManager&quot;,yadeFileWithSpheres,&quot;rootBody&quot;,metaBodyWithSpheres);
-
-			else if(filesystem::extension(yadeFileWithSpheres)==&quot;.yade&quot; )
-				IOFormatManager::loadFromFile(&quot;BINFormatManager&quot;,yadeFileWithSpheres,&quot;rootBody&quot;,metaBodyWithSpheres);
-
-			if( metaBodyWithSpheres-&gt;getClassName() != &quot;MetaBody&quot;)
-				return &quot;Error: cannot load the file that should contain spheres&quot;;
-		} 
-		catch(SerializableError&amp; e)
-		{
-			return &quot;Error: cannot load the file that should contain spheres&quot;;
-		}
-		catch(yadeError&amp; e)
-		{
-			return &quot;Error: cannot load the file that should contain spheres&quot;;
-		}
-	}
-	else
-		return &quot;Error: cannot load the file that should contain spheres&quot;;
-/////////////////////////////////////
-	Vector3r min(10000,10000,10000),max(-10000,-10000,-10000);
-	{// calc min/max
-		BodyContainer::iterator bi    = metaBodyWithSpheres-&gt;bodies-&gt;begin();
-		BodyContainer::iterator biEnd = metaBodyWithSpheres-&gt;bodies-&gt;end();
-		for( ; bi!=biEnd ; ++bi )
-		{
-			if((*bi)-&gt;geometricalModel-&gt;getClassName() == &quot;Sphere&quot; )
-			{
-				shared_ptr&lt;Body&gt; b = *bi;
-				min = componentMinVector(min,b-&gt;physicalParameters-&gt;se3.position - static_cast&lt;Sphere*&gt;(b-&gt;geometricalModel.get())-&gt;radius * Vector3r(1,1,1));
-				max = componentMaxVector(max,b-&gt;physicalParameters-&gt;se3.position + static_cast&lt;Sphere*&gt;(b-&gt;geometricalModel.get())-&gt;radius * Vector3r(1,1,1));
-
-				BodyMacroParameters* bm = dynamic_cast&lt;BodyMacroParameters*&gt;(b-&gt;physicalParameters.get());
-				if(!bm)
-					return &quot;Error: spheres don't use BodyMacroParameters for physical parameters&quot;;
-
-				bm-&gt;young		= sphereYoungModulus;
-				bm-&gt;poisson		= spherePoissonRatio;
-				bm-&gt;frictionAngle	= sphereFrictionDeg * Mathr::PI/180.0;
-				bm-&gt;mass		/= 1000.0; // FIXME !!!
-			}
-		}
-	}
-////////////////////////////////////
-
-	shared_ptr&lt;Body&gt; piston;
-	shared_ptr&lt;Body&gt; supportBox1;
-	shared_ptr&lt;Body&gt; supportBox2;
-	
-	createBox(piston,      Vector3r( (max[0]+min[0])*0.5 , max[1] + (max[0]-min[0])*0.5 ,          (max[2]+min[2])*0.5                ), Vector3r( (max[0]-min[0])*0.5, (max[0]-min[0])*0.5 , pistonWidth          ));
-	createBox(supportBox1, Vector3r( (max[0]+min[0])*0.5 , min[1] - (max[0]-min[0])*0.5 , min[2] - (max[0]-min[0])*0.5 + supportDepth ), Vector3r( (max[0]-min[0])*0.5, (max[0]-min[0])*0.5 , (max[0]-min[0])*0.5  ));
-	createBox(supportBox2, Vector3r( (max[0]+min[0])*0.5 , min[1] - (max[0]-min[0])*0.5 , max[2] + (max[0]-min[0])*0.5 - supportDepth ), Vector3r( (max[0]-min[0])*0.5, (max[0]-min[0])*0.5 , (max[0]-min[0])*0.5  ));
-			
-	rootBody-&gt;bodies-&gt;insert(piston);
-	rootBody-&gt;bodies-&gt;insert(supportBox1);
-	rootBody-&gt;bodies-&gt;insert(supportBox2);
-
-/////////////////////////////////////
-        
-	{// insert Spheres
-		BodyContainer::iterator bi    = metaBodyWithSpheres-&gt;bodies-&gt;begin();
-		BodyContainer::iterator biEnd = metaBodyWithSpheres-&gt;bodies-&gt;end();
-		for( ; bi!=biEnd ; ++bi )
-		{
-			if((*bi)-&gt;geometricalModel-&gt;getClassName() == &quot;Sphere&quot; )
-			{
-				shared_ptr&lt;Body&gt; b = *bi;
-			        rootBody-&gt;bodies-&gt;insert(b);
-			}
-		}
-	}
-	
-/////////////////////////////////////
-
-	rootBody-&gt;persistentInteractions-&gt;clear();
-	
-	shared_ptr&lt;Body&gt; bodyA;
-
-	BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-	BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-	BodyContainer::iterator bi2;
-
-	++bi; // skips piston
-	++bi; // skips supportBox1
-	++bi; // skips supportBox2
-		
-		
-	for( ; bi!=biEnd ; ++bi )
-	{
-		bodyA =*bi;
-		bi2=bi;
-		++bi2;
-		for( ; bi2!=biEnd ; ++bi2 )
-		{
-			shared_ptr&lt;Body&gt; bodyB = *bi2;
-
-			shared_ptr&lt;BodyMacroParameters&gt; a = YADE_PTR_CAST&lt;BodyMacroParameters&gt;(bodyA-&gt;physicalParameters);
-			shared_ptr&lt;BodyMacroParameters&gt; b = YADE_PTR_CAST&lt;BodyMacroParameters&gt;(bodyB-&gt;physicalParameters);
-			shared_ptr&lt;InteractingSphere&gt;	as = YADE_PTR_CAST&lt;InteractingSphere&gt;(bodyA-&gt;interactingGeometry);
-			shared_ptr&lt;InteractingSphere&gt;	bs = YADE_PTR_CAST&lt;InteractingSphere&gt;(bodyB-&gt;interactingGeometry);
-
-			if ((a-&gt;se3.position - b-&gt;se3.position).Length() &lt; (as-&gt;radius + bs-&gt;radius))  
-			{
-				shared_ptr&lt;Interaction&gt; 		link(new Interaction( bodyA-&gt;getId() , bodyB-&gt;getId() ));
-				shared_ptr&lt;SDECLinkGeometry&gt;		geometry(new SDECLinkGeometry);
-				shared_ptr&lt;SDECLinkPhysics&gt;	physics(new SDECLinkPhysics);
-				
-				geometry-&gt;radius1			= as-&gt;radius - fabs(as-&gt;radius - bs-&gt;radius)*0.5;
-				geometry-&gt;radius2			= bs-&gt;radius - fabs(as-&gt;radius - bs-&gt;radius)*0.5;
-
-				physics-&gt;initialKn			= linkKn; // FIXME - BIG problem here.
-				physics-&gt;initialKs			= linkKs;
-				physics-&gt;heta				= 1;
-				physics-&gt;initialEquilibriumDistance	= (a-&gt;se3.position - b-&gt;se3.position).Length();
-				physics-&gt;knMax				= linkMaxNormalForce;
-				physics-&gt;ksMax				= linkMaxShearForce;
-
-				link-&gt;interactionGeometry 		= geometry;
-				link-&gt;interactionPhysics 		= physics;
-				link-&gt;isReal 				= true;
-				link-&gt;isNew 				= false;
-				
-				rootBody-&gt;persistentInteractions-&gt;insert(link);
-			}
-		}
-	}
-	
-	return &quot;total number of permament links created: &quot; 
-		+ lexical_cast&lt;string&gt;(rootBody-&gt;persistentInteractions-&gt;size()) 
-		+ &quot;\nWARNING: link bonds are nearly working, but the formulas are waiting for total rewrite!&quot;;
-}
-
-
-void ThreePointBending::createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,55));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= extents[0]*extents[1]*extents[2]*2; 
-	physics-&gt;inertia		= Vector3r(
-							  physics-&gt;mass*(extents[1]*extents[1]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[0]*extents[0]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[1]*extents[1]+extents[0]*extents[0])/3
-						);
-//	physics-&gt;mass			= 0;
-//	physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
-
-	gBox-&gt;extents			= extents;
-	gBox-&gt;diffuseColor		= Vector3r(1,1,1);
-	gBox-&gt;wire			= false;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= true;
-	
-	iBox-&gt;extents			= extents;
-	iBox-&gt;diffuseColor		= Vector3r(1,1,1);
-
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void ThreePointBending::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
-	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingSphere&quot;,&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
-
-	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
-	interactionPhysicsDispatcher-&gt;add(&quot;BodyMacroParameters&quot;,&quot;BodyMacroParameters&quot;,&quot;MacroMicroElasticRelationships&quot;);
-		
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-		
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping-&gt;damping = dampingForce;
-	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping-&gt;damping = dampingMomentum;
-	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
-	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
-	
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
- 	
-	shared_ptr&lt;ElasticCriterionTimeStepper&gt; sdecTimeStepper(new ElasticCriterionTimeStepper);
-	sdecTimeStepper-&gt;sdecGroupMask = 55;
-	sdecTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-
-// moving wall
-	shared_ptr&lt;TranslationEngine&gt; kinematic = shared_ptr&lt;TranslationEngine&gt;(new TranslationEngine);
-	kinematic-&gt;velocity  = pistonVelocity;
-	kinematic-&gt;translationAxis  = Vector3r(0,-1,0);
-	kinematic-&gt;subscribedBodies.push_back(0);
-
-	shared_ptr&lt;ElasticContactLaw&gt; constitutiveLaw(new ElasticContactLaw);
-	constitutiveLaw-&gt;sdecGroupMask = 55;
-	constitutiveLaw-&gt;momentRotationLaw = momentRotationLaw;
-// FIXME FIXME FIXME ....	
-	shared_ptr&lt;ElasticCohesiveLaw&gt; constitutiveLaw2(new ElasticCohesiveLaw);
-	constitutiveLaw2-&gt;sdecGroupMask = 55;
-	constitutiveLaw2-&gt;momentRotationLaw = momentRotationLaw;
-	
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(sdecTimeStepper);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
-	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-	rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
-	rootBody-&gt;engines.push_back(constitutiveLaw);
-	rootBody-&gt;engines.push_back(constitutiveLaw2);
-	rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(actionDampingDispatcher);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-	rootBody-&gt;engines.push_back(orientationIntegrator);
-	rootBody-&gt;engines.push_back(kinematic);
-
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-}
-	
-
-void ThreePointBending::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	rootBody-&gt;isDynamic		= false;
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	
-	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters); // FIXME : fix indexable class PhysicalParameters
-	physics-&gt;se3			= Se3r(Vector3r(0,0,0),q);
-	physics-&gt;mass			= 0;
-	physics-&gt;velocity		= Vector3r::ZERO;
-	physics-&gt;acceleration		= Vector3r::ZERO;
-	
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	set-&gt;diffuseColor		= Vector3r(0,0,1);
-
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor		= Vector3r(0,0,1);
-	
-	rootBody-&gt;interactingGeometry	= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume	= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;physicalParameters 	= physics;
-	
-}
-

Deleted: branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending/ThreePointBending.hpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending/ThreePointBending.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending/ThreePointBending.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,60 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2007 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LINKEDSPHERES_HPP
-#define LINKEDSPHERES_HPP
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-
-class ThreePointBending : public FileGenerator
-{
-	private	:
-		std::string	 yadeFileWithSpheres;
-		Vector3r	 gravity;
-
-		Real		 supportDepth
-				,pistonWidth
-				,pistonVelocity
-				,dampingForce
-				,dampingMomentum
-
-				,linkKn
-				,linkKs
-				,linkMaxNormalForce
-				,linkMaxShearForce
-				,sphereYoungModulus
-				,spherePoissonRatio
-				,sphereFrictionDeg;
-
-		int		 timeStepUpdateInterval;
-
-		bool		 momentRotationLaw;
-	
-		void createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents);
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-	
-	public :
-		ThreePointBending ();
-		~ThreePointBending ();
-		string generate();
-	
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-		void registerAttributes();
-	REGISTER_CLASS_NAME(ThreePointBending);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-};
-
-REGISTER_SERIALIZABLE(ThreePointBending,false);
-
-#endif // LINKEDSPHERES_HPP
-

Copied: branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending.cpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending/ThreePointBending.cpp)

Copied: branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending.hpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/ThreePointBending/ThreePointBending.hpp)

Deleted: branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest/TriaxialTest.cpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest/TriaxialTest.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest/TriaxialTest.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,764 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*  Copyright (C) 2007 by Bruno Chareyre		                         *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">bruno.chareyre at hmg.inpg.fr</A>                                            *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;TriaxialTest.hpp&quot;
-
-#include &quot;ElasticContactLaw.hpp&quot;
-#include &quot;SimpleElasticRelationships.hpp&quot;
-#include &quot;BodyMacroParameters.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include &quot;SDECLinkPhysics.hpp&quot;
-//#include &quot;ElasticCriterionTimeStepper.hpp&quot;
-//#include &quot;StiffnessMatrixTimeStepper.hpp&quot;
-//#include &quot;StiffnessCounter.hpp&quot;
-#include &quot;GlobalStiffnessCounter.hpp&quot;
-#include &quot;GlobalStiffnessTimeStepper.hpp&quot;
-
-#include &quot;AveragePositionRecorder.hpp&quot;
-#include &quot;ForceRecorder.hpp&quot;
-#include &quot;VelocityRecorder.hpp&quot;
-#include &quot;TriaxialStressController.hpp&quot;
-#include &quot;TriaxialCompressionEngine.hpp&quot;
-
-#include&lt;yade/pkg-common/Box.hpp&gt;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/SAPCollider.hpp&gt;
-#include&lt;yade/pkg-common/PersistentSAPCollider.hpp&gt;
-#include&lt;yade/lib-serialization/IOFormatManager.hpp&gt;
-#include&lt;yade/core/Interaction.hpp&gt;
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionPhysicsMetaEngine.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/InteractionHashMap.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-#include &lt;boost/filesystem/convenience.hpp&gt;
-#include &lt;boost/lexical_cast.hpp&gt;
-#include &lt;boost/numeric/conversion/bounds.hpp&gt;
-#include &lt;boost/limits.hpp&gt;
-
-// random
-#include &lt;boost/random/linear_congruential.hpp&gt;
-#include &lt;boost/random/uniform_real.hpp&gt;
-#include &lt;boost/random/variate_generator.hpp&gt;
-#include &lt;boost/random/normal_distribution.hpp&gt;
-
-
-
-using namespace boost;
-using namespace std;
-
-
-typedef pair&lt;Vector3r, Real&gt; BasicSphere;
-//! make a list of spheres non-overlapping sphere
-string GenerateCloud(vector&lt;BasicSphere&gt;&amp; sphere_list, Vector3r lowerCorner, Vector3r upperCorner, long number, Real rad_std_dev, Real porosity);
-
-
-TriaxialTest::TriaxialTest () : FileGenerator()
-{
-	lowerCorner 		= Vector3r(0,0,0);
-	upperCorner 		= Vector3r(1,1,1);
-	thickness 		= 0.001;
-	importFilename 		= &quot;../data/small.sdec.xyz&quot;;
-	outputFileName 		= &quot;../data/TriaxialTest.xml&quot;;
-	//nlayers = 1;
-	wall_top 		= true;
-	wall_bottom 		= true;
-	wall_1			= true;
-	wall_2			= true;
-	wall_3			= true;
-	wall_4			= true;
-	wall_top_wire 		= true;
-	wall_bottom_wire	= true;
-	wall_1_wire		= true;
-	wall_2_wire		= true;
-	wall_3_wire		= true;
-	wall_4_wire		= true;
-	spheresColor		= Vector3r(0.8,0.3,0.3);
-	spheresRandomColor	= false;
-	recordBottomForce	= true;
-	forceRecordFile		= &quot;../data/force&quot;;
-	recordAveragePositions	= true;
-	positionRecordFile	= &quot;../data/position&quot;;
-	recordIntervalIter	= 20;
-	velocityRecordFile 	= &quot;../data/velocities&quot;;
-	rotationBlocked = false;
-	
-//	boxWalls 		= false;
-	boxWalls 		= true;
-	internalCompaction	=false;
-
-//	bigBall 		= true;
-	bigBall 		= false;
-	bigBallRadius		= 0.075;
-	bigBallPoissonRatio 	= 0.3;
-	bigBallYoungModulus 	= 10000000.0;
-	bigBallFrictDeg 	= 60;
-//	bigBallCohesion 	= 10000000000;
-//	bigBallTensionStr 	= 10000000000;
-	bigBallDensity		= 7800;
-	bigBallDropTimeSeconds	= 30;
-	bigBallDropHeight 	= 3.04776;
-	
-	dampingForce = 0.5;
-	dampingMomentum = 0.5;
-	defaultDt = 0.0001;
-	
-	timeStepUpdateInterval = 50;
-	timeStepOutputInterval = 50;
-	wallStiffnessUpdateInterval = 10;
-	radiusControlInterval = 10;
-	numberOfGrains = 400;
-	strainRate = 0.1;
-	StabilityCriterion = 0.01;
-	autoCompressionActivation = false;
-	maxMultiplier = 1.01;
-	finalMaxMultiplier = 1.001;
-	
-	sphereYoungModulus  = 15000000.0;
-	spherePoissonRatio  = 0.5;
-	sphereFrictionDeg   = 18.0;
-	density			= 2600;
-	
-	boxYoungModulus   = 15000000.0;
-	boxPoissonRatio  = 0.2;
-	boxFrictionDeg   = 0.f;
-	gravity 	= Vector3r(0,-9.81,0);
-	
-	sigma_iso = 50000;
-	
-//	wall_top_id =0;
-// 	wall_bottom_id =0;
-// 	wall_left_id =0;
-// 	all_right_id =0;
-// 	wall_front_id =0;
-// 	wall_back_id =0;
-}
-
-
-TriaxialTest::~TriaxialTest ()
-{
-
-}
-
-
-void TriaxialTest::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	REGISTER_ATTRIBUTE(lowerCorner);
-	REGISTER_ATTRIBUTE(upperCorner);
-	REGISTER_ATTRIBUTE(thickness);
-	REGISTER_ATTRIBUTE(importFilename);
-	//REGISTER_ATTRIBUTE(nlayers);
-	//REGISTER_ATTRIBUTE(boxWalls);
-	REGISTER_ATTRIBUTE(internalCompaction);
-	REGISTER_ATTRIBUTE(maxMultiplier);
-	REGISTER_ATTRIBUTE(finalMaxMultiplier);
-
-	REGISTER_ATTRIBUTE(sphereYoungModulus);
-	REGISTER_ATTRIBUTE(spherePoissonRatio);
-	REGISTER_ATTRIBUTE(sphereFrictionDeg);
-
-	REGISTER_ATTRIBUTE(boxYoungModulus);
-	REGISTER_ATTRIBUTE(boxPoissonRatio);
-	REGISTER_ATTRIBUTE(boxFrictionDeg);
-
-	REGISTER_ATTRIBUTE(density);
-	REGISTER_ATTRIBUTE(defaultDt);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum);
-	REGISTER_ATTRIBUTE(rotationBlocked);
-	REGISTER_ATTRIBUTE(timeStepUpdateInterval);
-	REGISTER_ATTRIBUTE(timeStepOutputInterval);
-	REGISTER_ATTRIBUTE(wallStiffnessUpdateInterval);
-	REGISTER_ATTRIBUTE(radiusControlInterval);
-	REGISTER_ATTRIBUTE(numberOfGrains);
-	REGISTER_ATTRIBUTE(strainRate);
-	REGISTER_ATTRIBUTE(StabilityCriterion);
-	REGISTER_ATTRIBUTE(autoCompressionActivation);
-//	REGISTER_ATTRIBUTE(wall_top);
-//	REGISTER_ATTRIBUTE(wall_bottom);
-//	REGISTER_ATTRIBUTE(wall_1);
-//	REGISTER_ATTRIBUTE(wall_2);
-//	REGISTER_ATTRIBUTE(wall_3);
-//	REGISTER_ATTRIBUTE(wall_4);
-//	REGISTER_ATTRIBUTE(wall_top_wire);
-//	REGISTER_ATTRIBUTE(wall_bottom_wire);
-//	REGISTER_ATTRIBUTE(wall_1_wire);
-//	REGISTER_ATTRIBUTE(wall_2_wire);
-//	REGISTER_ATTRIBUTE(wall_3_wire);
-//	REGISTER_ATTRIBUTE(wall_4_wire);
-//	REGISTER_ATTRIBUTE(spheresColor);
-//	REGISTER_ATTRIBUTE(spheresRandomColor);
-	REGISTER_ATTRIBUTE(recordBottomForce);
-	REGISTER_ATTRIBUTE(forceRecordFile);
-//	REGISTER_ATTRIBUTE(recordAveragePositions);
-	REGISTER_ATTRIBUTE(positionRecordFile);
-	REGISTER_ATTRIBUTE(velocityRecordFile)
-	REGISTER_ATTRIBUTE(recordIntervalIter);
-
-//	REGISTER_ATTRIBUTE(gravity);
-	
-	//REGISTER_ATTRIBUTE(bigBall);
-	//REGISTER_ATTRIBUTE(bigBallRadius);
-	//REGISTER_ATTRIBUTE(bigBallDensity);
-	//REGISTER_ATTRIBUTE(bigBallDropTimeSeconds);
-	//REGISTER_ATTRIBUTE(bigBallFrictDeg);
-	//REGISTER_ATTRIBUTE(bigBallYoungModulus);
-	//REGISTER_ATTRIBUTE(bigBallPoissonRatio);
-	//REGISTER_ATTRIBUTE(bigBallDropHeight);
-	REGISTER_ATTRIBUTE(sigma_iso);
-
-}
-
-
-string TriaxialTest::generate()
-{
-	unsigned int startId=boost::numeric::bounds&lt;unsigned int&gt;::highest(), endId=0; // record forces from group 2
-	
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-	createActors(rootBody);
-	positionRootBody(rootBody);
-
-// 	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-// 	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionHashMap);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionHashMap);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-
-	shared_ptr&lt;Body&gt; body;
-	
-	vector&lt;BasicSphere&gt; sphere_list;
-	string output = GenerateCloud(sphere_list, lowerCorner, upperCorner, numberOfGrains, 0.3, 0.75);
-	
-	vector&lt;BasicSphere&gt;::iterator it = sphere_list.begin();
-	vector&lt;BasicSphere&gt;::iterator it_end = sphere_list.end();
-			
-	for (;it!=it_end; ++it)
-	{
-		cerr &lt;&lt; &quot;sphere (&quot; &lt;&lt; it-&gt;first &lt;&lt; &quot; &quot; &lt;&lt; it-&gt;second &lt;&lt; endl;
-		createSphere(body,it-&gt;first,it-&gt;second,false,true);
-		rootBody-&gt;bodies-&gt;insert(body);
-	}
-	
-// 	if(importFilename.size() != 0 &amp;&amp; filesystem::exists(importFilename) )
-// 	{
-// 		
-// 		Vector3r layersDistance (Vector3r::ZERO); 
-// 		for (int layer=1; layer &lt;= nlayers; ++layer)
-// 		{			
-// 			ifstream loadFile(importFilename.c_str());
-// 			long int i=0;
-// 			Real f,g,x,y,z,radius;
-// 			while( ! loadFile.eof() )
-// 			{
-// 				++i;
-// 				loadFile &gt;&gt; x;
-// 				loadFile &gt;&gt; y;
-// 				loadFile &gt;&gt; z;
-// 				Vector3r position = (Vector3r(x,z,y) + layersDistance);
-// 				loadFile &gt;&gt; radius;
-// 			
-// 				loadFile &gt;&gt; f;
-// 				loadFile &gt;&gt; g;
-// 				if( boxWalls ? f&gt;1 : false ) // skip loading of SDEC walls
-// 					continue;
-// 				if(f==8)
-// 					continue;
-// 	
-// 		//		if( i % 100 == 0 ) // FIXME - should display a progress BAR !!
-// 		//			cout &lt;&lt; &quot;loaded: &quot; &lt;&lt; i &lt;&lt; endl;
-// 				if(f==1)
-// 				{
-// 					lowerCorner[0] = min(position[0]-radius , lowerCorner[0]);
-// 					lowerCorner[1] = min(position[1]-radius , lowerCorner[1]);
-// 					lowerCorner[2] = min(position[2]-radius , lowerCorner[2]);
-// 					upperCorner[0] = max(position[0]+radius , upperCorner[0]);
-// 					upperCorner[1] = max(position[1]+radius , upperCorner[1]);
-// 					upperCorner[2] = max(position[2]+radius , upperCorner[2]);
-// 				}
-// 				createSphere(body,position,radius,false,f==1);
-// 				rootBody-&gt;bodies-&gt;insert(body);
-// 				if(f == 2)
-// 				{
-// 					startId = std::min(body-&gt;getId() , startId);
-// 					endId   = std::max(body-&gt;getId() , endId);
-// 				}
-// 					
-// 			}
-// 			layersDistance.y() = upperCorner.y();
-// 		}
-// 	}
-
-// create bigBall
-	//Vector3r position = (upperCorner+lowerCorner)*0.5 + Vector3r(0,bigBallDropHeight,0);
-	//createSphere(body,position,bigBallRadius,true,false);	
-	//int bigId = 0;
-// 	if(bigBall)
-// 		rootBody-&gt;bodies-&gt;insert(body);
-// 	bigId = body-&gt;getId();
-// 	forcerec-&gt;bigBallId = bigId;
-	forcerec-&gt;bigBallReleaseTime = 0;
-	//forcerec-&gt;startId = startId;
-	//forcerec-&gt;endId   = endId;
-	//averagePositionRecorder-&gt;bigBallId = bigId;
-	//velocityRecorder-&gt;bigBallId = bigId;
-
-	if(boxWalls)
-	{
-	// bottom box
-	 	Vector3r center		= Vector3r(
-	 						(lowerCorner[0]+upperCorner[0])/2,
-	 						lowerCorner[1]-thickness/2.0,
-	 						(lowerCorner[2]+upperCorner[2])/2);
-	 	Vector3r halfSize	= Vector3r(
-	 						fabs(lowerCorner[0]-upperCorner[0])/2+thickness,
-							thickness/2.0,
-	 						fabs(lowerCorner[2]-upperCorner[2])/2+thickness);
-	
-		createBox(body,center,halfSize,wall_bottom_wire);
-	 	if(wall_bottom) {
-			rootBody-&gt;bodies-&gt;insert(body);
-			//(resultantforceEngine-&gt;subscribedBodies).push_back(body-&gt;getId());
-			triaxialcompressionEngine-&gt;wall_bottom_id = body-&gt;getId();
-			forcerec-&gt;startId = body-&gt;getId();
-			forcerec-&gt;endId   = body-&gt;getId();
-			}
-		//forcerec-&gt;id = body-&gt;getId();
-	
-	// top box
-	 	center			= Vector3r(
-	 						(lowerCorner[0]+upperCorner[0])/2,
-	 						upperCorner[1]+thickness/2.0,
-	 						(lowerCorner[2]+upperCorner[2])/2);
-	 	halfSize		= Vector3r(
-	 						fabs(lowerCorner[0]-upperCorner[0])/2+thickness,
-	 						thickness/2.0,
-	 						fabs(lowerCorner[2]-upperCorner[2])/2+thickness);
-	
-		createBox(body,center,halfSize,wall_top_wire);
-	 	if(wall_top) {
-			rootBody-&gt;bodies-&gt;insert(body);
-			triaxialcompressionEngine-&gt;wall_top_id = body-&gt;getId();
-			}
-	// box 1
-	
-	 	center			= Vector3r(
-	 						lowerCorner[0]-thickness/2.0,
-	 						(lowerCorner[1]+upperCorner[1])/2,
-	 						(lowerCorner[2]+upperCorner[2])/2);
-		halfSize		= Vector3r(
-							thickness/2.0,
-	 						fabs(lowerCorner[1]-upperCorner[1])/2+thickness,
-	 						fabs(lowerCorner[2]-upperCorner[2])/2+thickness);
-		createBox(body,center,halfSize,wall_1_wire);
-	 	if(wall_1) {
-			rootBody-&gt;bodies-&gt;insert(body);
-			triaxialcompressionEngine-&gt;wall_left_id = body-&gt;getId();
-			}
-	// box 2
-	 	center			= Vector3r(
-	 						upperCorner[0]+thickness/2.0,
-	 						(lowerCorner[1]+upperCorner[1])/2,
-							(lowerCorner[2]+upperCorner[2])/2);
-	 	halfSize		= Vector3r(
-	 						thickness/2.0,
-	 						fabs(lowerCorner[1]-upperCorner[1])/2+thickness,
-	 						fabs(lowerCorner[2]-upperCorner[2])/2+thickness);
-	 	
-		createBox(body,center,halfSize,wall_2_wire);
-	 	if(wall_2) {
-			rootBody-&gt;bodies-&gt;insert(body);
-			triaxialcompressionEngine-&gt;wall_right_id = body-&gt;getId();
-			}
-	// box 3
-	 	center			= Vector3r(
-	 						(lowerCorner[0]+upperCorner[0])/2,
-	 						(lowerCorner[1]+upperCorner[1])/2,
-	 						lowerCorner[2]-thickness/2.0);
-	 	halfSize		= Vector3r(
-	 						fabs(lowerCorner[0]-upperCorner[0])/2+thickness,
-	 						fabs(lowerCorner[1]-upperCorner[1])/2+thickness,
-	 						thickness/2.0);
-		createBox(body,center,halfSize,wall_3_wire);
-	 	if(wall_3) {
-			rootBody-&gt;bodies-&gt;insert(body);
-			triaxialcompressionEngine-&gt;wall_back_id = body-&gt;getId();
-			}
-	
-	// box 4
-	 	center			= Vector3r(
-	 						(lowerCorner[0]+upperCorner[0])/2,
-	 						(lowerCorner[1]+upperCorner[1])/2,
-	 						upperCorner[2]+thickness/2.0);
-	 	halfSize		= Vector3r(
-	 						fabs(lowerCorner[0]-upperCorner[0])/2+thickness,
-	 						fabs(lowerCorner[1]-upperCorner[1])/2+thickness,
-	 						thickness/2.0);
-		createBox(body,center,halfSize,wall_3_wire);
-	 	if(wall_4) {
-			rootBody-&gt;bodies-&gt;insert(body);
-			triaxialcompressionEngine-&gt;wall_front_id = body-&gt;getId();
-			}
-			 
-	}
-	
-	return output;
-//  	return &quot;Generated a sample inside box of dimensions: (&quot; 
-//  		+ lexical_cast&lt;string&gt;(lowerCorner[0]) + &quot;,&quot; 
-//  		+ lexical_cast&lt;string&gt;(lowerCorner[1]) + &quot;,&quot; 
-//  		+ lexical_cast&lt;string&gt;(lowerCorner[2]) + &quot;) and (&quot; 
-//  		+ lexical_cast&lt;string&gt;(upperCorner[0]) + &quot;,&quot; 
-//  		+ lexical_cast&lt;string&gt;(upperCorner[1]) + &quot;,&quot; 
-//  		+ lexical_cast&lt;string&gt;(upperCorner[2]) + &quot;).&quot;;
-
-}
-
-
-void TriaxialTest::createSphere(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Real radius, bool big, bool dynamic )
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,2));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	
-	body-&gt;isDynamic			= dynamic;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 4.0/3.0*Mathr::PI*radius*radius*radius*(big ? bigBallDensity : density);
-	
-	physics-&gt;inertia		= Vector3r( 	2.0/5.0*physics-&gt;mass*radius*radius,
-							2.0/5.0*physics-&gt;mass*radius*radius,
-							2.0/5.0*physics-&gt;mass*radius*radius);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= big ? bigBallYoungModulus : sphereYoungModulus;
-	physics-&gt;poisson		= big ? bigBallPoissonRatio : spherePoissonRatio;
-	physics-&gt;frictionAngle		= (big ? bigBallFrictDeg : sphereFrictionDeg ) * Mathr::PI/180.0;
-
-	if((!big) &amp;&amp; (!dynamic) &amp;&amp; (!boxWalls))
-	{
-		physics-&gt;young			= boxYoungModulus;
-		physics-&gt;poisson		= boxPoissonRatio;
-		physics-&gt;frictionAngle		= boxFrictionDeg * Mathr::PI/180.0;
-	}
-	
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-
-
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= spheresColor;
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	iSphere-&gt;radius			= radius;
-	iSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-
-	body-&gt;interactingGeometry	= iSphere;
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void TriaxialTest::createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents, bool wire)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,2));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 0; 
-	//physics-&gt;mass			= extents[0]*extents[1]*extents[2]*density*2; 
-	physics-&gt;inertia		= Vector3r(
-							  physics-&gt;mass*(extents[1]*extents[1]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[0]*extents[0]+extents[2]*extents[2])/3
-							, physics-&gt;mass*(extents[1]*extents[1]+extents[0]*extents[0])/3
-						);
-//	physics-&gt;mass			= 0;
-//	physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-
-	physics-&gt;young			= boxYoungModulus;
-	physics-&gt;poisson		= boxPoissonRatio;
-	physics-&gt;frictionAngle		= boxFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
-
-	gBox-&gt;extents			= extents;
-	gBox-&gt;diffuseColor		= Vector3r(1,1,1);
-	gBox-&gt;wire			= wire;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= false;
-	
-	iBox-&gt;extents			= extents;
-	iBox-&gt;diffuseColor		= Vector3r(1,1,1);
-
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void TriaxialTest::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-// recording average positions
-	averagePositionRecorder = shared_ptr&lt;AveragePositionRecorder&gt;(new AveragePositionRecorder);
-	averagePositionRecorder -&gt; outputFile 		= positionRecordFile;
-	averagePositionRecorder -&gt; interval 		= recordIntervalIter;
-// recording forces
-	forcerec = shared_ptr&lt;ForceRecorder&gt;(new ForceRecorder);
-	forcerec -&gt; outputFile 	= forceRecordFile;
-	forcerec -&gt; interval 	= recordIntervalIter;
-// recording velocities
-	velocityRecorder = shared_ptr&lt;VelocityRecorder&gt;(new VelocityRecorder);
-	velocityRecorder-&gt; outputFile 	= velocityRecordFile;
-	velocityRecorder-&gt; interval 	= recordIntervalIter;
-
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	//physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;StiffnessMatrix&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;GlobalStiffness&quot;);
-	
-	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingSphere&quot;,&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
-
-	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
-	interactionPhysicsDispatcher-&gt;add(&quot;BodyMacroParameters&quot;,&quot;BodyMacroParameters&quot;,&quot;SimpleElasticRelationships&quot;);
-		
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-
-	
-
-		
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping-&gt;damping = dampingForce;
-	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping-&gt;damping = dampingMomentum;
-	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
-	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
-		
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
-
-	//shared_ptr&lt;ElasticCriterionTimeStepper&gt; sdecTimeStepper(new ElasticCriterionTimeStepper);
-	//sdecTimeStepper-&gt;sdecGroupMask = 2;
-	//sdecTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-	
-	//shared_ptr&lt;StiffnessMatrixTimeStepper&gt; stiffnessMatrixTimeStepper(new StiffnessMatrixTimeStepper);
-	//stiffnessMatrixTimeStepper-&gt;sdecGroupMask = 2;
-	//stiffnessMatrixTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-	
-	shared_ptr&lt;GlobalStiffnessTimeStepper&gt; globalStiffnessTimeStepper(new GlobalStiffnessTimeStepper);
-	globalStiffnessTimeStepper-&gt;sdecGroupMask = 2;
-	globalStiffnessTimeStepper-&gt;timeStepUpdateInterval = timeStepUpdateInterval;
-	globalStiffnessTimeStepper-&gt;defaultDt = defaultDt;
-	
-	shared_ptr&lt;ElasticContactLaw&gt; elasticContactLaw(new ElasticContactLaw);
-	elasticContactLaw-&gt;sdecGroupMask = 2;
-	
-	//shared_ptr&lt;StiffnessCounter&gt; stiffnesscounter(new StiffnessCounter);
-	//stiffnesscounter-&gt;sdecGroupMask = 2;
-	//stiffnesscounter-&gt;interval = timeStepUpdateInterval;
-	
-	shared_ptr&lt;GlobalStiffnessCounter&gt; globalStiffnessCounter(new GlobalStiffnessCounter);
-	globalStiffnessCounter-&gt;sdecGroupMask = 2;
-	globalStiffnessCounter-&gt;interval = timeStepUpdateInterval;
-	
-	// moving walls to regulate the stress applied + compress when the packing is dense an stable
-	cerr &lt;&lt; &quot;triaxialcompressionEngine = shared_ptr&lt;TriaxialCompressionEngine&gt; (new TriaxialCompressionEngine);&quot; &lt;&lt; std::endl;
-	triaxialcompressionEngine = shared_ptr&lt;TriaxialCompressionEngine&gt; (new TriaxialCompressionEngine);
-	triaxialcompressionEngine-&gt; interval = wallStiffnessUpdateInterval;// = stiffness update interval
-	triaxialcompressionEngine-&gt; radiusControlInterval = radiusControlInterval;// = stiffness update interval
-	triaxialcompressionEngine-&gt; sigma_iso = sigma_iso;
-	triaxialcompressionEngine-&gt; max_vel = 0.0001;
-	triaxialcompressionEngine-&gt; thickness = thickness;
-	triaxialcompressionEngine-&gt;strainRate = strainRate;
-	triaxialcompressionEngine-&gt;StabilityCriterion = StabilityCriterion;
-	triaxialcompressionEngine-&gt;autoCompressionActivation = autoCompressionActivation;
-	triaxialcompressionEngine-&gt;internalCompaction = internalCompaction;
-	triaxialcompressionEngine-&gt;maxMultiplier = maxMultiplier;
-		
-	cerr &lt;&lt; &quot;fin de section triaxialcompressionEngine = shared_ptr&lt;TriaxialCompressionEngine&gt; (new TriaxialCompressionEngine);&quot; &lt;&lt; std::endl;
-	
-	
-	// moving walls to regulate the stress applied
-	cerr &lt;&lt; &quot;triaxialstressController = shared_ptr&lt;TriaxialStressController&gt; (new TriaxialStressController);&quot; &lt;&lt; std::endl;
-	triaxialstressController = shared_ptr&lt;TriaxialStressController&gt; (new TriaxialStressController);
-	triaxialstressController-&gt; interval = 1;// = recordIntervalIter
-	triaxialstressController-&gt; sigma_iso = sigma_iso;
-	triaxialstressController-&gt; max_vel = 0.0001;
-	triaxialstressController-&gt; thickness = thickness;
-	triaxialstressController-&gt;wall_bottom_activated = false;
-	triaxialstressController-&gt;wall_top_activated = false;	
-		cerr &lt;&lt; &quot;fin de sezction triaxialstressController = shared_ptr&lt;TriaxialStressController&gt; (new TriaxialStressController);&quot; &lt;&lt; std::endl;
-	
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-//	rootBody-&gt;engines.push_back(sdecTimeStepper);	
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
-	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-	rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
-	rootBody-&gt;engines.push_back(elasticContactLaw);
-	rootBody-&gt;engines.push_back(triaxialcompressionEngine);
-	//rootBody-&gt;engines.push_back(stiffnesscounter);
-	//rootBody-&gt;engines.push_back(stiffnessMatrixTimeStepper);
-	rootBody-&gt;engines.push_back(globalStiffnessCounter);
-	rootBody-&gt;engines.push_back(globalStiffnessTimeStepper);
-	//rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(actionDampingDispatcher);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-	if(!rotationBlocked)
-		rootBody-&gt;engines.push_back(orientationIntegrator);
-	//rootBody-&gt;engines.push_back(resultantforceEngine);
-	//rootBody-&gt;engines.push_back(triaxialstressController);
-	
-		
-	rootBody-&gt;engines.push_back(averagePositionRecorder);
-	rootBody-&gt;engines.push_back(velocityRecorder);
-	rootBody-&gt;engines.push_back(forcerec);
-	
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-	
-}
-
-
-void TriaxialTest::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	rootBody-&gt;isDynamic		= false;
-
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters); // FIXME : fix indexable class PhysicalParameters
-	physics-&gt;se3			= Se3r(Vector3r(0,0,0),q);
-	physics-&gt;mass			= 0;
-	physics-&gt;velocity		= Vector3r::ZERO;
-	physics-&gt;acceleration		= Vector3r::ZERO;
-	
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	
-	set-&gt;diffuseColor		= Vector3r(0,0,1);
-
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor		= Vector3r(0,0,1);
-	
-	rootBody-&gt;interactingGeometry	= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume	= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;physicalParameters 	= physics;
-	
-}
-
-
-
-string GenerateCloud(vector&lt;BasicSphere&gt;&amp; sphere_list, Vector3r lowerCorner, Vector3r upperCorner, long number, Real rad_std_dev, Real porosity)
-{
-	typedef boost::minstd_rand StdGenerator;
-	static StdGenerator generator;
-	static boost::variate_generator&lt;StdGenerator&amp;, boost::uniform_real&lt;&gt; &gt;
-			random1(generator, boost::uniform_real&lt;&gt;(0,1));
-        //         static boost::variate_generator&lt;StdGenerator&amp;, boost::normal_distribution&lt;&gt; &gt;
-        //         randomN(generator, boost::normal_distribution&lt;&gt;(aggregateMeanRadius,aggregateSigmaRadius));
-
-	sphere_list.clear();
-	long tries = 1000; //nb of tries for positionning the next sphere
-	Vector3r dimensions = upperCorner - lowerCorner;
-		
-	Real mean_radius = std::pow(dimensions.X()*dimensions.Y()*dimensions.Z()*(1-porosity)/(3.1416*1.3333*number),0.333333);
-        //cerr &lt;&lt; mean_radius;
-
-	std::cerr &lt;&lt; &quot;generating aggregates ... &quot;;
-	
-	long t, i;
-	for (i=0; i&lt;number; ++i) {
-		BasicSphere s;
-		for (t=0; t&lt;tries; ++t) {
-			s.second = (random1()-0.5)*rad_std_dev*mean_radius+mean_radius;
-			s.first.X() = lowerCorner.X()+s.second+(dimensions.X()-2*s.second)*random1();
-			s.first.Y() = lowerCorner.Y()+s.second+(dimensions.Y()-2*s.second)*random1();
-			s.first.Z() = lowerCorner.Z()+s.second+(dimensions.Z()-2*s.second)*random1();
-			bool overlap=false;
-			for (long j=0; (j&lt;i &amp;&amp; !overlap); j++)
-				if ( pow(sphere_list[j].second+s.second, 2) &gt; (sphere_list[j].first-s.first).SquaredLength()) overlap=true;
-			if (!overlap)
-			{
-				sphere_list.push_back(s);
-				break;
-			}			
-		}
-		if (t==tries) return &quot;More than &quot; + lexical_cast&lt;string&gt;(tries) +
-					&quot; tries while generating sphere number &quot; +
-					lexical_cast&lt;string&gt;(i+1) + &quot;/&quot; + lexical_cast&lt;string&gt;(number) + &quot;.&quot;;
-	}
-	return &quot;Generated a sample with &quot; + lexical_cast&lt;string&gt;(number) + &quot;spheres inside box of dimensions: (&quot; 
-			+ lexical_cast&lt;string&gt;(dimensions[0]) + &quot;,&quot; 
-			+ lexical_cast&lt;string&gt;(dimensions[1]) + &quot;,&quot; 
-			+ lexical_cast&lt;string&gt;(dimensions[2]) + &quot;).&quot;;
-}
-
-
-

Deleted: branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest/TriaxialTest.hpp
===================================================================
--- branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest/TriaxialTest.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest/TriaxialTest.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,126 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SDECIMPORT_HPP
-#define SDECIMPORT_HPP
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class ForceRecorder;
-class AveragePositionRecorder;
-class VelocityRecorder;
-class TriaxialStressController;
-class TriaxialCompressionEngine;
-
-/*! \brief Isotropic compression + uniaxial compression test
-
-	detailed description...
- */
-
-class TriaxialTest : public FileGenerator
-{
-	private	:
-		Vector3r	 gravity
-				,lowerCorner
-				,upperCorner;
-
-		Vector3r	 spheresColor;
-
-		Real		 thickness
-				,sphereYoungModulus
-				,spherePoissonRatio
-				,sphereFrictionDeg
-				,boxYoungModulus
-				,boxPoissonRatio
-				,boxFrictionDeg
-				,density
-				,dampingForce
-				,dampingMomentum
-				,defaultDt
-
-				,bigBallRadius
-				,bigBallDensity
-				,bigBallDropTimeSeconds
-				,bigBallPoissonRatio
-				,bigBallYoungModulus
-				,bigBallFrictDeg
-				,bigBallDropHeight
-				
-				,sigma_iso
-				,strainRate
-				,StabilityCriterion
-				,autoCompressionActivation
-				,maxMultiplier ///max multiplier of diameters during internal compaction
-				,finalMaxMultiplier;
-
-		bool		 wall_top
-				,wall_bottom
-				,wall_1
-				,wall_2
-				,wall_3
-				,wall_4
-				,wall_top_wire
-				,wall_bottom_wire
-				,wall_1_wire
-				,wall_2_wire
-				,wall_3_wire
-				,wall_4_wire
-				,bigBall
-				,rotationBlocked
-				,spheresRandomColor
-				,recordBottomForce
-				,recordAveragePositions
-				,boxWalls
-				,internalCompaction;
-
-		int		 recordIntervalIter
-				,timeStepUpdateInterval
-				,timeStepOutputInterval
-				,wallStiffnessUpdateInterval
-				,radiusControlInterval
-				,numberOfGrains;
-				/*,wall_top_id
-				,wall_bottom_id
-				,wall_left_id
-				,all_right_id
-				,wall_front_id
-				,wall_back_id;*/
-		
-		string		 forceRecordFile
-				,positionRecordFile
-				,velocityRecordFile
-				,importFilename;
-	
-		shared_ptr&lt;ForceRecorder&gt; forcerec;
-		shared_ptr&lt;VelocityRecorder&gt; velocityRecorder;
-		shared_ptr&lt;AveragePositionRecorder&gt; averagePositionRecorder;
-		shared_ptr&lt;TriaxialCompressionEngine&gt; triaxialcompressionEngine;
-		shared_ptr&lt;TriaxialStressController&gt; triaxialstressController;
-			
-		void createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents,bool wire);
-		void createSphere(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Real radius,bool big,bool dynamic);
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-	
-	public : 
-		TriaxialTest ();
-		~TriaxialTest ();
-		string generate();
-	
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(TriaxialTest);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-};
-
-REGISTER_SERIALIZABLE(TriaxialTest,false);
-
-#endif // SDECIMPORT_HPP
-

Copied: branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest.cpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest/TriaxialTest.cpp)

Copied: branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest.hpp (from rev 1105, branches/scons-layout/pkg/dem/PreProcessor/TriaxialTest/TriaxialTest.hpp)

Modified: branches/scons-layout/pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -6,10 +6,10 @@
 *  GNU General Public License v2 or later. See file LICENSE for details. *
 *************************************************************************/
 
-#include &quot;GLDrawSDECLinkGeometry.hpp&quot;
-#include &quot;SDECLinkGeometry.hpp&quot;
-#include &quot;SimpleElasticInteraction.hpp&quot;
-#include &quot;SDECLinkPhysics.hpp&quot;
+#include&quot;GLDrawSDECLinkGeometry.hpp&quot;
+#include&quot;SDECLinkGeometry.hpp&quot;
+#include&lt;yade/pkg-common/SimpleElasticInteraction.hpp&gt;
+#include&quot;SDECLinkPhysics.hpp&quot;
 
 #include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;
 

Modified: branches/scons-layout/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -8,7 +8,7 @@
 
 #include &quot;GLDrawSpheresContactGeometry.hpp&quot;
 #include &quot;SpheresContactGeometry.hpp&quot;
-#include &quot;SimpleElasticInteraction.hpp&quot;
+#include&lt;yade/pkg-common/SimpleElasticInteraction.hpp&gt;
 #include &quot;ElasticContactInteraction.hpp&quot;
 
 #include&lt;yade/lib-opengl/OpenGLWrapper.hpp&gt;

Modified: branches/scons-layout/pkg/dem/SConscript
===================================================================
--- branches/scons-layout/pkg/dem/SConscript	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/dem/SConscript	2007-03-07 14:13:16 UTC (rev 1107)
@@ -2,53 +2,53 @@
 env.Install('$PREFIX/lib/yade$POSTFIX/pkg-dem',[
 
 	env.SharedLibrary('InteractingMyTetrahedron',
-		['DataClass/InteractingGeometry/InteractingMyTetrahedron/InteractingMyTetrahedron.cpp'],
+		['DataClass/InteractingGeometry/InteractingMyTetrahedron.cpp'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractingGeometry/InteractingMyTetrahedron']),
+			'DataClass/InteractingGeometry']),
 
 	env.SharedLibrary('BodyMacroParameters',
-		['DataClass/PhysicalParameters/BodyMacroParameters/BodyMacroParameters.cpp'],
+		['DataClass/PhysicalParameters/BodyMacroParameters.cpp'],
 		LIBS=env['LIBS']+['RigidBodyParameters',
 			'ElasticBodyParameters',
 			'yade-serialization',
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/PhysicalParameters/BodyMacroParameters']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('SpheresContactGeometry',
-		['DataClass/InteractionGeometry/SpheresContactGeometry/SpheresContactGeometry.cpp'],
+		['DataClass/InteractionGeometry/SpheresContactGeometry.cpp'],
 		LIBS=env['LIBS']+['yade-serialization', 'yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionGeometry/SpheresContactGeometry']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('SDECLinkGeometry',
-		['DataClass/InteractionGeometry/SDECLinkGeometry/SDECLinkGeometry.cpp'],
+		['DataClass/InteractionGeometry/SDECLinkGeometry.cpp'],
 		LIBS=env['LIBS']+['yade-serialization', 'yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionGeometry/SDECLinkGeometry']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('InteractionOfMyTetrahedron',
-		['DataClass/InteractionGeometry/InteractionOfMyTetrahedron/InteractionOfMyTetrahedron.cpp'],
+		['DataClass/InteractionGeometry/InteractionOfMyTetrahedron.cpp'],
 		LIBS=env['LIBS']+['yade-serialization', 'yade-base', 'Wm3Foundation'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionGeometry/InteractionOfMyTetrahedron']),
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('ElasticContactInteraction',
-		['DataClass/InteractionPhysics/ElasticContactInteraction/ElasticContactInteraction.cpp'],
+		['DataClass/InteractionPhysics/ElasticContactInteraction.cpp'],
 		LIBS=env['LIBS']+['SimpleElasticInteraction'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/ElasticContactInteraction']),
+			'DataClass/InteractionPhysics']),
 
 	env.SharedLibrary('SDECLinkPhysics',
-		['DataClass/InteractionPhysics/SDECLinkPhysics/SDECLinkPhysics.cpp'],
-		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics/SDECLinkPhysics', '$PREFIX/include']),
+		['DataClass/InteractionPhysics/SDECLinkPhysics.cpp'],
+		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics', '$PREFIX/include']),
 
 	env.SharedLibrary('GlobalStiffness',
-		['DataClass/PhysicalAction/GlobalStiffness/GlobalStiffness.cpp'],
+		['DataClass/PhysicalAction/GlobalStiffness.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/PhysicalAction/GlobalStiffness']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/PhysicalAction']),
 
 	env.SharedLibrary('MacroMicroElasticRelationships',
-		['Engine/EngineUnit/MacroMicroElasticRelationships/MacroMicroElasticRelationships.cpp'],
+		['Engine/EngineUnit/MacroMicroElasticRelationships.cpp'],
 		LIBS=env['LIBS']+['SDECLinkPhysics',
 			'SDECLinkGeometry',
 			'ElasticContactInteraction',
@@ -58,15 +58,15 @@
 			'ParticleParameters',
 			'InteractionPhysicsMetaEngine'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/ElasticContactInteraction',
-			'DataClass/InteractionPhysics/SDECLinkPhysics',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'DataClass/InteractionGeometry/SpheresContactGeometry',
-			'DataClass/InteractionGeometry/SDECLinkGeometry',
-			'Engine/EngineUnit/MacroMicroElasticRelationships']),
+			'DataClass/InteractionPhysics',
+			'DataClass/InteractionPhysics',
+			'DataClass/PhysicalParameters',
+			'DataClass/InteractionGeometry',
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('SimpleElasticRelationships',
-		['Engine/EngineUnit/SimpleElasticRelationships/SimpleElasticRelationships.cpp'],
+		['Engine/EngineUnit/SimpleElasticRelationships.cpp'],
 		LIBS=env['LIBS']+['SDECLinkPhysics',
 			'SDECLinkGeometry',
 			'ElasticContactInteraction',
@@ -76,15 +76,15 @@
 			'ParticleParameters',
 			'InteractionPhysicsMetaEngine'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/ElasticContactInteraction',
-			'DataClass/InteractionPhysics/SDECLinkPhysics',
-			'Engine/EngineUnit/SimpleElasticRelationships',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'DataClass/InteractionGeometry/SpheresContactGeometry',
-			'DataClass/InteractionGeometry/SDECLinkGeometry']),
+			'DataClass/InteractionPhysics',
+			'DataClass/InteractionPhysics',
+			'Engine/EngineUnit',
+			'DataClass/PhysicalParameters',
+			'DataClass/InteractionGeometry',
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('InteractingBox2InteractingSphere4SpheresContactGeometry',
-		['Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry/InteractingBox2InteractingSphere4SpheresContactGeometry.cpp'],
+		['Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry.cpp'],
 		LIBS=env['LIBS']+['SpheresContactGeometry',
 			'InteractionGeometryMetaEngine',
 			'yade-base',
@@ -93,11 +93,11 @@
 			'InteractingSphere',
 			'InteractingBox'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionGeometry/SpheresContactGeometry',
-			'Engine/EngineUnit/InteractingBox2InteractingSphere4SpheresContactGeometry']),
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('InteractingSphere2InteractingSphere4SpheresContactGeometry',
-		['Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp'],
+		['Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry.cpp'],
 		LIBS=env['LIBS']+['SDECLinkGeometry',
 			'SpheresContactGeometry',
 			'InteractionGeometryMetaEngine',
@@ -106,23 +106,23 @@
 			'yade-multimethods',
 			'InteractingSphere'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionGeometry/SpheresContactGeometry',
-			'Engine/EngineUnit/InteractingSphere2InteractingSphere4SpheresContactGeometry',
-			'DataClass/InteractionGeometry/SDECLinkGeometry']),
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit',
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('InteractingMyTetrahedron2AABB',
-		['Engine/EngineUnit/InteractingMyTetrahedron2AABB/InteractingMyTetrahedron2AABB.cpp'],
+		['Engine/EngineUnit/InteractingMyTetrahedron2AABB.cpp'],
 		LIBS=env['LIBS']+['BoundingVolumeMetaEngine',
 			'InteractingMyTetrahedron',
 			'AABB',
 			'yade-base',
 			'Wm3Foundation'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Engine/EngineUnit/InteractingMyTetrahedron2AABB',
-			'DataClass/InteractingGeometry/InteractingMyTetrahedron']),
+			'Engine/EngineUnit',
+			'DataClass/InteractingGeometry']),
 
 	env.SharedLibrary('InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron',
-		['Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.cpp'],
+		['Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron.cpp'],
 		LIBS=env['LIBS']+['InteractionOfMyTetrahedron',
 			'InteractionGeometryMetaEngine',
 			'yade-base',
@@ -132,12 +132,12 @@
 			'yade-base',
 			'Wm3Foundation'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionGeometry/InteractionOfMyTetrahedron',
-			'DataClass/InteractingGeometry/InteractingMyTetrahedron',
-			'Engine/EngineUnit/InteractingMyTetrahedron2InteractingMyTetrahedron4InteractionOfMyTetrahedron']),
+			'DataClass/InteractionGeometry',
+			'DataClass/InteractingGeometry',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron',
-		['Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.cpp'],
+		['Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron.cpp'],
 		LIBS=env['LIBS']+['InteractionOfMyTetrahedron',
 			'InteractionGeometryMetaEngine',
 			'InteractingBox2InteractingSphere4SpheresContactGeometry',
@@ -148,21 +148,21 @@
 			'Wm3Foundation',
 			'yade-multimethods',
 			'InteractingMyTetrahedron'],
-		CPPPATH=env['CPPPATH']+['DataClass/InteractionGeometry/SpheresContactGeometry',
+		CPPPATH=env['CPPPATH']+['DataClass/InteractionGeometry',
 			'$PREFIX/include',
-			'Engine/EngineUnit/InteractingMyTetrahedron2InteractingBox4InteractionOfMyTetrahedron',
-			'DataClass/InteractingGeometry/InteractingMyTetrahedron',
-			'DataClass/InteractionGeometry/InteractionOfMyTetrahedron']),
+			'Engine/EngineUnit',
+			'DataClass/InteractingGeometry',
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('Tetrahedron2InteractingMyTetrahedron',
-		['Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron/Tetrahedron2InteractingMyTetrahedron.cpp'],
+		['Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron.cpp'],
 		LIBS=env['LIBS']+['InteractingMyTetrahedron', 'InteractingGeometryMetaEngine', 'Tetrahedron'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Engine/EngineUnit/Tetrahedron2InteractingMyTetrahedron',
-			'DataClass/InteractingGeometry/InteractingMyTetrahedron']),
+			'Engine/EngineUnit',
+			'DataClass/InteractingGeometry']),
 
 	env.SharedLibrary('ElasticCohesiveLaw',
-		['Engine/StandAloneEngine/ElasticCohesiveLaw/ElasticCohesiveLaw.cpp'],
+		['Engine/StandAloneEngine/ElasticCohesiveLaw.cpp'],
 		LIBS=env['LIBS']+['SDECLinkPhysics',
 			'ElasticContactInteraction',
 			'SDECLinkGeometry',
@@ -176,15 +176,15 @@
 			'Sphere',
 			'RigidBodyParameters'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/ElasticContactInteraction',
-			'DataClass/InteractionPhysics/SDECLinkPhysics',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'Engine/StandAloneEngine/ElasticCohesiveLaw',
-			'DataClass/InteractionGeometry/SpheresContactGeometry',
-			'DataClass/InteractionGeometry/SDECLinkGeometry']),
+			'DataClass/InteractionPhysics',
+			'DataClass/InteractionPhysics',
+			'DataClass/PhysicalParameters',
+			'Engine/StandAloneEngine',
+			'DataClass/InteractionGeometry',
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('ElasticContactLaw',
-		['Engine/StandAloneEngine/ElasticContactLaw/ElasticContactLaw.cpp'],
+		['Engine/StandAloneEngine/ElasticContactLaw.cpp'],
 		LIBS=env['LIBS']+['SDECLinkPhysics',
 			'ElasticContactInteraction',
 			'SDECLinkGeometry',
@@ -199,15 +199,15 @@
 			'Sphere',
 			'RigidBodyParameters'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/ElasticContactInteraction',
-			'Engine/StandAloneEngine/ElasticContactLaw',
-			'DataClass/InteractionPhysics/SDECLinkPhysics',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'DataClass/InteractionGeometry/SpheresContactGeometry',
-			'DataClass/InteractionGeometry/SDECLinkGeometry']),
+			'DataClass/InteractionPhysics',
+			'Engine/StandAloneEngine',
+			'DataClass/InteractionPhysics',
+			'DataClass/PhysicalParameters',
+			'DataClass/InteractionGeometry',
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('MyTetrahedronLaw',
-		['Engine/StandAloneEngine/MyTetrahedronLaw/MyTetrahedronLaw.cpp'],
+		['Engine/StandAloneEngine/MyTetrahedronLaw.cpp'],
 		LIBS=env['LIBS']+['ElasticContactInteraction',
 			'SimpleElasticInteraction',
 			'InteractionOfMyTetrahedron',
@@ -221,45 +221,45 @@
 			'Sphere',
 			'RigidBodyParameters'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/ElasticContactInteraction',
-			'Engine/StandAloneEngine/MyTetrahedronLaw',
-			'DataClass/InteractionGeometry/InteractionOfMyTetrahedron']),
+			'DataClass/InteractionPhysics',
+			'Engine/StandAloneEngine',
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('ElasticCriterionTimeStepper',
-		['Engine/StandAloneEngine/ElasticCriterionTimeStepper/ElasticCriterionTimeStepper.cpp'],
+		['Engine/StandAloneEngine/ElasticCriterionTimeStepper.cpp'],
 		LIBS=env['LIBS']+['ElasticContactInteraction',
 			'SpheresContactGeometry',
 			'MacroMicroElasticRelationships',
 			'Sphere'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/ElasticContactInteraction',
-			'Engine/StandAloneEngine/ElasticCriterionTimeStepper',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'DataClass/InteractionGeometry/SpheresContactGeometry',
-			'Engine/EngineUnit/MacroMicroElasticRelationships']),
+			'DataClass/InteractionPhysics',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('AveragePositionRecorder',
-		['Engine/StandAloneEngine/AveragePositionRecorder/AveragePositionRecorder.cpp'],
+		['Engine/StandAloneEngine/AveragePositionRecorder.cpp'],
 		LIBS=env['LIBS']+['RigidBodyParameters'],
-		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine/AveragePositionRecorder', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine', '$PREFIX/include']),
 
 	env.SharedLibrary('ForceRecorder',
-		['Engine/StandAloneEngine/ForceRecorder/ForceRecorder.cpp'],
+		['Engine/StandAloneEngine/ForceRecorder.cpp'],
 		LIBS=env['LIBS']+['RigidBodyParameters', 'Force'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/StandAloneEngine/ForceRecorder']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('PositionOrientationRecorder',
-		['Engine/StandAloneEngine/PositionOrientationRecorder/PositionOrientationRecorder.cpp'],
+		['Engine/StandAloneEngine/PositionOrientationRecorder.cpp'],
 		LIBS=env['LIBS']+['RigidBodyParameters'],
-		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine/PositionOrientationRecorder', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine', '$PREFIX/include']),
 
 	env.SharedLibrary('VelocityRecorder',
-		['Engine/StandAloneEngine/VelocityRecorder/VelocityRecorder.cpp'],
+		['Engine/StandAloneEngine/VelocityRecorder.cpp'],
 		LIBS=env['LIBS']+['ParticleParameters'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/StandAloneEngine/VelocityRecorder']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('GlobalStiffnessCounter',
-		['Engine/StandAloneEngine/GlobalStiffnessCounter/GlobalStiffnessCounter.cpp'],
+		['Engine/StandAloneEngine/GlobalStiffnessCounter.cpp'],
 		LIBS=env['LIBS']+['SDECLinkPhysics',
 			'ElasticContactInteraction',
 			'SDECLinkGeometry',
@@ -275,16 +275,16 @@
 			'RigidBodyParameters',
 			'GlobalStiffness'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/ElasticContactInteraction',
-			'DataClass/PhysicalAction/GlobalStiffness',
-			'DataClass/InteractionPhysics/SDECLinkPhysics',
-			'Engine/StandAloneEngine/GlobalStiffnessCounter',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'DataClass/InteractionGeometry/SpheresContactGeometry',
-			'DataClass/InteractionGeometry/SDECLinkGeometry']),
+			'DataClass/InteractionPhysics',
+			'DataClass/PhysicalAction',
+			'DataClass/InteractionPhysics',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'DataClass/InteractionGeometry',
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('GlobalStiffnessTimeStepper',
-		['Engine/StandAloneEngine/GlobalStiffnessTimeStepper/GlobalStiffnessTimeStepper.cpp'],
+		['Engine/StandAloneEngine/GlobalStiffnessTimeStepper.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'ElasticContactInteraction',
@@ -292,22 +292,22 @@
 			'MacroMicroElasticRelationships',
 			'Sphere',
 			'GlobalStiffness'],
-		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine/GlobalStiffnessTimeStepper',
+		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine',
 			'$PREFIX/include',
-			'DataClass/InteractionPhysics/ElasticContactInteraction',
-			'DataClass/PhysicalAction/GlobalStiffness',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'DataClass/InteractionGeometry/SpheresContactGeometry',
-			'Engine/EngineUnit/MacroMicroElasticRelationships']),
+			'DataClass/InteractionPhysics',
+			'DataClass/PhysicalAction',
+			'DataClass/PhysicalParameters',
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('GeometricalModelForceColorizer',
-		['Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp'],
+		['Engine/StandAloneEngine/GeometricalModelForceColorizer.cpp'],
 		LIBS=env['LIBS']+['RigidBodyParameters', 'Force'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Engine/StandAloneEngine/GeometricalModelForceColorizer']),
+			'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('ResultantForceEngine',
-		['Engine/DeusExMachina/ResultantForceEngine/ResultantForceEngine.cpp'],
+		['Engine/DeusExMachina/ResultantForceEngine.cpp'],
 		LIBS=env['LIBS']+['yade-factory',
 			'yade-base',
 			'Wm3Foundation',
@@ -315,11 +315,11 @@
 			'ParticleParameters',
 			'GlobalStiffness'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/PhysicalAction/GlobalStiffness',
-			'Engine/DeusExMachina/ResultantForceEngine']),
+			'DataClass/PhysicalAction',
+			'Engine/DeusExMachina']),
 
 	env.SharedLibrary('TriaxialStressController',
-		['Engine/DeusExMachina/TriaxialStressController/TriaxialStressController.cpp'],
+		['Engine/DeusExMachina/TriaxialStressController.cpp'],
 		LIBS=env['LIBS']+['yade-factory',
 			'yade-base',
 			'Wm3Foundation',
@@ -329,13 +329,13 @@
 			'InteractingSphere',
 			'SpheresContactGeometry',
 			'Sphere'],
-		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics/ElasticContactInteraction',
-			'Engine/DeusExMachina/TriaxialStressController',
+		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics',
+			'Engine/DeusExMachina',
 			'$PREFIX/include',
-			'DataClass/InteractionGeometry/SpheresContactGeometry']),
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('TriaxialCompressionEngine',
-		['Engine/DeusExMachina/TriaxialCompressionEngine/TriaxialCompressionEngine.cpp'],
+		['Engine/DeusExMachina/TriaxialCompressionEngine.cpp'],
 		LIBS=env['LIBS']+['yade-factory',
 			'yade-base',
 			'Wm3Foundation',
@@ -343,17 +343,17 @@
 			'ParticleParameters',
 			'ElasticContactInteraction',
 			'TriaxialStressController'],
-		CPPPATH=env['CPPPATH']+['Engine/DeusExMachina/TriaxialStressController',
+		CPPPATH=env['CPPPATH']+['Engine/DeusExMachina',
 			'$PREFIX/include',
-			'DataClass/InteractionPhysics/ElasticContactInteraction',
-			'Engine/DeusExMachina/TriaxialCompressionEngine']),
+			'DataClass/InteractionPhysics',
+			'Engine/DeusExMachina']),
 
 	env.SharedLibrary('GLDrawInteractingMyTetrahedron',
 		['RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.cpp'],
 		LIBS=env['LIBS']+['InteractingMyTetrahedron', 'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['RenderingEngine/GLDrawInteractingMyTetrahedron',
 			'$PREFIX/include',
-			'DataClass/InteractingGeometry/InteractingMyTetrahedron']),
+			'DataClass/InteractingGeometry']),
 
 	env.SharedLibrary('GLDrawSpheresContactGeometry',
 		['RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp'],
@@ -361,11 +361,11 @@
 			'ElasticContactInteraction',
 			'SimpleElasticInteraction',
 			'yade-opengl'],
-		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics/ElasticContactInteraction',
+		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics',
 			'RenderingEngine/GLDrawSpheresContactGeometry',
 			'$PREFIX/include',
 			'../yade-package-common/src/DataClass/InteractionPhysics/SimpleElasticInteraction',
-			'DataClass/InteractionGeometry/SpheresContactGeometry']),
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('GLDrawSDECLinkGeometry',
 		['RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp'],
@@ -373,14 +373,14 @@
 			'SDECLinkPhysics',
 			'SimpleElasticInteraction',
 			'yade-opengl'],
-		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics/SDECLinkPhysics',
+		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics',
 			'$PREFIX/include',
 			'../yade-package-common/src/DataClass/InteractionPhysics/SimpleElasticInteraction',
 			'RenderingEngine/GLDrawSDECLinkGeometry',
-			'DataClass/InteractionGeometry/SDECLinkGeometry']),
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('Funnel',
-		['PreProcessor/Funnel/Funnel.cpp'],
+		['PreProcessor/Funnel.cpp'],
 		LIBS=env['LIBS']+['SDECLinkGeometry',
 			'ElasticContactLaw',
 			'MacroMicroElasticRelationships',
@@ -413,15 +413,15 @@
 			'MetaInteractingGeometry2AABB',
 			'yade-multimethods'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Engine/StandAloneEngine/ElasticContactLaw',
-			'PreProcessor/Funnel',
-			'Engine/StandAloneEngine/ElasticCriterionTimeStepper',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'DataClass/InteractionGeometry/SDECLinkGeometry',
-			'Engine/EngineUnit/MacroMicroElasticRelationships']),
+			'Engine/StandAloneEngine',
+			'PreProcessor',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('SDECImpactTest',
-		['PreProcessor/SDECImpactTest/SDECImpactTest.cpp'],
+		['PreProcessor/SDECImpactTest.cpp'],
 		LIBS=env['LIBS']+['SDECLinkGeometry',
 			'ElasticContactLaw',
 			'AveragePositionRecorder',
@@ -455,20 +455,20 @@
 			'PersistentSAPCollider',
 			'SAPCollider',
 			'MetaInteractingGeometry2AABB'],
-		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine/AveragePositionRecorder',
+		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine',
 			'$PREFIX/include',
-			'PreProcessor/SDECImpactTest',
-			'DataClass/InteractionPhysics/SDECLinkPhysics',
-			'Engine/StandAloneEngine/ForceRecorder',
-			'Engine/StandAloneEngine/ElasticCriterionTimeStepper',
-			'Engine/StandAloneEngine/ElasticContactLaw',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'Engine/StandAloneEngine/VelocityRecorder',
-			'DataClass/InteractionGeometry/SDECLinkGeometry',
-			'Engine/EngineUnit/MacroMicroElasticRelationships']),
+			'PreProcessor',
+			'DataClass/InteractionPhysics',
+			'Engine/StandAloneEngine',
+			'Engine/StandAloneEngine',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'Engine/StandAloneEngine',
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('SDECLinkedSpheres',
-		['PreProcessor/SDECLinkedSpheres/SDECLinkedSpheres.cpp'],
+		['PreProcessor/SDECLinkedSpheres.cpp'],
 		LIBS=env['LIBS']+['SDECLinkGeometry',
 			'ElasticContactLaw',
 			'ElasticCohesiveLaw',
@@ -502,17 +502,17 @@
 			'MetaInteractingGeometry2AABB',
 			'yade-multimethods'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/SDECLinkPhysics',
-			'Engine/StandAloneEngine/ElasticCriterionTimeStepper',
-			'Engine/StandAloneEngine/ElasticContactLaw',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'Engine/StandAloneEngine/ElasticCohesiveLaw',
-			'PreProcessor/SDECLinkedSpheres',
-			'DataClass/InteractionGeometry/SDECLinkGeometry',
-			'Engine/EngineUnit/MacroMicroElasticRelationships']),
+			'DataClass/InteractionPhysics',
+			'Engine/StandAloneEngine',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'Engine/StandAloneEngine',
+			'PreProcessor',
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('SDECSpheresPlane',
-		['PreProcessor/SDECSpheresPlane/SDECSpheresPlane.cpp'],
+		['PreProcessor/SDECSpheresPlane.cpp'],
 		LIBS=env['LIBS']+['SDECLinkGeometry',
 			'ElasticContactLaw',
 			'MacroMicroElasticRelationships',
@@ -546,16 +546,16 @@
 			'MetaInteractingGeometry2AABB',
 			'yade-multimethods'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Engine/StandAloneEngine/ElasticContactLaw',
-			'PreProcessor/SDECSpheresPlane',
-			'Engine/StandAloneEngine/ElasticCriterionTimeStepper',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'Engine/StandAloneEngine/PositionOrientationRecorder',
-			'DataClass/InteractionGeometry/SDECLinkGeometry',
-			'Engine/EngineUnit/MacroMicroElasticRelationships']),
+			'Engine/StandAloneEngine',
+			'PreProcessor',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'Engine/StandAloneEngine',
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('SDECMovingWall',
-		['PreProcessor/SDECMovingWall/SDECMovingWall.cpp'],
+		['PreProcessor/SDECMovingWall.cpp'],
 		LIBS=env['LIBS']+['SDECLinkGeometry',
 			'ElasticContactLaw',
 			'MacroMicroElasticRelationships',
@@ -590,16 +590,16 @@
 			'MetaInteractingGeometry2AABB',
 			'yade-multimethods'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Engine/StandAloneEngine/ElasticContactLaw',
-			'Engine/StandAloneEngine/ElasticCriterionTimeStepper',
-			'PreProcessor/SDECMovingWall',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'Engine/StandAloneEngine/PositionOrientationRecorder',
-			'DataClass/InteractionGeometry/SDECLinkGeometry',
-			'Engine/EngineUnit/MacroMicroElasticRelationships']),
+			'Engine/StandAloneEngine',
+			'Engine/StandAloneEngine',
+			'PreProcessor',
+			'DataClass/PhysicalParameters',
+			'Engine/StandAloneEngine',
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('TetrahedronsTest',
-		['PreProcessor/TetrahedronsTest/TetrahedronsTest.cpp'],
+		['PreProcessor/TetrahedronsTest.cpp'],
 		LIBS=env['LIBS']+['MyTetrahedronLaw',
 			'MacroMicroElasticRelationships',
 			'ElasticCriterionTimeStepper',
@@ -633,14 +633,14 @@
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['PreProcessor/TetrahedronsTest',
+		CPPPATH=env['CPPPATH']+['PreProcessor',
 			'$PREFIX/include',
-			'Engine/StandAloneEngine/MyTetrahedronLaw',
-			'DataClass/InteractingGeometry/InteractingMyTetrahedron',
-			'Engine/StandAloneEngine/ElasticCriterionTimeStepper']),
+			'Engine/StandAloneEngine',
+			'DataClass/InteractingGeometry',
+			'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('TriaxialTest',
-		['PreProcessor/TriaxialTest/TriaxialTest.cpp'],
+		['PreProcessor/TriaxialTest.cpp'],
 		LIBS=env['LIBS']+['SDECLinkGeometry',
 			'ElasticContactLaw',
 			'AveragePositionRecorder',
@@ -681,25 +681,25 @@
 			'GlobalStiffnessTimeStepper',
 			'yade-base',
 			'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine/GlobalStiffnessTimeStepper',
-			'Engine/StandAloneEngine/AveragePositionRecorder',
+		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine',
+			'Engine/StandAloneEngine',
 			'$PREFIX/include',
-			'DataClass/PhysicalAction/GlobalStiffness',
-			'DataClass/InteractionPhysics/SDECLinkPhysics',
-			'Engine/DeusExMachina/TriaxialStressController',
-			'Engine/StandAloneEngine/ForceRecorder',
-			'PreProcessor/TriaxialTest',
-			'Engine/EngineUnit/SimpleElasticRelationships',
-			'Engine/StandAloneEngine/GlobalStiffnessCounter',
-			'Engine/StandAloneEngine/ElasticCriterionTimeStepper',
-			'Engine/StandAloneEngine/ElasticContactLaw',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'Engine/DeusExMachina/TriaxialCompressionEngine',
-			'Engine/StandAloneEngine/VelocityRecorder',
-			'DataClass/InteractionGeometry/SDECLinkGeometry']),
+			'DataClass/PhysicalAction',
+			'DataClass/InteractionPhysics',
+			'Engine/DeusExMachina',
+			'Engine/StandAloneEngine',
+			'PreProcessor',
+			'Engine/EngineUnit',
+			'Engine/StandAloneEngine',
+			'Engine/StandAloneEngine',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'Engine/DeusExMachina',
+			'Engine/StandAloneEngine',
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('ThreePointBending',
-		['PreProcessor/ThreePointBending/ThreePointBending.cpp'],
+		['PreProcessor/ThreePointBending.cpp'],
 		LIBS=env['LIBS']+['SDECLinkGeometry',
 			'ElasticContactLaw',
 			'ElasticCohesiveLaw',
@@ -735,13 +735,13 @@
 			'boost_filesystem',
 			'TranslationEngine'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/SDECLinkPhysics',
-			'PreProcessor/ThreePointBending',
-			'Engine/StandAloneEngine/ElasticCriterionTimeStepper',
-			'Engine/StandAloneEngine/ElasticContactLaw',
-			'DataClass/PhysicalParameters/BodyMacroParameters',
-			'Engine/StandAloneEngine/ElasticCohesiveLaw',
-			'DataClass/InteractionGeometry/SDECLinkGeometry',
-			'Engine/EngineUnit/MacroMicroElasticRelationships'])
+			'DataClass/InteractionPhysics',
+			'PreProcessor',
+			'Engine/StandAloneEngine',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'Engine/StandAloneEngine',
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit'])
 ])
 

Deleted: branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry/FEMSetGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry/FEMSetGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry/FEMSetGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,23 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;FEMSetGeometry.hpp&quot;
-
-
-FEMSetGeometry::FEMSetGeometry() : GeometricalModel()
-{
-	createIndex();
-}
-
-
-FEMSetGeometry::~FEMSetGeometry()
-{
-
-}
-
-

Deleted: branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry/FEMSetGeometry.hpp
===================================================================
--- branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry/FEMSetGeometry.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry/FEMSetGeometry.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,32 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FEM_SET_GEOMETRY_HPP
-#define FEM_SET_GEOMETRY_HPP 
-
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-
-class FEMSetGeometry : public GeometricalModel
-{
-	public :
-		FEMSetGeometry();
-		virtual ~FEMSetGeometry ();
-	
-/// Serialization
-	REGISTER_CLASS_NAME(FEMSetGeometry);
-	REGISTER_BASE_CLASS_NAME(GeometricalModel);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(FEMSetGeometry,GeometricalModel);
-
-};
-
-REGISTER_SERIALIZABLE(FEMSetGeometry,false);
-
-#endif // FEM_SET_GEOMETRY_HPP
-

Copied: branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry.cpp (from rev 1105, branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry/FEMSetGeometry.cpp)

Copied: branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry.hpp (from rev 1105, branches/scons-layout/pkg/fem/DataClass/GeometricalModel/FEMSetGeometry/FEMSetGeometry.hpp)

Deleted: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData/FEMNodeData.cpp
===================================================================
--- branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData/FEMNodeData.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData/FEMNodeData.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,29 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;FEMNodeData.hpp&quot;
-
-
-FEMNodeData::FEMNodeData() : ParticleParameters()
-{
-	createIndex();
-}
-
-
-FEMNodeData::~FEMNodeData()
-{
-
-}
-
-
-void FEMNodeData::registerAttributes()
-{
-	ParticleParameters::registerAttributes();
-	REGISTER_ATTRIBUTE(initialPosition);
-}
-

Deleted: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData/FEMNodeData.hpp
===================================================================
--- branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData/FEMNodeData.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData/FEMNodeData.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,39 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FEM_NODE_PARAMETERS_HPP 
-#define FEM_NODE_PARAMETERS_HPP 
-
-#include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-
-class FEMNodeData : public ParticleParameters
-{
-/// Attributes 
-	
-	public :
-		Vector3r initialPosition; // maybe this should be stored in FEMTetrahedron? (but then this data will be stored multiple times, since each tetrahedron will copy the same coordinades for each of its nodes...)
-	
-/// Methods 
-		FEMNodeData();
-		virtual ~FEMNodeData();
-
-/// Serialization
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(FEMNodeData);
-	REGISTER_BASE_CLASS_NAME(ParticleParameters);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(FEMNodeData,ParticleParameters);
-
-};
-
-REGISTER_SERIALIZABLE(FEMNodeData,false);
-
-#endif // FEM_NODE_PARAMETERS_HPP
-

Copied: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData.cpp (from rev 1105, branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData/FEMNodeData.cpp)

Copied: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData.hpp (from rev 1105, branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMNodeData/FEMNodeData.hpp)

Deleted: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters/FEMSetParameters.cpp
===================================================================
--- branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters/FEMSetParameters.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters/FEMSetParameters.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,32 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;FEMSetParameters.hpp&quot;
-
-
-FEMSetParameters::FEMSetParameters() : PhysicalParameters()
-{
-	createIndex();
-	nodeGroupMask = 1;
-	tetrahedronGroupMask = 1;
-}
-
-
-FEMSetParameters::~FEMSetParameters()
-{
-
-}
-
-
-void FEMSetParameters::registerAttributes()
-{
-	PhysicalParameters::registerAttributes();
-	REGISTER_ATTRIBUTE(nodeGroupMask);
-	REGISTER_ATTRIBUTE(tetrahedronGroupMask);
-}
-

Deleted: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters/FEMSetParameters.hpp
===================================================================
--- branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters/FEMSetParameters.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters/FEMSetParameters.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,38 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FEM_SET_PARAMETERS_HPP
-#define FEM_SET_PARAMETERS_HPP 
-
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-
-class FEMSetParameters : public PhysicalParameters
-{
-	public :
-		int	 nodeGroupMask
-			,tetrahedronGroupMask;
-
-/// Constructor/Destructor
-		FEMSetParameters();
-		virtual ~FEMSetParameters();
-
-/// Serializable
-	REGISTER_CLASS_NAME(FEMSetParameters);
-	REGISTER_BASE_CLASS_NAME(PhysicalParameters);
-
-/// Indexable
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_INDEX(FEMSetParameters,PhysicalParameters);
-
-};
-
-REGISTER_SERIALIZABLE(FEMSetParameters,false);
-
-#endif // LATTICEBEAMPARAMETERS_HPP
-

Copied: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters.cpp (from rev 1105, branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters/FEMSetParameters.cpp)

Copied: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters.hpp (from rev 1105, branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMSetParameters/FEMSetParameters.hpp)

Deleted: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData/FEMTetrahedronData.cpp
===================================================================
--- branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData/FEMTetrahedronData.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData/FEMTetrahedronData.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,190 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;FEMTetrahedronData.hpp&quot;
-#include &quot;FEMNodeData.hpp&quot;
-
-
-FEMTetrahedronData::FEMTetrahedronData() : PhysicalParameters()
-{ 
-	createIndex();
-	ids.clear();
-}
-
-
-FEMTetrahedronData::~FEMTetrahedronData()
-{
-
-}
-
-
-void FEMTetrahedronData::registerAttributes()
-{
-	PhysicalParameters::registerAttributes();
-	REGISTER_ATTRIBUTE(ids);
-}
-
-void FEMTetrahedronData::calcKeMatrix(MetaBody* femBody)
-{
-	ublas::matrix&lt;Real&gt; nodesCoordinates;
-	nodesCoordinates.resize(3,4);
-	nodesCoordinates.clear();
-	
-	nodesCoordinates(0,0) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[0]]-&gt;physicalParameters.get())-&gt;initialPosition[0];
-	nodesCoordinates(1,0) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[0]]-&gt;physicalParameters.get())-&gt;initialPosition[1];
-	nodesCoordinates(2,0) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[0]]-&gt;physicalParameters.get())-&gt;initialPosition[2];
-
-	nodesCoordinates(0,1) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[1]]-&gt;physicalParameters.get())-&gt;initialPosition[0];
-	nodesCoordinates(1,1) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[1]]-&gt;physicalParameters.get())-&gt;initialPosition[1];
-	nodesCoordinates(2,1) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[1]]-&gt;physicalParameters.get())-&gt;initialPosition[2];
-
-	nodesCoordinates(0,2) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[2]]-&gt;physicalParameters.get())-&gt;initialPosition[0];
-	nodesCoordinates(1,2) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[2]]-&gt;physicalParameters.get())-&gt;initialPosition[1];
-	nodesCoordinates(2,2) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[2]]-&gt;physicalParameters.get())-&gt;initialPosition[2];
-
-	nodesCoordinates(0,3) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[3]]-&gt;physicalParameters.get())-&gt;initialPosition[0];
-	nodesCoordinates(1,3) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[3]]-&gt;physicalParameters.get())-&gt;initialPosition[1];
-	nodesCoordinates(2,3) = YADE_CAST&lt;FEMNodeData*&gt;((*(femBody-&gt;bodies))[ids[3]]-&gt;physicalParameters.get())-&gt;initialPosition[2]; 
-	
-	localCalcKeMatrix(nodesCoordinates);
-	
-//	std::cerr &lt;&lt; Ke_ &lt;&lt; std::endl;
-}
-
-void FEMTetrahedronData::localCalcKeMatrix( ublas::matrix&lt;Real&gt;&amp; coord )
-{
-	double h1, h2, G, h3;
-	double Youn, nu, rho, Damp;
-// FIXME - those are parameters
-	Youn = 150; // young modulus I guess?
-	nu = 0.28 ; // and what is this one?
-	rho = 1; // what is this ? density maybe?
-	Damp = 1; // how this one works?
-
-
-//	Youn = 1; // young modulus I guess?
-//	nu = 0.28 ; // and what is this one?
-//	rho = 1; // what is this ?
-//	Damp = 1; // how this one works?
-
-//	Youn = 210E9;
-//	nu = 0.28 ;
-//	rho = 7800;
-//	Damp = 1000;
-	
-	h1=Youn/((1+nu)*(1-nu));
-	h2=nu*h1;
-	G=Youn/(2*(1+nu));
-	ublas::matrix&lt;double&gt; H2;
-	H2.resize(3,3);
-	H2.clear();
-	H2(0,0)=h1;
-	H2(0,1)=h2;
-	H2(0,2)=0;
-	H2(1,0)=h2;
-	H2(1,1)=h1;
-	H2(1,2)=0;
-	H2(2,0)=0;
-	H2(2,1)=0;
-	H2(2,2)=G;
-	h1=(Youn*(1-nu))/((1+nu)*(1-2*nu));
-	h2=(Youn*nu)/((1+nu)*(1-2*nu));
-	h3=(Youn*0.5)/((1+nu));
-	ublas::matrix&lt;double&gt; H3;
-	H3.resize(6,6);
-	H3.clear();
-	for (int i=0 ; i&lt;3; ++i)
-		for (int j=0 ; j&lt;3; ++j)
-			H3(i,j)=h2;
-	for (int i=0 ; i&lt;3; ++i)
-	{	//for (int j=0 ; j&lt;2; ++j)
-		H3(i,i)=h1;
-		H3(i+3,i+3)=h3;
-	}
-	ublas::matrix&lt;double&gt; nialpha;
-	nialpha.resize(4,3);
-	nialpha.clear();
-	for (int i=0 ; i&lt;3; ++i)
-		nialpha(0,i)=-1;
-	nialpha(1,0)=1;
-	nialpha(2,1)=1;
-	nialpha(3,2)=1;
-	ublas::matrix&lt;double&gt; jac;
-	jac.resize(3,3);
-	jac.clear();
-	jac = prod(coord,nialpha);
-	double det  ;
-	det = jac(0,0) * jac(1,1) * jac(2,2) + jac(0,1) * jac(1,2) *jac(2,0) + jac(1,0) * jac(2,1) *jac(0,2) - jac(0,0) * jac(2,1) *jac(1,2) - jac(1,0) * jac(0,1) *jac(2,2) - jac(2,0) * jac(1,1) *jac(0,2);
-	double volume = det/6 ;
-	if (volume&lt;0)
-	{volume = -volume;}
-	ublas::matrix&lt;double&gt; invjac ;
-	invjac.resize( 3,3);
-	invjac.clear();
-	invjac(0,0) = 1/det * (jac(1,1) * jac(2,2) - jac(1,2) * jac(2,1) );
-	invjac(0,1) = -1/det * (jac(1,0) * jac(2,2) - jac(1,2) * jac(2,0) );
-	invjac(0,2) = 1/det * (jac(1,0) * jac(2,1) - jac(1,1) * jac(2,0) );
-	invjac(1,0) = -1/det * (jac(0,1) * jac(2,2) - jac(0,2) * jac(2,1) );
-	invjac(1,1) = 1/det * (jac(0,0) * jac(2,2) - jac(0,2) * jac(2,0) );
-	invjac(1,2) = -1/det * (jac(0,0) * jac(2,1) - jac(0,1) * jac(2,0) );
-	invjac(2,0) = 1/det * (jac(0,1) * jac(1,2) - jac(0,2) * jac(1,1) );
-	invjac(2,1) = -1/det * (jac(0,0) * jac(1,2) - jac(0,2) * jac(1,0) );
-	invjac(2,2) = 1/det * (jac(0,0) * jac(1,1) - jac(0,1) * jac(1,0) );
-	ublas::matrix&lt;double&gt; invJacT;
-	invJacT.resize( 3,3);
-	invJacT.clear();
-	for (int i = 0 ; i&lt;3 ; i++)
-		for (int j = 0 ; j&lt;3 ; j++)
-			invJacT(i,j) = invjac (j,i);
-//	ublas::matrix&lt;double&gt; toto ;
-//	toto.resize( 3,3);
-	ublas::matrix&lt;double&gt; resultinv ;
-	resultinv.resize( 3,3);
-	ublas::matrix&lt;double&gt; verifInv2 ;
-	verifInv2.resize( 3,3);
-	verifInv2 = prod (invJacT, jac);
-	for (int i = 0 ; i&lt;3 ; i++)
-		for (int j = 0 ; j&lt;3 ; j++)
-			resultinv(i,j) = verifInv2(i,j);//-toto(i,j);
-	ublas::matrix&lt;double&gt; nix;
-	nix.resize(  4,3);
-	nix.clear();
-	nix= prod (nialpha , invJacT);
-	ublas::matrix&lt;double&gt; be;
-	be.resize( 6,12);
-	be.clear();
-	for (int l = 0 ; l &lt; 4  ;l++)
-	{	be(0,l*3)=nix(l,0);
-		be(3,l*3)=nix(l,1);
-		be(4,l*3)=nix(l,2);
-		be(1,l*3+1)=nix(l,1);
-		be(3,l*3+1)=nix(l,0);
-		be(5,l*3+1)=nix(l,2);
-		be(2,l*3+2)=nix(l,2);
-		be(4,l*3+2)=nix(l,0);
-		be(5,l*3+2)=nix(l,1);
-	}
-	ublas::matrix&lt;double&gt; beTranspose;
-	beTranspose.resize( 12,6);
-	beTranspose.clear();
-	for (int i = 0 ; i&lt;12 ; i++)
-		for (int j = 0 ; j&lt;6 ; j++)
-		{beTranspose(i,j) = be (j,i);}
-	ublas::matrix&lt;double&gt; ke1;
-	ke1.resize( 12,12);
-	ke1.clear();
-	Ke_.resize( 12,12);
-	Ke_.clear();
-	ke1 = prod(H3, be);
-	Ke_ = volume * prod (beTranspose , ke1);
-	// Concentred mass
-	mass = rho * volume / 4 ;
-	// Concentred damping
-	damping = Damp * mass ;
-}
-

Deleted: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData/FEMTetrahedronData.hpp
===================================================================
--- branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData/FEMTetrahedronData.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData/FEMTetrahedronData.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,55 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LATTICEBEAMPARAMETERS_HPP
-#define LATTICEBEAMPARAMETERS_HPP
-
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-
-#include &lt;boost/numeric/ublas/matrix.hpp&gt;
-#include &lt;boost/numeric/ublas/vector.hpp&gt;
-
-#include &lt;vector&gt;
-
-using namespace boost::numeric;
-	
-// FIXME - remove Se3 - FEMTetrahedron DOES NOT need Se3 !
-	
-class FEMTetrahedronData : public PhysicalParameters
-{
-	private :
-		Real	 damping
-			,mass;
-
-		void localCalcKeMatrix( ublas::matrix&lt;Real&gt;&amp; nodesCoordinates );
-
-	public :
-		std::vector&lt;unsigned int&gt; 	ids; // FIXME - stupid serialization is not recognizing array: unsigned int ids[4]
-		ublas::matrix&lt;Real&gt;	Ke_; // FIXME - this is actually interaction property
-	
-		void calcKeMatrix(MetaBody* femBody);
-	
-		FEMTetrahedronData();
-		virtual ~FEMTetrahedronData();
-
-/// Serialization
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(FEMTetrahedronData);
-	REGISTER_BASE_CLASS_NAME(PhysicalParameters);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(FEMTetrahedronData,RigidBodyParameters);
-
-};
-
-REGISTER_SERIALIZABLE(FEMTetrahedronData,false);
-
-#endif // LATTICEBEAMPARAMETERS_HPP
-

Copied: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData.cpp (from rev 1105, branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData/FEMTetrahedronData.cpp)

Copied: branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData.hpp (from rev 1105, branches/scons-layout/pkg/fem/DataClass/PhysicalParameters/FEMTetrahedronData/FEMTetrahedronData.hpp)

Deleted: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons/FEMSet2Tetrahedrons.cpp
===================================================================
--- branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons/FEMSet2Tetrahedrons.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons/FEMSet2Tetrahedrons.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,45 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;FEMSet2Tetrahedrons.hpp&quot;
-
-#include &quot;FEMSetParameters.hpp&quot;
-#include &quot;FEMTetrahedronData.hpp&quot;
-
-
-#include&lt;yade/pkg-common/Tetrahedron.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-
-void FEMSet2Tetrahedrons::go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp; ph
-				, shared_ptr&lt;GeometricalModel&gt;&amp; 
-				, const Body* body)
-{
-	int tetrahedronGroupMask = YADE_CAST&lt;const FEMSetParameters*&gt;(ph.get())-&gt;tetrahedronGroupMask;
-	const MetaBody * cb = YADE_CAST&lt;const MetaBody*&gt;(body);
-	const shared_ptr&lt;BodyContainer&gt;&amp; bodies = cb-&gt;bodies;
-	
-// FIXME - this copying of data! 
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for(  ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		if(b-&gt;getGroupMask() &amp; tetrahedronGroupMask )
-		{
-			Tetrahedron* tet 		= YADE_CAST&lt;Tetrahedron*&gt;        (b-&gt;geometricalModel.get());
-			FEMTetrahedronData* tetData	= YADE_CAST&lt;FEMTetrahedronData*&gt; (b-&gt;physicalParameters.get());
-			
-			tet-&gt;v1 			= (*(cb-&gt;bodies))[tetData-&gt;ids[0]]-&gt;physicalParameters-&gt;se3.position;
-			tet-&gt;v2 			= (*(cb-&gt;bodies))[tetData-&gt;ids[1]]-&gt;physicalParameters-&gt;se3.position;
-			tet-&gt;v3 			= (*(cb-&gt;bodies))[tetData-&gt;ids[2]]-&gt;physicalParameters-&gt;se3.position;
-			tet-&gt;v4 			= (*(cb-&gt;bodies))[tetData-&gt;ids[3]]-&gt;physicalParameters-&gt;se3.position;
-		}
-	}
-}
-

Deleted: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons/FEMSet2Tetrahedrons.hpp
===================================================================
--- branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons/FEMSet2Tetrahedrons.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons/FEMSet2Tetrahedrons.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,28 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FEM_SET_2_TETRAHEDRONS_HPP
-#define FEM_SET_2_TETRAHEDRONS_HPP
-
-#include&lt;yade/pkg-common/GeometricalModelEngineUnit.hpp&gt;
-
-class FEMSet2Tetrahedrons : public GeometricalModelEngineUnit
-{
-	public :
-		void go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-				, shared_ptr&lt;GeometricalModel&gt;&amp;
-				, const Body*);
-	REGISTER_CLASS_NAME(FEMSet2Tetrahedrons);
-	REGISTER_BASE_CLASS_NAME(GeometricalModelEngineUnit);
-
-};
-
-REGISTER_SERIALIZABLE(FEMSet2Tetrahedrons,false);
-
-#endif // FEM_SET_2_TETRAHEDRONS_HPP 
-

Copied: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons.cpp (from rev 1105, branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons/FEMSet2Tetrahedrons.cpp)

Copied: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons.hpp (from rev 1105, branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSet2Tetrahedrons/FEMSet2Tetrahedrons.hpp)

Deleted: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader/FEMSetTextLoader.cpp
===================================================================
--- branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader/FEMSetTextLoader.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader/FEMSetTextLoader.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,136 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;FEMSetTextLoader.hpp&quot;
-#include &quot;FEMSetParameters.hpp&quot;
-#include &quot;FEMNodeData.hpp&quot;
-#include &quot;FEMTetrahedronData.hpp&quot;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/pkg-common/Tetrahedron.hpp&gt;
-#include &lt;boost/filesystem/convenience.hpp&gt;
-
-
-void FEMSetTextLoader::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(fileName);
-}
-
-void FEMSetTextLoader::go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp; par
-					, Body* body)
-
-{
-	MetaBody* rootBody = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;FEMSetParameters&gt; physics = YADE_PTR_CAST&lt;FEMSetParameters&gt;(par);
-	nodeGroupMask = physics-&gt;nodeGroupMask;
-	tetrahedronGroupMask = physics-&gt;tetrahedronGroupMask;
-
-///////// load file 
-	if(fileName.size() != 0 &amp;&amp; filesystem::exists(fileName) )
-	{
-		ifstream loadFile(fileName.c_str());
-		unsigned int nbNodes,nbTetrahedrons;
-		loadFile &gt;&gt; nbNodes;
-		loadFile &gt;&gt; nbTetrahedrons;
-		for(unsigned int i = 0 ; i&lt;nbNodes ; ++i)
-		{
-			Real x,y,z;
-			unsigned int id;
-			loadFile &gt;&gt; id &gt;&gt; x &gt;&gt; y &gt;&gt; z;
-//			cerr &lt;&lt; id &lt;&lt; &quot; \t&quot; &lt;&lt; x &lt;&lt; &quot; \t&quot; &lt;&lt; y &lt;&lt; &quot; \t&quot; &lt;&lt; z &lt;&lt; endl;
-			shared_ptr&lt;Body&gt; femNode;
-			createNode(femNode,Vector3r(x,y,z),id);
-			rootBody-&gt;bodies-&gt;insert(femNode);
-		}
-		for(unsigned int i = 0 ; i&lt;nbTetrahedrons ; ++i)
-		{
-			unsigned int id,id1,id2,id3,id4;
-			loadFile &gt;&gt; id &gt;&gt; id1 &gt;&gt; id2 &gt;&gt; id3 &gt;&gt; id4;
-			shared_ptr&lt;Body&gt; femTetrahedron;
-			createTetrahedron(rootBody,femTetrahedron,id,id1,id2,id3,id4);
-			rootBody-&gt;bodies-&gt;insert(femTetrahedron);
-		}
-	}
-	
-}
-
-
-
-void FEMSetTextLoader::createNode( shared_ptr&lt;Body&gt;&amp; body
-					, Vector3r position
-					, unsigned int id)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(id,nodeGroupMask));
-	shared_ptr&lt;FEMNodeData&gt; physics(new FEMNodeData);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1) , 0 );
-	
-	Real radius 			= 0.5;
-	
-	body-&gt;isDynamic			= true;
-//cerr &lt;&lt; position &lt;&lt; endl;	
-//	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;acceleration		= Vector3r(0,0,0);
-	physics-&gt;mass			= 1;
-//	physics-&gt;inertia		= Vector3r(1,1,1);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;initialPosition	= position;
-
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= Vector3r(0.9,0.9,0.3);
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void FEMSetTextLoader::createTetrahedron(  const MetaBody* rootBody
-						, shared_ptr&lt;Body&gt;&amp; body
-						, unsigned int id
-						, unsigned int id1
-						, unsigned int id2
-						, unsigned int id3
-						, unsigned int id4)
-{
-	
-	body = shared_ptr&lt;Body&gt;(new Body(id,tetrahedronGroupMask));
-	shared_ptr&lt;FEMTetrahedronData&gt; physics(new FEMTetrahedronData);
-	shared_ptr&lt;Tetrahedron&gt; gTet(new Tetrahedron);
-	
-	body-&gt;isDynamic			= false;
-	
-//	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-//	physics-&gt;velocity		= Vector3r(0,0,0);
-//	physics-&gt;mass			= 1; // FIXME
-//	physics-&gt;inertia		= Vector3r(1,1,1); // FIXME
-	physics-&gt;ids.clear();
-	physics-&gt;ids.push_back(id1);
-	physics-&gt;ids.push_back(id2);
-	physics-&gt;ids.push_back(id3);
-	physics-&gt;ids.push_back(id4);
-	// FIXME - remove Se3 - FEMTetrahedron DOES NOT need Se3 !
-	physics-&gt;se3 			= Se3r( Vector3r(0,0,0) , Quaternionr(0,0,0,0) );
-
-	gTet-&gt;diffuseColor		= Vector3r(1,1,1);
-	gTet-&gt;wire			= false;
-	gTet-&gt;visible			= true;
-	gTet-&gt;shadowCaster		= true;
-//	gTet-&gt;v1 			= (*(rootBody-&gt;bodies))[id1]-&gt;physicalParameters-&gt;se3.position;
-//	gTet-&gt;v2 			= (*(rootBody-&gt;bodies))[id2]-&gt;physicalParameters-&gt;se3.position;
-//	gTet-&gt;v3 			= (*(rootBody-&gt;bodies))[id3]-&gt;physicalParameters-&gt;se3.position;
-//	gTet-&gt;v4 			= (*(rootBody-&gt;bodies))[id4]-&gt;physicalParameters-&gt;se3.position;
-	
-	body-&gt;geometricalModel		= gTet;
-	body-&gt;physicalParameters	= physics;
-}
-

Deleted: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader/FEMSetTextLoader.hpp
===================================================================
--- branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader/FEMSetTextLoader.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader/FEMSetTextLoader.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,51 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FEM_SET_TEXT_LOADER_HPP
-#define FEM_SET_TEXT_LOADER_HPP
-
-#include&lt;yade/pkg-common/PhysicalParametersEngineUnit.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-class FEMSetTextLoader : public PhysicalParametersEngineUnit
-{
-	private :
-		int	 nodeGroupMask
-			,tetrahedronGroupMask;
-
-	public :
-		string fileName; 
-
-	public :
-		virtual void go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-					, Body*);
-	
-		void createNode(	  shared_ptr&lt;Body&gt;&amp; body
-					, Vector3r position
-					, unsigned int id);
-					
-		void createTetrahedron(   const MetaBody* rootBody
-					, shared_ptr&lt;Body&gt;&amp; body
-					, unsigned int id
-					, unsigned int id1
-					, unsigned int id2
-					, unsigned int id3
-					, unsigned int id4);
-
-	protected :
-		virtual void registerAttributes();	
-	REGISTER_CLASS_NAME(FEMSetTextLoader);
-	REGISTER_BASE_CLASS_NAME(PhysicalParametersEngineUnit);
-
-};
-
-REGISTER_SERIALIZABLE(FEMSetTextLoader,false);
-
-#endif // FEM_SET_TEXT_LOADER_HPP 
-

Copied: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader.cpp (from rev 1105, branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader/FEMSetTextLoader.cpp)

Copied: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader.hpp (from rev 1105, branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMSetTextLoader/FEMSetTextLoader.hpp)

Deleted: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness/FEMTetrahedronStiffness.cpp
===================================================================
--- branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness/FEMTetrahedronStiffness.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness/FEMTetrahedronStiffness.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;FEMTetrahedronStiffness.hpp&quot;
-#include &quot;FEMSetParameters.hpp&quot;
-#include &quot;FEMTetrahedronData.hpp&quot;
-
-
-
-// FIXME - uh, libnames FEMTetrahedronData and FEMTetrahedronStiffness are maybe wrong! it will be fixed, when whole tetrahedron-as-interaction mess will be cleaned up
-
-void FEMTetrahedronStiffness::go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp; par
-					, Body* body)
-
-{
-	MetaBody* rootBody = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;FEMSetParameters&gt; physics = YADE_PTR_CAST&lt;FEMSetParameters&gt;(par);
-	nodeGroupMask = physics-&gt;nodeGroupMask;
-	tetrahedronGroupMask = physics-&gt;tetrahedronGroupMask;
-	
-	BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-	BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-	for(  ; bi!=biEnd ; ++bi )
-	{
-	// FIXME - this loop should be somewhere in InteractionPhysicsMetaEngine
-		shared_ptr&lt;Body&gt; b = *bi;
-		if(b-&gt;getGroupMask() &amp; tetrahedronGroupMask)
-			YADE_CAST&lt;FEMTetrahedronData*&gt;( b-&gt;physicalParameters.get() )-&gt;calcKeMatrix(rootBody);
-		// FIXME - that should be done inside InteractionPhysicsEngineUnit
-	}
-	
-}

Deleted: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness/FEMTetrahedronStiffness.hpp
===================================================================
--- branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness/FEMTetrahedronStiffness.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness/FEMTetrahedronStiffness.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FEM_TETRAHEDRON_PARAMETERS_HPP
-#define FEM_TETRAHEDRON_PARAMETERS_HPP 
-
-// FIXME - this file should be located in: /plugins/Interaction/InteractionPhysicsEngineUnit/FEMParameters/FEMTetrahedronStiffness
-
-#include&lt;yade/pkg-common/PhysicalParametersEngineUnit.hpp&gt;
-
-class FEMTetrahedronStiffness : public PhysicalParametersEngineUnit
-{
-
-	private :
-		int	 nodeGroupMask
-			,tetrahedronGroupMask;
-
-	public :
-		virtual void go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-					, Body*);
-	
-	REGISTER_CLASS_NAME(FEMTetrahedronStiffness);
-	REGISTER_BASE_CLASS_NAME(PhysicalParametersEngineUnit);
-
-};
-
-REGISTER_SERIALIZABLE(FEMTetrahedronStiffness,false);
-
-#endif // FEM_TETRAHEDRON_PARAMETERS_HPP 
-

Copied: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness.cpp (from rev 1105, branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness/FEMTetrahedronStiffness.cpp)

Copied: branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness.hpp (from rev 1105, branches/scons-layout/pkg/fem/Engine/EngineUnit/FEMTetrahedronStiffness/FEMTetrahedronStiffness.hpp)

Deleted: branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw/FEMLaw.cpp
===================================================================
--- branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw/FEMLaw.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw/FEMLaw.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,90 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*  with help from Emmanuel Frangin                                       *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;FEMLaw.hpp&quot;
-#include &quot;FEMTetrahedronData.hpp&quot;
-#include &quot;FEMNodeData.hpp&quot;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include &lt;boost/numeric/ublas/matrix.hpp&gt;
-#include &lt;boost/numeric/ublas/vector.hpp&gt;
-#include &lt;boost/numeric/ublas/io.hpp&gt;
-
-using namespace boost::numeric;
-
-
-FEMLaw::FEMLaw() : InteractionSolver() , actionForce(new Force)
-{
-	nodeGroupMask = 1;
-	tetrahedronGroupMask = 2;
-}
-
-
-FEMLaw::~FEMLaw()
-{
-
-}
-
-
-void FEMLaw::registerAttributes()
-{
-	InteractionSolver::registerAttributes();
-	REGISTER_ATTRIBUTE(nodeGroupMask);
-	REGISTER_ATTRIBUTE(tetrahedronGroupMask);
-}
-
-
-void FEMLaw::action(Body* body)
-{
-	MetaBody * fem = static_cast&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = fem-&gt;bodies;
-	shared_ptr&lt;PhysicalActionContainer&gt;&amp; physicalActions = fem-&gt;physicalActions;
-	
-	ublas::matrix&lt;double&gt; Ue1 , fe;
-	Ue1.resize(12,1);
-	fe.resize(12,1);
-	
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for(  ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; body = *bi;
-		if( ! ( body-&gt;getGroupMask() &amp; tetrahedronGroupMask ) )
-			continue; // skip non-tetraherons
-		
-		FEMTetrahedronData* femTet = static_cast&lt;FEMTetrahedronData*&gt;(body-&gt;physicalParameters.get() );
-		
-		for ( int i = 0 ; i &lt; 4 ; ++i ) // loop over all tetrahedron nodes
-		{
-			FEMNodeData* femNode = static_cast&lt;FEMNodeData*&gt;( (*bodies)[femTet-&gt;ids[i]]-&gt;physicalParameters.get() );
-			
-			Vector3r displacement = femNode-&gt;se3.position - femNode-&gt;initialPosition;
-			
-			Ue1( i*3    , 0 ) = displacement[0]; // x displacement of node
-			Ue1( i*3 + 1, 0 ) = displacement[1]; // y displacement of node
-			Ue1( i*3 + 2, 0 ) = displacement[2]; // z displacement of node
-		}
-		
-		fe = - prod( femTet-&gt;Ke_ , Ue1 ); // solve this tetrahedron
-		
-		for ( int i = 0 ; i &lt; 4 ; ++i ) // loop again over all tetrahedron nodes
-		{
-			Vector3r force = Vector3r(	  fe( i*3     , 0 )
-							, fe( i*3 + 1 , 0 )
-							, fe( i*3 + 2 , 0 ));
-			
-			static_cast&lt;Force*&gt;( physicalActions
-				-&gt;find( femTet-&gt;ids[i] , actionForce -&gt;getClassIndex() ).get() )
-					-&gt;force  += force;
-					
-		}
-	}
-}
-
-
-

Deleted: branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw/FEMLaw.hpp
===================================================================
--- branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw/FEMLaw.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw/FEMLaw.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,44 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FEMLAW_HPP
-#define FEMLAW_HPP
-
-#include&lt;yade/core/InteractionSolver.hpp&gt;
-
-class PhysicalAction;
-
-class FEMLaw : public InteractionSolver
-{
-/// Attributes
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-	public :
-		int	 nodeGroupMask
-			,tetrahedronGroupMask;
-
-		FEMLaw();
-		virtual ~FEMLaw();
-
-/// Methods
-		void action(Body* body);
-
-/// Serializtion
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(FEMLaw);
-	REGISTER_BASE_CLASS_NAME(InteractionSolver);
-
-
-};
-
-REGISTER_SERIALIZABLE(FEMLaw,false);
-
-#endif // FEMLAW_HPP
-
-

Copied: branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw.cpp (from rev 1105, branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw/FEMLaw.cpp)

Copied: branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw.hpp (from rev 1105, branches/scons-layout/pkg/fem/Engine/StandAloneEngine/FEMLaw/FEMLaw.hpp)

Deleted: branches/scons-layout/pkg/fem/PreProcessor/FEMBeam/FEMBeam.cpp
===================================================================
--- branches/scons-layout/pkg/fem/PreProcessor/FEMBeam/FEMBeam.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/PreProcessor/FEMBeam/FEMBeam.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,256 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*  with help from Emmanuel Frangin                                       *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;FEMBeam.hpp&quot;
-
-#include &quot;FEMSetParameters.hpp&quot;
-#include &quot;FEMTetrahedronData.hpp&quot;
-#include &quot;FEMNodeData.hpp&quot;
-#include &quot;FEMTetrahedronStiffness.hpp&quot;
-#include &quot;FEMLaw.hpp&quot;
-#include &quot;FEMSetTextLoader.hpp&quot;
-
-
-// data
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/pkg-common/Tetrahedron.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-
-// engines
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-#include&lt;yade/pkg-common/TranslationEngine.hpp&gt;
-
-// body
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-
-// dispatchers
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionPhysicsMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/GeometricalModelMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-
-#include &lt;boost/filesystem/convenience.hpp&gt;
-
-
-
-using namespace boost;
-using namespace std;
-
-
-FEMBeam::FEMBeam () : FileGenerator()
-{
-	gravity 		= Vector3r(0,-9.81,0);
-	femTxtFile 		= &quot;../data/fem.beam&quot;;
-	nodeGroupMask 		= 1;
-	tetrahedronGroupMask 	= 2;
-
-	regionMin1 		= Vector3r(9,-20,-20);
-	regionMax1 		= Vector3r(10,20,20);
-	translationAxis1 	= Vector3r(1,0,0);
-	velocity1 		= 0;
-	
-	regionMin2 		= Vector3r(-8,-2,6);
-	regionMax2 		= Vector3r(-8,0,20);
-	translationAxis2 	= Vector3r(-1,0,0); 
-	velocity2 		= 0.0;
-
-/*	
-	regionMin1 		= Vector3r(9,0,-20);
-	regionMax1 		= Vector3r(10,20,20);
-	translationAxis1 	= Vector3r(1,0,0);
-	velocity1 		= 0.5;
-	
-	regionMin2 		= Vector3r(-11,-2,6);
-	regionMax2 		= Vector3r(-8,0,20);
-	translationAxis2 	= Vector3r(-1,0,0);
-	velocity2 		= 0.0;
-*/		
-}
-
-
-FEMBeam::~FEMBeam ()
-{ 
-}
-
-
-void FEMBeam::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	REGISTER_ATTRIBUTE(femTxtFile);
-	REGISTER_ATTRIBUTE(gravity);
-	
-	REGISTER_ATTRIBUTE(regionMin1);
-	REGISTER_ATTRIBUTE(regionMax1);
-	REGISTER_ATTRIBUTE(translationAxis1);
-	REGISTER_ATTRIBUTE(velocity1);
-	
-	REGISTER_ATTRIBUTE(regionMin2);
-	REGISTER_ATTRIBUTE(regionMax2);
-	REGISTER_ATTRIBUTE(translationAxis2);
-	REGISTER_ATTRIBUTE(velocity2);
-}
-
-
-string FEMBeam::generate()
-{
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-	positionRootBody(rootBody);
-	
-	
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-	
-	
-	
-	createActors(rootBody);
-	imposeTranslation(rootBody,regionMin1,regionMax1,translationAxis1,velocity1);
-	imposeTranslation(rootBody,regionMin2,regionMax2,translationAxis2,velocity2);
-
-	return &quot;\nNOTE: if it explodes, set smaller time step.&quot;;
-}
-
-
-void FEMBeam::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-
-	shared_ptr&lt;FEMSetTextLoader&gt; femSetTextLoaderFunctor	= shared_ptr&lt;FEMSetTextLoader&gt;(new FEMSetTextLoader);
-	femSetTextLoaderFunctor-&gt;fileName = femTxtFile;
-
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; bodyPhysicalParametersDispatcher(new PhysicalParametersMetaEngine);
-	bodyPhysicalParametersDispatcher-&gt;add(&quot;FEMSetParameters&quot;,&quot;FEMTetrahedronStiffness&quot;);
-	
-	shared_ptr&lt;GeometricalModelMetaEngine&gt; geometricalModelDispatcher	= shared_ptr&lt;GeometricalModelMetaEngine&gt;(new GeometricalModelMetaEngine);
-	geometricalModelDispatcher-&gt;add(&quot;FEMSetParameters&quot;,&quot;FEMSetGeometry&quot;,&quot;FEMSet2Tetrahedrons&quot;);
-	
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-	
-	shared_ptr&lt;FEMLaw&gt; femLaw(new FEMLaw);
-	femLaw-&gt;nodeGroupMask = nodeGroupMask;
-	femLaw-&gt;tetrahedronGroupMask = tetrahedronGroupMask;
-
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;); // FIXME - should be unnecessery, but BUG in PhysicalActionVectorVector
-	
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);
-	rootBody-&gt;engines.push_back(geometricalModelDispatcher);
-	rootBody-&gt;engines.push_back(femLaw);
-	rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-	
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(bodyPhysicalParametersDispatcher);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-	rootBody-&gt;initializers.push_back(geometricalModelDispatcher);
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	
-	femSetTextLoaderFunctor-&gt;go(rootBody-&gt;physicalParameters,rootBody.get()); // load FEM from file.
-
-// will not run - function is protected.
-//	rootBody-&gt;postProcessAttributes(true); // we don't want to save 'nan' as tetrahedrons' coordinates
-// so call is by hand...
-
-	geometricalModelDispatcher-&gt;action(rootBody.get() );
-
-}
-
-
-void FEMBeam::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody) 
-{
-	rootBody-&gt;isDynamic			= false;
-
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	shared_ptr&lt;FEMSetParameters&gt; physics(new FEMSetParameters);
-	physics-&gt;se3				= Se3r(Vector3r(0,0,0),q);
-	physics-&gt;nodeGroupMask 			= nodeGroupMask;
-	physics-&gt;tetrahedronGroupMask 		= tetrahedronGroupMask;
-	
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	
-	set-&gt;diffuseColor			= Vector3r(0,0,1);
-
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor			= Vector3r(0,0,1);
-
-	shared_ptr&lt;GeometricalModel&gt; gm 	= YADE_PTR_CAST&lt;GeometricalModel&gt;(ClassFactory::instance().createShared(&quot;FEMSetGeometry&quot;));
-	gm-&gt;diffuseColor 			= Vector3r(1,1,1);
-	gm-&gt;wire 				= false;
-	gm-&gt;visible 				= true;
-	gm-&gt;shadowCaster 			= true;
-	
-	rootBody-&gt;interactingGeometry 		= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume		= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;geometricalModel 		= gm;
-	rootBody-&gt;physicalParameters 		= physics;
-}
-
- 
-void FEMBeam::imposeTranslation(shared_ptr&lt;MetaBody&gt;&amp; rootBody, Vector3r min, Vector3r max, Vector3r direction, Real velocity)
-{
-	shared_ptr&lt;TranslationEngine&gt; translationCondition = shared_ptr&lt;TranslationEngine&gt;(new TranslationEngine);
- 	translationCondition-&gt;velocity  = velocity;
-	direction.Normalize();
- 	translationCondition-&gt;translationAxis = direction;
-	
-	rootBody-&gt;engines.push_back(translationCondition);
-	translationCondition-&gt;subscribedBodies.clear();
-	BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-	BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-	for(  ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		if( b-&gt;getGroupMask() &amp; nodeGroupMask )
-		{
-			Vector3r pos = b-&gt;physicalParameters-&gt;se3.position;
-			if(        pos[0] &gt; min[0] 
-				&amp;&amp; pos[1] &gt; min[1] 
-				&amp;&amp; pos[2] &gt; min[2] 
-				&amp;&amp; pos[0] &lt; max[0] 
-				&amp;&amp; pos[1] &lt; max[1] 
-				&amp;&amp; pos[2] &lt; max[2] )
-			{
-				b-&gt;isDynamic = false;
-				b-&gt;geometricalModel-&gt;diffuseColor = Vector3r(1,0,0);
-				translationCondition-&gt;subscribedBodies.push_back(b-&gt;getId());
-			}
-		}
-	}
-}
-
- 

Deleted: branches/scons-layout/pkg/fem/PreProcessor/FEMBeam/FEMBeam.hpp
===================================================================
--- branches/scons-layout/pkg/fem/PreProcessor/FEMBeam/FEMBeam.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/PreProcessor/FEMBeam/FEMBeam.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,60 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FEM_BEAM_HPP
-#define FEM_BEAM_HPP 
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-
-#include &lt;string&gt;
-
-class FEMBeam : public FileGenerator
-{
-	private :
-		
-		std::string	 femTxtFile;
-
-		int		 nodeGroupMask
-				,tetrahedronGroupMask;
-		
-		Vector3r	 gravity
-				,regionMin1
-				,regionMax1
-				,translationAxis1
-				,regionMin2
-				,regionMax2
-				,translationAxis2;
-
-		Real		 velocity2
-				,velocity1;
-
-//	private : Real dampingForce;
-//	private : Real dampingMomentum;
-
-// construction
-	public :
-		FEMBeam ();
-		~FEMBeam ();
-		string generate();
-
-	private :
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void imposeTranslation(shared_ptr&lt;MetaBody&gt;&amp; rootBody, Vector3r min, Vector3r max, Vector3r direction, Real velocity);
-
-	protected :
-		void registerAttributes();
-
-	REGISTER_CLASS_NAME(FEMBeam);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-};
-
-REGISTER_SERIALIZABLE(FEMBeam,false);
-
-#endif // SDEC_SPHERES_PLANE_HPP 
-

Copied: branches/scons-layout/pkg/fem/PreProcessor/FEMBeam.cpp (from rev 1105, branches/scons-layout/pkg/fem/PreProcessor/FEMBeam/FEMBeam.cpp)

Copied: branches/scons-layout/pkg/fem/PreProcessor/FEMBeam.hpp (from rev 1105, branches/scons-layout/pkg/fem/PreProcessor/FEMBeam/FEMBeam.hpp)

Modified: branches/scons-layout/pkg/fem/SConscript
===================================================================
--- branches/scons-layout/pkg/fem/SConscript	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/fem/SConscript	2007-03-07 14:13:16 UTC (rev 1107)
@@ -2,12 +2,12 @@
 env.Install('$PREFIX/lib/yade$POSTFIX/pkg-fem',[
 
 	env.SharedLibrary('FEMSetGeometry',
-		['DataClass/GeometricalModel/FEMSetGeometry/FEMSetGeometry.cpp'],
+		['DataClass/GeometricalModel/FEMSetGeometry.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['DataClass/GeometricalModel/FEMSetGeometry', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['DataClass/GeometricalModel', '$PREFIX/include']),
 
 	env.SharedLibrary('FEMNodeData',
-		['DataClass/PhysicalParameters/FEMNodeData/FEMNodeData.cpp'],
+		['DataClass/PhysicalParameters/FEMNodeData.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'ParticleParameters',
@@ -16,10 +16,10 @@
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/PhysicalParameters/FEMNodeData']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('FEMSetParameters',
-		['DataClass/PhysicalParameters/FEMSetParameters/FEMSetParameters.cpp'],
+		['DataClass/PhysicalParameters/FEMSetParameters.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'AABB',
@@ -27,10 +27,10 @@
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/FEMSetParameters', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters', '$PREFIX/include']),
 
 	env.SharedLibrary('FEMTetrahedronData',
-		['DataClass/PhysicalParameters/FEMTetrahedronData/FEMTetrahedronData.cpp'],
+		['DataClass/PhysicalParameters/FEMTetrahedronData.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'FEMNodeData',
@@ -41,11 +41,11 @@
 			'Wm3Foundation',
 			'yade-multimethods'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/PhysicalParameters/FEMNodeData',
-			'DataClass/PhysicalParameters/FEMTetrahedronData']),
+			'DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('FEMSet2Tetrahedrons',
-		['Engine/EngineUnit/FEMSet2Tetrahedrons/FEMSet2Tetrahedrons.cpp'],
+		['Engine/EngineUnit/FEMSet2Tetrahedrons.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'FEMSetParameters',
@@ -53,13 +53,13 @@
 			'ParticleParameters',
 			'GeometricalModelMetaEngine',
 			'Tetrahedron'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/FEMSetParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'Engine/EngineUnit/FEMSet2Tetrahedrons',
-			'DataClass/PhysicalParameters/FEMTetrahedronData']),
+			'Engine/EngineUnit',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('FEMSetTextLoader',
-		['Engine/EngineUnit/FEMSetTextLoader/FEMSetTextLoader.cpp'],
+		['Engine/EngineUnit/FEMSetTextLoader.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'FEMSetParameters',
@@ -69,39 +69,39 @@
 			'RigidBodyParameters',
 			'Sphere',
 			'Tetrahedron'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/FEMSetParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'Engine/EngineUnit/FEMSetTextLoader',
-			'DataClass/PhysicalParameters/FEMNodeData',
-			'DataClass/PhysicalParameters/FEMTetrahedronData']),
+			'Engine/EngineUnit',
+			'DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('FEMTetrahedronStiffness',
-		['Engine/EngineUnit/FEMTetrahedronStiffness/FEMTetrahedronStiffness.cpp'],
+		['Engine/EngineUnit/FEMTetrahedronStiffness.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'FEMSetParameters',
 			'FEMTetrahedronData',
 			'PhysicalParametersMetaEngine',
 			'ParticleParameters'],
-		CPPPATH=env['CPPPATH']+['Engine/EngineUnit/FEMTetrahedronStiffness',
+		CPPPATH=env['CPPPATH']+['Engine/EngineUnit',
 			'$PREFIX/include',
-			'DataClass/PhysicalParameters/FEMTetrahedronData',
-			'DataClass/PhysicalParameters/FEMSetParameters']),
+			'DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('FEMLaw',
-		['Engine/StandAloneEngine/FEMLaw/FEMLaw.cpp'],
+		['Engine/StandAloneEngine/FEMLaw.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'FEMTetrahedronData',
 			'Force',
 			'ParticleParameters'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/PhysicalParameters/FEMNodeData',
-			'Engine/StandAloneEngine/FEMLaw',
-			'DataClass/PhysicalParameters/FEMTetrahedronData']),
+			'DataClass/PhysicalParameters',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('FEMBeam',
-		['PreProcessor/FEMBeam/FEMBeam.cpp'],
+		['PreProcessor/FEMBeam.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'FEMTetrahedronData',
@@ -134,13 +134,13 @@
 			'Tetrahedron',
 			'TranslationEngine',
 			'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/FEMSetParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'DataClass/PhysicalParameters/FEMNodeData',
-			'Engine/StandAloneEngine/FEMLaw',
-			'DataClass/PhysicalParameters/FEMTetrahedronData',
-			'Engine/EngineUnit/FEMTetrahedronStiffness',
-			'Engine/EngineUnit/FEMSetTextLoader',
-			'PreProcessor/FEMBeam'])
+			'DataClass/PhysicalParameters',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'Engine/EngineUnit',
+			'Engine/EngineUnit',
+			'PreProcessor'])
 ])
 

Deleted: branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry/LatticeSetGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry/LatticeSetGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry/LatticeSetGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,23 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LatticeSetGeometry.hpp&quot;
-
-
-LatticeSetGeometry::LatticeSetGeometry() : GeometricalModel()
-{
-	createIndex();
-}
-
-
-LatticeSetGeometry::~LatticeSetGeometry()
-{
-
-}
-
-

Deleted: branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry/LatticeSetGeometry.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry/LatticeSetGeometry.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry/LatticeSetGeometry.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,31 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LATTICE_SET_GEOMETRY_HPP
-#define LATTICE_SET_GEOMETRY_HPP 
-
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-
-class LatticeSetGeometry : public GeometricalModel
-{
-	public :
-		LatticeSetGeometry();
-		virtual ~LatticeSetGeometry ();
-	
-/// Serialization
-	REGISTER_CLASS_NAME(LatticeSetGeometry);
-	REGISTER_BASE_CLASS_NAME(GeometricalModel);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(LatticeSetGeometry,GeometricalModel);
-};
-
-REGISTER_SERIALIZABLE(LatticeSetGeometry,false);
-
-#endif // __LATTICESETGEOMETRY_HPP__
-

Copied: branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry.cpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry/LatticeSetGeometry.cpp)

Copied: branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry.hpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LatticeSetGeometry/LatticeSetGeometry.hpp)

Deleted: branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment/LineSegment.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment/LineSegment.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment/LineSegment.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,25 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LineSegment.hpp&quot;
-
-LineSegment::LineSegment () : GeometricalModel()
-{		
-	createIndex();
-}
-
-LineSegment::~LineSegment ()
-{		
-}
-
-void LineSegment::registerAttributes()
-{
-	GeometricalModel::registerAttributes();
-//	REGISTER_ATTRIBUTE(length); // no need to save it
-}
-

Deleted: branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment/LineSegment.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment/LineSegment.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment/LineSegment.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LINE_SEGMENT_HPP
-#define LINE_SEGMENT_HPP
-
-
-#include&lt;yade/core/GeometricalModel.hpp&gt;
-
-
-class LineSegment : public GeometricalModel
-{
-	public :
-		Real length;
-		LineSegment ();
-		virtual ~LineSegment ();
-	
-/// Serialization
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(LineSegment);
-	REGISTER_BASE_CLASS_NAME(GeometricalModel);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(LineSegment,GeometricalModel);
-
-};
-
-REGISTER_SERIALIZABLE(LineSegment,false);
-
-#endif // LINE_SEGMENT_HPP
-

Copied: branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment.cpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment/LineSegment.cpp)

Copied: branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment.hpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/GeometricalModel/LineSegment/LineSegment.hpp)

Deleted: branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,21 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2007 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LatticeInteractingGeometry.hpp&quot;
-
-
-LatticeInteractingGeometry::LatticeInteractingGeometry () : MetaInteractingGeometry()
-{
-	createIndex();
-}
-
-LatticeInteractingGeometry::~LatticeInteractingGeometry ()
-{
-}
-
-

Deleted: branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,31 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2007 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LATTICE_INTERACTINGGEOMETRY_HPP
-#define LATTICE_INTERACTINGGEOMETRY_HPP
-
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-
-class LatticeInteractingGeometry : public MetaInteractingGeometry
-{
-	public :
-		LatticeInteractingGeometry ();
-		virtual ~LatticeInteractingGeometry ();
-
-/// Serialization
-	REGISTER_CLASS_NAME(LatticeInteractingGeometry);
-	REGISTER_BASE_CLASS_NAME(MetaInteractingGeometry);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(LatticeInteractingGeometry,MetaInteractingGeometry);
-};
-
-REGISTER_SERIALIZABLE(LatticeInteractingGeometry,false);
-
-#endif // METAINTERACTINGGEOMETRY_HPP
-

Copied: branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry.cpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.cpp)

Copied: branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry.hpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.hpp)

Deleted: branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring/LatticeBeamAngularSpring.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring/LatticeBeamAngularSpring.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring/LatticeBeamAngularSpring.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,51 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LatticeBeamAngularSpring.hpp&quot;
-
-
-LatticeBeamAngularSpring::LatticeBeamAngularSpring() : InteractionPhysics()
-{
-
-	initialPlaneAngle	= 0;
-//	planeAngle		= 0;
-	lastCrossProduct	= Vector3r(0,0,0); // stupid value, zero is useless...
-	initialOffPlaneAngle1	= 0;
-	initialOffPlaneAngle2	= 0;
-	lastOffPlaneAngleDifference1	= 0;
-	lastOffPlaneAngleDifference2	= 0;
-	swirl1			= 0;
-	swirl2			= 0;
-//	offPlaneAngle		= 0;
-	planeSwap180		= false;
-
-	createIndex();
-}
-
-
-LatticeBeamAngularSpring::~LatticeBeamAngularSpring()
-{
-
-}
-
-void LatticeBeamAngularSpring::registerAttributes()
-{
-	InteractionPhysics::registerAttributes();
-	REGISTER_ATTRIBUTE(initialPlaneAngle);
-//	REGISTER_ATTRIBUTE(planeAngle); // FIXME - can be calculated after deserialization
-	REGISTER_ATTRIBUTE(lastCrossProduct);
-	REGISTER_ATTRIBUTE(planeSwap180);
-	REGISTER_ATTRIBUTE(initialOffPlaneAngle1);
-	REGISTER_ATTRIBUTE(initialOffPlaneAngle2);
-	REGISTER_ATTRIBUTE(lastOffPlaneAngleDifference1);
-	REGISTER_ATTRIBUTE(lastOffPlaneAngleDifference2);
-	REGISTER_ATTRIBUTE(swirl1);
-	REGISTER_ATTRIBUTE(swirl2);
-//	REGISTER_ATTRIBUTE(offPlaneAngle); // FIXME - can be calculated after deserialization
-}
-

Deleted: branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring/LatticeBeamAngularSpring.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring/LatticeBeamAngularSpring.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring/LatticeBeamAngularSpring.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,48 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LATTICEBEAMANGULARSPRING_HPP
-#define LATTICEBEAMANGULARSPRING_HPP
-
-#include&lt;yade/core/InteractionPhysics.hpp&gt;
-#include &lt;vector&gt;
-
-class LatticeBeamAngularSpring : public InteractionPhysics
-{
-	public :
-		Vector3r		 lastCrossProduct;
-		bool			 planeSwap180;
-		Real			 initialPlaneAngle  // 2D only for now
-			 		//,planeAngle
-					,initialOffPlaneAngle1
-					,initialOffPlaneAngle2
-					,lastOffPlaneAngleDifference1
-					,lastOffPlaneAngleDifference2
-					//,offPlaneAngle
-					;
-		int			 swirl1
-					,swirl2;
-		
-		LatticeBeamAngularSpring();
-		virtual ~LatticeBeamAngularSpring();
-
-/// Serialization
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(LatticeBeamAngularSpring);
-	REGISTER_BASE_CLASS_NAME(InteractionPhysics);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(LatticeBeamAngularSpring,InteractionPhysics);
-
-};
-
-REGISTER_SERIALIZABLE(LatticeBeamAngularSpring,false);
-
-#endif //  LATTICEBEAMANGULARSPRING_HPP
-

Copied: branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring.cpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring/LatticeBeamAngularSpring.cpp)

Copied: branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring.hpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/LatticeBeamAngularSpring/LatticeBeamAngularSpring.hpp)

Deleted: branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency/NonLocalDependency.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency/NonLocalDependency.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency/NonLocalDependency.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,28 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;NonLocalDependency.hpp&quot;
-
-
-NonLocalDependency::NonLocalDependency() : InteractionPhysics()
-{
-	createIndex();
-}
-
-
-NonLocalDependency::~NonLocalDependency()
-{
-
-}
-
-void NonLocalDependency::registerAttributes()
-{
-	InteractionPhysics::registerAttributes();
-	REGISTER_ATTRIBUTE(gaussValue);
-}
-

Deleted: branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency/NonLocalDependency.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency/NonLocalDependency.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency/NonLocalDependency.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef NONLOCALDEPENDENCY_HPP
-#define NONLOCALDEPENDENCY_HPP
-
-#include&lt;yade/core/InteractionPhysics.hpp&gt;
-#include &lt;vector&gt;
-
-class NonLocalDependency : public InteractionPhysics
-{
-	public :
-		Real			gaussValue;
-		
-		NonLocalDependency();
-		virtual ~NonLocalDependency();
-
-/// Serialization
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(NonLocalDependency);
-	REGISTER_BASE_CLASS_NAME(InteractionPhysics);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(NonLocalDependency,InteractionPhysics);
-
-};
-
-REGISTER_SERIALIZABLE(NonLocalDependency,false);
-
-#endif //  LATTICEBEAMANGULARSPRING_HPP
-

Copied: branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency.cpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency/NonLocalDependency.cpp)

Copied: branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency.hpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/InteractionPhysics/NonLocalDependency/NonLocalDependency.hpp)

Deleted: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters/LatticeBeamParameters.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters/LatticeBeamParameters.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters/LatticeBeamParameters.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,158 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LatticeBeamParameters.hpp&quot;
-#include&lt;yade/core/Omega.hpp&gt;
-
-LatticeBeamParameters::LatticeBeamParameters() : PhysicalParameters()
-{
-	createIndex();
-	count = 0.0;
-	bendingRotation = Quaternionr(1.0,0.0,0.0,0.0);
-	torsionalRotation = Quaternionr(1.0,0.0,0.0,0.0);
-	torsionAngle = 0;
-	torsionalStiffness = 0.6;
-	lastIter_ = -1;
-}
-
-
-LatticeBeamParameters::~LatticeBeamParameters()
-{
-
-}
-
-void LatticeBeamParameters::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-
-	//	torsionalStiffness /= 10.0;
-
-	//	static bool first=true;
-	//	if(first)
-	//		std::cerr &lt;&lt; &quot;using dt for k.b\n&quot;, first=false;
-	//	bendingStiffness    = Omega::instance().getTimeStep();
-
-//		bendingStiffness		/= 10.0;
-//		longitudalStiffness		/= 10.0;
-//		criticalTensileStrain		*= 10.0;
-
-
-/*		if(criticalTensileStrain &gt; 0.00015) // E.l
-		{ // CEMENT MATRIX
-			longitudalStiffness       = 1.0;	// k.l
-			bendingStiffness          = 0.7;	// k.b
-			criticalCompressiveStrain = 1.0;	// E.c
-			criticalTensileStrain     = 0.0002;	// E.l
-		}
-		else if(criticalTensileStrain &gt; 0.00006) // E.l
-		{ // AGGREGATE
-			longitudalStiffness       = 3.0;	// k.l
-			bendingStiffness          = 2.1;	// k.b
-			criticalCompressiveStrain = 1.0;	// E.c
-			criticalTensileStrain     = 0.0001333;	// E.l
-		}
-		else
-		{ // BOND / INTERFACE
-			longitudalStiffness       = 1.0;	// k.l
-			bendingStiffness          = 0.7;	// k.b
-			criticalCompressiveStrain = 1.0;	// E.c
-			criticalTensileStrain     = 0.0002;	// E.l
-		}
-*/		lastIter_ = -10;
-
-
-// checking
-
-#define chk(x,y) std::cout &lt;&lt; #y &lt;&lt; &quot;,      &quot; &lt;&lt; x &lt;&lt; &quot; = &quot; &lt;&lt; y &lt;&lt; &quot;\n&quot;
-		if(criticalTensileStrain &gt; 0.00015) // E.l
-		{ // CEMENT MATRIX
-			static int cement=0;	++cement;
-			static bool d1=true;
-			if(d1)
-			{
-				d1=false;
-				std::cout &lt;&lt; &quot;\nCEMENT:\n&quot;;
-				chk(&quot;\tk.l&quot;,longitudalStiffness);               // k.l
-				chk(&quot;\t\tk.b&quot;,bendingStiffness);                // k.b
-				chk(&quot;\tk.t&quot;,torsionalStiffness);              // k.t
-				chk(&quot;E.c&quot;,criticalCompressiveStrain);           // E.c
-				chk(&quot;\tE.l&quot;,criticalTensileStrain);             // E.l
-			}
-		}
-		else if(criticalTensileStrain &gt; 0.00006) // E.l
-		{ // AGGREGATE
-			static int aggregate=0; ++aggregate;
-			static bool d2=true;
-			if(d2)
-			{
-				d2=false;
-				std::cout &lt;&lt; &quot;\nAGGREGATE:\n&quot;;
-				chk(&quot;\tk.l&quot;,longitudalStiffness);               // k.l
-				chk(&quot;\t\tk.b&quot;,bendingStiffness);                // k.b
-				chk(&quot;\tk.t&quot;,torsionalStiffness);              // k.t
-				chk(&quot;E.c&quot;,criticalCompressiveStrain);           // E.c
-				chk(&quot;\tE.l&quot;,criticalTensileStrain);             // E.l
-			}
-		}
-		else
-		{ // BOND / INTERFACE
-			static int bond=0; ++bond;
-			static bool d3=true;
-			if(d3)
-			{
-				d3=false;
-				std::cout &lt;&lt; &quot;\nBOND:\n&quot;;
-				chk(&quot;\tk.l&quot;,longitudalStiffness);               // k.l
-				chk(&quot;\t\tk.b&quot;,bendingStiffness);                // k.b
-				chk(&quot;\tk.t&quot;,torsionalStiffness);              // k.t
-				chk(&quot;E.c&quot;,criticalCompressiveStrain);           // E.c
-				chk(&quot;\tE.l&quot;,criticalTensileStrain);             // E.l
-			}
-		}
-#undef chk
-
-        }
-}
-
-
-Real LatticeBeamParameters::strain()
-{
-        long int it = Omega::instance().getCurrentIteration();
-        if( lastIter_ == it )
-                return strain_;
-        else
-        {
-                lastIter_ = it;
-                strain_ = (length - initialLength) / initialLength;
-                return strain_;
-        }
-}
-
-void LatticeBeamParameters::registerAttributes()
-{
-	PhysicalParameters::registerAttributes();
-	REGISTER_ATTRIBUTE(id1);
-	REGISTER_ATTRIBUTE(id2);
-	
-	REGISTER_ATTRIBUTE(initialLength);
-	REGISTER_ATTRIBUTE(length); // FIXME - can be calculated after deserialization
-	
-	REGISTER_ATTRIBUTE(direction); // FIXME - can be calculated after deserialization
-	REGISTER_ATTRIBUTE(otherDirection); // this must be saved!
-	
-	REGISTER_ATTRIBUTE(criticalTensileStrain);
-	REGISTER_ATTRIBUTE(criticalCompressiveStrain);
-
-	REGISTER_ATTRIBUTE(longitudalStiffness);
-	REGISTER_ATTRIBUTE(bendingStiffness);
-	REGISTER_ATTRIBUTE(torsionalStiffness);
-
-	REGISTER_ATTRIBUTE(se3Displacement);
-}
-

Deleted: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters/LatticeBeamParameters.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters/LatticeBeamParameters.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters/LatticeBeamParameters.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,72 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LATTICE_BEAM_PARAMETERS_HPP
-#define LATTICE_BEAM_PARAMETERS_HPP 
-
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include &lt;vector&gt;
-
-class LatticeBeamParameters : public PhysicalParameters 
-{
-	private:
-		long int                 lastIter_;
-		Real                     strain_;
-	public :
-		// element
-		unsigned int             id1
-					,id2;
-		// state		
-		Real  			 initialLength
-					,length;
-
-		Vector3r                 direction		// is a unit vector
-					,otherDirection;	// is a unit vector too
-
-		Se3r                     se3Displacement;
-
-		// parameters
-		Real                     criticalTensileStrain
-					,criticalCompressiveStrain
-	
-					,longitudalStiffness
-					,bendingStiffness
-					,torsionalStiffness;
-
-
-		// where does it belong, what is it?
-		// a PhysicalAction !
-		Real 			 count
-					,torsionAngle;
-		Quaternionr		 bendingRotation
-					,torsionalRotation;
-
-		Real strain();
-		// must go to derived class
-		//Real                     nonLocalStrain
-		//                        ,nonLocalDivisor;
-
-		LatticeBeamParameters();
-		virtual ~LatticeBeamParameters();
-
-/// Serialization
-	protected :
-		virtual void postProcessAttributes(bool);
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(LatticeBeamParameters);
-	REGISTER_BASE_CLASS_NAME(PhysicalParameters);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(LatticeBeamParameters,PhysicalParameters);
-
-};
-
-REGISTER_SERIALIZABLE(LatticeBeamParameters,false);
-
-#endif // LATTICE_BEAM_PARAMETERS_HPP 
-

Copied: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters.cpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters/LatticeBeamParameters.cpp)

Copied: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters.hpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeBeamParameters/LatticeBeamParameters.hpp)

Deleted: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters/LatticeNodeParameters.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters/LatticeNodeParameters.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters/LatticeNodeParameters.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,30 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LatticeNodeParameters.hpp&quot;
-
-LatticeNodeParameters::LatticeNodeParameters() : PhysicalParameters()
-{
-	createIndex();
-	
-	countIncremental 	= 0;
-	countStiffness 		= 0;
-	displacementIncremental = Vector3r(0.0,0.0,0.0);
-	displacementAlignmental 	= Vector3r(0.0,0.0,0.0);
-}
-
-LatticeNodeParameters::~LatticeNodeParameters()
-{
-
-}
-
-void LatticeNodeParameters::registerAttributes()
-{
-	PhysicalParameters::registerAttributes();
-}
-

Deleted: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters/LatticeNodeParameters.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters/LatticeNodeParameters.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters/LatticeNodeParameters.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,41 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LATTICE_NODE_PARAMETERS_HPP
-#define LATTICE_NODE_PARAMETERS_HPP 
-
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include &lt;vector&gt;
-
-class LatticeNodeParameters : public PhysicalParameters 
-{
-	public : 
-		Real 		 countIncremental
-				,countStiffness;
-		Vector3r 	 displacementIncremental
-				,displacementAlignmental;
-	
-		LatticeNodeParameters();
-		virtual ~LatticeNodeParameters();
-
-/// Serialization
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(LatticeNodeParameters);
-	REGISTER_BASE_CLASS_NAME(PhysicalParameters);
-	
-/// Indexable
-	REGISTER_CLASS_INDEX(LatticeNodeParameters,PhysicalParameters);
-
-};
-
-REGISTER_SERIALIZABLE(LatticeNodeParameters,false);
-
-#endif // LATTICE_NODE_PARAMETERS_HPP 
-
-

Copied: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters.cpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters/LatticeNodeParameters.cpp)

Copied: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters.hpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeNodeParameters/LatticeNodeParameters.hpp)

Deleted: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters/LatticeSetParameters.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters/LatticeSetParameters.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters/LatticeSetParameters.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,39 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LatticeSetParameters.hpp&quot;
-
-
-LatticeSetParameters::LatticeSetParameters() : PhysicalParameters()
-{
-        createIndex();
-        nodeGroupMask = 1;
-        beamGroupMask = 2;
-        total = 0;
-        nonl = 0;
-        range=0;
-        useBendTensileSoftening = false;
-        useStiffnessSoftening   = false;
-}
-
-
-LatticeSetParameters::~LatticeSetParameters()
-{
-
-}
-
-
-void LatticeSetParameters::registerAttributes()
-{
-        PhysicalParameters::registerAttributes();
-        REGISTER_ATTRIBUTE(nodeGroupMask);
-        REGISTER_ATTRIBUTE(beamGroupMask);
-        REGISTER_ATTRIBUTE(useBendTensileSoftening);
-        REGISTER_ATTRIBUTE(useStiffnessSoftening);
-}
- 

Deleted: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters/LatticeSetParameters.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters/LatticeSetParameters.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters/LatticeSetParameters.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,53 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LATTICE_SET_PARAMETERS_HPP
-#define LATTICE_SET_PARAMETERS_HPP 
-
-
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-#include &lt;list&gt;
-
-class LatticeSetParameters : public PhysicalParameters
-{
-	public :
-                int      beamGroupMask
-                        ,nodeGroupMask;
-
-                bool     useBendTensileSoftening,useStiffnessSoftening;
-                        
-                unsigned long int total;
-                
-                struct NonLocalInteraction
-                {
-                        unsigned int    id1,id2;
-                //      Real            gaussValue; // must use malloc()
-                        //float                 gaussValue; // must use malloc()
-                };
-                //std::vector&lt;std::list&lt;NonLocalInteraction , std::__malloc_alloc_template&lt;sizeof(NonLocalInteraction)&gt; &gt; &gt; nonl;
-                void* nonl;
-                Real range;
-                
-                LatticeSetParameters();
-                virtual ~LatticeSetParameters();
-
-/// Serializable
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(LatticeSetParameters);
-	REGISTER_BASE_CLASS_NAME(PhysicalParameters);
-
-/// Indexable
-	REGISTER_CLASS_INDEX(LatticeSetParameters,PhysicalParameters);
-
-};
-
-REGISTER_SERIALIZABLE(LatticeSetParameters,false);
-
-#endif // LATTICE_SET_PARAMETERS_HPP 
-

Copied: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters.cpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters/LatticeSetParameters.cpp)

Copied: branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters.hpp (from rev 1105, branches/scons-layout/pkg/lattice/DataClass/PhysicalParameters/LatticeSetParameters/LatticeSetParameters.hpp)

Deleted: branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams/LatticeSet2LatticeBeams.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams/LatticeSet2LatticeBeams.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams/LatticeSet2LatticeBeams.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,47 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LatticeSet2LatticeBeams.hpp&quot;
-#include &quot;LatticeSetParameters.hpp&quot;
-#include &quot;LatticeBeamParameters.hpp&quot;
-#include &quot;LineSegment.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-void LatticeSet2LatticeBeams::go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp; ph
-					, shared_ptr&lt;GeometricalModel&gt;&amp; 
-					, const Body* body)
-{
-	int beamGroupMask = static_cast&lt;const LatticeSetParameters*&gt;(ph.get())-&gt;beamGroupMask;
-	const MetaBody * ncb = static_cast&lt;const MetaBody*&gt;(body);
-	const shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for(  ; bi!=biEnd ; ++bi )
-	{
-		Body* b = (*bi).get();
-		if( b-&gt;getGroupMask() &amp; beamGroupMask )
-		{
-			LineSegment* line 		= static_cast&lt;LineSegment*&gt;	     (b-&gt;geometricalModel.get());
-			LatticeBeamParameters* beam 	= static_cast&lt;LatticeBeamParameters*&gt;(b-&gt;physicalParameters.get());
-
-// FIXME - this copying of length between latticeBeam geometry and physics, inside MetaBody could
-//         be done just once, if length was inside shared_ptr. This can be improved once we make
-//         indexable Parameters: Velocity, Position, Orientation, ....
-			line-&gt;length                    = beam-&gt;length;
-
-			// FIXME - display aggregates as brown, bonds as dark brown.
-			      if(beam-&gt;criticalTensileStrain &gt; 0.00015) line-&gt;diffuseColor = Vector3r(0.6,0.6,0.6); else // CEMENT
-			      if(beam-&gt;criticalTensileStrain &gt; 0.00006) line-&gt;diffuseColor = Vector3r(0.0,0.0,0.0); else // AGGREGATE
-			                                                line-&gt;diffuseColor = Vector3r(0.3,0.3,0.3);      // BOND
-
-			      if(beam-&gt;longitudalStiffness &gt; 3.6 ) line-&gt;diffuseColor = Vector3r(0.4,0.4,1.0); // NON-DESTROY
-		}
-	}
-}
-

Deleted: branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams/LatticeSet2LatticeBeams.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams/LatticeSet2LatticeBeams.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams/LatticeSet2LatticeBeams.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,32 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LATTICE_SET_2_LATTICE_BEAMS_HPP
-#define LATTICE_SET_2_LATTICE_BEAMS_HPP 
-
-
-#include&lt;yade/pkg-common/GeometricalModelEngineUnit.hpp&gt;
-#include&lt;yade/core/BodyContainer.hpp&gt;
-
-
-class LatticeSet2LatticeBeams : public GeometricalModelEngineUnit
-{
-	public : 
-		void go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-				, shared_ptr&lt;GeometricalModel&gt;&amp;
-				, const Body*);
-
-	REGISTER_CLASS_NAME(LatticeSet2LatticeBeams);
-	REGISTER_BASE_CLASS_NAME(GeometricalModelEngineUnit);
-
-};
-
-REGISTER_SERIALIZABLE(LatticeSet2LatticeBeams,false);
-
-#endif // LATTICE_SET_2_LATTICE_BEAMS_HPP 
-

Copied: branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams.cpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams/LatticeSet2LatticeBeams.cpp)

Copied: branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams.hpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/EngineUnit/LatticeSet2LatticeBeams/LatticeSet2LatticeBeams.hpp)

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder/BeamRecorder.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder/BeamRecorder.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder/BeamRecorder.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,171 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;BeamRecorder.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include &quot;LatticeBeamParameters.hpp&quot;
-#include &quot;LatticeNodeParameters.hpp&quot;
-// to calculate strain of whole speciemen - first two bodies in subscribedBodies are Nodes. FIXME - make it clean!
-#include &lt;boost/lexical_cast.hpp&gt;
-
-/*
- *
-	private :
-		std::ofstream ofile; 
-		std::vector&lt;std::pair&lt;std::list&lt;unsigned int&gt;, int&gt; &gt;	subscribedBodies; // [region]&lt;list of bodies' ids, direction&gt;
-		bool			first;
-		int			nodeGroupMask,beamGroupMask;
-
-	public :
-		std::string	 outputFile;
-		unsigned int	 interval;
-		std::list&lt;std::pair&lt;Vector3r,std::pair&lt; Real, int &gt; &gt; &gt; sections; // a list of section planes: &lt;a midpoint, half length, direction &gt;
-		// int direction refers to: which coordinate to take from the Beam's.direction: x, y or z (0, 1 or 2)
- * */
-
-
-BeamRecorder::BeamRecorder () : DataRecorder()
-{
-	outputFile = &quot;&quot;;
-	interval = 50;
-	subscribedBodies.clear();
-	first = true;
-	// FIXME ...
-        nodeGroupMask           = 1;
-        beamGroupMask           = 2;
-}
-
-
-void BeamRecorder::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-	//	outputFile += &quot;_&quot;+boost::lexical_cast&lt;std::string&gt;(Omega::instance().getTimeStep());
-	//	std::cerr &lt;&lt; &quot;using dt for BeamRecorder output file: &quot; &lt;&lt; outputFile &lt;&lt; &quot;\n&quot;;
-
-		ofile.open(outputFile.c_str());
-
-	}
-}
-
-
-void BeamRecorder::registerAttributes()
-{
-	DataRecorder::registerAttributes();
-	REGISTER_ATTRIBUTE(outputFile);
-	REGISTER_ATTRIBUTE(interval);
-	REGISTER_ATTRIBUTE(sections);
-
-	REGISTER_ATTRIBUTE(first);
-	REGISTER_ATTRIBUTE(subscribedBodies);
-}
-
-
-bool BeamRecorder::isActivated()
-{
-	return ((Omega::instance().getCurrentIteration() % interval == 0) &amp;&amp; (ofile));
-}
-
-
-void BeamRecorder::action(Body * body)
-{
-//	std::cerr &lt;&lt; &quot;BeamRecorder quits\n&quot;;
-//	return;
-	
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
-
-	if(first)
-	{
-	// scan the sections and subscribe beams that cross each of them
-	// FIXME - this is still problematic, because this should be done only
-	// on the first run, regardless of saving/loading this file...
-		first = false;
-		subscribedBodies.resize( sections.size() );
-
-		std::list&lt;std::pair&lt;Vector3r,std::pair&lt;Real,int&gt; &gt; &gt;::iterator i  =sections.begin();
-		std::list&lt;std::pair&lt;Vector3r,std::pair&lt;Real,int&gt; &gt; &gt;::iterator end=sections.end();
-
-		for( int section=0 ; i != end ; ++i, ++section )
-		{
-			Vector3r midpoint = i-&gt;first;
-			Real     half     = i-&gt;second.first;
-			int	 dir	  = i-&gt;second.second;
-
-			if(!subscribedBodies[section].first.empty())
-				std::cerr &lt;&lt; &quot;First, but not empty\n&quot;;
-
-			subscribedBodies[section].second=dir; 
-
-			BodyContainer::iterator bi    = ncb-&gt;bodies-&gt;begin();
-			BodyContainer::iterator biEnd = ncb-&gt;bodies-&gt;end();
-			for(  ; bi!=biEnd ; ++bi )
-			{
-				if( (*bi)-&gt;getGroupMask() &amp; beamGroupMask )
-				{
-					Vector3r pos1 = (*(ncb-&gt;bodies))[static_cast&lt;LatticeBeamParameters*&gt;( (*bi)-&gt;physicalParameters.get() )-&gt;id1]-&gt;physicalParameters-&gt;se3.position; // beam first node
-					Vector3r pos2 = (*(ncb-&gt;bodies))[static_cast&lt;LatticeBeamParameters*&gt;( (*bi)-&gt;physicalParameters.get() )-&gt;id2]-&gt;physicalParameters-&gt;se3.position; // beam second node
-					
-					if( pos1[dir] &lt; pos2[dir] )
-						std::swap(pos1,pos2); // make sure that pos1[dir] is bigger 
-		
-					if(        pos1[dir] &gt; midpoint[dir]
-						&amp;&amp; pos2[dir] &lt; midpoint[dir] // beam crosses the plane!
-
-						&amp;&amp; pos1[(dir+1)%3] &gt; midpoint[(dir+1)%3]-half
-						&amp;&amp; pos1[(dir+1)%3] &lt; midpoint[(dir+1)%3]+half
-						&amp;&amp; pos2[(dir+1)%3] &gt; midpoint[(dir+1)%3]-half
-						&amp;&amp; pos2[(dir+1)%3] &lt; midpoint[(dir+1)%3]+half // both points are within halflength in direction (dir+1)%3
-
-						&amp;&amp; pos1[(dir+2)%3] &gt; midpoint[(dir+2)%3]-half
-						&amp;&amp; pos1[(dir+2)%3] &lt; midpoint[(dir+2)%3]+half
-						&amp;&amp; pos2[(dir+2)%3] &gt; midpoint[(dir+2)%3]-half
-						&amp;&amp; pos2[(dir+2)%3] &lt; midpoint[(dir+2)%3]+half // both points are within halflength in direction (dir+2)%3
-						)
-						subscribedBodies[section].first.push_back( (*bi)-&gt;getId() ); 
-				}
-			}
-		}
-	}
-
-
-	for( int section=0 ; section&lt;sections.size() ; ++section )
-	{
-		std::list&lt;unsigned int&gt;::iterator i   = subscribedBodies[section].first.begin();
-		std::list&lt;unsigned int&gt;::iterator end = subscribedBodies[section].first.end();
-		//int dir                               = subscribedBodies[section].second; // unused...
-		
-		//Real stress=0; // in direction 'dir'
-		Real stress_x=0;
-		Real stress_y=0;
-
-		for( ; i != end ; ++i )
-		{
-			if( (*(ncb-&gt;bodies)).exists(*i) )
-			{
-				LatticeBeamParameters* beam 	= static_cast&lt;LatticeBeamParameters*&gt;( (*(ncb-&gt;bodies))[*i]-&gt;physicalParameters . get() );
-				// direction is a unit vector, so direction[1] is cos(angle_to_dir)
-				//Real s			= beam-&gt;strain() * std::abs(beam-&gt;direction[dir]) * beam-&gt;longitudalStiffness;
-				Real s_x			= beam-&gt;strain() * std::abs(beam-&gt;direction[0]) * beam-&gt;longitudalStiffness;
-				Real s_y			= beam-&gt;strain() * std::abs(beam-&gt;direction[1]) * beam-&gt;longitudalStiffness;
-				stress_x += s_x;
-				stress_y += s_y;
-
-				(*(ncb-&gt;bodies))[*i]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(1.0,0.0,((float)section)/3.0); // FIXME [1]
-			}
-		}
-
-		ofile	&lt;&lt; lexical_cast&lt;string&gt;(stress_x) &lt;&lt; &quot; &quot; &lt;&lt; lexical_cast&lt;string&gt;(stress_y) &lt;&lt; &quot; \t &quot;;
-	}
-	ofile &lt;&lt; endl; 
-		
-	// [1]
-	// mark colors what is monitored - FIXME - provide a way to do that for ALL DataRecorders in that parent class.
-	// GLDrawSomething can just put a getClassName()
-	 
-}
-

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder/BeamRecorder.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder/BeamRecorder.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder/BeamRecorder.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,51 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BEAM_RECORDER_HPP
-#define BEAM_RECORDER_HPP 
-
-#include&lt;yade/core/DataRecorder.hpp&gt;
-
-#include &lt;string&gt;
-#include &lt;fstream&gt;
-#include &lt;list&gt;
-#include &lt;vector&gt;
-
-//class PhysicalAction;
-
-class BeamRecorder : public DataRecorder
-{ // given a section plane it records all the beams that cross it: their deformation projected
-  // on direction perpendicular to the plane multiplied by their longitudalStiffness
-	private :
-		std::ofstream ofile; 
-		std::vector&lt;std::pair&lt;std::list&lt;unsigned int&gt;, int&gt; &gt;	subscribedBodies; // [region]&lt;list of bodies' ids, direction&gt;
-		bool			first;
-		int			nodeGroupMask,beamGroupMask;
-
-	public :
-		std::string	 outputFile;
-		unsigned int	 interval;
-		std::list&lt;std::pair&lt;Vector3r,std::pair&lt; Real, int &gt; &gt; &gt; sections; // a list of section planes: &lt;a midpoint, half length, direction &gt;
-		// int direction refers to: which coordinate to take from the Beam's.direction: x, y or z (0, 1 or 2)
-
-		BeamRecorder ();
-
-		virtual void registerAttributes();
-		virtual void action(Body* b);
-		virtual bool isActivated();
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-	REGISTER_CLASS_NAME(BeamRecorder);
-	REGISTER_BASE_CLASS_NAME(DataRecorder);
-};
-
-REGISTER_SERIALIZABLE(BeamRecorder,false);
-
-#endif // STRAIN_RECORDER_HPP 
-

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.cpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder/BeamRecorder.cpp)

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder.hpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/BeamRecorder/BeamRecorder.hpp)

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw/LatticeLaw.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw/LatticeLaw.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw/LatticeLaw.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,573 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LatticeLaw.hpp&quot;
-#include &quot;LatticeBeamParameters.hpp&quot;
-#include &quot;LatticeBeamAngularSpring.hpp&quot;
-#include &quot;NonLocalDependency.hpp&quot;
-#include &quot;LatticeNodeParameters.hpp&quot;
-#include &quot;LatticeSetParameters.hpp&quot;
-#include&lt;yade/core/BodyContainer.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-LatticeLaw::LatticeLaw() : InteractionSolver()
-{
-}
-
-
-LatticeLaw::~LatticeLaw()
-{
-
-}
-
-bool LatticeLaw::deleteBeam(MetaBody* metaBody , LatticeBeamParameters* beam, Body* b)
-{
-	Real strain;
-
-//	if ( nonlocal) // calculate strain with non-local law
-//		strain = beam-&gt;nonLocalStrain / beam-&gt;nonLocalDivisor;
-//	else
-
-	
-	strain = beam-&gt;strain();
-	return     strain &lt; -beam-&gt;criticalCompressiveStrain
-		|| strain &gt;  beam-&gt;criticalTensileStrain;
-}
-
-
-void LatticeLaw::calcBeamPositionOrientationNewLength(Body* body, BodyContainer* bodies)
-{
-// FIXME - verify that this updating of length, position, orientation and color is in correct place/plugin
-	LatticeBeamParameters* beam 	  = static_cast&lt;LatticeBeamParameters*&gt;(body-&gt;physicalParameters.get());
-
-	Body* bodyA 			  = (*(bodies))[beam-&gt;id1].get();
-	Body* bodyB 			  = (*(bodies))[beam-&gt;id2].get();
-	Se3r&amp; se3A 			  = bodyA-&gt;physicalParameters-&gt;se3;
-	Se3r&amp; se3B 			  = bodyB-&gt;physicalParameters-&gt;se3;
-	
-	Se3r se3Beam;
-	se3Beam.position 		  = (se3A.position + se3B.position)*0.5;
-	Vector3r dist 			  =  se3A.position - se3B.position;
-	
-	Real length 			  = dist.Normalize();
-
-	beam-&gt;direction 		  = dist;
-	beam-&gt;length 			  = length;
-
-/////////////////////////////////////////
-//	// rotate otherDirection
-//	{
-		beam-&gt;otherDirection -= beam-&gt;direction.Dot(beam-&gt;otherDirection)*beam-&gt;direction;
-		Quaternionr tor(beam-&gt;direction,beam-&gt;torsionAngle);
-		beam-&gt;otherDirection = tor * beam-&gt;otherDirection;
-		beam-&gt;otherDirection.Normalize();
-//	}
-/////////////////////////////////////////
-	
-	Vector3r CP			  = beam-&gt;direction.Cross(beam-&gt;otherDirection);
-	se3Beam.orientation.FromRotationMatrix( Matrix3r( beam-&gt;direction , beam-&gt;otherDirection , CP , true ) );
-	
-	beam-&gt;se3Displacement.position    = se3Beam.position - beam-&gt;se3.position;
-	beam-&gt;se3Displacement.orientation = se3Beam.orientation * beam-&gt;se3.orientation.Conjugate();
-	
-	beam-&gt;se3 			  = se3Beam;
-
-	// PhysicalActionResetter
-	beam-&gt;bendingRotation		= Quaternionr(1.0,0.0,0.0,0.0);
-	beam-&gt;torsionalRotation		= Quaternionr(1.0,0.0,0.0,0.0);
-	beam-&gt;torsionAngle		= 0.0;
-	beam-&gt;count			= 0.0;
-
-//	double zzzzz=beam-&gt;direction.dot(beam-&gt;otherDirection);
-//	if(zzzzz &lt; -3e-16 || zzzzz &gt; 3e-16 )
-//		std::cerr &lt;&lt; &quot;============== &quot; &lt;&lt; zzzzz &lt;&lt; &quot;\n&quot;;
-//		std::cerr &lt;&lt; &quot; (&quot; &lt;&lt; beam-&gt;otherDirection &lt;&lt; &quot;)&quot;;
-
-}
-
-void LatticeLaw::action(Body* body)
-{
-	futureDeletes.clear();
-
-	MetaBody * lattice = static_cast&lt;MetaBody*&gt;(body);
-
-	int nodeGroupMask  = static_cast&lt;LatticeSetParameters*&gt;(lattice-&gt;physicalParameters.get())-&gt;nodeGroupMask;
-	int beamGroupMask  = static_cast&lt;LatticeSetParameters*&gt;(lattice-&gt;physicalParameters.get())-&gt;beamGroupMask;
-
-	BodyContainer* bodies = lattice-&gt;bodies.get();
-
-	InteractionContainer::iterator angles     = lattice-&gt;persistentInteractions-&gt;begin();
-	InteractionContainer::iterator angles_end = lattice-&gt;persistentInteractions-&gt;end();
-
-	{ // 'B' calculate how many neighbors each beam currently has
-		for(  ; angles != angles_end; ++angles )
-		{
-			if(        bodies-&gt;exists( (*angles)-&gt;getId1() )        // FIXME - remove this test ....
-				&amp;&amp; bodies-&gt;exists( (*angles)-&gt;getId2() ) ) 	//
-			{
-				++(static_cast&lt;LatticeBeamParameters*&gt;(((*(bodies))[(*angles)-&gt;getId1()])-&gt;physicalParameters.get())-&gt;count);
-                                ++(static_cast&lt;LatticeBeamParameters*&gt;(((*(bodies))[(*angles)-&gt;getId2()])-&gt;physicalParameters.get())-&gt;count);
-			}
-			// else FIXME - delete unused angularSpring
-		}
-	}
-	{ // calculate new angles between beams
-		angles     = lattice-&gt;persistentInteractions-&gt;begin();
-		angles_end = lattice-&gt;persistentInteractions-&gt;end();
-		for(  ; angles != angles_end; ++angles )
-		{
-			if( 	   bodies-&gt;exists( (*angles)-&gt;getId1() )
-				&amp;&amp; bodies-&gt;exists( (*angles)-&gt;getId2() ) )
-			{
-				LatticeBeamParameters* beam1 = static_cast&lt;LatticeBeamParameters*&gt;(((*(bodies))[(*angles)-&gt;getId1()])-&gt;physicalParameters.get());
-				LatticeBeamParameters* beam2 = static_cast&lt;LatticeBeamParameters*&gt;(((*(bodies))[(*angles)-&gt;getId2()])-&gt;physicalParameters.get());
-				
-				LatticeBeamAngularSpring* an = static_cast&lt;LatticeBeamAngularSpring*&gt;((*angles)-&gt;interactionPhysics.get());
-				
-				Vector3r	newCP;
-				Vector3r&amp;	lastCP		= an-&gt;lastCrossProduct;
-				bool&amp;		planeSwap180	= an-&gt;planeSwap180;
-				bool		oldPS180	= planeSwap180;
-				Real		planeAngle;
-
-				newCP		= beam1-&gt;direction.Cross(beam2-&gt;direction);
-				if(newCP.Dot(lastCP)&lt; 0.0)
-					planeSwap180=!planeSwap180;
-				
-				// beam1-&gt;direction and beam2-&gt;direction are unit vectors
-				planeAngle	= ( planeSwap180      ? -1.0 : 1.0 ) * unitVectorsAngle(beam1-&gt;direction,beam2-&gt;direction);
-
-				Real sinAngleSquared = newCP.SquaredLength();
-				if(sinAngleSquared &gt; 0.0001)
-					lastCP = newCP;
-				else
-					planeSwap180 = oldPS180;	
-				
-		 // 'B' calculate needed beam rotations 
-				Real angleDifference = planeAngle - an-&gt;initialPlaneAngle;
-				
-				if( angleDifference &gt; 0 )
-					while(angleDifference &gt; Mathr::PI) angleDifference -= Mathr::TWO_PI;
-				else
-					while(angleDifference &lt; -Mathr::PI) angleDifference += Mathr::TWO_PI;
-				
-				// axis of bending rotation is orthogonal to the plane between two beams and must have unit length
-				lastCP.Normalize();
-				Quaternionr rotationDifference1,rotationDifference2;
-
-				rotationDifference1.FromAxisAngle(lastCP, ( planeSwap180 ? -1.0 : 1.0 ) * angleDifference/beam1-&gt;count);
-				rotationDifference2.FromAxisAngle(lastCP, ( planeSwap180 ? 1.0 : -1.0 ) * angleDifference/beam2-&gt;count);
-				
-				beam1-&gt;bendingRotation = beam1-&gt;bendingRotation * rotationDifference1;
-				beam2-&gt;bendingRotation = beam2-&gt;bendingRotation * rotationDifference2;
-
-		// 'T' calculate torsional rotation
-			if(calcTorsion)
-			{
-
-				bool sameFlow			= true;
-				if( (beam1-&gt;id1 == beam2-&gt;id1) || (beam1-&gt;id2 == beam2-&gt;id2) )
-					sameFlow		= false;
-
-				Real offPlaneAngle1		= unitVectorsAngle(beam1-&gt;otherDirection,lastCP);
-				Real offPlaneAngle2		= unitVectorsAngle(beam2-&gt;otherDirection,lastCP);
-		
-				/////////////////////////////////////////////////////////////
-				Quaternionr	aligner1,aligner2;
-				aligner1.FromAxisAngle(beam1-&gt;direction , offPlaneAngle1);
-				aligner2.FromAxisAngle(beam2-&gt;direction , offPlaneAngle2);
-						
-				Vector3r	dir1			= aligner1 * lastCP;
-				Vector3r	dir2			= aligner2 * lastCP;
-		
-				// FIXME
-				if( dir1.Dot(beam1-&gt;otherDirection) &lt; 0.999999 )
-					offPlaneAngle1   *= -1.0;
-				if( dir2.Dot(beam2-&gt;otherDirection) &lt; 0.999999 )
-					offPlaneAngle2   *= -1.0;
-				/////////////////////////////////////////////////////////////
-
-				Real offPlaneAngleDifference1	= an-&gt;initialOffPlaneAngle1 - offPlaneAngle1;
-				Real offPlaneAngleDifference2	= an-&gt;initialOffPlaneAngle2 - offPlaneAngle2;
-				
-				if( offPlaneAngleDifference1 &gt; 0 )
-					while(offPlaneAngleDifference1 &gt; Mathr::PI) offPlaneAngleDifference1 -= Mathr::TWO_PI;
-				else
-					while(offPlaneAngleDifference1 &lt; -Mathr::PI) offPlaneAngleDifference1 += Mathr::TWO_PI;
-				
-				if( offPlaneAngleDifference2 &gt; 0 )
-					while(offPlaneAngleDifference2 &gt; Mathr::PI) offPlaneAngleDifference2 -= Mathr::TWO_PI;
-				else
-					while(offPlaneAngleDifference2 &lt; -Mathr::PI) offPlaneAngleDifference2 += Mathr::TWO_PI;
-
-				Real torsionAngle1, torsionAngle2;
-				if(sameFlow)
-				{
-					torsionAngle1 = offPlaneAngleDifference1 - offPlaneAngleDifference2;
-					torsionAngle2 = -torsionAngle1;
-				}
-				else
-				{
-					torsionAngle1 = offPlaneAngleDifference1 + offPlaneAngleDifference2;
-					torsionAngle2 = torsionAngle1;
-				}
-				
-				if( torsionAngle1 &gt; 0 )
-					while(torsionAngle1 &gt; Mathr::PI) torsionAngle1 -= Mathr::TWO_PI;
-				else
-					while(torsionAngle1 &lt; -Mathr::PI) torsionAngle1 += Mathr::TWO_PI;
-				
-				if( torsionAngle2 &gt; 0 )
-					while(torsionAngle2 &gt; Mathr::PI) torsionAngle2 -= Mathr::TWO_PI;
-				else
-					while(torsionAngle2 &lt; -Mathr::PI) torsionAngle2 += Mathr::TWO_PI;
-
-				// calculate beam swirl
-				if( an-&gt;lastOffPlaneAngleDifference1 &gt;  3.0 &amp;&amp; offPlaneAngleDifference1 &lt; -3.0 ) ++(an-&gt;swirl1);
-				if( an-&gt;lastOffPlaneAngleDifference1 &lt; -3.0 &amp;&amp; offPlaneAngleDifference1 &gt;  3.0 ) --(an-&gt;swirl1);
-				if( an-&gt;lastOffPlaneAngleDifference2 &gt;  3.0 &amp;&amp; offPlaneAngleDifference2 &lt; -3.0 ) ++(an-&gt;swirl2);
-				if( an-&gt;lastOffPlaneAngleDifference2 &lt; -3.0 &amp;&amp; offPlaneAngleDifference2 &gt;  3.0 ) --(an-&gt;swirl2);
-
-				an-&gt;lastOffPlaneAngleDifference1   = offPlaneAngleDifference1;
-				an-&gt;lastOffPlaneAngleDifference2   = offPlaneAngleDifference2;
-
-				Real swirlAngle1 = (offPlaneAngleDifference1 + Mathr::TWO_PI * an-&gt;swirl1)*sinAngleSquared;
-				Real swirlAngle2 = (offPlaneAngleDifference2 + Mathr::TWO_PI * an-&gt;swirl2)*sinAngleSquared;
-				
-				beam1-&gt;torsionAngle += 0.5*( swirlAngle1 + torsionAngle1)/beam1-&gt;count;
-				beam2-&gt;torsionAngle += 0.5*( swirlAngle2 + torsionAngle2)/beam2-&gt;count;
-				
-				//axis of torsional rotation is the other's beam direction, the beam tries to rotate its neighbours to fit its orientation
-				rotationDifference1.FromAxisAngle(beam2-&gt;direction, ((sameFlow ? -1.0 : 1.0)*swirlAngle1-torsionAngle2)/beam1-&gt;count);
-				rotationDifference2.FromAxisAngle(beam1-&gt;direction, ((sameFlow ? -1.0 : 1.0)*swirlAngle2-torsionAngle1)/beam2-&gt;count);
-			
-				beam1-&gt;torsionalRotation = beam1-&gt;torsionalRotation * rotationDifference1;
-				beam2-&gt;torsionalRotation = beam2-&gt;torsionalRotation * rotationDifference2;
-			}
-			}
-		}
-	}
-
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-
-	for(  ; bi!=biEnd ; ++bi )  // loop over all beams
-	{
-		Body* body = (*bi).get();
-		if( ! ( body-&gt;getGroupMask() &amp; beamGroupMask ) )
-			continue; // skip non-beams
-
-		// next beam
-		LatticeBeamParameters* beam = static_cast&lt;LatticeBeamParameters*&gt;(body-&gt;physicalParameters.get() );
-
-		Real      stretch      = beam-&gt;length - beam-&gt;initialLength;
-
-		// 'D' from picture. how much beam wants to change length at each node, to bounce back through original length to mirror position.
-		Vector3r  displacementLongitudal = beam-&gt;direction * stretch;
-
-		{ // 'E_min' 'E_max' criterion
-			if( deleteBeam(lattice , beam, body) ) // calculates strain
-			{
-				std::cerr &lt;&lt; &quot;one beam deleted\n&quot;;
-				futureDeletes.push_back(body-&gt;getId());
-				continue;
-			}
-		}
-		
-		LatticeNodeParameters* node1 = static_cast&lt;LatticeNodeParameters*&gt;(((*(bodies))[beam-&gt;id1])-&gt;physicalParameters.get());
-		LatticeNodeParameters* node2 = static_cast&lt;LatticeNodeParameters*&gt;(((*(bodies))[beam-&gt;id2])-&gt;physicalParameters.get());
-
-		++(node1-&gt;countIncremental);
-		++(node2-&gt;countIncremental);
-
-		{ // 'W' from picture - previous displacement of the beam. try to do it again.
-			node1-&gt;displacementIncremental += beam-&gt;se3Displacement.position;
-			node2-&gt;displacementIncremental += beam-&gt;se3Displacement.position;
-		}
-
-		{ // 'R' from picture - previous rotation of the beam. try to do it again.
-			Vector3r halfLength = beam-&gt;length * beam-&gt;direction * 0.5;
-			node1-&gt;displacementIncremental += beam-&gt;se3Displacement.orientation * ( halfLength) - halfLength;
-			node2-&gt;displacementIncremental += beam-&gt;se3Displacement.orientation * (-halfLength) + halfLength;
-
-		//	beam-&gt;otherDirection		= beam-&gt;se3Displacement.orientation * beam-&gt;otherDirection;
-		}
-
-		{ // 'D' to nodes
-			node1-&gt;countStiffness += beam-&gt;longitudalStiffness;
-			node2-&gt;countStiffness += beam-&gt;longitudalStiffness;
-			node1-&gt;displacementAlignmental -= displacementLongitudal * beam-&gt;longitudalStiffness;
-			node2-&gt;displacementAlignmental += displacementLongitudal * beam-&gt;longitudalStiffness;
-		}
-
-		if( beam-&gt;count != 0 )
-		{
-		Vector3r beam_vec = beam-&gt;length * beam-&gt;direction;
-		{ // 'B' from picture - rotate to align with neighbouring beams
-
-/*   
- *   Bending stiffness different for compression and tension.
- *
-			Real kb = beam-&gt;bendingStiffness;
-			Real Em = beam-&gt;criticalTensileStrain/2.0;
-			Real x  = beam-&gt;strain();
-			const Real howmuch = 0.5;
-
-		//	if(beam-&gt;strain() &lt; 0) // compression
-		//	//if(beam-&gt;strain() &gt; 0) // tension
-		//		kb *= howmuch;	// FIXME - it's a material paramater. k.b in compression is 0.2 of k.b in tension.
-		//				// it should be a function in LatticeBeamParameters that returs correct value depending
-		//				// on tension/compression
-		
-		//	x&lt;-E ? kb*0.2 : ((kb*0.2+kb)/2+(kb*0.2-kb)/(-2*E)*x)
-
-			if( x &lt; -Em )
-				kb *= howmuch;
-			else if( x &lt; Em )
-				kb = (kb*howmuch+kb)/2.0+x*(kb*howmuch-kb)/(-2.0*Em);
-			// if strain &gt; criticalTensileStrain/2.0 then kb is not changed
-
-			node1-&gt;countStiffness += kb;
-			node2-&gt;countStiffness += kb;
-
-			node1-&gt;displacementAlignmental += (beam-&gt;bendingRotation * ( beam_vec) - beam_vec) * kb;
-			node2-&gt;displacementAlignmental += (beam-&gt;bendingRotation * (-beam_vec) + beam_vec) * kb;
-
-*/
-			node1-&gt;countStiffness += beam-&gt;bendingStiffness;
-			node2-&gt;countStiffness += beam-&gt;bendingStiffness;
-
-			node1-&gt;displacementAlignmental += (beam-&gt;bendingRotation * ( beam_vec) - beam_vec) * beam-&gt;bendingStiffness;
-			node2-&gt;displacementAlignmental += (beam-&gt;bendingRotation * (-beam_vec) + beam_vec) * beam-&gt;bendingStiffness;
-
-		}
-		
-		if(calcTorsion)
-		{ // 'T' from picture - torsion
-
-			node1-&gt;countStiffness += beam-&gt;torsionalStiffness;
-			node2-&gt;countStiffness += beam-&gt;torsionalStiffness;
-
-			node1-&gt;displacementAlignmental += (beam-&gt;torsionalRotation * ( beam_vec) - beam_vec) * beam-&gt;torsionalStiffness;
-			node2-&gt;displacementAlignmental += (beam-&gt;torsionalRotation * (-beam_vec) + beam_vec) * beam-&gt;torsionalStiffness;
-		}
-		}
-	}
-	
-	{ // move nodes
-		bi    = bodies-&gt;begin();
-		biEnd = bodies-&gt;end();
-		for(  ; bi!=biEnd ; ++bi )  // loop over all nodes -- move them according to displacements from beams
-		{
-			Body* body = (*bi).get();
-	
-			if( ! ( body-&gt;getGroupMask() &amp; nodeGroupMask ) )
-				continue; // skip non-nodes
-			
-			LatticeNodeParameters* node = static_cast&lt;LatticeNodeParameters*&gt;(body-&gt;physicalParameters.get() );
-			
-			{ // check nodes if they have any beams left
-				if(node-&gt;countIncremental == 0) 
-				{ // node not moving (marked for deletion)
-					futureDeletes.push_back(body-&gt;getId());
-					continue; 
-				}
-			}
-			Vector3r displacementTotal      = 
-				  node-&gt;displacementIncremental / node-&gt;countIncremental 
-				+ node-&gt;displacementAlignmental / node-&gt;countStiffness;
-
-			node-&gt;countIncremental		= 0;
-			node-&gt;countStiffness            = 0;
-			node-&gt;displacementIncremental 	= Vector3r(0.0,0.0,0.0);
-			node-&gt;displacementAlignmental   = Vector3r(0.0,0.0,0.0);
-
-			if(body-&gt;isDynamic)
-			{
-				node-&gt;se3.position      += displacementTotal;
-			//	node-&gt;se3.orientation	+= ;
-			}
-			// FIXME FIXME FIXME FIXME FIXME FIXME FIXME
-			else
-			{
-				if(!roughEdges)// FIXME - else move only in x and z directions
-				{
-					node-&gt;se3.position[0]   += displacementTotal[0];
-					node-&gt;se3.position[2]   += displacementTotal[2];
-				}
-			}
-			if(ensure2D)
-				node-&gt;se3.position[2] = 0; // ensure 2D
-		}
-	}
-	
-	{ // calc new beam position:    X_b = ( X_n1 + X_n2 ) / 2 ,
-	  // calc new beam orientation: ------------||-----------
-	  // store position/orientation displacement, for 'W' and 'R' in se3Displacement
-		bi    = bodies-&gt;begin();
-		biEnd = bodies-&gt;end(); 
-		for(  ; bi!=biEnd ; ++bi )  // loop over all beams
-		{
-			Body* body = (*bi).get();
-			if( body-&gt;getGroupMask() &amp; beamGroupMask )
-				calcBeamPositionOrientationNewLength(body,bodies);
-		}
-	} 
-	
-	{ // delete all beams and nodes marked for deletion 
-	  // - beams that exceeded critical tensile/compressive strain
-	  // - nodes that have no more beams
-		std::list&lt;unsigned int&gt;::iterator vend = futureDeletes.end();
-		for( std::list&lt;unsigned int&gt;::iterator vsta = futureDeletes.begin() ; vsta != vend ; ++vsta)
-			bodies-&gt;erase(*vsta); 
-	}
-}
-
-
-
-
-
-
-
-
-
-/* 
- * this method should be placed in a class derived from this LatticeLaw:
- * it will be a LatticeLaw with softening.
- *
- *
- *
- *
-	//bool FIXME_useBendTensileSoftening = static_cast&lt;LatticeSetParameters*&gt;(lattice-&gt;physicalParameters.get())-&gt;useBendTensileSoftening;
-	//bool FIXME_useStiffnessSoftening   = static_cast&lt;LatticeSetParameters*&gt;(lattice-&gt;physicalParameters.get())-&gt;useStiffnessSoftening;
-	//
-	//void* nonl = static_cast&lt;LatticeSetParameters*&gt;(lattice-&gt;physicalParameters.get())-&gt;nonl;
-	//unsigned long int&amp; total = static_cast&lt;LatticeSetParameters*&gt;(lattice-&gt;physicalParameters.get())-&gt;total;
-	//nonlocal = ( total != 0 );
-	//Real FIXME_range                   = static_cast&lt;LatticeSetParameters*&gt;(lattice-&gt;physicalParameters.get())-&gt;range;
-
- *
- * this non-local calculations stuff was right after 'B' calculate needed beam rotations
- * it should be placed in a derived class.
- * Or some other place, where it could be turned on/off easily
- *
-	for(  ; bi!=biEnd ; ++bi )  // clear all non-local vaules in all beams.
-	{
-		Body* body = (*bi).get();
-		if( ! ( body-&gt;getGroupMask() &amp; beamGroupMask ) )
-			continue; // skip non-beams
-
-		LatticeBeamParameters* beam = static_cast&lt;LatticeBeamParameters*&gt;(body-&gt;physicalParameters.get() );
-
-		beam-&gt;nonLocalStrain = 0.0;
-		beam-&gt;nonLocalDivisor = 0.0;
-	}
-
-        //if (lattice-&gt;transientInteractions-&gt;size() != 0) // calculate non-local strain of beams
-        if ( nonlocal ) // calculate non-local strain of beams
-	{
-		unsigned long int counter = 0;
-		LatticeSetParameters::NonLocalInteraction* nb = reinterpret_cast&lt;LatticeSetParameters::NonLocalInteraction*&gt;(nonl);
-		for( ; counter != total ; ++nb , ++counter )
-		{
-			if(	   bodies-&gt;exists( nb-&gt;id1 )
-					&amp;&amp; bodies-&gt;exists( nb-&gt;id2 ) ) // both beams exist ..
-			{
-				LatticeBeamParameters* beam1 = static_cast&lt;LatticeBeamParameters*&gt;(((*(bodies))[nb-&gt;id1])-&gt;physicalParameters.get());
-				LatticeBeamParameters* beam2 = static_cast&lt;LatticeBeamParameters*&gt;(((*(bodies))[nb-&gt;id2])-&gt;physicalParameters.get());
-
-				Real cosAngle = std::abs(beam1-&gt;direction.dot(beam2-&gt;direction)); // direction is a unit vector, abs() - because I want a number between 0 .. 1
-
-				Real sqDist = (beam1-&gt;se3.position - beam2-&gt;se3.position).squaredLength();
-				Real len = FIXME_range;
-				static Real sqPi = std::sqrt(Mathr::PI);
-				Real gaussValue  = std::exp( - (sqDist/(len*len)) ) / ( len * sqPi );
-				//	Real gaussValue  = std::exp( - std::pow( dist / len , 2) ) / ( len * sqPi );
-
-				Real b2 = beam2-&gt;length * gaussValue * cosAngle;
-				Real b1 = beam1-&gt;length * gaussValue * cosAngle;
-				beam1-&gt;nonLocalStrain += beam2-&gt;strain() * b2;// * cosAngle;
-				beam2-&gt;nonLocalStrain += beam1-&gt;strain() * b1;// * cosAngle;
-				beam1-&gt;nonLocalDivisor += b2;
-				beam2-&gt;nonLocalDivisor += b1;
-			}
-			// else FIXME - delete unused NonLocalDependency
-		}
-	}
-
-	bi    = bodies-&gt;begin();
-	biEnd = bodies-&gt;end();
-
- *
- *
- * this stiffness softening must go somewhere else, too
- *
- *
-
-
-		Real FIXME_useStiffnessSoftening_Factor=1.0;
-		if(FIXME_useStiffnessSoftening)
-		{ // give 'D' to nodes
-			Real sTrAiN = beam-&gt;strain();                                                  // only with over half of tension. (compression is ignored)
-			FIXME_useStiffnessSoftening_Factor = sTrAiN &gt; beam-&gt;criticalTensileStrain*0.5 
-				? (2.0-sTrAiN*2.0/beam-&gt;criticalTensileStrain) : 1.0 ;
-			if(FIXME_useStiffnessSoftening_Factor&lt;0.01) FIXME_useStiffnessSoftening_Factor=0.01;
-
-			assert(FIXME_useStiffnessSoftening_Factor&lt;=1.0);
-
-			Real FIXME_longitudalStiffness = beam-&gt;longitudalStiffness*FIXME_useStiffnessSoftening_Factor;
-			node1-&gt;countStiffness += FIXME_longitudalStiffness;
-			node2-&gt;countStiffness += FIXME_longitudalStiffness;
-			node1-&gt;displacementAlignmental -= displacementLongitudal * FIXME_longitudalStiffness;
-			node2-&gt;displacementAlignmental += displacementLongitudal * FIXME_longitudalStiffness;
-		}
- 
- 
- *
- *
- *
- *
-		if(FIXME_useBendTensileSoftening)
-		{ // 'B' from picture - rotate to align with neighbouring beams
-			Real FIXME_bendingStiffness = beam-&gt;bendingStiffness * FIXME_useStiffnessSoftening_Factor;
-			Real strain                     = beam-&gt;strain();
-
-			Real factor;
-
-			if( strain &gt; 0 )
-			{
-				//                              (   0 ... 0.5 ... 1 ... inf          ) 
-				factor                  = 1.0 - (strain / beam-&gt;criticalTensileStrain); // positive
-				if(factor&lt; 0.0) factor  = 0.0;
-				FIXME_bendingStiffness *=factor;
-			}
-			else
-			{
-				//                        (  0 ... -0.5 ... -1 ... -inf            )
-				factor                  = (strain / beam-&gt;criticalCompressiveStrain); // negative
-				if(factor&lt;-1.0) factor  =-1.0;
-				FIXME_bendingStiffness -= (1.0-FIXME_bendingStiffness)*factor;
-			}
-			node1-&gt;countStiffness += FIXME_bendingStiffness;
-			node2-&gt;countStiffness += FIXME_bendingStiffness;
-			Vector3r axis           = Vector3r( 0.0 , 0.0 , 1.0 ); // 2D - always rotation around z 
-			Real angle              = beam-&gt;bendingRotation;
-			angle /= beam-&gt;count;
-			Quaternionr rotation;
-			rotation.fromAxisAngle(axis,angle);
-			Vector3r length = beam-&gt;length * beam-&gt;direction;// * 0.5;// beam-&gt;bendingStiffness / beam-&gt;count;// * 0.5; // FIXME - duplicate line
-			node1-&gt;displacementAlignmental += (rotation * ( length) - length) * FIXME_bendingStiffness;
-			node2-&gt;displacementAlignmental += (rotation * (-length) + length) * FIXME_bendingStiffness;
-			beam-&gt;bendingRotation	= 0.0;
-			beam-&gt;torsionalRotation	= 0.0;
-			beam-&gt;count             = 0.0;
-		}
-
-*/
-

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw/LatticeLaw.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw/LatticeLaw.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw/LatticeLaw.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,54 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LATTICELAW_HPP
-#define LATTICELAW_HPP
-
-
-#include &quot;LatticeBeamParameters.hpp&quot;
-#include&lt;yade/core/InteractionSolver.hpp&gt;
-#include&lt;yade/core/BodyContainer.hpp&gt;
-#include &lt;list&gt;
-
-class PhysicalAction;
-
-
-class LatticeLaw : public InteractionSolver
-{
-	private:
-		std::list&lt;unsigned int&gt; futureDeletes;
-		//bool nonlocal;
-                
-                bool deleteBeam(MetaBody* lattice , LatticeBeamParameters* beam, Body*);
-                void calcBeamPositionOrientationNewLength(Body* body, BodyContainer* bodies);
-	public :
-		bool roughEdges,ensure2D,calcTorsion; // FIXME, FIXME, FIXME 
-		LatticeLaw();
-		virtual ~LatticeLaw();
-		void action(Body* body);
-		void registerAttributes()
-		{
-			REGISTER_ATTRIBUTE(roughEdges);
-			REGISTER_ATTRIBUTE(ensure2D);
-			REGISTER_ATTRIBUTE(calcTorsion);
-			// must go to derived class
-			//REGISTER_ATTRIBUTE(nonlocal);
-		};
-
-/// Serializtion
-	REGISTER_CLASS_NAME(LatticeLaw);
-	REGISTER_BASE_CLASS_NAME(InteractionSolver);
-};
-
-
-REGISTER_SERIALIZABLE(LatticeLaw,false);
-
-
-#endif // LATTICELAW_HPP
-
-

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.cpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw/LatticeLaw.cpp)

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw.hpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/LatticeLaw/LatticeLaw.hpp)

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson/MeasurePoisson.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson/MeasurePoisson.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson/MeasurePoisson.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,116 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;MeasurePoisson.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include &quot;LatticeBeamParameters.hpp&quot;
-#include &quot;LatticeNodeParameters.hpp&quot;
-// to calculate strain of whole speciemen - first two bodies in subscribedBodies are Nodes. FIXME - make it clean!
-#include &lt;boost/lexical_cast.hpp&gt;
-
-#include &lt;cmath&gt;
-
-MeasurePoisson::MeasurePoisson () : DataRecorder()
-{
-	outputFile = &quot;&quot;;
-	interval = 50;
-	horizontal = vertical -1.0;
-	bottom = upper = left = right = -1;
-	idx=0;
-}
-
-
-void MeasurePoisson::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-	//	outputFile += &quot;_&quot;+boost::lexical_cast&lt;std::string&gt;(Omega::instance().getTimeStep());
-	//	std::cerr &lt;&lt; &quot;using dt for poisson output file: &quot; &lt;&lt; outputFile &lt;&lt; &quot;\n&quot;;
-
-		ofile.open(outputFile.c_str());
-
-	}
-}
-
-
-void MeasurePoisson::registerAttributes()
-{
-	DataRecorder::registerAttributes();
-	REGISTER_ATTRIBUTE(outputFile);
-	REGISTER_ATTRIBUTE(interval);
-	REGISTER_ATTRIBUTE(horizontal);
-	REGISTER_ATTRIBUTE(vertical);
-	REGISTER_ATTRIBUTE(bottom);
-	REGISTER_ATTRIBUTE(upper);
-	REGISTER_ATTRIBUTE(left);
-	REGISTER_ATTRIBUTE(right);
-}
-
-
-bool MeasurePoisson::isActivated()
-{
-	return ((Omega::instance().getCurrentIteration() % interval == 0) &amp;&amp; (ofile));
-}
-
-
-void MeasurePoisson::action(Body * body)
-{
-
-
-	return;
-
-	if(bottom==-1 || upper==-1 || left==-1 || right==-1)
-	{
-		std::cerr &lt;&lt; &quot;bad nodes!\n&quot;;
-		return;
-	}
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
-
-	LatticeNodeParameters* node_left   = YADE_CAST&lt;LatticeNodeParameters*&gt;( (*(ncb-&gt;bodies))[left  ]-&gt;physicalParameters . get() );
-	(*(ncb-&gt;bodies))[left  ]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(1.0,1.0,0.0); // FIXME [1]
-	LatticeNodeParameters* node_right  = YADE_CAST&lt;LatticeNodeParameters*&gt;( (*(ncb-&gt;bodies))[right ]-&gt;physicalParameters . get() );
-	(*(ncb-&gt;bodies))[right ]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(1.0,1.0,0.0); // FIXME [1]
-	LatticeNodeParameters* node_bottom = YADE_CAST&lt;LatticeNodeParameters*&gt;( (*(ncb-&gt;bodies))[bottom]-&gt;physicalParameters . get() );
-	(*(ncb-&gt;bodies))[bottom]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(1.0,1.0,0.0); // FIXME [1]
-	LatticeNodeParameters* node_upper  = YADE_CAST&lt;LatticeNodeParameters*&gt;( (*(ncb-&gt;bodies))[upper ]-&gt;physicalParameters . get() );
-	(*(ncb-&gt;bodies))[upper ]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(1.0,1.0,0.0); // FIXME [1]
-	
-	// FIXME - zamiast &#182;ledzi&#230; tylko dwa punkty (jeden na dole i jeden u g&#243;ry), to lepiej zaznaczy&#230; dwa obszary punkt&#243;w i liczy&#230; &#182;redni&#177; ich po&#179;o&#191;enia,
-	// bo teraz, je&#182;li kt&#243;ry&#182; punkt zostanie wykasowany, to nie jest mo&#191;liwe kontynuowanie pomiar&#243;w.
-
-	Real	d  = horizontal;
-	Real	dd = ((node_right -&gt;se3.position[0] - node_left  -&gt;se3.position[0])-horizontal);
-	Real	L  = vertical;
-	Real	dL = ((node_upper -&gt;se3.position[1] - node_bottom-&gt;se3.position[1])-vertical  );
-
-	Real 	poisson1 = -1.0* ( (((node_right -&gt;se3.position[0] - node_left  -&gt;se3.position[0])-horizontal)/horizontal)
-			         / (((node_upper -&gt;se3.position[1] - node_bottom-&gt;se3.position[1])-vertical  )/vertical  ));
-	
-	Real 	poisson2 = -1.0* ( (dd/d)
-			          / (dL/L));
-
-	last20[(idx++)%20] = poisson2;
-	Real avg=0;
-	if(idx&gt;22)
-		for(int i=0;i&lt;20;i++)
-			avg+=last20[i]*0.05;
-
-	Real	poisson3 = std::log(d/(dd-d))/std::log(dL/L+1.0);
-	
-	ofile	&lt;&lt; lexical_cast&lt;string&gt;(poisson1) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(poisson2) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(poisson3) &lt;&lt; &quot; &quot; 
-		&lt;&lt; &quot; avg: &quot; &lt;&lt; lexical_cast&lt;string&gt;(avg) &lt;&lt; &quot; &quot; 
-		&lt;&lt; endl; 
-		
-	// [1]
-	// mark colors what is monitored - FIXME - provide a way to do that for ALL DataRecorders in that parent class.
-	// GLDrawSomething can just put a getClassName()
-	 
-}
-

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson/MeasurePoisson.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson/MeasurePoisson.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson/MeasurePoisson.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,46 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef POISSON_RECORDER_HPP
-#define POISSON_RECORDER_HPP
-
-#include&lt;yade/core/DataRecorder.hpp&gt;
-
-#include &lt;string&gt;
-#include &lt;fstream&gt;
-
-class MeasurePoisson : public DataRecorder
-{
-	private :
-		std::ofstream ofile; 
-		Real	last20[20];
-		int	idx;
-	
-
-	public :
-		std::string	 outputFile;
-		unsigned int	 interval;
-		Real 		 vertical,horizontal;
-		int		 bottom,upper,left,right;
-		
-		MeasurePoisson ();
-
-		virtual void registerAttributes();
-		virtual void action(Body* b);
-		virtual bool isActivated();
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-	REGISTER_CLASS_NAME(MeasurePoisson);
-	REGISTER_BASE_CLASS_NAME(DataRecorder);
-};
-
-REGISTER_SERIALIZABLE(MeasurePoisson,false);
-
-#endif // POISSON_RECORDER_HPP
-

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.cpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson/MeasurePoisson.cpp)

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson.hpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MeasurePoisson/MeasurePoisson.hpp)

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport/MovingSupport.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport/MovingSupport.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport/MovingSupport.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,188 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;MovingSupport.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include &quot;LatticeBeamParameters.hpp&quot;
-#include &quot;LatticeNodeParameters.hpp&quot;
-// to calculate strain of whole speciemen - first two bodies in subscribedBodies are Nodes. FIXME - make it clean!
-#include &lt;boost/lexical_cast.hpp&gt;
-
-MovingSupport::MovingSupport () : DataRecorder()
-{
-	subscribedBodies.clear();
-	first = true;
-	// FIXME ...
-        nodeGroupMask           = 1;
-        beamGroupMask           = 2;
-}
-
-
-void MovingSupport::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-//		first = true;
-//		subscribedBodies.clear();
-	}
-}
-
-
-void MovingSupport::registerAttributes()
-{
-	DataRecorder::registerAttributes();
-	REGISTER_ATTRIBUTE(sections);
-
-	REGISTER_ATTRIBUTE(first);
-	REGISTER_ATTRIBUTE(subscribedBodies);
-}
-
-
-bool MovingSupport::isActivated()
-{
-	return true;
-}
-
-
-void MovingSupport::action(Body * body)
-	// FIXME: about &quot;bool first&quot;:
-	// FIXME: maybe it could be added to initialiers, and called with a bool argument saying that the initialisation is performed. 
-{
-//	std::cerr &lt;&lt; &quot;MovingSupport quits\n&quot;;
-//	return;
-	
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
-
-	if(first)
-	{
-	// scan the sections and delete beams that cross each of them
-	// FIXME - this is still problematic, because this should be done only
-	// on the first run, regardless of saving/loading this file...
-		first = false;
-		subscribedBodies.resize( sections.size() );
-
-		std::list&lt;std::pair&lt;Vector3r,std::pair&lt;int,Real&gt; &gt; &gt;::iterator i  =sections.begin();
-		std::list&lt;std::pair&lt;Vector3r,std::pair&lt;int,Real&gt; &gt; &gt;::iterator end=sections.end();
-
-		for( int section=0 ; i != end ; ++i, ++section )
-		{
-			Vector3r midpoint = i-&gt;first;
-			Real     half     = i-&gt;second.second;
-			int	 dir	  = i-&gt;second.first;
-// std::vector
-//	&lt;
-//		std::pair
-//		&lt;
-//			std::list
-//			&lt;
-//				std::pair
-//				&lt;
-//					std::pair
-//					&lt;unsigned int,unsigned int&gt;
-//					,Real distance
-//				&gt;
-//			&gt;
-//			, int direction
-//		&gt;
-//	&gt;	subscribedBodies; // [region]&lt;(list of node pairs, distance), direction&gt;
-			if(!subscribedBodies[section].first.empty())
-				std::cerr &lt;&lt; &quot;First, but not empty\n&quot;;
-
-			subscribedBodies[section].second=dir; 
-
-			BodyContainer::iterator bi    = ncb-&gt;bodies-&gt;begin();
-			BodyContainer::iterator biEnd = ncb-&gt;bodies-&gt;end();
-			for(  ; bi!=biEnd ; ++bi )
-			{
-				if( (*bi)-&gt;getGroupMask() &amp; beamGroupMask )
-				{
-					Vector3r pos1 = (*(ncb-&gt;bodies))[static_cast&lt;LatticeBeamParameters*&gt;( (*bi)-&gt;physicalParameters.get() )-&gt;id1]-&gt;physicalParameters-&gt;se3.position; // beam first node
-					Vector3r pos2 = (*(ncb-&gt;bodies))[static_cast&lt;LatticeBeamParameters*&gt;( (*bi)-&gt;physicalParameters.get() )-&gt;id2]-&gt;physicalParameters-&gt;se3.position; // beam second node
-					
-					if( pos1[dir] &lt; pos2[dir] )
-						std::swap(pos1,pos2); // make sure that pos1[dir] is bigger 
-		
-					if(        pos1[dir] &gt; midpoint[dir]
-						&amp;&amp; pos2[dir] &lt; midpoint[dir] // beam crosses the plane!
-
-						&amp;&amp; pos1[(dir+1)%3] &gt; midpoint[(dir+1)%3]-half
-						&amp;&amp; pos1[(dir+1)%3] &lt; midpoint[(dir+1)%3]+half
-						&amp;&amp; pos2[(dir+1)%3] &gt; midpoint[(dir+1)%3]-half
-						&amp;&amp; pos2[(dir+1)%3] &lt; midpoint[(dir+1)%3]+half // both points are within halflength in direction (dir+1)%3
-
-						&amp;&amp; pos1[(dir+2)%3] &gt; midpoint[(dir+2)%3]-half
-						&amp;&amp; pos1[(dir+2)%3] &lt; midpoint[(dir+2)%3]+half
-						&amp;&amp; pos2[(dir+2)%3] &gt; midpoint[(dir+2)%3]-half
-						&amp;&amp; pos2[(dir+2)%3] &lt; midpoint[(dir+2)%3]+half // both points are within halflength in direction (dir+2)%3
-						)
-					{
-						subscribedBodies[section].first.push_back(
-							 std::make_pair( // push nodes
-								 std::make_pair(
-								 static_cast&lt;LatticeBeamParameters*&gt;( (*bi)-&gt;physicalParameters.get() )-&gt;id1
-								,static_cast&lt;LatticeBeamParameters*&gt;( (*bi)-&gt;physicalParameters.get() )-&gt;id2)
-								,
-								  (*(ncb-&gt;bodies))[static_cast&lt;LatticeBeamParameters*&gt;( (*bi)-&gt;physicalParameters.get() )-&gt;id1]-&gt;physicalParameters-&gt;se3.position[dir]
-								- (*(ncb-&gt;bodies))[static_cast&lt;LatticeBeamParameters*&gt;( (*bi)-&gt;physicalParameters.get() )-&gt;id2]-&gt;physicalParameters-&gt;se3.position[dir]
-								) ); 
-						futureDeletes.push_back( (*bi)-&gt;getId() );
-					}
-				}
-			}
-		}
-		// still first: delete
-		std::list&lt;unsigned int&gt;::iterator vend = futureDeletes.end();
-		for( std::list&lt;unsigned int&gt;::iterator vsta = futureDeletes.begin() ; vsta != vend ; ++vsta)
-			ncb-&gt;bodies-&gt;erase(*vsta); 
-	}
-
-
-	for( int section=0 ; section&lt;sections.size() ; ++section )
-	{
-	//	std::list&lt;unsigned int&gt;::iterator i   = subscribedBodies[section].first.begin();
-	//	std::list&lt;unsigned int&gt;::iterator end = subscribedBodies[section].first.end();
-		std::list&lt;std::pair&lt;std::pair&lt;unsigned int,unsigned int&gt;,Real&gt; &gt;::iterator i   = subscribedBodies[section].first.begin();
-		std::list&lt;std::pair&lt;std::pair&lt;unsigned int,unsigned int&gt;,Real&gt; &gt;::iterator end = subscribedBodies[section].first.end();
-		int dir                               = subscribedBodies[section].second;
-		
-		Real stress=0; // in direction 'dir'
-
-		for( ; i != end ; ++i )
-		{
-			unsigned int id1 = i-&gt;first.first;
-			unsigned int id2 = i-&gt;first.second;
-			Real        dist = i-&gt;second;
-			if( (*(ncb-&gt;bodies)).exists(id1) &amp;&amp; (*(ncb-&gt;bodies)).exists(id2) )
-			{
-				Real current_dist	= (*(ncb-&gt;bodies))[id1]-&gt;physicalParameters-&gt;se3.position[dir]
-							- (*(ncb-&gt;bodies))[id2]-&gt;physicalParameters-&gt;se3.position[dir];
-				Real delta = (dist - current_dist)/2.0;
-
-//				(*(ncb-&gt;bodies))[id1]-&gt;physicalParameters-&gt;se3.position[dir] += delta;
-//				(*(ncb-&gt;bodies))[id2]-&gt;physicalParameters-&gt;se3.position[dir] -= delta;
-
-				LatticeNodeParameters* node1 = static_cast&lt;LatticeNodeParameters*&gt;((*(ncb-&gt;bodies))[id1]-&gt;physicalParameters.get() );
-				LatticeNodeParameters* node2 = static_cast&lt;LatticeNodeParameters*&gt;((*(ncb-&gt;bodies))[id2]-&gt;physicalParameters.get() );
-//				++(node1-&gt;countIncremental);
-//				++(node2-&gt;countIncremental);
-				Vector3r DI(0,0,0);DI[dir]=delta;
-				node1-&gt;displacementIncremental += DI; 
-				node2-&gt;displacementIncremental -= DI;
-
-				(*(ncb-&gt;bodies))[id1]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(0.0,0.0,((float)section)/2.0); // FIXME [1]
-				(*(ncb-&gt;bodies))[id2]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(0.0,0.0,((float)section)/2.0); // FIXME [1]
-			}
-		}
-	}
-		
-	// [1]
-	// mark colors what is monitored - FIXME - provide a way to do that for ALL DataRecorders in that parent class.
-	// GLDrawSomething can just put a getClassName()
-	 
-}
-

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport/MovingSupport.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport/MovingSupport.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport/MovingSupport.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,52 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef NO_SHEAR_PLANE
-#define NO_SHEAR_PLANE
-
-#include&lt;yade/core/DataRecorder.hpp&gt;
-
-#include &lt;string&gt;
-#include &lt;fstream&gt;
-#include &lt;list&gt;
-#include &lt;vector&gt;
-
-//class PhysicalAction;
-
-class MovingSupport : public DataRecorder
-{ // given a section plane it deletes all the beams that cross it, and remembers the nodes that they did connect.
-  // Then it ensures that the nodes have constant distance in the 'direction' coordinate. But nodes can move in other directions
-  // thus it creates a place that transfers only displacement in 'direction' and ignores movement in other directions.
-  // It like a moving support.
-	private :
-		std::ofstream ofile; 
-		std::vector&lt;std::pair&lt;std::list&lt;std::pair&lt;std::pair&lt;unsigned int,unsigned int&gt;,Real&gt; &gt;, int&gt; &gt;	subscribedBodies; // [region]&lt;(list of node pairs,distance), direction&gt;
-		bool			first;
-		std::list&lt;unsigned int&gt; futureDeletes;
-		int			nodeGroupMask,beamGroupMask;
-
-	public :
-		std::list&lt;std::pair&lt;Vector3r,std::pair&lt; int , Real &gt; &gt; &gt; sections; // a list of section planes: &lt;a midpoint, direction , half length &gt;
-		// int direction refers to: which coordinate to take from the Beam's.direction: x, y or z (0, 1 or 2)
-
-		MovingSupport ();
-
-		virtual void registerAttributes();
-		virtual void action(Body* b);
-		virtual bool isActivated();
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-	REGISTER_CLASS_NAME(MovingSupport);
-	REGISTER_BASE_CLASS_NAME(DataRecorder);
-};
-
-REGISTER_SERIALIZABLE(MovingSupport,false);
-
-#endif // STRAIN_RECORDER_HPP 
-

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport.cpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport/MovingSupport.cpp)

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport.hpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/MovingSupport/MovingSupport.hpp)

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder/NodeRecorder.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder/NodeRecorder.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder/NodeRecorder.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,140 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;NodeRecorder.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include &quot;LatticeBeamParameters.hpp&quot;
-#include &quot;LatticeNodeParameters.hpp&quot;
-// to calculate strain of whole speciemen - first two bodies in subscribedBodies are Nodes. FIXME - make it clean!
-#include &lt;boost/lexical_cast.hpp&gt;
-
-
-NodeRecorder::NodeRecorder () : DataRecorder()
-{
-	outputFile = &quot;&quot;;
-	interval = 50;
-	subscribedBodies.clear();
-	first = true;
-	// FIXME ...
-        nodeGroupMask           = 1;
-        beamGroupMask           = 2;
-}
-
-
-void NodeRecorder::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-	//	outputFile += &quot;_&quot;+boost::lexical_cast&lt;std::string&gt;(Omega::instance().getTimeStep());
-	//	std::cerr &lt;&lt; &quot;using dt for NodeRecorder output file: &quot; &lt;&lt; outputFile &lt;&lt; &quot;\n&quot;;
-
-		ofile.open(outputFile.c_str());
-
-	}
-}
-
-
-void NodeRecorder::registerAttributes()
-{
-	DataRecorder::registerAttributes();
-	REGISTER_ATTRIBUTE(outputFile);
-	REGISTER_ATTRIBUTE(interval);
-	REGISTER_ATTRIBUTE(regions);
-
-	REGISTER_ATTRIBUTE(first);
-	REGISTER_ATTRIBUTE(subscribedBodies);
-}
-
-
-bool NodeRecorder::isActivated()
-{
-	return ((Omega::instance().getCurrentIteration() % interval == 0) &amp;&amp; (ofile));
-}
-
-
-void NodeRecorder::action(Body * body)
-{
-//	std::cerr &lt;&lt; &quot;NodeRecorder quits\n&quot;;
-//	return;
-	
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
-
-	if(first)
-	{
-	// scan the regions and subscribe bodies for each of them
-	// FIXME - this is still problematic, because this should be done only
-	// on the first run, regardless of saving/loading this file...
-		first = false;
-		subscribedBodies.resize( regions.size() );
-
-		std::list&lt;std::pair&lt;Vector3r,Vector3r&gt; &gt;::iterator i  =regions.begin();
-		std::list&lt;std::pair&lt;Vector3r,Vector3r&gt; &gt;::iterator end=regions.end();
-
-		for( int region=0 ; i != end ; ++i, ++region )
-		{
-			Vector3r min = i-&gt;first;
-			Vector3r max = i-&gt;second;
-
-			if(!subscribedBodies[region].empty())
-				std::cerr &lt;&lt; &quot;First, but not empty\n&quot;;
-
-			BodyContainer::iterator bi    = ncb-&gt;bodies-&gt;begin();
-			BodyContainer::iterator biEnd = ncb-&gt;bodies-&gt;end();
-			for(  ; bi!=biEnd ; ++bi )
-			{
-				if( (*bi)-&gt;getGroupMask() &amp; nodeGroupMask )
-				{
-					Vector3r pos = (*bi)-&gt;physicalParameters-&gt;se3.position;
-					if(        pos[0] &gt; min[0] 
-						&amp;&amp; pos[1] &gt; min[1] 
-						&amp;&amp; pos[2] &gt; min[2] 
-						&amp;&amp; pos[0] &lt; max[0] 
-						&amp;&amp; pos[1] &lt; max[1] 
-						&amp;&amp; pos[2] &lt; max[2] 
-						&amp;&amp; ((*bi)-&gt;getGroupMask() &amp; nodeGroupMask)
-					  )
-					{
-						subscribedBodies[region].push_back((*bi)-&gt;getId());
-					}
-				}
-			}
-		}
-	}
-
-	for( int region=0 ; region&lt;regions.size() ; ++region )
-	{
-		std::list&lt;unsigned int&gt;::iterator i   = subscribedBodies[region].begin();
-		std::list&lt;unsigned int&gt;::iterator end = subscribedBodies[region].end();
-		
-		Real count=0;
-		Vector3r sum=Vector3r(0,0,0);
-
-		for( ; i != end ; ++i )
-		{
-			if( (*(ncb-&gt;bodies)).exists(*i) )
-			{
-				sum+=(*(ncb-&gt;bodies))[*i]-&gt;physicalParameters-&gt;se3.position;
-				++count;
-				
-				(*(ncb-&gt;bodies))[*i]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(0.0,1.0,((float)region)/1.5); // FIXME [1]
-			}
-		}
-
-		sum/=count;
-
-		ofile	&lt;&lt; lexical_cast&lt;string&gt;(sum[0]) &lt;&lt; &quot; &quot; 
-			&lt;&lt; lexical_cast&lt;string&gt;(sum[1]) &lt;&lt; &quot; &quot; 
-			&lt;&lt; lexical_cast&lt;string&gt;(sum[2]) &lt;&lt; &quot; \t &quot;; 
-	}
-	ofile &lt;&lt; endl; 
-		
-	// [1]
-	// mark colors what is monitored - FIXME - provide a way to do that for ALL DataRecorders in that parent class.
-	// GLDrawSomething can just put a getClassName()
-}
-

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder/NodeRecorder.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder/NodeRecorder.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder/NodeRecorder.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,50 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef NODE_RECORDER_HPP
-#define NODE_RECORDER_HPP 
-
-#include&lt;yade/core/DataRecorder.hpp&gt;
-
-#include &lt;string&gt;
-#include &lt;fstream&gt;
-#include &lt;list&gt;
-#include &lt;vector&gt;
-
-//class PhysicalAction;
-
-class NodeRecorder : public DataRecorder
-{ // records average position of nodes in a given region
-	private :
-		std::ofstream ofile; 
-		
-		std::vector&lt;std::list&lt;unsigned int&gt; &gt;	subscribedBodies; // [region]&lt;list of bodies' ids&gt;
-		bool			first;
-		int			nodeGroupMask,beamGroupMask;
-
-	public :
-		std::string	 outputFile;
-		unsigned int	 interval;
-		std::list&lt;std::pair&lt;Vector3r,Vector3r&gt; &gt; regions; // a list of min/max pairs describing each region.
-
-		NodeRecorder ();
-
-		virtual void registerAttributes();
-		virtual void action(Body* b);
-		virtual bool isActivated();
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-	REGISTER_CLASS_NAME(NodeRecorder);
-	REGISTER_BASE_CLASS_NAME(DataRecorder);
-};
-
-REGISTER_SERIALIZABLE(NodeRecorder,false);
-
-#endif // STRAIN_RECORDER_HPP 
-

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.cpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder/NodeRecorder.cpp)

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder.hpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NodeRecorder/NodeRecorder.hpp)

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer/NonLocalInitializer.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer/NonLocalInitializer.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer/NonLocalInitializer.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,190 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;NonLocalInitializer.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include &quot;LatticeBeamParameters.hpp&quot;
-#include &quot;LatticeNodeParameters.hpp&quot;
-#include &quot;LatticeSetParameters.hpp&quot;
-#include &quot;NonLocalDependency.hpp&quot;
-
-
-NonLocalInitializer::NonLocalInitializer () : StandAloneEngine()
-{
-}
-
-NonLocalInitializer::~NonLocalInitializer ()
-{
-}
-
-void NonLocalInitializer::registerAttributes()
-{
-	StandAloneEngine::registerAttributes();
-	REGISTER_ATTRIBUTE(range);
-}
-
-bool NonLocalInitializer::calcNonLocal(Body* body1, Body* body2, BodyContainer* bodies, void* nonl)
-//void NonLocalInitializer::calcNonLocal(Body* body1, Body* body2, BodyContainer* bodies, InteractionContainer* nonl)
-//bool NonLocalInitializer::calcNonLocal(Body* body1, Body* body2, BodyContainer* bodies,//std::list&lt;std::list&lt;LatticeSetParameters::NonLocalInteraction&gt; &gt;
-//std::vector&lt;std::list&lt;LatticeSetParameters::NonLocalInteraction , std::__malloc_alloc_template&lt;sizeof(LatticeSetParameters::NonLocalInteraction)&gt; &gt; &gt;&amp; nonl)
-{
-	LatticeBeamParameters* beam1 	= static_cast&lt;LatticeBeamParameters*&gt;(body1-&gt;physicalParameters.get());
-	LatticeBeamParameters* beam2 	= static_cast&lt;LatticeBeamParameters*&gt;(body2-&gt;physicalParameters.get());
-	
-	static Real sqPi = std::sqrt(Mathr::PI);
-	
-	//bool exists = false;
-	/*
-	std::vector&lt;LatticeSetParameters::NonLocalInteraction&gt;::iterator nb = nonl.begin();
-	std::vector&lt;LatticeSetParameters::NonLocalInteraction&gt;::iterator ne = nonl.end();
-	for( ; nb != ne ; ++nb )
-		if( 	   ( nb-&gt;id1 == body1-&gt;getId() &amp;&amp; nb-&gt;id2 == body2-&gt;getId() )
-			|| ( nb-&gt;id2 == body1-&gt;getId() &amp;&amp; nb-&gt;id1 == body2-&gt;getId() ) )
-			{
-				exists = true;
-				break;
-			}
-	*/
-	
-	//std::list&lt;std::list&lt;LatticeSetParameters::NonLocalInteraction&gt; &gt;
-	/*
-	std::vector&lt;std::list&lt;LatticeSetParameters::NonLocalInteraction , std::__malloc_alloc_template&lt;sizeof(LatticeSetParameters::NonLocalInteraction)&gt; &gt; &gt;::iterator nonlOuter = nonl.begin();
-	
-	static unsigned long int check =0;
-	static unsigned long int idx = 0;
-	++check;
-	if(check &gt; 4294967290ul )
-	//if(check &gt; 90000 )
-	{
-		check = 0;
-		++idx;
-	}
-	if( idx &gt;= nonl.size() )
-	{
-		cerr &lt;&lt; &quot;making next list, first is full.\n&quot;;
-		nonl.resize( nonl.size()+1 );
-	}
-	for( int ii = 0 ; ii &lt; idx ; ++ii )
-		++nonlOuter;
-	*/	
-	/*
-	std::list&lt;std::list&lt;LatticeSetParameters::NonLocalInteraction&gt; &gt;::iterator nonlEnd   = nonl.end();
-	while( nonlOuter-&gt;size() == nonlOuter-&gt;max_size()-1 )
-	{
-		++nonlOuter;
-		if( nonlOuter == nonlEnd )
-		{
-			cerr &lt;&lt; &quot;making next list, first is full.\n&quot;;
-			nonl.resize( nonl.size()+1 );
-			nonlOuter = nonl.end();
-			--nonlOuter;
-			nonlEnd = nonl.end();
-		}
-	}
-	*/
-	
-	//if( ! nonl-&gt;find( body1-&gt;getId() , body2-&gt;getId() ) )
-	//if( ! exists )
-	{
-		Real sqDist = (beam1-&gt;se3.position - beam2-&gt;se3.position).SquaredLength();
-	//	Real dist = (beam1-&gt;se3.position - beam2-&gt;se3.position).length();
-		Real len  = range;
-		if( sqDist &lt; std::pow(3 * len,2) )
-	//	if( dist &lt; 3 * len )
-		// 3 * characteristic length give less than 0.1 % (2*  gives 1.83% and 1*  gives 37 % )
-		{
-			static unsigned long int total = 0;
-			//Real dist = sqrt(sqDist);
-			/*
-			shared_ptr&lt;Interaction&gt; 		interaction(new Interaction( body1-&gt;getId() , body2-&gt;getId() ));
-			shared_ptr&lt;NonLocalDependency&gt; 		nonLocal(new NonLocalDependency);
-			
-			nonLocal-&gt;gaussValue 			= std::exp( - std::pow( dist / len , 2) ) / ( len * sqPi );
-			
-			interaction-&gt;isReal			= true;
-			interaction-&gt;isNew 			= false;
-			interaction-&gt;interactionPhysics 	= nonLocal;
-			nonl-&gt;insert(interaction);
-			*/
-			LatticeSetParameters::NonLocalInteraction another;
-			//another.gaussValue 			= std::exp( - std::pow( dist / len , 2) ) / ( len * sqPi );
-	/////////		another.gaussValue 			= std::exp( - (sqDist/(len*len)) ) / ( len * sqPi );
-			another.id1 				= body1-&gt;getId();
-			another.id2 				= body2-&gt;getId();
-			//nonlOuter-&gt;push_back(another);
-			reinterpret_cast&lt;LatticeSetParameters::NonLocalInteraction *&gt;(nonl)[total] = another;
-			++total;
-			if( total &gt; 121637000ul )
-				cerr &lt;&lt; &quot;too much\n&quot;, exit(0);
-			return true;
-		}
-		else
-			return false;
-	} 
-}
-
-void NonLocalInitializer::action(Body * body)
-{
-	return; // YADEview
-
-	MetaBody * rootBody = static_cast&lt;MetaBody*&gt;(body);
-	int beamGroupMask = YADE_CAST&lt;LatticeSetParameters*&gt;(rootBody-&gt;physicalParameters.get())-&gt;beamGroupMask;
-	//std::list&lt;std::list&lt;LatticeSetParameters::NonLocalInteraction&gt; &gt;
-	//std::vector&lt;std::list&lt;LatticeSetParameters::NonLocalInteraction , std::__malloc_alloc_template&lt;sizeof(LatticeSetParameters::NonLocalInteraction)&gt; &gt; &gt;&amp; nonl = dynamic_cast&lt;LatticeSetParameters*&gt;(rootBody-&gt;physicalParameters.get())-&gt;nonl;
-	void* nonl = YADE_CAST&lt;LatticeSetParameters*&gt;(rootBody-&gt;physicalParameters.get())-&gt;nonl;
-	YADE_CAST&lt;LatticeSetParameters*&gt;(rootBody-&gt;physicalParameters.get())-&gt;range=range;
-
-	BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-	BodyContainer::iterator bi2;
-	BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-	
-	//rootBody-&gt;transientInteractions-&gt;clear();
-	//nonl.clear();
-	//nonl.resize(1);
-	
-	nonl = calloc(121637044ul,sizeof(LatticeSetParameters::NonLocalInteraction));
-	if( nonl == 0 )
-		cerr &lt;&lt; &quot;cannot allocate memory\n&quot;,exit(0);
-	YADE_CAST&lt;LatticeSetParameters*&gt;(rootBody-&gt;physicalParameters.get())-&gt;nonl = nonl;
-	
-	unsigned long int&amp; total = YADE_CAST&lt;LatticeSetParameters*&gt;(rootBody-&gt;physicalParameters.get())-&gt;total;
-	total=0;
-
-	int beam_counter = 0;
-	float nodes_a=0;
-	float nodes_all = rootBody-&gt;bodies-&gt;size();
-	for(  ; bi!=biEnd ; ++bi )  // loop over all beams to create non-local
-	{
-		Body* body1 = (*bi).get(); // first_node
-		
-		if( ! ( body1-&gt;getGroupMask() &amp; beamGroupMask ) )
-			continue; // skip non-beams
-			
-		//total++;
-		
-	
-		bi2 = bi;
-		nodes_a+=1.0;
-		
-		for( ; bi2!=biEnd ; ++bi2 )
-		{
-			Body* body2 = (*bi2).get(); // all other beams (including this one)
-
-			if( ! ( body2-&gt;getGroupMask() &amp; beamGroupMask ) )
-				continue; // skip non-beams
-			
-			//calcNonLocal(body1,body2,rootBody-&gt;bodies.get(),rootBody-&gt;transientInteractions.get());
-			if( calcNonLocal(body1,body2,rootBody-&gt;bodies.get(),nonl) )
-				++total; 
-		}
-		if( ++beam_counter % 400 == 0 )
-			cerr &lt;&lt; &quot;non-local dependency &quot;&lt;&lt; total &lt;&lt;&quot;: &quot; &lt;&lt; ((nodes_a/nodes_all)*100.0)  &lt;&lt; &quot; %\n&quot;; 
-	}
-//	cerr &lt;&lt; &quot;number of beams: &quot; &lt;&lt; total &lt;&lt; &quot;\n&quot;;
-}
-

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer/NonLocalInitializer.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer/NonLocalInitializer.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer/NonLocalInitializer.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,42 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef NONLOCALINITIALIZER_HPP
-#define NONLOCALINITIALIZER_HPP
-
-#include&lt;yade/core/StandAloneEngine.hpp&gt;
-#include &quot;LatticeSetParameters.hpp&quot;
-
-class Body;
-class BodyContainer;
-class InteractionContainer; 
-
-class NonLocalInitializer : public StandAloneEngine
-{
-	private:
-		//void calcNonLocal(Body* body1, Body* body2, BodyContainer* bodies,InteractionContainer* ints);
-		//bool calcNonLocal(Body* body1, Body* body2, BodyContainer* bodies,std::vector&lt;std::list&lt;LatticeSetParameters::NonLocalInteraction , std::__malloc_alloc_template&lt;sizeof(LatticeSetParameters::NonLocalInteraction)&gt; &gt; &gt;&amp; nonl);
-		bool calcNonLocal(Body* body1, Body* body2, BodyContainer* bodies,void* nonl);
-
-	public :
-		Real 	range;
-		
-		NonLocalInitializer ();
-		virtual ~NonLocalInitializer ();
-		virtual void action(Body* b);
-
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(NonLocalInitializer);
-	REGISTER_BASE_CLASS_NAME(StandAloneEngine);
-};
-
-REGISTER_SERIALIZABLE(NonLocalInitializer,false);
-
-#endif // NONLOCALINITIALIZER_HPP
-

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.cpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer/NonLocalInitializer.cpp)

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer.hpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/NonLocalInitializer/NonLocalInitializer.hpp)

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder/StrainRecorder.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder/StrainRecorder.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder/StrainRecorder.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,110 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;StrainRecorder.hpp&quot;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include &quot;LatticeBeamParameters.hpp&quot;
-#include &quot;LatticeNodeParameters.hpp&quot;
-// to calculate strain of whole speciemen - first two bodies in subscribedBodies are Nodes. FIXME - make it clean!
-#include &lt;boost/lexical_cast.hpp&gt;
-
-
-StrainRecorder::StrainRecorder () : DataRecorder()
-{
-	outputFile = &quot;&quot;;
-	interval = 50;
-	subscribedBodies.clear();
-}
-
-
-void StrainRecorder::postProcessAttributes(bool deserializing)
-{
-	if(deserializing)
-	{
-	//	outputFile += &quot;_&quot;+boost::lexical_cast&lt;std::string&gt;(Omega::instance().getTimeStep());
-	//	std::cerr &lt;&lt; &quot;using dt for StrainRecorder output file: &quot; &lt;&lt; outputFile &lt;&lt; &quot;\n&quot;;
-
-		ofile.open(outputFile.c_str());
-
-	}
-}
-
-
-void StrainRecorder::registerAttributes()
-{
-	DataRecorder::registerAttributes();
-	REGISTER_ATTRIBUTE(outputFile);
-	REGISTER_ATTRIBUTE(interval);
-	REGISTER_ATTRIBUTE(subscribedBodies);
-	REGISTER_ATTRIBUTE(initialLength);
-}
-
-
-bool StrainRecorder::isActivated()
-{
-	return ((Omega::instance().getCurrentIteration() % interval == 0) &amp;&amp; (ofile));
-}
-
-
-void StrainRecorder::action(Body * body)
-{
-//	std::cerr &lt;&lt; &quot;StrainRecorder quits\n&quot;;
-//	return;
-	
-	MetaBody * ncb = static_cast&lt;MetaBody*&gt;(body);
-	Real strain_y=0,stress_y=0;//,stress_nonlocal_y=0;
-	
-	std::vector&lt;unsigned int&gt;::iterator i   = subscribedBodies.begin();
-	std::vector&lt;unsigned int&gt;::iterator end = subscribedBodies.end();
-	
-	if(!ncb-&gt;bodies-&gt;exists(*i)) std::cerr &lt;&lt; &quot;StrainRecorder missing node\n&quot;, exit(1);
-	LatticeNodeParameters* node1 = YADE_CAST&lt;LatticeNodeParameters*&gt;( (*(ncb-&gt;bodies))[*i]-&gt;physicalParameters . get() );
-	(*(ncb-&gt;bodies))[*i]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(1.0,0.0,0.0); // FIXME [1]
-	++i;
-	if(!ncb-&gt;bodies-&gt;exists(*i)) std::cerr &lt;&lt; &quot;StrainRecorder missing node\n&quot;, exit(1);
-	LatticeNodeParameters* node2 = YADE_CAST&lt;LatticeNodeParameters*&gt;( (*(ncb-&gt;bodies))[*i]-&gt;physicalParameters . get() );
-	(*(ncb-&gt;bodies))[*i]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(1.0,0.0,0.0); // FIXME [1]
-	++i;
-	// FIXME - zamiast &#182;ledzi&#230; tylko dwa punkty (jeden na dole i jeden u g&#243;ry), to lepiej zaznaczy&#230; dwa obszary punkt&#243;w i liczy&#230; &#182;redni&#177; ich po&#179;o&#191;enia,
-	// bo teraz, je&#182;li kt&#243;ry&#182; punkt zostanie wykasowany, to nie jest mo&#191;liwe kontynuowanie pomiar&#243;w.
-	
-	Real 		currentLength = node1-&gt;se3.position[1] - node2-&gt;se3.position[1];
-	
-	strain_y = (currentLength - initialLength) / initialLength; // odkszta&#179;cenie ca&#179;ej pr&#243;bki
-	
-	//bool nonlocal = false;
-	//if (ncb-&gt;transientInteractions-&gt;size() != 0) // it's non-local
-	//	nonlocal = true;
-	
-	for( ; i != end ; ++i )
-	{
-		if( (*(ncb-&gt;bodies)).exists(*i) )
-		{
-			LatticeBeamParameters* beam 	= static_cast&lt;LatticeBeamParameters*&gt;( (*(ncb-&gt;bodies))[*i]-&gt;physicalParameters . get() );
-			Real s_y 			= beam-&gt;strain() * std::abs(beam-&gt;direction[1]) * beam-&gt;longitudalStiffness; // direction is a unit vector, so direction[1] is cos(angle_to_y)
-			//Real s_nonl_y =0;
-			//if(nonlocal)
-			//	s_nonl_y 		= (beam-&gt;nonLocalStrain / beam-&gt;nonLocalDivisor) * std::abs(beam-&gt;direction[1]);
-			(*(ncb-&gt;bodies))[*i]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(0.0,1.0,1.0); // FIXME [1]
-			stress_y += s_y;
-			//stress_nonlocal_y += s_nonl_y;
-		}
-	}
-	
-	//ofile &lt;&lt; lexical_cast&lt;string&gt;(Omega::instance().getSimulationTime()) &lt;&lt; &quot; &quot; 
-	ofile	&lt;&lt; lexical_cast&lt;string&gt;(strain_y) &lt;&lt; &quot; &quot; 
-		&lt;&lt; lexical_cast&lt;string&gt;(stress_y)// &lt;&lt; &quot; &quot; 
-		//&lt;&lt; lexical_cast&lt;string&gt;(stress_nonlocal_y)
-		&lt;&lt; endl; 
-		
-	// [1]
-	// mark colors what is monitored - FIXME - provide a way to do that for ALL DataRecorders in that parent class.
-	// GLDrawSomething can just put a getClassName()
-	 
-}
-

Deleted: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder/StrainRecorder.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder/StrainRecorder.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder/StrainRecorder.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,46 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef STRAIN_RECORDER_HPP
-#define STRAIN_RECORDER_HPP 
-
-#include&lt;yade/core/DataRecorder.hpp&gt;
-
-#include &lt;string&gt;
-#include &lt;fstream&gt;
-
-//class PhysicalAction;
-
-class StrainRecorder : public DataRecorder
-{
-	private :
-//		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		std::ofstream ofile; 
-
-	public :
-		std::string	 outputFile;
-		unsigned int	 interval;
-		std::vector&lt;unsigned int&gt; subscribedBodies;
-		Real 		 initialLength;
-
-		StrainRecorder ();
-
-		virtual void registerAttributes();
-		virtual void action(Body* b);
-		virtual bool isActivated();
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-	REGISTER_CLASS_NAME(StrainRecorder);
-	REGISTER_BASE_CLASS_NAME(DataRecorder);
-};
-
-REGISTER_SERIALIZABLE(StrainRecorder,false);
-
-#endif // STRAIN_RECORDER_HPP 
-

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.cpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder/StrainRecorder.cpp)

Copied: branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder.hpp (from rev 1105, branches/scons-layout/pkg/lattice/Engine/StandAloneEngine/StrainRecorder/StrainRecorder.hpp)

Deleted: branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample/LatticeExample.cpp
===================================================================
--- branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample/LatticeExample.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample/LatticeExample.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,1440 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;LatticeExample.hpp&quot;
-
-#include &quot;LatticeSetParameters.hpp&quot;
-#include &quot;LatticeBeamParameters.hpp&quot;
-#include &quot;LatticeBeamAngularSpring.hpp&quot;
-#include &quot;NonLocalDependency.hpp&quot;
-#include &quot;LatticeNodeParameters.hpp&quot;
-#include &quot;LineSegment.hpp&quot;
-#include &quot;LatticeLaw.hpp&quot;
-#include &quot;StrainRecorder.hpp&quot;
-#include &quot;NodeRecorder.hpp&quot;
-#include &quot;BeamRecorder.hpp&quot;
-#include &quot;MovingSupport.hpp&quot;
-#include &quot;MeasurePoisson.hpp&quot;
-#include &quot;NonLocalInitializer.hpp&quot;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-#include &quot;LatticeInteractingGeometry.hpp&quot;
-
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/GeometricalModelMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-#include&lt;yade/pkg-common/DisplacementEngine.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-#include&lt;yade/pkg-common/Quadrilateral.hpp&gt;
-#include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-
-// Delaunay
-#include &lt;Wm3Delaunay3.h&gt;
-#include &lt;Wm3Delaunay2.h&gt;
-#include &lt;Wm3Query.h&gt;
-
-using namespace boost;
-using namespace std;
-
-
-LatticeExample::LatticeExample() : FileGenerator()
-{
-        nodeGroupMask           = 1;
-        beamGroupMask           = 2;
-	quadGroupMask		= 4;
-        
-        speciemen_size_in_meters = Vector3r(0.1,0.1,0.0001);
-        cellsizeUnit_in_meters   = 0.003;
-	use_Delaunay		 = true;
-        minAngle_betweenBeams_deg= 20.0;
-        disorder_in_cellsizeUnit = Vector3r(0.6,0.6,0.0);
-        maxLength_in_cellsizeUnit= 1.9;
-        triangularBaseGrid       = true;
-        triangularBaseGrid3D     = true;
-        useNonLocalModel         = false;
-        useBendTensileSoftening  = false;
-        useStiffnessSoftening    = false;
-        nonLocalL_in_cellsizeUnit= 1.1;         // l
-                                
-        crit_TensileStrain       = 1.0; // E_min
-        crit_ComprStrain         = 0.5; // E_max
-                        
-        longitudalStiffness_noUnit= 1.0;        // k_l
-        bendingStiffness_noUnit   = 0.6;        // k_b
-        torsionalStiffness_noUnit = 0.6;        // k_t
-        
-        ensure2D 		 = false;
-        roughEdges 		 = false;
-	calculate_Torsion	 = false;
-	quads			 = false;
-        
-        region_A_min             = Vector3r(-0.006, 0.096,-1);
-        region_A_max             = Vector3r( 0.16 , 0.16 , 1);
-	direction_A 		 = Vector3r(0,1,0);
-	displacement_A_meters	 = 0.0001;
-	
-	region_B_min 		 = Vector3r(-0.006,-0.006,-1);
-	region_B_max 		 = Vector3r( 0.16 , 0.004, 1);
-	direction_B 		 = Vector3r(0,-1,0);
-	displacement_B_meters	 = 0.0001;
-
-	region_C_min 		 = Vector3r(-0.006, 0.096,-1);
-	region_C_max 		 = Vector3r( 0.16 , 0.16 ,-1);
-	direction_C 		 = Vector3r(0,1,0);
-	displacement_C_meters	 = 0.0001;
-	
-	region_D_min 		 = Vector3r(-0.006,-0.006,-1);
-	region_D_max 		 = Vector3r( 0.16 , 0.004,-1);
-        direction_D              = Vector3r(0,-1,0);
-        displacement_D_meters    = 0.0001;
-        
-	region_E_min 		 = Vector3r(0,0,-1);
-	region_E_max 		 = Vector3r(0,0,-1);
-        direction_E              = Vector3r(0,1,0);
-        displacement_E_meters    = 0.0;
-        
-	region_F_min 		 = Vector3r(0,0,-1);
-	region_F_max 		 = Vector3r(0,0,-1);
-        direction_F              = Vector3r(0,1,0);
-        displacement_F_meters    = 0.0;
-        
-        strainRecorder_xz_plane  = -1;
-        strainRecorder_node1     = Vector3r(0,0,0);
-        strainRecorder_node2     = Vector3r(0,1,0);
-        measurePoisson_node3     = Vector3r(0  ,0.1,0);
-        measurePoisson_node4     = Vector3r(0.2,0.1,0);
-        outputFile               = &quot;../data/strains&quot;;
-        poissonFile              = &quot;../data/poisson&quot;;
-        nodeRecorderFile         = &quot;../data/npos&quot;;
-        beamRecorderFile         = &quot;../data/bstr&quot;;
-        subscribedBodies.clear();
-                
-        regionDelete_A_min       = Vector3r(0,0,0);
-        regionDelete_A_max       = Vector3r(0,0,0);
-        regionDelete_B_min       = Vector3r(0,0,0);
-        regionDelete_B_max       = Vector3r(0,0,0);
-        regionDelete_C_min       = Vector3r(0,0,0);
-        regionDelete_C_max       = Vector3r(0,0,0);
-        regionDelete_D_min       = Vector3r(0,0,0);
-        regionDelete_D_max       = Vector3r(0,0,0);
-        regionDelete_E_min       = Vector3r(0,0,0);
-        regionDelete_E_max       = Vector3r(0,0,0);
-        regionDelete_F_min       = Vector3r(0,0,0);
-        regionDelete_F_max       = Vector3r(0,0,0);
-
-        regionDelete_1_min       = Vector3r(0,0,0);
-        regionDelete_1_max       = Vector3r(0,0,0);
-        regionDelete_2_min       = Vector3r(0,0,0);
-        regionDelete_2_max       = Vector3r(0,0,0);
-        regionDelete_3_min       = Vector3r(0,0,0);
-        regionDelete_3_max       = Vector3r(0,0,0);
-        regionDelete_4_min       = Vector3r(0,0,0);
-        regionDelete_4_max       = Vector3r(0,0,0);
-        regionDelete_5_min       = Vector3r(0,0,0);
-        regionDelete_5_max       = Vector3r(0,0,0);
-
-        nonDestroy_A_min         = Vector3r(0,0,0);
-        nonDestroy_A_max         = Vector3r(0,0,0);
-        nonDestroy_B_min         = Vector3r(0,0,0);
-        nonDestroy_B_max         = Vector3r(0,0,0);
-
-	CT_A_min		 = Vector3r(0,0,-1);
-	CT_A_max		 = Vector3r(0,0,-1);
-	CT_B_min		 = Vector3r(0,0,-1);
-	CT_B_max		 = Vector3r(0,0,-1);
-	CT			 = 1;
-
-        useAggregates            = false;
-        aggregatePercent         = 40;
-        aggregateMeanDiameter    = cellsizeUnit_in_meters*1;
-        aggregateSigmaDiameter   = cellsizeUnit_in_meters*2;
-        aggregateMinDiameter     = cellsizeUnit_in_meters*2;
-        aggregateMaxDiameter     = cellsizeUnit_in_meters*4;
-        // MaterialParameters of aggregate
-        agg_longStiffness_noUnit = 3.0;                                 // k_l aggregate
-        agg_bendStiffness_noUnit = 2.1;                                 // k_b aggregate
-        agg_torsStiffness_noUnit = 2.1;                                 // k_b aggregate
-        agg_critCompressStrain   = 100.0;                               // E.c aggregate
-        agg_critTensileStrain    = 50.0;                                // E.l aggregate
-        // MaterialParameters of bond
-        bond_longStiffness_noUnit= 0.7;                                 // k_l bond
-        bond_bendStiffness_noUnit= 0.28;                                // k_b bond
-        bond_torsStiffness_noUnit= 0.28;                                // k_b bond
-        bond_critCompressStrain  = 100.0;                               // E.c bond
-        bond_critTensileStrain   = 50.0;                                // E.l bond
-		
-	nodeRec_A_min=Vector3r(0,0,0);
-	nodeRec_A_max=Vector3r(0,0,0);
-	nodeRec_B_min=Vector3r(0,0,0);
-	nodeRec_B_max=Vector3r(0,0,0);
-	nodeRec_C_min=Vector3r(0,0,0);
-	nodeRec_C_max=Vector3r(0,0,0);
-	nodeRec_D_min=Vector3r(0,0,0);
-	nodeRec_D_max=Vector3r(0,0,0);
-	nodeRec_E_min=Vector3r(0,0,0);
-	nodeRec_E_max=Vector3r(0,0,0);
-	nodeRec_F_min=Vector3r(0,0,0);
-	nodeRec_F_max=Vector3r(0,0,0);
-	
-	beamRec_A_pos=Vector3r(0,0,0);
-	beamRec_B_pos=Vector3r(0,0,0);
-	beamRec_C_pos=Vector3r(0,0,0);
-	beamRec_D_pos=Vector3r(0,0,0);
-	beamRec_E_pos=Vector3r(0,0,0);
-
-	beamRec_A_range=0;
-	beamRec_B_range=0;
-	beamRec_C_range=0;
-	beamRec_D_range=0;
-	beamRec_E_range=0;
-
-	beamRec_A_dir=-1;
-	beamRec_B_dir=-1;
-	beamRec_C_dir=-1;
-	beamRec_D_dir=-1;
-	beamRec_E_dir=-1;
-		
-	movSupp_A_pos=Vector3r(0,0,0);
-	movSupp_A_range=0;
-	movSupp_A_dir=-1;
-
-	movSupp_B_pos=Vector3r(0,0,0);
-	movSupp_B_range=0;
-	movSupp_B_dir=-1;
-
-	movSupp_C_pos=Vector3r(0,0,0);
-	movSupp_C_range=0;
-	movSupp_C_dir=-1;
-
-	movSupp_D_pos=Vector3r(0,0,0);
-	movSupp_D_range=0;
-	movSupp_D_dir=-1;
-}
-
-
-LatticeExample::~LatticeExample()
-{
-
-}
-
-
-void LatticeExample::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	REGISTER_ATTRIBUTE(speciemen_size_in_meters); 	// size
-	REGISTER_ATTRIBUTE(cellsizeUnit_in_meters);	// g [m]  	- cell size
-	REGISTER_ATTRIBUTE(minAngle_betweenBeams_deg); 	// a [deg] 	- min angle
-        REGISTER_ATTRIBUTE(disorder_in_cellsizeUnit);   // s [-]        - disorder 
-        REGISTER_ATTRIBUTE(maxLength_in_cellsizeUnit);  // r [-]        - max beam length
-	REGISTER_ATTRIBUTE(use_Delaunay);
-        
-        REGISTER_ATTRIBUTE(crit_TensileStrain);         // E_min [%]    - default 0.02 %
-        REGISTER_ATTRIBUTE(crit_ComprStrain);           // E_max [%]    - default 0.2 %
-        REGISTER_ATTRIBUTE(longitudalStiffness_noUnit); // k_l [-]      - default 1.0
-        REGISTER_ATTRIBUTE(bendingStiffness_noUnit);    // k_b [-]      - default 0.6
-        REGISTER_ATTRIBUTE(torsionalStiffness_noUnit);  // k_t [-]      - default 0.6
-        
-        REGISTER_ATTRIBUTE(ensure2D);
-        REGISTER_ATTRIBUTE(roughEdges);
-        REGISTER_ATTRIBUTE(calculate_Torsion);
-        REGISTER_ATTRIBUTE(quads);
-        
-        REGISTER_ATTRIBUTE(triangularBaseGrid);         //              - triangles
-        REGISTER_ATTRIBUTE(triangularBaseGrid3D);       //              - triangles 3d
-        REGISTER_ATTRIBUTE(useBendTensileSoftening);
-        REGISTER_ATTRIBUTE(useStiffnessSoftening);
-        REGISTER_ATTRIBUTE(useNonLocalModel);
-        REGISTER_ATTRIBUTE(nonLocalL_in_cellsizeUnit);  // l
-        
-	REGISTER_ATTRIBUTE(region_A_min);
-	REGISTER_ATTRIBUTE(region_A_max);
-	REGISTER_ATTRIBUTE(direction_A);
-	REGISTER_ATTRIBUTE(displacement_A_meters);
-	
-	REGISTER_ATTRIBUTE(region_B_min);
-	REGISTER_ATTRIBUTE(region_B_max);
-	REGISTER_ATTRIBUTE(direction_B);
-	REGISTER_ATTRIBUTE(displacement_B_meters);
-	
-	REGISTER_ATTRIBUTE(region_C_min);
-	REGISTER_ATTRIBUTE(region_C_max);
-	REGISTER_ATTRIBUTE(direction_C);
-	REGISTER_ATTRIBUTE(displacement_C_meters);
-	
-	REGISTER_ATTRIBUTE(region_D_min);
-        REGISTER_ATTRIBUTE(region_D_max);
-        REGISTER_ATTRIBUTE(direction_D);
-        REGISTER_ATTRIBUTE(displacement_D_meters);
-        
-	REGISTER_ATTRIBUTE(region_E_min);
-        REGISTER_ATTRIBUTE(region_E_max);
-        REGISTER_ATTRIBUTE(direction_E);
-        REGISTER_ATTRIBUTE(displacement_E_meters);
-        
-	REGISTER_ATTRIBUTE(region_F_min);
-        REGISTER_ATTRIBUTE(region_F_max);
-        REGISTER_ATTRIBUTE(direction_F);
-        REGISTER_ATTRIBUTE(displacement_F_meters);
-        
-	REGISTER_ATTRIBUTE(outputFile);
-        REGISTER_ATTRIBUTE(strainRecorder_xz_plane);
-        REGISTER_ATTRIBUTE(strainRecorder_node1);
-        REGISTER_ATTRIBUTE(strainRecorder_node2);
-
-        REGISTER_ATTRIBUTE(poissonFile);
-        REGISTER_ATTRIBUTE(measurePoisson_node3);
-        REGISTER_ATTRIBUTE(measurePoisson_node4);
-
-
-	REGISTER_ATTRIBUTE(nodeRecorderFile);
-	REGISTER_ATTRIBUTE(nodeRec_A_min);
-	REGISTER_ATTRIBUTE(nodeRec_A_max);
-	REGISTER_ATTRIBUTE(nodeRec_B_min);
-	REGISTER_ATTRIBUTE(nodeRec_B_max);
-	REGISTER_ATTRIBUTE(nodeRec_C_min);
-	REGISTER_ATTRIBUTE(nodeRec_C_max);
-	REGISTER_ATTRIBUTE(nodeRec_D_min);
-	REGISTER_ATTRIBUTE(nodeRec_D_max);
-	REGISTER_ATTRIBUTE(nodeRec_E_min);
-	REGISTER_ATTRIBUTE(nodeRec_E_max);
-	REGISTER_ATTRIBUTE(nodeRec_F_min);
-	REGISTER_ATTRIBUTE(nodeRec_F_max);
-	
-	REGISTER_ATTRIBUTE(beamRecorderFile);
-	REGISTER_ATTRIBUTE(beamRec_A_dir);
-	REGISTER_ATTRIBUTE(beamRec_A_pos);
-	REGISTER_ATTRIBUTE(beamRec_A_range);
-	REGISTER_ATTRIBUTE(beamRec_B_dir);
-	REGISTER_ATTRIBUTE(beamRec_B_pos);
-	REGISTER_ATTRIBUTE(beamRec_B_range);
-	REGISTER_ATTRIBUTE(beamRec_C_dir);
-	REGISTER_ATTRIBUTE(beamRec_C_pos);
-	REGISTER_ATTRIBUTE(beamRec_C_range);
-	REGISTER_ATTRIBUTE(beamRec_D_dir);
-	REGISTER_ATTRIBUTE(beamRec_D_pos);
-	REGISTER_ATTRIBUTE(beamRec_D_range);
-	REGISTER_ATTRIBUTE(beamRec_E_dir);
-	REGISTER_ATTRIBUTE(beamRec_E_pos);
-	REGISTER_ATTRIBUTE(beamRec_E_range);
-
-	REGISTER_ATTRIBUTE(movSupp_A_dir);
-	REGISTER_ATTRIBUTE(movSupp_A_pos);
-	REGISTER_ATTRIBUTE(movSupp_A_range);
-	REGISTER_ATTRIBUTE(movSupp_B_dir);
-	REGISTER_ATTRIBUTE(movSupp_B_pos);
-	REGISTER_ATTRIBUTE(movSupp_B_range);
-	REGISTER_ATTRIBUTE(movSupp_C_dir);
-	REGISTER_ATTRIBUTE(movSupp_C_pos);
-	REGISTER_ATTRIBUTE(movSupp_C_range);
-	REGISTER_ATTRIBUTE(movSupp_D_dir);
-	REGISTER_ATTRIBUTE(movSupp_D_pos);
-	REGISTER_ATTRIBUTE(movSupp_D_range);
-
-        REGISTER_ATTRIBUTE(regionDelete_A_min);
-        REGISTER_ATTRIBUTE(regionDelete_A_max);
-        REGISTER_ATTRIBUTE(regionDelete_B_min);
-        REGISTER_ATTRIBUTE(regionDelete_B_max);
-        REGISTER_ATTRIBUTE(regionDelete_C_min);
-        REGISTER_ATTRIBUTE(regionDelete_C_max);
-        REGISTER_ATTRIBUTE(regionDelete_D_min);
-        REGISTER_ATTRIBUTE(regionDelete_D_max);
-        REGISTER_ATTRIBUTE(regionDelete_E_min);
-        REGISTER_ATTRIBUTE(regionDelete_E_max);
-        REGISTER_ATTRIBUTE(regionDelete_F_min);
-        REGISTER_ATTRIBUTE(regionDelete_F_max);
-
-        REGISTER_ATTRIBUTE(regionDelete_1_min);
-        REGISTER_ATTRIBUTE(regionDelete_1_max);
-        REGISTER_ATTRIBUTE(regionDelete_2_min);
-        REGISTER_ATTRIBUTE(regionDelete_2_max);
-        REGISTER_ATTRIBUTE(regionDelete_3_min);
-        REGISTER_ATTRIBUTE(regionDelete_3_max);
-        REGISTER_ATTRIBUTE(regionDelete_4_min);
-        REGISTER_ATTRIBUTE(regionDelete_4_max);
-        REGISTER_ATTRIBUTE(regionDelete_5_min);
-        REGISTER_ATTRIBUTE(regionDelete_5_max);
-
-        REGISTER_ATTRIBUTE(nonDestroy_A_min);
-        REGISTER_ATTRIBUTE(nonDestroy_A_max);
-        REGISTER_ATTRIBUTE(nonDestroy_B_min);
-        REGISTER_ATTRIBUTE(nonDestroy_B_max);
-       
-	REGISTER_ATTRIBUTE(CT);
-	REGISTER_ATTRIBUTE(CT_A_min);
-        REGISTER_ATTRIBUTE(CT_A_max);
-        REGISTER_ATTRIBUTE(CT_B_min);
-        REGISTER_ATTRIBUTE(CT_B_max);
-
-        REGISTER_ATTRIBUTE(useAggregates);
-        REGISTER_ATTRIBUTE(aggregatePercent);
-        REGISTER_ATTRIBUTE(aggregateMeanDiameter);
-        REGISTER_ATTRIBUTE(aggregateSigmaDiameter);
-        REGISTER_ATTRIBUTE(aggregateMinDiameter);
-        REGISTER_ATTRIBUTE(aggregateMaxDiameter);
-        // MaterialParameters of aggregate
-        REGISTER_ATTRIBUTE(agg_longStiffness_noUnit);
-        REGISTER_ATTRIBUTE(agg_bendStiffness_noUnit);
-        REGISTER_ATTRIBUTE(agg_torsStiffness_noUnit);
-        REGISTER_ATTRIBUTE(agg_critCompressStrain);
-        REGISTER_ATTRIBUTE(agg_critTensileStrain);
-        // MaterialParameters of bond
-        REGISTER_ATTRIBUTE(bond_longStiffness_noUnit);
-        REGISTER_ATTRIBUTE(bond_bendStiffness_noUnit);
-        REGISTER_ATTRIBUTE(bond_torsStiffness_noUnit);
-        REGISTER_ATTRIBUTE(bond_critCompressStrain);
-        REGISTER_ATTRIBUTE(bond_critTensileStrain);
-}
-
-string LatticeExample::generate()
-{
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-	createActors(rootBody);
-	positionRootBody(rootBody);
-	
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-
-	
-	shared_ptr&lt;Body&gt; body;
-	
-	Vector3r nbNodes = speciemen_size_in_meters / cellsizeUnit_in_meters;
-	if(triangularBaseGrid)
-		nbNodes[1] *= 1.15471; // bigger by sqrt(3)/2 factor
-	if(triangularBaseGrid3D)
-		nbNodes[2] *= 1.22475; // bigger by (1/3)*(sqrt(6)) factor
-
-
-	bool FLAT = speciemen_size_in_meters[2]&lt;cellsizeUnit_in_meters;
-	std::vector&lt;Vector2r&gt; vert2; vert2.clear(); // Delaunay
-	std::vector&lt;Vector3r&gt; vert3; vert3.clear(); // Delaunay
-
-        unsigned int totalNodesCount = 0;
-	{
-		setMessage(&quot;creating nodes...&quot;);
-		float all = nbNodes[0]*nbNodes[1]*nbNodes[2];
-		float current = 0.0;
-
-		for( int j=0 ; j&lt;=nbNodes[1] ; j++ )
-		{
-			if(shouldTerminate()) return &quot;&quot;;
-
-			for( int i=0 ; i&lt;=nbNodes[0] ; i++ )
-				for( int k=0 ; k&lt;=nbNodes[2] ; k++)
-				{
-					setProgress(current++/all);
-
-					shared_ptr&lt;Body&gt; node;
-					if(createNode(node,i,j,k) || quads)
-					{
-						rootBody-&gt;bodies-&gt;insert(node), ++totalNodesCount;
-						if(FLAT)
-							vert2.push_back(Vector2r(node-&gt;physicalParameters-&gt;se3.position[0],node-&gt;physicalParameters-&gt;se3.position[1])); // Delaunay
-						else
-							vert3.push_back(node-&gt;physicalParameters-&gt;se3.position); // Delaunay
-					}
-				}
-		}
-	}
-
-        BodyRedirectionVector bc;
-        bc.clear();
-
-	BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-	BodyContainer::iterator bi2;
-	BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-
-	if(use_Delaunay) // create beams, Delaunay
-	{
-		std::set&lt; std::pair&lt;int,int&gt; &gt; pairs;
-		int I,J;
-		if(FLAT)
-		{
-			setProgress(0); setMessage(&quot;Delaunay 2d...&quot;);
-			Delaunay2&lt;Real&gt; del2(vert2.size(),&amp;(vert2[0]),cellsizeUnit_in_meters/50,false, Query::QT_INTEGER); // Delaunay
-
-			int del2_i = 0;
-			int del2_ind[3];
-			while(del2.GetIndexSet(del2_i++,del2_ind))
-			{
-				if(shouldTerminate()) return &quot;&quot;;
-				setProgress((float)del2_i/(float)del2.GetSimplexQuantity());
-				shared_ptr&lt;Body&gt; beam;
-
-				for(int zzz=0 ; zzz&lt;3 ; ++zzz)
-				{
-					I=del2_ind[zzz];J=del2_ind[(zzz+1)%3];
-					if(J&gt;I) std::swap(I,J);
-					if(pairs.insert(std::make_pair(I,J)).second)
-					{
-						createBeam(beam,I,J);
-						if(calcBeamPositionOrientationLength(beam)&lt;maxLength_in_cellsizeUnit*cellsizeUnit_in_meters)
-							if(notDeleted(beam-&gt;physicalParameters-&gt;se3.position)) 
-								bc.insert(beam);
-					}
-				}
-			}
-		}
-		else
-		{
-			setProgress(0); setMessage(&quot;Delaunay 3d...&quot;);
-			Delaunay3&lt;Real&gt; del3(vert3.size(),&amp;(vert3[0]),cellsizeUnit_in_meters/50,false, Query::QT_INTEGER); // Delaunay
-			
-			int del3_i = 0;
-			int del3_ind[4];
-			while(del3.GetIndexSet(del3_i++,del3_ind))
-			{
-				if(shouldTerminate()) return &quot;&quot;;
-				setProgress((float)del3_i/(float)del3.GetSimplexQuantity());
-				shared_ptr&lt;Body&gt; beam;
-
-				for(int zzz=0 ; zzz&lt;4 ; ++zzz)
-				{
-					I=del3_ind[zzz];J=del3_ind[(zzz+1)%4];
-					if(J&gt;I) std::swap(I,J);
-					if(pairs.insert(std::make_pair(I,J)).second)
-					{
-						createBeam(beam,I,J);
-						if(calcBeamPositionOrientationLength(beam)&lt;maxLength_in_cellsizeUnit*cellsizeUnit_in_meters)
-							if(notDeleted(beam-&gt;physicalParameters-&gt;se3.position)) 
-								bc.insert(beam);
-					}
-				}
-			}
-		}
-
-	}
-	else
-	{ //  create beams, old method
-	int beam_counter = 0;
-	float nodes_a=0;
-	float nodes_all = rootBody-&gt;bodies-&gt;size();
-	setMessage(&quot;creating beams...&quot;);
-	double r  = maxLength_in_cellsizeUnit*cellsizeUnit_in_meters;
-	double r2 = std::pow(r,2);
-	for(  ; bi!=biEnd ; ++bi )  // loop over all nodes, to create beams
-	{
-		Body* bodyA = (*bi).get(); // first_node
-	
-		bi2 = bi;
-		++bi2;
-		nodes_a+=1.0;
-		
-		for( ; bi2!=biEnd ; ++bi2 )
-		{
-			if(shouldTerminate()) return &quot;&quot;;
-
-			Body* bodyB = (*bi2).get(); // all other nodes
-			// warning - I'm assuming that there are ONLY Nodes in the rootBody
-			LatticeNodeParameters* a = static_cast&lt;LatticeNodeParameters*&gt;(bodyA-&gt;physicalParameters.get());
-			LatticeNodeParameters* b = static_cast&lt;LatticeNodeParameters*&gt;(bodyB-&gt;physicalParameters.get());
-			
-			//if ((a-&gt;se3.position - b-&gt;se3.position).SquaredLength() &lt; std::pow(maxLength_in_cellsizeUnit*cellsizeUnit_in_meters,2) )  
-
-			if (	   ( std::abs(a-&gt;se3.position[0] - b-&gt;se3.position[0])&lt;= r )
-				&amp;&amp; ( std::abs(a-&gt;se3.position[1] - b-&gt;se3.position[1])&lt;= r )
-				&amp;&amp; ( std::abs(a-&gt;se3.position[2] - b-&gt;se3.position[2])&lt;= r )
-				&amp;&amp; ((a-&gt;se3.position - b-&gt;se3.position).SquaredLength() &lt; r2 ) )  
-			{
-				shared_ptr&lt;Body&gt; beam;
-				createBeam(beam,bodyA-&gt;getId(),bodyB-&gt;getId());
-				calcBeamPositionOrientationLength(beam);
-				if(checkMinimumAngle(bc,beam))
-				{
-					if( ++beam_counter % 100 == 0 )
-					{
-						cerr &lt;&lt; &quot;creating beam: &quot; &lt;&lt; beam_counter &lt;&lt; &quot; , &quot; &lt;&lt; ((nodes_a/nodes_all)*100.0)  &lt;&lt; &quot; %\n&quot;; 
-						setProgress(std::pow(nodes_a/nodes_all,2));
-					}
-					
-					if(notDeleted(beam-&gt;physicalParameters-&gt;se3.position)) 
-						bc.insert(beam);
-				}
-			}
-                }
-        }
-	} // beams are created
-
-
-        { // subscribe two nodes, that are monitored by strain recoder to get a measure of length
-                bi    = rootBody-&gt;bodies-&gt;begin();
-                biEnd = rootBody-&gt;bodies-&gt;end();
-                int node1Id=-1; Real len1=100000; Real tmpLen;
-                int node2Id=-1; Real len2=100000;
-                for(  ; bi!=biEnd ; ++bi )  // loop over all nodes, to find those closest to strainRecorder_node1 and strainRecorder_node2
-                {
-			if(shouldTerminate()) return &quot;&quot;;
-
-                        Body* body = (*bi).get();
-                        LatticeNodeParameters* node = YADE_CAST&lt;LatticeNodeParameters*&gt;(body-&gt;physicalParameters.get());
-                        tmpLen = ( strainRecorder_node1 - node-&gt;se3.position ).SquaredLength();
-                        if(tmpLen &lt; len1) len1=tmpLen, node1Id=body-&gt;getId();
-                        tmpLen = ( strainRecorder_node2 - node-&gt;se3.position ).SquaredLength();
-                        if(tmpLen &lt; len2) len2=tmpLen, node2Id=body-&gt;getId();
-                }
-                assert(node1Id!=-1 &amp;&amp; node2Id!=-1);
-                subscribedBodies.push_back(node1Id); // bottom
-                subscribedBodies.push_back(node2Id); // upper
-                
-                measurePoisson-&gt;bottom =node1Id; // bottom
-                measurePoisson-&gt;upper  =node2Id; // upper
-        }
-        
-        { // subscribe two nodes, that are monitored by MeasurePoisson to get a measure of poisson
-                bi    = rootBody-&gt;bodies-&gt;begin();
-                biEnd = rootBody-&gt;bodies-&gt;end();
-                int node3Id=-1; Real len1=100000; Real tmpLen;
-                int node4Id=-1; Real len2=100000;
-                for(  ; bi!=biEnd ; ++bi )  // loop over all nodes, to find those closest to measurePoisson_node3 and measurePoisson_node4
-                {
-			if(shouldTerminate()) return &quot;&quot;;
-
-                        Body* body = (*bi).get();
-                        LatticeNodeParameters* node = YADE_CAST&lt;LatticeNodeParameters*&gt;(body-&gt;physicalParameters.get());
-                        tmpLen = ( measurePoisson_node3 - node-&gt;se3.position ).SquaredLength();
-                        if(tmpLen &lt; len1) len1=tmpLen, node3Id=body-&gt;getId();
-                        tmpLen = ( measurePoisson_node4 - node-&gt;se3.position ).SquaredLength();
-                        if(tmpLen &lt; len2) len2=tmpLen, node4Id=body-&gt;getId();
-                }
-                assert(node3Id!=-1 &amp;&amp; node4Id!=-1);
-                measurePoisson-&gt;left   =node3Id; // left
-                measurePoisson-&gt;right  =node4Id; // right
-                measurePoisson-&gt;horizontal              =   (*(rootBody-&gt;bodies))[node4Id]-&gt;physicalParameters-&gt;se3.position[0] 
-                                                          - (*(rootBody-&gt;bodies))[node3Id]-&gt;physicalParameters-&gt;se3.position[0];
-        }
-
-
-        bi    = bc.begin();
-        biEnd = bc.end();
-        for(  ; bi!=biEnd ; ++bi )  // loop over all newly created beams ...
-        {
-		if(shouldTerminate()) return &quot;&quot;;
-
-                shared_ptr&lt;Body&gt; b = *bi;
-                rootBody-&gt;bodies-&gt;insert(b); // .. to insert them into rootBody
-                
-                // attach them to strain recorder
-                
-                Real xz_plane = strainRecorder_xz_plane;
-                Real pos1 = (*(rootBody-&gt;bodies))[static_cast&lt;LatticeBeamParameters*&gt;( b-&gt;physicalParameters.get() )-&gt;id1]-&gt;physicalParameters-&gt;se3.position[1]; // beam first node
-                Real pos2 = (*(rootBody-&gt;bodies))[static_cast&lt;LatticeBeamParameters*&gt;( b-&gt;physicalParameters.get() )-&gt;id2]-&gt;physicalParameters-&gt;se3.position[1]; // beam second node
-                if( pos1 &lt; pos2 )
-                        std::swap(pos1,pos2); // make sure that pos1 is bigger 
-                if(        pos1 &gt; xz_plane
-                        &amp;&amp; pos2 &lt; xz_plane 
-                        )
-                        subscribedBodies.push_back( b-&gt;getId() ); // beam crosses the plane!
-        }
-        strainRecorder-&gt;subscribedBodies        = subscribedBodies;
-
-        strainRecorder-&gt;initialLength           =   (*(rootBody-&gt;bodies))[subscribedBodies[0]]-&gt;physicalParameters-&gt;se3.position[1] 
-                                                  - (*(rootBody-&gt;bodies))[subscribedBodies[1]]-&gt;physicalParameters-&gt;se3.position[1];
-        
-        measurePoisson-&gt;vertical                =   (*(rootBody-&gt;bodies))[subscribedBodies[1]]-&gt;physicalParameters-&gt;se3.position[1] 
-                                                  - (*(rootBody-&gt;bodies))[subscribedBodies[0]]-&gt;physicalParameters-&gt;se3.position[1];
-                
-        { // remember what node is in contact with what beams
-                //    node                   beams
-		connections.resize(totalNodesCount);
-		
-		bi    = rootBody-&gt;bodies-&gt;begin();
-		biEnd = rootBody-&gt;bodies-&gt;end();
-		
-		for(  ; bi!=biEnd ; ++bi )  // loop over all beams
-		{
-			if(shouldTerminate()) return &quot;&quot;;
-
-			Body* body = (*bi).get();
-			if( ! ( body-&gt;getGroupMask() &amp; beamGroupMask ) )
-				continue; // skip non-beams
-			
-			LatticeBeamParameters* beam = static_cast&lt;LatticeBeamParameters*&gt;(body-&gt;physicalParameters.get() );
-			connections[beam-&gt;id1].push_back(body-&gt;getId());
-			connections[beam-&gt;id2].push_back(body-&gt;getId());
-		}
-	}
-
-	setMessage(&quot;angular springs...&quot;);
-	{ // create angular springs between beams
-		bi    = rootBody-&gt;bodies-&gt;begin();
-		biEnd = rootBody-&gt;bodies-&gt;end();
-		float all_bodies = rootBody-&gt;bodies-&gt;size();
-		int current = 0;
-		for(  ; bi!=biEnd ; ++bi )  // loop over all beams
-		{
-			if(shouldTerminate()) return &quot;&quot;;
-
-			if( ++current % 100 == 0 )
-			{
-				//cerr &lt;&lt; &quot;angular springs: &quot; &lt;&lt; current &lt;&lt; &quot; , &quot; &lt;&lt; ((static_cast&lt;float&gt;(current)/all_bodies)*100.0) &lt;&lt; &quot; %\n&quot;;
-				setProgress(((float)(current)/all_bodies));
-			}
-				
-			Body* body = (*bi).get();
-			if( ! ( body-&gt;getGroupMask() &amp; beamGroupMask ) )
-				continue; // skip non-beams
-				
-			calcBeamAngles(body,rootBody-&gt;bodies.get(),rootBody-&gt;persistentInteractions.get());
-                }
-        }
-	
-	if(quads)
-	{
-		float all = (nbNodes[0]-1)*(nbNodes[1]-1)*(nbNodes[2]-1);
-		float current = 0.0;
-		setMessage(&quot;quadrilaterals...&quot;);
-		for( int j=1 ; j&lt;=nbNodes[1] ; j++ )
-		{
-			if(shouldTerminate()) return &quot;&quot;;
-
-			for( int i=1 ; i&lt;=nbNodes[0] ; i++ )
-			{
-				shared_ptr&lt;Body&gt; quad;
-				if(createQuad(quad,i,j,nbNodes))
-					rootBody-&gt;bodies-&gt;insert(quad);
-				setProgress(current++/all);
-			}
-		}
-	};
-        
-        imposeTranslation(rootBody,region_A_min,region_A_max,direction_A,displacement_A_meters);
-        imposeTranslation(rootBody,region_B_min,region_B_max,direction_B,displacement_B_meters);
-        imposeTranslation(rootBody,region_C_min,region_C_max,direction_C,displacement_C_meters);
-        imposeTranslation(rootBody,region_D_min,region_D_max,direction_D,displacement_D_meters);
-        imposeTranslation(rootBody,region_E_min,region_E_max,direction_E,displacement_E_meters);
-        imposeTranslation(rootBody,region_F_min,region_F_max,direction_F,displacement_F_meters);
-
-        if(useAggregates) addAggregates(rootBody);
-	if(shouldTerminate()) return &quot;&quot;;
-        
-        nonDestroy(rootBody,nonDestroy_A_min,nonDestroy_A_max);
-        nonDestroy(rootBody,nonDestroy_B_min,nonDestroy_B_max);
-        
-	modifyCT(rootBody,CT_A_min,CT_A_max);
-        modifyCT(rootBody,CT_B_min,CT_B_max);
-        
-        cerr &lt;&lt; &quot;finished.. saving\n&quot;;
-
-        return &quot;Number of nodes created:\n&quot; + lexical_cast&lt;string&gt;(nbNodes[0]) + &quot;,&quot;
-                                            + lexical_cast&lt;string&gt;(nbNodes[1]) + &quot;,&quot;
-                                            + lexical_cast&lt;string&gt;(nbNodes[2]) + &quot;,&quot;
-	     + &quot;Number of beams: &quot; + lexical_cast&lt;string&gt;(bc.size()) + &quot;\n&quot;
-	     + &quot;\nNOTE: sometimes it can look better when 'drawWireFrame' is enabled in Display tab.&quot;;
-
-}
-
-/// returns true if angle is bigger than minAngle_betweenBeams_deg
-bool LatticeExample::checkAngle( Vector3r a, Vector3r&amp; b)
-{
-	Quaternionr al;
-	al.Align(a,b);
-	Vector3r axis;
-	Real angle;
-	al.ToAxisAngle(axis, angle);
-	angle *= 180.0/Mathr::PI ;
-//	cerr &lt;&lt; &quot; angle: &quot; &lt;&lt; angle &lt;&lt; &quot;\n&quot;;
-	return angle &gt; minAngle_betweenBeams_deg;
-}
-
-/// returns true if angle is bigger than minAngle_betweenBeams_deg
-bool LatticeExample::checkMinimumAngle(BodyRedirectionVector&amp; bc,shared_ptr&lt;Body&gt;&amp; body)
-{
-	bool answer = true;
-	LatticeBeamParameters* newBeam = static_cast&lt;LatticeBeamParameters*&gt;(body-&gt;physicalParameters.get());
-	
-	BodyContainer::iterator bi    = bc.begin();
-	BodyContainer::iterator biEnd = bc.end();
-	for(  ; bi!=biEnd ; ++bi )  // loop over all beams - they MUST be beams, for static_cast&lt;&gt; 
-	{ 
-		LatticeBeamParameters* oldBeam = static_cast&lt;LatticeBeamParameters*&gt;((*bi)-&gt;physicalParameters.get());
-		if( 	   (oldBeam-&gt;id1 == newBeam-&gt;id1)
-			|| (oldBeam-&gt;id2 == newBeam-&gt;id2))
-			answer = answer &amp;&amp; checkAngle(   oldBeam-&gt;direction ,  newBeam-&gt;direction );
-		if( 	   (oldBeam-&gt;id2 == newBeam-&gt;id1)
-			|| (oldBeam-&gt;id1 == newBeam-&gt;id2))
-			answer = answer &amp;&amp; checkAngle( - oldBeam-&gt;direction ,  newBeam-&gt;direction );
-	} 
-	return answer;
-}
-
-bool LatticeExample::createNode(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,nodeGroupMask));
-	shared_ptr&lt;LatticeNodeParameters&gt; physics(new LatticeNodeParameters);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom()) , Mathr::UnitRandom()*Mathr::PI );
-	
-	float  triang_x = triangularBaseGrid   ? ((static_cast&lt;float&gt;(j%2))*0.5)+i : i+0;
-	double triang_y = triangularBaseGrid   ? 0.86602540378443864676*j          : j*1; // sqrt(3)/2
-	double triang_z = k;
-
-	if(triangularBaseGrid3D)
-	{
-		triang_z *= 0.81649658092772603273;
-		switch(k%3)
-		{
-			case 0 : triang_x += 0.5; triang_y +=     0.86602540378443864676/3.0; break;
-			case 1 :                  triang_y += 2.0*0.86602540378443864676/3.0; break;
-			case 2 : break;
-		}
-	}
-	
-	Vector3r position		= ( Vector3r(triang_x,triang_y,triang_z)
-					  + Vector3r( 	  Mathr::SymmetricRandom()*disorder_in_cellsizeUnit[0]
-					  		, Mathr::SymmetricRandom()*disorder_in_cellsizeUnit[1]
-							, Mathr::SymmetricRandom()*disorder_in_cellsizeUnit[2]
-						    ) * 0.5 // *0.5 because symmetricRandom is (-1,1), and disorder is whole size where nodes can appear
-					  )*cellsizeUnit_in_meters;
-
-	Real radius 			= cellsizeUnit_in_meters*0.05;
-	
-	body-&gt;isDynamic			= true;
-	
-	physics-&gt;se3			= Se3r(position,q);
-
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= Vector3r(0.8,0.8,0.8);
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= false;
-	
-        body-&gt;geometricalModel          = gSphere;
-        body-&gt;physicalParameters        = physics;
-
-//////////////////////
-// some custom coordinates for testing: - FIXME - it will be useful to be able to get coordinates from outside
-//static int zzzzz=0;
-//switch(zzzzz%5)
-//{
-//      case 0  : physics-&gt;se3.position=Vector3r(0.4,1.5,0); break;
-//      case 1  : physics-&gt;se3.position=Vector3r(0.8,0.6,0); break;
-//      case 2  : physics-&gt;se3.position=Vector3r(0  ,0  ,0); break;
-//      case 3  : physics-&gt;se3.position=Vector3r(1.6,0.5,0); break;
-//      case 4  : physics-&gt;se3.position=Vector3r(2.0,0  ,0); break;
-//};
-//zzzzz++;
-//
-//////////////////////
-        
-	if( 	   position[0] &gt;= speciemen_size_in_meters[0] 
-		|| position[1] &gt;= speciemen_size_in_meters[1]
-		|| position[2] &gt;= speciemen_size_in_meters[2] )
-		return false;
-
-        return true;
-}
-
-
-bool LatticeExample::createQuad(shared_ptr&lt;Body&gt;&amp; quad, int i, int j, Vector3r nbNodes)
-{
-	quad = shared_ptr&lt;Body&gt;(new Body(0,quadGroupMask));
-	shared_ptr&lt;Quadrilateral&gt; gQuad(new Quadrilateral( (j-1)*(int)std::floor(nbNodes[0]+1)+i-1 , j*(int)std::floor(nbNodes[0]+1)+i-1 , j*(int)std::floor(nbNodes[0]+1)+i , (j-1)*(int)std::floor(nbNodes[0]+1)+i, rootBody.get()));
-	// FIXME FIXME - this is an empty class. not needed at all.
-	// all this Quadrilateral stuff in fact does not fit current design at all.
-	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters);
-	
-	quad-&gt;isDynamic			= false;
-
-	physics-&gt;se3			= Se3r(Vector3r(0,0,0),Quaternionr(1,0,0,0));
-	physics-&gt;mass			= 0;
-	physics-&gt;velocity		= Vector3r(0,0,0);
-
-	gQuad-&gt;diffuseColor		= Vector3r(0.0,0.0,0.0);
-	gQuad-&gt;visible			= true;
-	gQuad-&gt;wire			= false;
-	gQuad-&gt;shadowCaster		= false;
-	
-        quad-&gt;geometricalModel          = gQuad;
-	quad-&gt;physicalParameters	= physics;
-
-        return true;
-}
-
-
-void LatticeExample::createBeam(shared_ptr&lt;Body&gt;&amp; body, unsigned int i, unsigned int j)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,beamGroupMask));
-	shared_ptr&lt;LatticeBeamParameters&gt; physics(new LatticeBeamParameters);
-	shared_ptr&lt;LineSegment&gt; gBeam(new LineSegment);
-	
-	Real length 			= 1.0; // unspecified for now, calcBeamsPositionOrientationLength will calculate it
-	
-	body-&gt;isDynamic			= true;
-	
-	physics-&gt;id1 			= i;
-	physics-&gt;id2 			= j;
-
-	gBeam-&gt;length			= length;
-	gBeam-&gt;diffuseColor		= Vector3r(0.6,0.6,0.6);
-	gBeam-&gt;wire			= false;
-	gBeam-&gt;visible			= true;
-	gBeam-&gt;shadowCaster		= false;
-	
-	body-&gt;geometricalModel		= gBeam;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-Real LatticeExample::calcBeamPositionOrientationLength(shared_ptr&lt;Body&gt;&amp; body)
-{
-	LatticeBeamParameters* beam = static_cast&lt;LatticeBeamParameters*&gt;(body-&gt;physicalParameters.get());
-	shared_ptr&lt;Body&gt;&amp; bodyA = (*(rootBody-&gt;bodies))[beam-&gt;id1];
-	shared_ptr&lt;Body&gt;&amp; bodyB = (*(rootBody-&gt;bodies))[beam-&gt;id2];
-	Se3r&amp; se3A 		= bodyA-&gt;physicalParameters-&gt;se3;
-	Se3r&amp; se3B 		= bodyB-&gt;physicalParameters-&gt;se3;
-	
-	Se3r se3Beam;
-	se3Beam.position 	= (se3A.position + se3B.position)*0.5;
-	Vector3r dist 		= se3A.position - se3B.position;
-	
-	Real length 		= dist.Normalize();
-	beam-&gt;direction 	= dist;
-        beam-&gt;length            = length;
-        beam-&gt;initialLength     = length;
-        
-        beam-&gt;criticalTensileStrain     = crit_TensileStrain;
-        beam-&gt;criticalCompressiveStrain = crit_ComprStrain;
-        beam-&gt;longitudalStiffness       = longitudalStiffness_noUnit;
-        beam-&gt;bendingStiffness          = bendingStiffness_noUnit;
-        beam-&gt;torsionalStiffness        = torsionalStiffness_noUnit;
-        
-	se3Beam.orientation.Align( Vector3r::UNIT_X , dist );
-	beam-&gt;se3 		= se3Beam;
-	beam-&gt;se3Displacement.position 	= Vector3r(0.0,0.0,0.0);
-	beam-&gt;se3Displacement.orientation.Align(dist,dist);
-
-	beam-&gt;otherDirection	= beam-&gt;se3.orientation*Vector3r::UNIT_Y; // any unit vector that is orthogonal to direction.
-
-	return length;
-}
-
-void LatticeExample::calcAxisAngle(LatticeBeamParameters* beam1, BodyContainer* bodies, unsigned int otherId, InteractionContainer* ints, unsigned int thisId)
-{ 
-	if( ! ints-&gt;find(otherId,thisId) &amp;&amp; otherId != thisId )
-	{
-		LatticeBeamParameters* 	beam2 		= static_cast&lt;LatticeBeamParameters*&gt;( ((*(bodies))[ otherId ])-&gt;physicalParameters.get() );
-		Real 			angle, offPlaneAngle;
-		
-		angle = unitVectorsAngle(beam1-&gt;direction,beam2-&gt;direction);
-
-                shared_ptr&lt;Interaction&gt;                 interaction(new Interaction( thisId , otherId ));
-                shared_ptr&lt;LatticeBeamAngularSpring&gt;    angularSpring(new LatticeBeamAngularSpring);
-		
-		angularSpring-&gt;initialPlaneAngle 	= angle;
-		angularSpring-&gt;planeSwap180		= false;
-		angularSpring-&gt;lastCrossProduct		= 1.0*(beam1-&gt;direction.Cross(beam2-&gt;direction));
-		angularSpring-&gt;lastCrossProduct.Normalize();
-		
-		angularSpring-&gt;initialOffPlaneAngle1	= unitVectorsAngle(beam1-&gt;otherDirection,angularSpring-&gt;lastCrossProduct);
-		angularSpring-&gt;initialOffPlaneAngle2	= unitVectorsAngle(beam2-&gt;otherDirection,angularSpring-&gt;lastCrossProduct);
-
-	//	std::cerr &lt;&lt; thisId &lt;&lt; &quot;, &quot; &lt;&lt; otherId &lt;&lt; &quot;, (&quot; &lt;&lt; beam1-&gt;otherDirection &lt;&lt; &quot;) (&quot; &lt;&lt; beam2-&gt;otherDirection &lt;&lt; &quot;) (&quot; &lt;&lt; angularSpring-&gt;lastCrossProduct &lt;&lt; &quot;)\n&quot;;
-				
-		Quaternionr	aligner1,aligner2;
-		aligner1.FromAxisAngle(beam1-&gt;direction , angularSpring-&gt;initialOffPlaneAngle1);
-		aligner2.FromAxisAngle(beam2-&gt;direction , angularSpring-&gt;initialOffPlaneAngle2);
-				
-		Vector3r	dir1			= aligner1 * angularSpring-&gt;lastCrossProduct;
-		Vector3r	dir2			= aligner2 * angularSpring-&gt;lastCrossProduct;
-
-		// FIXME
-		if( dir1.Dot(beam1-&gt;otherDirection) &lt; 0.999999 )
-			angularSpring-&gt;initialOffPlaneAngle1   *= -1.0;//, angularSpring-&gt;offPlaneSwap1 = true;
-		if( dir2.Dot(beam2-&gt;otherDirection) &lt; 0.999999 )
-			angularSpring-&gt;initialOffPlaneAngle2   *= -1.0;//, angularSpring-&gt;offPlaneSwap2 = true;
-	
-		interaction-&gt;isReal			= true;
-		interaction-&gt;isNew 			= false;
-		interaction-&gt;interactionPhysics 	= angularSpring;
-		ints-&gt;insert(interaction);
-	}
-}
-
-void LatticeExample::calcBeamAngles(Body* body, BodyContainer* bodies, InteractionContainer* ints)
-{
-	LatticeBeamParameters* beam 	= static_cast&lt;LatticeBeamParameters*&gt;(body-&gt;physicalParameters.get());
-
-	std::vector&lt;unsigned int&gt;::iterator i   = connections[beam-&gt;id1].begin();
-	std::vector&lt;unsigned int&gt;::iterator end = connections[beam-&gt;id1].end();
-	
-	for( ; i != end ; ++i )
-		calcAxisAngle(beam,bodies,*i,ints,body-&gt;getId());
-	
-	i   = connections[beam-&gt;id2].begin();
-	end = connections[beam-&gt;id2].end();
-	for( ; i != end ; ++i )
-                calcAxisAngle(beam,bodies,*i,ints,body-&gt;getId());
-}
-
-void LatticeExample::createActors(shared_ptr&lt;MetaBody&gt;&amp; )
-{
-        shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher   = shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-
-        shared_ptr&lt;GeometricalModelMetaEngine&gt; geometricalModelDispatcher       = shared_ptr&lt;GeometricalModelMetaEngine&gt;(new GeometricalModelMetaEngine);
-        geometricalModelDispatcher-&gt;add(&quot;LatticeSetParameters&quot;,&quot;LatticeSetGeometry&quot;,&quot;LatticeSet2LatticeBeams&quot;);
-        
-        strainRecorder = shared_ptr&lt;StrainRecorder&gt;(new StrainRecorder);
-        strainRecorder-&gt;outputFile              = outputFile;
-        strainRecorder-&gt;interval                = 10;
-        
-        measurePoisson = shared_ptr&lt;MeasurePoisson&gt;(new MeasurePoisson);
-        measurePoisson-&gt;outputFile              = poissonFile;
-        measurePoisson-&gt;interval                = 10;
-        
-/*
-NodeRecorder nnnn;
-	std::string	 outputFile;
-	unsigned int	 interval;
-	std::list&lt;std::pair&lt;Vector3r,Vector3r&gt; &gt; regions; // a list of min/max pairs describing each region.
-BeamRecorder bbbb;
-	std::string	 outputFile;
-	unsigned int	 interval;
-	std::list&lt;std::pair&lt;Vector3r,std::pair&lt; Real, int &gt; &gt; &gt; sections; // a list of section planes: &lt;a midpoint, half length, direction &gt;
-*/
-        nodeRecorder   = shared_ptr&lt;NodeRecorder&gt;(new NodeRecorder);
-        nodeRecorder-&gt;outputFile                = nodeRecorderFile;
-        nodeRecorder-&gt;interval                  = 10;
-	if(nodeRec_A_min != nodeRec_A_max) nodeRecorder-&gt;regions.push_back(std::make_pair(nodeRec_A_min,nodeRec_A_max));
-	if(nodeRec_B_min != nodeRec_B_max) nodeRecorder-&gt;regions.push_back(std::make_pair(nodeRec_B_min,nodeRec_B_max));
-	if(nodeRec_C_min != nodeRec_C_max) nodeRecorder-&gt;regions.push_back(std::make_pair(nodeRec_C_min,nodeRec_C_max));
-	if(nodeRec_D_min != nodeRec_D_max) nodeRecorder-&gt;regions.push_back(std::make_pair(nodeRec_D_min,nodeRec_D_max));
-	if(nodeRec_E_min != nodeRec_E_max) nodeRecorder-&gt;regions.push_back(std::make_pair(nodeRec_E_min,nodeRec_E_max));
-	if(nodeRec_F_min != nodeRec_F_max) nodeRecorder-&gt;regions.push_back(std::make_pair(nodeRec_F_min,nodeRec_F_max));
-        
-        beamRecorder = shared_ptr&lt;BeamRecorder&gt;(new BeamRecorder);
-        beamRecorder-&gt;outputFile                = beamRecorderFile;
-        beamRecorder-&gt;interval                  = 10;
-	if(beamRec_A_dir != -1) beamRecorder-&gt;sections.push_back(std::make_pair(beamRec_A_pos,std::make_pair(beamRec_A_range,beamRec_A_dir)));
-	if(beamRec_B_dir != -1) beamRecorder-&gt;sections.push_back(std::make_pair(beamRec_B_pos,std::make_pair(beamRec_B_range,beamRec_B_dir)));
-	if(beamRec_C_dir != -1) beamRecorder-&gt;sections.push_back(std::make_pair(beamRec_C_pos,std::make_pair(beamRec_C_range,beamRec_C_dir)));
-	if(beamRec_D_dir != -1) beamRecorder-&gt;sections.push_back(std::make_pair(beamRec_D_pos,std::make_pair(beamRec_D_range,beamRec_D_dir)));
-	if(beamRec_E_dir != -1) beamRecorder-&gt;sections.push_back(std::make_pair(beamRec_E_pos,std::make_pair(beamRec_E_range,beamRec_E_dir)));
-        
-        movingSupport   = shared_ptr&lt;MovingSupport&gt;(new MovingSupport);
-	if(movSupp_A_dir != -1) movingSupport-&gt;sections.push_back(std::make_pair(movSupp_A_pos,std::make_pair(movSupp_A_dir,movSupp_A_range)));
-	if(movSupp_B_dir != -1) movingSupport-&gt;sections.push_back(std::make_pair(movSupp_B_pos,std::make_pair(movSupp_B_dir,movSupp_B_range)));
-	if(movSupp_C_dir != -1) movingSupport-&gt;sections.push_back(std::make_pair(movSupp_C_pos,std::make_pair(movSupp_C_dir,movSupp_C_range)));
-	if(movSupp_D_dir != -1) movingSupport-&gt;sections.push_back(std::make_pair(movSupp_D_pos,std::make_pair(movSupp_D_dir,movSupp_D_range)));
- 	
-	shared_ptr&lt;LatticeLaw&gt; latticeLaw(new LatticeLaw);
-        latticeLaw-&gt;ensure2D   = ensure2D;
-        latticeLaw-&gt;roughEdges = roughEdges;
-        latticeLaw-&gt;calcTorsion= calculate_Torsion;
-        
-        rootBody-&gt;engines.clear();
-        rootBody-&gt;engines.push_back(boundingVolumeDispatcher);
-        rootBody-&gt;engines.push_back(latticeLaw);
-        rootBody-&gt;engines.push_back(geometricalModelDispatcher);
-        rootBody-&gt;engines.push_back(strainRecorder);
-        rootBody-&gt;engines.push_back(measurePoisson);
-        rootBody-&gt;engines.push_back(nodeRecorder);
-        rootBody-&gt;engines.push_back(beamRecorder);
-	rootBody-&gt;engines.push_back(movingSupport);
-        
-        rootBody-&gt;initializers.clear();
-        rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-        rootBody-&gt;initializers.push_back(geometricalModelDispatcher);
-
-        if(useNonLocalModel)
-        {
-                shared_ptr&lt;NonLocalInitializer&gt; nonLocalInitializer(new NonLocalInitializer);
-                nonLocalInitializer-&gt;range = nonLocalL_in_cellsizeUnit * cellsizeUnit_in_meters;
-                rootBody-&gt;initializers.push_back(nonLocalInitializer);
-        }
-}       
-
-void LatticeExample::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-        rootBody-&gt;isDynamic             = false;
-
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	shared_ptr&lt;LatticeSetParameters&gt; physics(new LatticeSetParameters);
-        physics-&gt;se3                    = Se3r(Vector3r(0,0,0),q);
-        physics-&gt;beamGroupMask          = beamGroupMask;
-        physics-&gt;nodeGroupMask          = nodeGroupMask;
-        physics-&gt;useBendTensileSoftening= useBendTensileSoftening;
-        physics-&gt;useStiffnessSoftening  = useStiffnessSoftening;
-        
-        shared_ptr&lt;LatticeInteractingGeometry&gt; set(new LatticeInteractingGeometry());
-       
-
-	set-&gt;diffuseColor		= Vector3r(0,0,1);
-
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor		= Vector3r(0,0,1);
-
-	shared_ptr&lt;GeometricalModel&gt; gm = YADE_PTR_CAST&lt;GeometricalModel&gt;(ClassFactory::instance().createShared(&quot;LatticeSetGeometry&quot;));
-	gm-&gt;diffuseColor 		= Vector3r(1,1,1);
-	gm-&gt;wire 			= false;
-	gm-&gt;visible 			= true;
-	gm-&gt;shadowCaster 		= true;
-	
-	rootBody-&gt;interactingGeometry	= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume	= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;geometricalModel 	= gm;
-	rootBody-&gt;physicalParameters 	= physics;
-}
-	
- 
-void LatticeExample::imposeTranslation(shared_ptr&lt;MetaBody&gt;&amp; rootBody, Vector3r min, Vector3r max, Vector3r direction, Real displacement)
-{
-	shared_ptr&lt;DisplacementEngine&gt; translationCondition = shared_ptr&lt;DisplacementEngine&gt;(new DisplacementEngine);
- 	translationCondition-&gt;displacement  = displacement;
-	direction.Normalize();
- 	translationCondition-&gt;translationAxis = direction;
-
-        // FIXME: WTF ???
-        rootBody-&gt;engines.push_back((rootBody-&gt;engines)[rootBody-&gt;engines.size()-1]);
-        (rootBody-&gt;engines)[rootBody-&gt;engines.size()-2]=(rootBody-&gt;engines)[rootBody-&gt;engines.size()-3];
-        (rootBody-&gt;engines)[rootBody-&gt;engines.size()-3]=(rootBody-&gt;engines)[rootBody-&gt;engines.size()-4];
-        (rootBody-&gt;engines)[rootBody-&gt;engines.size()-4]=(rootBody-&gt;engines)[rootBody-&gt;engines.size()-5];
-        (rootBody-&gt;engines)[rootBody-&gt;engines.size()-5]=(rootBody-&gt;engines)[rootBody-&gt;engines.size()-6];
-        (rootBody-&gt;engines)[rootBody-&gt;engines.size()-6]=(rootBody-&gt;engines)[rootBody-&gt;engines.size()-7];
-        (rootBody-&gt;engines)[rootBody-&gt;engines.size()-7]=translationCondition;
-        translationCondition-&gt;subscribedBodies.clear();
-        
-        BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-	BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-	for(  ; bi!=biEnd ; ++bi )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-	
-		if( b-&gt;getGroupMask() &amp; nodeGroupMask )
-		{
-			Vector3r pos = b-&gt;physicalParameters-&gt;se3.position;
-			if(        pos[0] &gt; min[0] 
-				&amp;&amp; pos[1] &gt; min[1] 
-				&amp;&amp; pos[2] &gt; min[2] 
-				&amp;&amp; pos[0] &lt; max[0] 
-				&amp;&amp; pos[1] &lt; max[1] 
-				&amp;&amp; pos[2] &lt; max[2] 
-				&amp;&amp; (b-&gt;getGroupMask() &amp; nodeGroupMask)
-				)
-			{
-				b-&gt;isDynamic = false;
-				b-&gt;geometricalModel-&gt;diffuseColor = Vector3r(0.3,0.3,0.3);
-				translationCondition-&gt;subscribedBodies.push_back(b-&gt;getId());
-			}
-		}
-        }
-}
-
-bool LatticeExample::isDeleted(Vector3r pos, Vector3r min, Vector3r max)
-{
-	return(
-		   pos[0] &gt; min[0] 
-		&amp;&amp; pos[1] &gt; min[1] 
-		&amp;&amp; pos[2] &gt; min[2] 
-		&amp;&amp; pos[0] &lt; max[0] 
-		&amp;&amp; pos[1] &lt; max[1] 
-		&amp;&amp; pos[2] &lt; max[2] 
-	      );
-}
-
-bool LatticeExample::notDeleted(Vector3r pos)
-{
-//	return true;
-	return (!(
-		   isDeleted(pos,regionDelete_A_min,regionDelete_A_max)
-        	|| isDeleted(pos,regionDelete_B_min,regionDelete_B_max)
-        	|| isDeleted(pos,regionDelete_C_min,regionDelete_C_max)
-        	|| isDeleted(pos,regionDelete_D_min,regionDelete_D_max)
-        	|| isDeleted(pos,regionDelete_E_min,regionDelete_E_max)
-        	|| isDeleted(pos,regionDelete_F_min,regionDelete_F_max)
-
-		|| isDeleted(pos,regionDelete_1_min,regionDelete_1_max)
-        	|| isDeleted(pos,regionDelete_2_min,regionDelete_2_max)
-        	|| isDeleted(pos,regionDelete_3_min,regionDelete_3_max)
-        	|| isDeleted(pos,regionDelete_4_min,regionDelete_4_max)
-        	|| isDeleted(pos,regionDelete_5_min,regionDelete_5_max)
-	));
-};
-
-void LatticeExample::regionDelete(shared_ptr&lt;MetaBody&gt;&amp; rootBody, Vector3r min, Vector3r max)
-{
-        vector&lt;unsigned int&gt; futureDeletes;
-        
-        BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-        BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-        for(  ; bi!=biEnd ; ++bi )
-        {
-                shared_ptr&lt;Body&gt; b = *bi;
-        
-                if( b-&gt;getGroupMask() &amp; beamGroupMask )
-                {
-                        Vector3r pos = b-&gt;physicalParameters-&gt;se3.position;
-                        if(        pos[0] &gt; min[0] 
-                                &amp;&amp; pos[1] &gt; min[1] 
-                                &amp;&amp; pos[2] &gt; min[2] 
-                                &amp;&amp; pos[0] &lt; max[0] 
-                                &amp;&amp; pos[1] &lt; max[1] 
-                                &amp;&amp; pos[2] &lt; max[2] 
-                                )
-                                futureDeletes.push_back( b-&gt;getId() );
-                }
-        }
-        
-        vector&lt;unsigned int&gt;::iterator vend = futureDeletes.end();
-        for( vector&lt;unsigned int&gt;::iterator vsta = futureDeletes.begin() ; vsta != vend ; ++vsta)
-                rootBody-&gt;bodies-&gt;erase(*vsta); 
-}
-
-void LatticeExample::nonDestroy(shared_ptr&lt;MetaBody&gt;&amp; rootBody, Vector3r min, Vector3r max)
-{
-	std::list&lt;unsigned int&gt; marked;
-        
-        BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-        BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-        for(  ; bi!=biEnd ; ++bi )
-        {
-                shared_ptr&lt;Body&gt; b = *bi;
-        
-                if( b-&gt;getGroupMask() &amp; beamGroupMask )
-                {
-                        Vector3r pos = b-&gt;physicalParameters-&gt;se3.position;
-                        if(        pos[0] &gt; min[0] 
-                                &amp;&amp; pos[1] &gt; min[1] 
-                                &amp;&amp; pos[2] &gt; min[2] 
-                                &amp;&amp; pos[0] &lt; max[0] 
-                                &amp;&amp; pos[1] &lt; max[1] 
-                                &amp;&amp; pos[2] &lt; max[2] 
-                                )
-                                marked.push_back( b-&gt;getId() );
-                }
-        }
-        
-	std::list&lt;unsigned int&gt;::iterator vend = marked.end();
-        for( std::list&lt;unsigned int&gt;::iterator vsta = marked.begin() ; vsta != vend ; ++vsta)
-        {
-                LatticeBeamParameters* beam = static_cast&lt;LatticeBeamParameters*&gt;( ((*(rootBody-&gt;bodies))[*vsta])-&gt;physicalParameters.get());
-                beam-&gt;criticalTensileStrain     = 0.9;
-                beam-&gt;criticalCompressiveStrain = 0.9;
-                beam-&gt;longitudalStiffness       = 10.0;
-                beam-&gt;bendingStiffness          = 2.8;
-                beam-&gt;torsionalStiffness        = 2.8;
-                (*(rootBody-&gt;bodies))[beam-&gt;id1]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(0.2,0.5,0.7);
-                (*(rootBody-&gt;bodies))[beam-&gt;id2]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(0.2,0.5,0.7);
-        }
-}
-
-
-void LatticeExample::modifyCT(shared_ptr&lt;MetaBody&gt;&amp; rootBody, Vector3r min, Vector3r max)
-{
-	std::list&lt;unsigned int&gt; marked;
-        
-        BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-        BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-        for(  ; bi!=biEnd ; ++bi )
-        {
-                shared_ptr&lt;Body&gt; b = *bi;
-        
-                if( b-&gt;getGroupMask() &amp; beamGroupMask )
-                {
-                        Vector3r pos = b-&gt;physicalParameters-&gt;se3.position;
-                        if(        pos[0] &gt; min[0] 
-                                &amp;&amp; pos[1] &gt; min[1] 
-                                &amp;&amp; pos[2] &gt; min[2] 
-                                &amp;&amp; pos[0] &lt; max[0] 
-                                &amp;&amp; pos[1] &lt; max[1] 
-                                &amp;&amp; pos[2] &lt; max[2] 
-                                )
-                                marked.push_back( b-&gt;getId() );
-                }
-        }
-        
-	std::list&lt;unsigned int&gt;::iterator vend = marked.end();
-        for( std::list&lt;unsigned int&gt;::iterator vsta = marked.begin() ; vsta != vend ; ++vsta)
-        {
-                LatticeBeamParameters* beam = static_cast&lt;LatticeBeamParameters*&gt;( ((*(rootBody-&gt;bodies))[*vsta])-&gt;physicalParameters.get());
-                beam-&gt;criticalTensileStrain     = CT;
-        }
-}
-
-
-/////////////////////////////////////////////////////////////////////////////////////////
-/////////////////////////////////////////////////////////////////////////////////////////
-
-struct Circle
-{
-        float x,y,z,d;
-};
-
-bool overlaps(Circle&amp; cc,std::vector&lt;Circle&gt;&amp; c)
-{
-        std::vector&lt;Circle&gt;::iterator end=c.end();
-        for(std::vector&lt;Circle&gt;::iterator i=c.begin();i!=end;++i)
-        {
-                float dist2 = std::pow(i-&gt;x - cc.x ,2)+std::pow(i-&gt;y - cc.y,2)+std::pow(i-&gt;z - cc.z,2);
-                float r2    = std::pow( 1.1*(i-&gt;d+cc.d)/2.0 ,2); // FIXME - 1.1 is hardcoded. van Mier's min distance is 1.1*(D1+D2)/2
-                if(dist2&lt;r2)
-                        return true;
-        }
-        return false;
-};
-
-int aggInside(Vector3r&amp; a,Vector3r&amp; b,std::vector&lt;Circle&gt;&amp; c, Real cellsizeUnit_in_meters)
-{ // checks if nodes 'a','b' are inside any of aggregates from list 'c'
-        int res=0;
-        std::vector&lt;Circle&gt;::iterator end=c.end();
-        for(std::vector&lt;Circle&gt;::iterator i=c.begin();i!=end;++i)
-        {
-        //      if(i-&gt;r &lt; cellsizeUnit_in_meters) // FIXME
-        //              continue;
-
-                float dist2 = std::pow(i-&gt;x - a[0],2)+std::pow(i-&gt;y - a[1],2)+std::pow(i-&gt;z - a[2],2);
-                float r2    = std::pow(i-&gt;d*0.5,2);
-                if(dist2&lt;r2) res=1; else res=0;
-
-                dist2 = std::pow(i-&gt;x - b[0],2)+std::pow(i-&gt;y - b[1],2)+std::pow(i-&gt;z - b[2],2);
-                if(dist2&lt;r2) ++res;
-
-                if(res!=0) return res;
-        }
-        return false;
-}
-
-float aggsAreas(std::vector&lt;Circle&gt;&amp; c)
-{
-        float aggArea=0.0;
-        std::vector&lt;Circle&gt;::iterator end=c.end();
-        for(std::vector&lt;Circle&gt;::iterator i=c.begin();i!=end;++i)
-                aggArea += 3.14159265358979323846*std::pow(i-&gt;d*0.5 ,2);
-        return aggArea;
-}
-
-float aggsVolumes(std::vector&lt;Circle&gt;&amp; c)
-{
-        float aggVolume=0.0;
-        std::vector&lt;Circle&gt;::iterator end=c.end();
-        for(std::vector&lt;Circle&gt;::iterator i=c.begin();i!=end;++i)
-                aggVolume += (4.0/3.0)*3.14159265358979323846*std::pow(i-&gt;d*0.5 ,3);
-        return aggVolume;
-}
-
-// random
-#include &lt;boost/random/linear_congruential.hpp&gt;
-#include &lt;boost/random/uniform_real.hpp&gt;
-#include &lt;boost/random/variate_generator.hpp&gt;
-#include &lt;boost/random/normal_distribution.hpp&gt;
-
-void LatticeExample::addAggregates(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-        // first make a list of circles
-        std::vector&lt;Circle&gt; c;
-
-        Real AGGREGATES_X=speciemen_size_in_meters[0];
-        Real AGGREGATES_Y=speciemen_size_in_meters[1];
-        Real AGGREGATES_Z=speciemen_size_in_meters[2];
-	if(AGGREGATES_Z &lt; cellsizeUnit_in_meters )
-		AGGREGATES_Z = 0.0;
-        Real MAX_DIAMETER  =aggregateMaxDiameter;
-        Real MIN_DIAMETER  =aggregateMinDiameter;
-        Real MEAN_DIAMETER =aggregateMeanDiameter;
-        Real SIGMA_DIAMETER=aggregateSigmaDiameter;
-
-        typedef boost::minstd_rand StdGenerator;
-        static StdGenerator generator;
-        static boost::variate_generator&lt;StdGenerator&amp;, boost::uniform_real&lt;&gt; &gt;
-                random1(generator, boost::uniform_real&lt;&gt;(0,1));
-        static boost::variate_generator&lt;StdGenerator&amp;, boost::normal_distribution&lt;&gt; &gt; 
-                randomN(generator, boost::normal_distribution&lt;&gt;(MEAN_DIAMETER,SIGMA_DIAMETER));
-
-        std::cerr &lt;&lt; &quot;generating aggregates ... &quot;;
-	setMessage(  &quot;generating aggregates...&quot;);
-        do
-        {
-		if(shouldTerminate()) return;
-
-                Circle cc;
-                cc.x=random1()*AGGREGATES_X, cc.y=random1()*AGGREGATES_Y, cc.z=AGGREGATES_Z==0?0:random1()*AGGREGATES_Z;
-                do { cc.d=randomN(); } while (cc.d&gt;=MAX_DIAMETER || cc.d&lt;=MIN_DIAMETER);
-                for(int i=0 ; i&lt;1000 ; ++i)
-                        if(overlaps(cc,c))
-                                cc.x=random1()*AGGREGATES_X, cc.y=random1()*AGGREGATES_Y, cc.z=AGGREGATES_Z==0?0:random1()*AGGREGATES_Z;
-                        else
-                        {
-                                c.push_back(cc);
-                //              std::cerr &lt;&lt; cc.x &lt;&lt; &quot; &quot; &lt;&lt; cc.y &lt;&lt; &quot; &quot; &lt;&lt; cc.d &lt;&lt; &quot;\n&quot;;
-                                break;
-                        }
-		if(AGGREGATES_Z == 0)
-			setProgress((aggsAreas(c)/(AGGREGATES_X*AGGREGATES_Y))/(aggregatePercent/100.0));
-		else
-			setProgress((aggsVolumes(c)/(AGGREGATES_X*AGGREGATES_Y*AGGREGATES_Z))/(aggregatePercent/100.0));
-        }
-        //while(aggregatePercent/100.0 &gt; aggsAreas(c)/(AGGREGATES_X*AGGREGATES_Y) );
-        while( progress() &lt; 1.0 );
-
-        std::cerr &lt;&lt; &quot;done. &quot; &lt;&lt; c.size() &lt;&lt; &quot; area: &quot; &lt;&lt; aggsAreas(c)/(AGGREGATES_X*AGGREGATES_Y) &lt;&lt; &quot; vol: &quot; &lt;&lt; aggsVolumes(c)/(AGGREGATES_X*AGGREGATES_Y*AGGREGATES_Z) &lt;&lt; &quot;\n&quot;;
-
-        { // set different properties for beams that lie in an aggregate
-          // parametrize from above - takes three arguments: 
-          // - MaterialParameters of aggregate, 
-          // - MaterialParameters of bond, 
-          // - list of circles.
-                BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-                BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-                float all_bodies = rootBody-&gt;bodies-&gt;size();
-                int current = 0;
-                for(  ; bi!=biEnd ; ++bi )  // loop over all beams
-                {
-                //      if( ++current % 100 == 0 )
-                //              cerr &lt;&lt; &quot;aggregate beams: &quot; &lt;&lt; current &lt;&lt; &quot; , &quot; &lt;&lt; ((static_cast&lt;float&gt;(current)/all_bodies)*100.0) &lt;&lt; &quot; %\n&quot;;
-                                
-                        Body* body = (*bi).get();
-                        if( ! ( body-&gt;getGroupMask() &amp; beamGroupMask ) )
-                                continue; // skip non-beams
-
-                        LatticeBeamParameters* beam     = static_cast&lt;LatticeBeamParameters*&gt;(body-&gt;physicalParameters.get());
-                        int ovv = aggInside(     (*(rootBody-&gt;bodies))[beam-&gt;id1]-&gt;physicalParameters-&gt;se3.position
-                                                ,(*(rootBody-&gt;bodies))[beam-&gt;id2]-&gt;physicalParameters-&gt;se3.position
-                                                ,c, cellsizeUnit_in_meters );
-                        if(ovv==2) // aggregate
-                        {
-                                beam-&gt;longitudalStiffness       = agg_longStiffness_noUnit;
-                                beam-&gt;bendingStiffness          = agg_bendStiffness_noUnit;
-                                beam-&gt;torsionalStiffness        = agg_torsStiffness_noUnit;
-                                beam-&gt;criticalTensileStrain     = agg_critTensileStrain;
-                                beam-&gt;criticalCompressiveStrain = agg_critCompressStrain;
-                
-                                (*(rootBody-&gt;bodies))[beam-&gt;id1]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(0.6,0.2,0.0);
-                                (*(rootBody-&gt;bodies))[beam-&gt;id2]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(0.6,0.2,0.0);
-                        }
-                        else if(ovv==1) // bond
-                        {
-                                beam-&gt;longitudalStiffness       = bond_longStiffness_noUnit;
-                                beam-&gt;bendingStiffness          = bond_bendStiffness_noUnit;
-                                beam-&gt;torsionalStiffness	= bond_torsStiffness_noUnit;
-                                beam-&gt;criticalTensileStrain     = bond_critTensileStrain;
-                                beam-&gt;criticalCompressiveStrain = bond_critCompressStrain;
-                
-                                (*(rootBody-&gt;bodies))[beam-&gt;id1]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(0.6,0.6,0.0);
-                                (*(rootBody-&gt;bodies))[beam-&gt;id2]-&gt;geometricalModel-&gt;diffuseColor = Vector3r(0.6,0.6,0.0);
-                        }
-                }
-        }
-}
-

Deleted: branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample/LatticeExample.hpp
===================================================================
--- branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample/LatticeExample.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample/LatticeExample.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,252 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef LATTICE_BOX_HPP
-#define LATTICE_BOX_HPP 
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-
-class LatticeBeamParameters;
-class StrainRecorder;
-class MeasurePoisson;
-class NodeRecorder;
-class BeamRecorder;
-class MovingSupport;
-
-class LatticeExample : public FileGenerator
-{
-	private :
-		int 		nodeGroupMask,beamGroupMask,quadGroupMask;
-		
-	// mesh generation	
-		Vector3r 	 speciemen_size_in_meters 	// size
-				,disorder_in_cellsizeUnit;	// s
-		
-                Real             maxLength_in_cellsizeUnit      // r
-                                ,minAngle_betweenBeams_deg      // a
-                                ,cellsizeUnit_in_meters         // g
-                        // MaterialParameters of cement matrix  
-                                ,crit_TensileStrain             // E_min
-                                ,crit_ComprStrain               // E_max
-                                
-                                ,longitudalStiffness_noUnit     // k_l
-                                ,bendingStiffness_noUnit        // k_b
-                                ,torsionalStiffness_noUnit      // k_t
-                        //////////////////////////////////////                          
-                                ,nonLocalL_in_cellsizeUnit;     // l
-                                
-                bool             triangularBaseGrid
-				,triangularBaseGrid3D
-				,use_Delaunay
-                                ,useNonLocalModel
-                                ,useBendTensileSoftening
-                                ,useStiffnessSoftening
-                                ,ensure2D
-                                ,roughEdges
-				,calculate_Torsion
-				,quads;
-        
-        // aggregates
-                bool             useAggregates;
-                Real             aggregatePercent
-                                ,aggregateMeanDiameter
-                                ,aggregateSigmaDiameter
-                                ,aggregateMinDiameter
-                                ,aggregateMaxDiameter
-                        // MaterialParameters of aggregate
-                                ,agg_longStiffness_noUnit       // k_l aggregate
-                                ,agg_bendStiffness_noUnit       // k_b aggregate
-                                ,agg_torsStiffness_noUnit       // k_t aggregate
-                                ,agg_critCompressStrain         // E.c aggregate
-                                ,agg_critTensileStrain          // E.l aggregate
-                        // MaterialParameters of bond
-                                ,bond_longStiffness_noUnit      // k_l bond
-                                ,bond_bendStiffness_noUnit      // k_b bond
-                                ,bond_torsStiffness_noUnit      // k_t bond
-                                ,bond_critCompressStrain        // E.c bond
-                                ,bond_critTensileStrain;        // E.l bond
-
-                void addAggregates(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-                
-                
-        // conditions
-		Vector3r 	 region_A_min
-			 	,region_A_max
-			 	,direction_A
-				 
-			 	,region_B_min
-			 	,region_B_max
-			 	,direction_B
-				 
-			 	,region_C_min
-			 	,region_C_max
-			 	,direction_C
-				 
-			 	,region_D_min
-			 	,region_D_max
-			 	,direction_D
-				 
-			 	,region_E_min
-			 	,region_E_max
-			 	,direction_E
-				 
-			 	,region_F_min
-			 	,region_F_max
-			 	,direction_F;
-				 
-						
-		Real		 displacement_A_meters
-		 		,displacement_B_meters
-                                ,displacement_C_meters
-                                ,displacement_D_meters
-                                ,displacement_E_meters
-                                ,displacement_F_meters;
-                                
-        // strain recorder
-                std::vector&lt; unsigned int &gt; subscribedBodies;
-                Real             strainRecorder_xz_plane;
-                Vector3r         strainRecorder_node1
-                                ,strainRecorder_node2
-                                ,measurePoisson_node3
-                                ,measurePoisson_node4;
-                shared_ptr&lt;StrainRecorder&gt; strainRecorder;
-                shared_ptr&lt;MeasurePoisson&gt; measurePoisson;
-		shared_ptr&lt;BeamRecorder&gt;   beamRecorder;
-		shared_ptr&lt;NodeRecorder&gt;   nodeRecorder;
-		shared_ptr&lt;MovingSupport&gt;  movingSupport;
-                std::string      outputFile,poissonFile,nodeRecorderFile,beamRecorderFile;
-                
-        // delete beams regions
-                Vector3r         regionDelete_A_min
-                                ,regionDelete_A_max
-                                ,regionDelete_B_min
-                                ,regionDelete_B_max
-                                ,regionDelete_C_min
-                                ,regionDelete_C_max
-                                ,regionDelete_D_min
-                                ,regionDelete_D_max
-                                ,regionDelete_E_min
-                                ,regionDelete_E_max
-                                ,regionDelete_F_min
-                                ,regionDelete_F_max
-
-                                ,regionDelete_1_min
-                                ,regionDelete_1_max
-                                ,regionDelete_2_min
-                                ,regionDelete_2_max
-                                ,regionDelete_3_min
-                                ,regionDelete_3_max
-                                ,regionDelete_4_min
-                                ,regionDelete_4_max
-                                ,regionDelete_5_min
-                                ,regionDelete_5_max;
-
-	// node recorder
-		Vector3r	 nodeRec_A_min
-				,nodeRec_A_max
-				,nodeRec_B_min
-				,nodeRec_B_max
-				,nodeRec_C_min
-				,nodeRec_C_max
-				,nodeRec_D_min
-				,nodeRec_D_max
-				,nodeRec_E_min
-				,nodeRec_E_max
-				,nodeRec_F_min
-				,nodeRec_F_max;
-	// beam recorder
-		
-		Vector3r	 beamRec_A_pos
-				,beamRec_B_pos
-				,beamRec_C_pos
-				,beamRec_D_pos
-				,beamRec_E_pos;
-
-		Real		 beamRec_A_range
-				,beamRec_B_range
-				,beamRec_C_range
-				,beamRec_D_range
-				,beamRec_E_range;
-
-		int		 beamRec_A_dir
-				,beamRec_B_dir
-				,beamRec_C_dir
-				,beamRec_D_dir
-				,beamRec_E_dir;
-
-	// moving support
-
-		Vector3r	 movSupp_A_pos;
-		Real		 movSupp_A_range;
-		int		 movSupp_A_dir;
-
-		Vector3r	 movSupp_B_pos;
-		Real		 movSupp_B_range;
-		int		 movSupp_B_dir;
-
-		Vector3r	 movSupp_C_pos;
-		Real		 movSupp_C_range;
-		int		 movSupp_C_dir;
-
-		Vector3r	 movSupp_D_pos;
-		Real		 movSupp_D_range;
-		int		 movSupp_D_dir;
-
-        // non destroy areas
-                Vector3r         nonDestroy_A_min
-                                ,nonDestroy_A_max
-                                ,nonDestroy_B_min
-                                ,nonDestroy_B_max;
-
-	// region of modified crit_TensileStrain
-	
-		Vector3r	 CT_A_min
-				,CT_A_max
-				,CT_B_min
-				,CT_B_max;
-		Real		 CT;
-
-                                 
-                std::vector&lt; std::vector&lt; unsigned int &gt; &gt; connections; // which node is in touch with what beams.
-                                
-        public : 
-		LatticeExample();
-		virtual ~LatticeExample();
-
-		string generate();
-	
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		bool createNode(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k);
-		bool createQuad(shared_ptr&lt;Body&gt;&amp; body, int i, int j, Vector3r);
-                void createBeam(shared_ptr&lt;Body&gt;&amp; body, unsigned int i, unsigned int j);
-                Real calcBeamPositionOrientationLength(shared_ptr&lt;Body&gt;&amp; body);
-                bool notDeleted(Vector3r pos);
-		bool isDeleted(Vector3r pos, Vector3r min, Vector3r max);
-                void calcBeamAngles(Body* body, BodyContainer* bodies,InteractionContainer* ints);
-                void calcAxisAngle(LatticeBeamParameters* beam, BodyContainer* bodies, unsigned int otherId,InteractionContainer* ints,unsigned int thisId);
-                bool checkMinimumAngle(BodyRedirectionVector&amp;,shared_ptr&lt;Body&gt;&amp;);
-                bool checkAngle( Vector3r , Vector3r&amp; );
-                void imposeTranslation(shared_ptr&lt;MetaBody&gt;&amp; rootBody, Vector3r min, Vector3r max, Vector3r direction, Real velocity);
-                void regionDelete(shared_ptr&lt;MetaBody&gt;&amp; rootBody, Vector3r min, Vector3r max);
-                void nonDestroy(shared_ptr&lt;MetaBody&gt;&amp; rootBody, Vector3r min, Vector3r max);
-                void modifyCT(shared_ptr&lt;MetaBody&gt;&amp; rootBody, Vector3r min, Vector3r max);
-
-                virtual void registerAttributes();
-                REGISTER_CLASS_NAME(LatticeExample);
-		REGISTER_BASE_CLASS_NAME(FileGenerator);
-
-};
-
-REGISTER_SERIALIZABLE(LatticeExample,false);
-
-#endif // LATTICE_BOX_HPP 
-

Copied: branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample.cpp (from rev 1105, branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample/LatticeExample.cpp)

Copied: branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample.hpp (from rev 1105, branches/scons-layout/pkg/lattice/PreProcessor/LatticeExample/LatticeExample.hpp)

Modified: branches/scons-layout/pkg/lattice/SConscript
===================================================================
--- branches/scons-layout/pkg/lattice/SConscript	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/lattice/SConscript	2007-03-07 14:13:16 UTC (rev 1107)
@@ -2,69 +2,69 @@
 env.Install('$PREFIX/lib/yade$POSTFIX/pkg-lattice',[
 
 	env.SharedLibrary('LatticeInteractingGeometry',
-		['DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.cpp'],
+		['DataClass/InteractingGeometry/LatticeInteractingGeometry.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'MetaInteractingGeometry'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractingGeometry/LatticeInteractingGeometry']),
+			'DataClass/InteractingGeometry']),
 
 	env.SharedLibrary('LatticeSetGeometry',
-		['DataClass/GeometricalModel/LatticeSetGeometry/LatticeSetGeometry.cpp'],
+		['DataClass/GeometricalModel/LatticeSetGeometry.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel/LatticeSetGeometry']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('LineSegment',
-		['DataClass/GeometricalModel/LineSegment/LineSegment.cpp'],
+		['DataClass/GeometricalModel/LineSegment.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'yade-multimethods'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel/LineSegment']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('LatticeBeamParameters',
-		['DataClass/PhysicalParameters/LatticeBeamParameters/LatticeBeamParameters.cpp'],
+		['DataClass/PhysicalParameters/LatticeBeamParameters.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods',
 			'yade-serialization'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/LatticeBeamParameters', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters', '$PREFIX/include']),
 
 	env.SharedLibrary('LatticeNodeParameters',
-		['DataClass/PhysicalParameters/LatticeNodeParameters/LatticeNodeParameters.cpp'],
+		['DataClass/PhysicalParameters/LatticeNodeParameters.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods',
 			'yade-serialization'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/LatticeNodeParameters', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters', '$PREFIX/include']),
 
 	env.SharedLibrary('LatticeSetParameters',
-		['DataClass/PhysicalParameters/LatticeSetParameters/LatticeSetParameters.cpp'],
+		['DataClass/PhysicalParameters/LatticeSetParameters.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/PhysicalParameters/LatticeSetParameters']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('LatticeBeamAngularSpring',
-		['DataClass/InteractionPhysics/LatticeBeamAngularSpring/LatticeBeamAngularSpring.cpp'],
+		['DataClass/InteractionPhysics/LatticeBeamAngularSpring.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods',
 			'yade-serialization'],
-		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics/LatticeBeamAngularSpring',
+		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics',
 			'$PREFIX/include']),
 
 	env.SharedLibrary('NonLocalDependency',
-		['DataClass/InteractionPhysics/NonLocalDependency/NonLocalDependency.cpp'],
+		['DataClass/InteractionPhysics/NonLocalDependency.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-base',
 			'Wm3Foundation',
 			'yade-multimethods',
 			'yade-serialization'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionPhysics/NonLocalDependency']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionPhysics']),
 
 	env.SharedLibrary('LatticeSet2LatticeBeams',
-		['Engine/EngineUnit/LatticeSet2LatticeBeams/LatticeSet2LatticeBeams.cpp'],
+		['Engine/EngineUnit/LatticeSet2LatticeBeams.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'LineSegment',
@@ -72,14 +72,14 @@
 			'LatticeBeamParameters',
 			'GeometricalModelMetaEngine',
 			'ParticleParameters'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/LatticeBeamParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'DataClass/PhysicalParameters/LatticeSetParameters',
-			'Engine/EngineUnit/LatticeSet2LatticeBeams',
-			'DataClass/GeometricalModel/LineSegment']),
+			'DataClass/PhysicalParameters',
+			'Engine/EngineUnit',
+			'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('LatticeLaw',
-		['Engine/StandAloneEngine/LatticeLaw/LatticeLaw.cpp'],
+		['Engine/StandAloneEngine/LatticeLaw.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'LatticeBeamParameters',
@@ -88,94 +88,94 @@
 			'LatticeBeamAngularSpring',
 			'NonLocalDependency'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionPhysics/LatticeBeamAngularSpring',
-			'DataClass/InteractionPhysics/NonLocalDependency',
-			'DataClass/PhysicalParameters/LatticeNodeParameters',
-			'Engine/StandAloneEngine/LatticeLaw',
-			'DataClass/PhysicalParameters/LatticeBeamParameters',
-			'DataClass/PhysicalParameters/LatticeSetParameters']),
+			'DataClass/InteractionPhysics',
+			'DataClass/InteractionPhysics',
+			'DataClass/PhysicalParameters',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('NonLocalInitializer',
-		['Engine/StandAloneEngine/NonLocalInitializer/NonLocalInitializer.cpp'],
+		['Engine/StandAloneEngine/NonLocalInitializer.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'LatticeBeamParameters',
 			'LatticeNodeParameters',
 			'LatticeSetParameters',
 			'NonLocalDependency'],
-		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine/NonLocalInitializer',
+		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine',
 			'$PREFIX/include',
-			'DataClass/PhysicalParameters/LatticeBeamParameters',
-			'DataClass/InteractionPhysics/NonLocalDependency',
-			'DataClass/PhysicalParameters/LatticeNodeParameters',
-			'DataClass/PhysicalParameters/LatticeSetParameters']),
+			'DataClass/PhysicalParameters',
+			'DataClass/InteractionPhysics',
+			'DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('MeasurePoisson',
-		['Engine/StandAloneEngine/MeasurePoisson/MeasurePoisson.cpp'],
+		['Engine/StandAloneEngine/MeasurePoisson.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'LatticeBeamParameters',
 			'LatticeNodeParameters'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/LatticeNodeParameters',
-			'DataClass/PhysicalParameters/LatticeBeamParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'Engine/StandAloneEngine/MeasurePoisson']),
+			'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('StrainRecorder',
-		['Engine/StandAloneEngine/StrainRecorder/StrainRecorder.cpp'],
+		['Engine/StandAloneEngine/StrainRecorder.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'LatticeBeamParameters',
 			'LatticeNodeParameters'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/LatticeNodeParameters',
-			'DataClass/PhysicalParameters/LatticeBeamParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'Engine/StandAloneEngine/StrainRecorder']),
+			'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('NodeRecorder',
-		['Engine/StandAloneEngine/NodeRecorder/NodeRecorder.cpp'],
+		['Engine/StandAloneEngine/NodeRecorder.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'LatticeBeamParameters',
 			'LatticeNodeParameters'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/LatticeNodeParameters',
-			'DataClass/PhysicalParameters/LatticeBeamParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'Engine/StandAloneEngine/NodeRecorder']),
+			'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('BeamRecorder',
-		['Engine/StandAloneEngine/BeamRecorder/BeamRecorder.cpp'],
+		['Engine/StandAloneEngine/BeamRecorder.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'LatticeBeamParameters',
 			'LatticeNodeParameters'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/LatticeNodeParameters',
-			'DataClass/PhysicalParameters/LatticeBeamParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'Engine/StandAloneEngine/BeamRecorder']),
+			'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('MovingSupport',
-		['Engine/StandAloneEngine/MovingSupport/MovingSupport.cpp'],
+		['Engine/StandAloneEngine/MovingSupport.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'LatticeBeamParameters',
 			'LatticeNodeParameters'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/LatticeNodeParameters',
-			'DataClass/PhysicalParameters/LatticeBeamParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'Engine/StandAloneEngine/MovingSupport']),
+			'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('GLDrawLineSegment',
 		['RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'LineSegment', 'yade-opengl'],
 		CPPPATH=env['CPPPATH']+['RenderingEngine/GLDrawLineSegment',
 			'$PREFIX/include',
-			'DataClass/GeometricalModel/LineSegment']),
+			'DataClass/GeometricalModel']),
 
 	env.SharedLibrary('GLDrawLatticeBeamState',
 		['RenderingEngine/GLDrawLatticeBeamState/GLDrawLatticeBeamState.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation', 'LatticeBeamParameters', 'yade-opengl'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/LatticeBeamParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
 			'$PREFIX/include',
 			'RenderingEngine/GLDrawLatticeBeamState']),
 
@@ -190,11 +190,11 @@
 			'yade-opengl',
 			'yade-computational-geometry'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/GeometricalModel/LatticeSetGeometry',
-			'DataClass/PhysicalParameters/LatticeBeamParameters',
-			'DataClass/PhysicalParameters/LatticeNodeParameters',
+			'DataClass/GeometricalModel',
+			'DataClass/PhysicalParameters',
+			'DataClass/PhysicalParameters',
 			'RenderingEngine/GLDrawLatticeSetGeometry',
-			'DataClass/PhysicalParameters/LatticeSetParameters']),
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('GLDrawLatticeInteractingGeometry',
 		['RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.cpp'],
@@ -208,15 +208,15 @@
 			'yade-opengl',
 			'yade-computational-geometry'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/GeometricalModel/LatticeSetGeometry',
-			'DataClass/PhysicalParameters/LatticeBeamParameters',
+			'DataClass/GeometricalModel',
+			'DataClass/PhysicalParameters',
 			'RenderingEngine/GLDrawLatticeInteractingGeometry',
-			'DataClass/PhysicalParameters/LatticeNodeParameters',
-			'DataClass/InteractingGeometry/LatticeInteractingGeometry',
-			'DataClass/PhysicalParameters/LatticeSetParameters']),
+			'DataClass/PhysicalParameters',
+			'DataClass/InteractingGeometry',
+			'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('LatticeExample',
-		['PreProcessor/LatticeExample/LatticeExample.cpp'],
+		['PreProcessor/LatticeExample.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'LineSegment',
@@ -251,21 +251,21 @@
 			'LatticeLaw',
 			'yade-base',
 			'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine/NonLocalInitializer',
+		CPPPATH=env['CPPPATH']+['Engine/StandAloneEngine',
 			'$PREFIX/include',
-			'Engine/StandAloneEngine/MeasurePoisson',
-			'DataClass/InteractionPhysics/LatticeBeamAngularSpring',
-			'Engine/StandAloneEngine/NodeRecorder',
-			'PreProcessor/LatticeExample',
-			'Engine/StandAloneEngine/MovingSupport',
-			'DataClass/InteractionPhysics/NonLocalDependency',
-			'Engine/StandAloneEngine/BeamRecorder',
-			'DataClass/PhysicalParameters/LatticeNodeParameters',
-			'Engine/StandAloneEngine/LatticeLaw',
-			'DataClass/PhysicalParameters/LatticeBeamParameters',
-			'DataClass/GeometricalModel/LineSegment',
-			'Engine/StandAloneEngine/StrainRecorder',
-			'DataClass/InteractingGeometry/LatticeInteractingGeometry',
-			'DataClass/PhysicalParameters/LatticeSetParameters'])
+			'Engine/StandAloneEngine',
+			'DataClass/InteractionPhysics',
+			'Engine/StandAloneEngine',
+			'PreProcessor',
+			'Engine/StandAloneEngine',
+			'DataClass/InteractionPhysics',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'Engine/StandAloneEngine',
+			'DataClass/PhysicalParameters',
+			'DataClass/GeometricalModel',
+			'Engine/StandAloneEngine',
+			'DataClass/InteractingGeometry',
+			'DataClass/PhysicalParameters'])
 ])
 

Deleted: branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry/SpringGeometry.cpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry/SpringGeometry.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry/SpringGeometry.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,25 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;SpringGeometry.hpp&quot;
-
-SpringGeometry::SpringGeometry()
-{
-	createIndex();
-}
-
-SpringGeometry::~SpringGeometry()
-{
-}
-
-void SpringGeometry::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(p1);
-	REGISTER_ATTRIBUTE(p2);
-}
-

Deleted: branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry/SpringGeometry.hpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry/SpringGeometry.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry/SpringGeometry.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SPRINGGEOMETRY_HPP
-#define SPRINGGEOMETRY_HPP
-
-
-#include&lt;yade/core/InteractionGeometry.hpp&gt;
-
-
-class SpringGeometry : public InteractionGeometry
-{
-	public :
-		Vector3r p1;
-		Vector3r p2;
-		SpringGeometry();
-		virtual ~SpringGeometry();
-	
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(SpringGeometry);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometry);
-
-	REGISTER_CLASS_INDEX(SpringGeometry,InteractionGeometry);
-};
-
-REGISTER_SERIALIZABLE(SpringGeometry,false);
-
-#endif // SPRINGGEOMETRY_HPP
-

Copied: branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry.cpp (from rev 1105, branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry/SpringGeometry.cpp)

Copied: branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry.hpp (from rev 1105, branches/scons-layout/pkg/mass-spring/DataClass/InteractionGeometry/SpringGeometry/SpringGeometry.hpp)

Deleted: branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics/SpringPhysics.cpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics/SpringPhysics.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics/SpringPhysics.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,26 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;SpringPhysics.hpp&quot;
-
-SpringPhysics::SpringPhysics()
-{
-	createIndex();
-}
-
-SpringPhysics::~SpringPhysics()
-{
-}
-
-void SpringPhysics::registerAttributes()
-{
-	REGISTER_ATTRIBUTE(stiffness);
-	REGISTER_ATTRIBUTE(damping);
-	REGISTER_ATTRIBUTE(initialLength);
-}
-

Deleted: branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics/SpringPhysics.hpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics/SpringPhysics.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics/SpringPhysics.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SPRINGPHYSICS_HPP
-#define SPRINGPHYSICS_HPP
-
-#include&lt;yade/core/InteractionPhysics.hpp&gt;
-
-class SpringPhysics : public InteractionPhysics
-{
-	public :
-		Real		 stiffness
-				,damping
-				,initialLength;
-
-		SpringPhysics();
-		virtual ~SpringPhysics();
-
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(SpringPhysics);
-	REGISTER_BASE_CLASS_NAME(InteractionPhysics);
-
-	REGISTER_CLASS_INDEX(SpringPhysics,InteractionPhysics);
-};
-
-REGISTER_SERIALIZABLE(SpringPhysics,false);
-
-#endif // SPRINGPHYSICS_HPP
-

Copied: branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics.cpp (from rev 1105, branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics/SpringPhysics.cpp)

Copied: branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics.hpp (from rev 1105, branches/scons-layout/pkg/mass-spring/DataClass/InteractionPhysics/SpringPhysics/SpringPhysics.hpp)

Deleted: branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters/ParticleSetParameters.cpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters/ParticleSetParameters.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters/ParticleSetParameters.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,22 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ParticleSetParameters.hpp&quot;
-
-
-ParticleSetParameters::ParticleSetParameters() : PhysicalParameters()
-{
-	createIndex();
-}
-
-
-ParticleSetParameters::~ParticleSetParameters()
-{
-}
-
-

Deleted: branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters/ParticleSetParameters.hpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters/ParticleSetParameters.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters/ParticleSetParameters.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,31 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef PARTICLESETPARAMETERS_HPP
-#define PARTICLESETPARAMETERS_HPP
-
-#include&lt;yade/core/PhysicalParameters.hpp&gt;
-
-class ParticleSetParameters : public PhysicalParameters
-{
-	public :
-		ParticleSetParameters();
-		virtual ~ParticleSetParameters();
-
-/// Serializable
-	REGISTER_CLASS_NAME(ParticleSetParameters);
-	REGISTER_BASE_CLASS_NAME(PhysicalParameters);
-
-/// Indexable
-	REGISTER_CLASS_INDEX(ParticleSetParameters,PhysicalParameters);
-};
-
-REGISTER_SERIALIZABLE(ParticleSetParameters,false);
-
-#endif // PARTICLESETPARAMETERS_HPP
-

Copied: branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters.cpp (from rev 1105, branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters/ParticleSetParameters.cpp)

Copied: branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters.hpp (from rev 1105, branches/scons-layout/pkg/mass-spring/DataClass/PhysicalParameters/ParticleSetParameters/ParticleSetParameters.hpp)

Deleted: branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D/ParticleSet2Mesh2D.cpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D/ParticleSet2Mesh2D.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D/ParticleSet2Mesh2D.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ParticleSet2Mesh2D.hpp&quot;
-#include &quot;ParticleSetParameters.hpp&quot;
-#include&lt;yade/pkg-common/Mesh2D.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-void ParticleSet2Mesh2D::go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-				, shared_ptr&lt;GeometricalModel&gt;&amp; gm
-				, const Body* body)
-{
-	Mesh2D* mesh2d = static_cast&lt;Mesh2D*&gt;(gm.get());
-	
-	const MetaBody * ncb = YADE_CAST&lt;const MetaBody*&gt;(body);
-	const shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-	
-// FIXME - this copying of Se3 between Mesh2D, and Particles inside MetaBody could be done just once, if Se3 was inside shared_ptr. This can be improved once we make indexable Parameters: Velocity, Position, Orientation, ....
-
-	int particleSetMask = 1; // FIXME - make this a class variable
- 	unsigned int i=0;
-
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for(  ; bi!=biEnd ; ++bi,++i )
-	{
-		shared_ptr&lt;Body&gt; b = *bi;
-		if( b-&gt;getGroupMask() &amp; particleSetMask )// FIXME - this line is a bad hack, to make things work, we should have TWO ComplexBodies, one with cloth, second with spheres. here I assume that spheres and cloth are in the same MetaBody, and that cloth belongs to group 1
-			mesh2d-&gt;vertices[i]=b-&gt;physicalParameters-&gt;se3.position;
-	}
-}
-	

Deleted: branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D/ParticleSet2Mesh2D.hpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D/ParticleSet2Mesh2D.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D/ParticleSet2Mesh2D.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,29 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef PARTICLESET2MESH2D_HPP
-#define PARTICLESET2MESH2D_HPP
-
-
-#include&lt;yade/pkg-common/GeometricalModelEngineUnit.hpp&gt;
-
-class ParticleSet2Mesh2D : public GeometricalModelEngineUnit
-{
-	public :
-		void go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp;
-				, shared_ptr&lt;GeometricalModel&gt;&amp;
-				, const Body*);
-
-	REGISTER_CLASS_NAME(ParticleSet2Mesh2D);
-	REGISTER_BASE_CLASS_NAME(GeometricalModelEngineUnit);
-};
-
-REGISTER_SERIALIZABLE(ParticleSet2Mesh2D,false);
-
-#endif // PARTICLESET2MESH2D_HPP
-

Copied: branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D.cpp (from rev 1105, branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D/ParticleSet2Mesh2D.cpp)

Copied: branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D.hpp (from rev 1105, branches/scons-layout/pkg/mass-spring/Engine/EngineUnit/ParticleSet2Mesh2D/ParticleSet2Mesh2D.hpp)

Deleted: branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw/MassSpringLaw.cpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw/MassSpringLaw.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw/MassSpringLaw.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,80 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;MassSpringLaw.hpp&quot;
-#include &quot;SpringGeometry.hpp&quot;
-#include &quot;SpringPhysics.hpp&quot;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Mesh2D.hpp&gt;
-#include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-MassSpringLaw::MassSpringLaw () : InteractionSolver(), actionForce(new Force) , actionMomentum(new Momentum)
-{
-}
-
-
-void MassSpringLaw::registerAttributes()
-{
-	InteractionSolver::registerAttributes();
-	REGISTER_ATTRIBUTE(springGroupMask);
-}
-
-
-void MassSpringLaw::action(Body * body)
-{
-	MetaBody * massSpring = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt;&amp; bodies = massSpring-&gt;bodies;
-	shared_ptr&lt;InteractionContainer&gt;&amp; persistentInteractions = massSpring-&gt;persistentInteractions;
-	shared_ptr&lt;PhysicalActionContainer&gt;&amp; physicalActions = massSpring-&gt;physicalActions;
-	
-
-	InteractionContainer::iterator ii    = persistentInteractions-&gt;begin();
-	InteractionContainer::iterator iiEnd = persistentInteractions-&gt;end();
-	for(  ; ii!=iiEnd ; ++ii )
-	{	
-		shared_ptr&lt;Interaction&gt; spring = *ii;
-		if (spring-&gt;isReal)
-		{
-			int id1 = spring-&gt;getId1();
-			int id2 = spring-&gt;getId2();
-			
-			if( !(  (*bodies)[id1]-&gt;getGroupMask() &amp; (*bodies)[id2]-&gt;getGroupMask() &amp; springGroupMask) )
-				continue; // skip other groups
-			
-			ParticleParameters * p1 = static_cast&lt;ParticleParameters*&gt;((*bodies)[id1]-&gt;physicalParameters.get());
-			ParticleParameters * p2 = static_cast&lt;ParticleParameters*&gt;((*bodies)[id2]-&gt;physicalParameters.get());
-			
-			SpringPhysics* physics		= static_cast&lt;SpringPhysics*&gt;(spring-&gt;interactionPhysics.get());
-			SpringGeometry* geometry	= static_cast&lt;SpringGeometry*&gt;(spring-&gt;interactionGeometry.get());
-			
-			Vector3r v1 = p2-&gt;se3.position;
-			Vector3r v2 = p1-&gt;se3.position;
-			
-			Real l  = (v2-v1).Length();
-			
-			Real l0 = physics-&gt;initialLength;
-			
-			Vector3r dir = (v2-v1);
-			dir.Normalize();
-			
-			Real e  = (l-l0)/l0;
-			Real relativeVelocity = dir.Dot((p1-&gt;velocity-p2-&gt;velocity));
-			Vector3r f3 = (e*physics-&gt;stiffness + relativeVelocity* ( 1.0 - physics-&gt;damping )  )*dir;
-			
-			static_cast&lt;Force*&gt;   ( physicalActions-&gt;find( id1 , actionForce-&gt;getClassIndex() ).get() )-&gt;force    -= f3;
-			static_cast&lt;Force*&gt;   ( physicalActions-&gt;find( id2 , actionForce-&gt;getClassIndex() ).get() )-&gt;force    += f3;
-		}
-	}
-	
-}
-

Deleted: branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw/MassSpringLaw.hpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw/MassSpringLaw.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw/MassSpringLaw.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,35 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef MASSSPRINGLAW_HPP
-#define MASSSPRINGLAW_HPP
-
-#include&lt;yade/core/InteractionSolver.hpp&gt;
-#include&lt;yade/core/PhysicalAction.hpp&gt;
-
-class MassSpringLaw : public InteractionSolver
-{
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;	
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
-	public :
-		int springGroupMask;
-		MassSpringLaw ();
-		void action(Body* body);
-
-	protected :
-		void registerAttributes();
-	REGISTER_CLASS_NAME(MassSpringLaw);
-	REGISTER_BASE_CLASS_NAME(InteractionSolver);
-};
-
-REGISTER_SERIALIZABLE(MassSpringLaw,false);
-
-#endif // MASSSPRINGLAW_HPP
-

Copied: branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.cpp (from rev 1105, branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw/MassSpringLaw.cpp)

Copied: branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw.hpp (from rev 1105, branches/scons-layout/pkg/mass-spring/Engine/StandAloneEngine/MassSpringLaw/MassSpringLaw.hpp)

Deleted: branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth/HangingCloth.cpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth/HangingCloth.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth/HangingCloth.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,556 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;HangingCloth.hpp&quot;
-
-#include &quot;MassSpringLaw.hpp&quot;
-#include &quot;ParticleSetParameters.hpp&quot;
-#include &quot;SpringGeometry.hpp&quot;
-#include &quot;SpringPhysics.hpp&quot;
-
-
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/Mesh2D.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/pkg-common/Box.hpp&gt;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-//#include&lt;yade/pkg-common/FrictionLessElasticContactLaw.hpp&gt;
-#include&lt;yade/pkg-common/PersistentSAPCollider.hpp&gt;
-//#include&lt;yade/pkg-common/MassSpringBody2RigidBodyLaw.hpp&gt;
-
-#include&lt;yade/lib-serialization/IOFormatManager.hpp&gt;
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/InteractionPhysicsMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/GeometricalModelMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-#include&lt;yade/pkg-common/ParticleParameters.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-
-#include&lt;yade/pkg-dem/ElasticContactLaw.hpp&gt;
-#include&lt;yade/pkg-dem/MacroMicroElasticRelationships.hpp&gt;
-#include&lt;yade/pkg-dem/BodyMacroParameters.hpp&gt;
-#include&lt;yade/pkg-dem/SDECLinkGeometry.hpp&gt;
-#include&lt;yade/pkg-dem/SDECLinkPhysics.hpp&gt;
-//#include&lt;yade/pkg-common/MassSpringBody2RigidBodyLaw.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-
-HangingCloth::HangingCloth () : FileGenerator()
-{
-	width = 20;
-	height = 20;
-	springStiffness = 400000;//500;
-	springDamping   = 1.0;
-	particleDamping = 0.997;
-	clothMass = 4000;//10;
-	cellSize = 20;
-	fixPoint1 = true;
-	fixPoint2 = true;
-	fixPoint3 = true;
-	fixPoint4 = true;
-	ground = true;
-	dampingForce = 0.3;
-
-// spheres	
-	nbSpheres = Vector3r(2,3,4);
-	minRadius = 6;
-	maxRadius = 10;
-	disorder = 2.1;
-	spacing = 17;
-	dampingMomentum = 0.3;
-	density = 2;
-	linkSpheres = true;
-
-	sphereYoungModulus   = 10000;
-	spherePoissonRatio  = 0.2;
-	sphereFrictionDeg   = 18.0;
-	gravity 	= Vector3r(0,-9.81,0);
-}
-
-
-HangingCloth::~HangingCloth ()
-{
-
-}
-
-
-void HangingCloth::postProcessAttributes(bool)
-{
-}
-
-
-void HangingCloth::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	REGISTER_ATTRIBUTE(width);
-	REGISTER_ATTRIBUTE(height);
-	REGISTER_ATTRIBUTE(springStiffness);
-	REGISTER_ATTRIBUTE(springDamping);
-	//REGISTER_ATTRIBUTE(particleDamping); 	// FIXME - ignored - delete it, or start using it
-	REGISTER_ATTRIBUTE(clothMass);
-	REGISTER_ATTRIBUTE(cellSize);
-	REGISTER_ATTRIBUTE(fixPoint1);
-	REGISTER_ATTRIBUTE(fixPoint2);
-	REGISTER_ATTRIBUTE(fixPoint3);
-	REGISTER_ATTRIBUTE(fixPoint4);
-	REGISTER_ATTRIBUTE(ground);
-	
-	// spheres
-	//REGISTER_ATTRIBUTE(nbSpheres);
-	//REGISTER_ATTRIBUTE(minRadius);
-	//REGISTER_ATTRIBUTE(maxRadius);
-	//rEGISTER_ATTRIBUTE(density); 		
-	//REGISTER_ATTRIBUTE(disorder);
-	//REGISTER_ATTRIBUTE(spacing);		
-	
-	REGISTER_ATTRIBUTE(gravity);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum);
-	//REGISTER_ATTRIBUTE(linkSpheres);
-
-//	REGISTER_ATTRIBUTE(sphereYoungModulus);
-//	REGISTER_ATTRIBUTE(spherePoissonRatio);
-//	REGISTER_ATTRIBUTE(sphereFrictionDeg);
-}
-
-
-string HangingCloth::generate()
-{
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
-	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingSphere&quot;,&quot;InteractingSphere2InteractingSphere4SpheresContactGeometry&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingSphere4SpheresContactGeometry&quot;);
-
-	shared_ptr&lt;InteractionPhysicsMetaEngine&gt; interactionPhysicsDispatcher(new InteractionPhysicsMetaEngine);
-	interactionPhysicsDispatcher-&gt;add(&quot;BodyMacroParameters&quot;,&quot;BodyMacroParameters&quot;,&quot;MacroMicroElasticRelationships&quot;);
-
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-
-	shared_ptr&lt;GeometricalModelMetaEngine&gt; geometricalModelDispatcher	= shared_ptr&lt;GeometricalModelMetaEngine&gt;(new GeometricalModelMetaEngine);
-	geometricalModelDispatcher-&gt;add(&quot;ParticleSetParameters&quot;,&quot;Mesh2D&quot;,&quot;ParticleSet2Mesh2D&quot;);
-
-	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping-&gt;damping = dampingForce;
-	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping-&gt;damping = dampingMomentum;
-	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
-	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
-
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
- 	
-	shared_ptr&lt;MassSpringLaw&gt; explicitMassSpringConstitutiveLaw(new MassSpringLaw);
-	explicitMassSpringConstitutiveLaw-&gt;springGroupMask = 1;
-
-	shared_ptr&lt;ElasticContactLaw&gt; elasticContactLaw(new ElasticContactLaw);
-	elasticContactLaw-&gt;sdecGroupMask = 2;
-
-	//shared_ptr&lt;MassSpringBody2RigidBodyLaw&gt; massSpringBody2RigidBodyConstitutiveLaw(new MassSpringBody2RigidBodyLaw);
-	//massSpringBody2RigidBodyConstitutiveLaw-&gt;sdecGroupMask = 2;
-	//massSpringBody2RigidBodyConstitutiveLaw-&gt;springGroupMask = 1;
-
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);
-	rootBody-&gt;engines.push_back(geometricalModelDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PersistentSAPCollider));
-	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-	rootBody-&gt;engines.push_back(interactionPhysicsDispatcher);
-	rootBody-&gt;engines.push_back(explicitMassSpringConstitutiveLaw);
-	rootBody-&gt;engines.push_back(elasticContactLaw);
-//	rootBody-&gt;engines.push_back(massSpringBody2RigidBodyConstitutiveLaw); // FIXME - is not working...
-	rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(actionDampingDispatcher);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-	rootBody-&gt;engines.push_back(orientationIntegrator);
-
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-	rootBody-&gt;initializers.push_back(geometricalModelDispatcher);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	// use ParticleSet so that we have automatic updating for free
-	shared_ptr&lt;ParticleSetParameters&gt; physics2(new ParticleSetParameters);
-	physics2-&gt;se3		= Se3r(Vector3r(0,0,0),q);
-
-	rootBody-&gt;isDynamic	= false;
-
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	set-&gt;diffuseColor	= Vector3r(0,0,1);
-
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor	= Vector3r(0,0,1);
-
-	shared_ptr&lt;Mesh2D&gt; mesh2d(new Mesh2D);
-	mesh2d-&gt;diffuseColor	= Vector3r(0,0,1);
-	mesh2d-&gt;wire		= false;
-	mesh2d-&gt;visible		= true;
-	mesh2d-&gt;shadowCaster	= false;
-
-	rootBody-&gt;geometricalModel			= mesh2d;
-	rootBody-&gt;interactingGeometry			= set;
-	rootBody-&gt;boundingVolume			= aabb;
-	rootBody-&gt;physicalParameters	= physics2;
-
-	rootBody-&gt;persistentInteractions-&gt;clear();
-
-// make mesh
-	
-	for(int i=0;i&lt;width;i++)
-		for(int j=0;j&lt;height;j++)
-		{
-			shared_ptr&lt;Body&gt; node(new Body(0,1|2));
-
-			node-&gt;isDynamic		= true;
-			
-			shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-			iSphere-&gt;diffuseColor	= Vector3r(0,0,1);
-			iSphere-&gt;radius		= cellSize/2.2;
-
-// BEGIN ORIGINAL							
-//			shared_ptr&lt;ParticleParameters&gt; particle(new ParticleParameters);
-//			particle-&gt;velocity		= Vector3r(0,0,0);
-//			particle-&gt;mass			= clothMass/(Real)(width*height);
-//			particle-&gt;se3			= Se3r(Vector3r(i*cellSize-(cellSize*(width-1))*0.5,0,j*cellSize-(cellSize*(height-1))*0.5),q);
-// END									
-
-// BEGIN HACK - to have collision between SDEC spheres and cloth	
-			shared_ptr&lt;BodyMacroParameters&gt; particle(new BodyMacroParameters);
-			particle-&gt;angularVelocity	= Vector3r(0,0,0);
-			particle-&gt;velocity		= Vector3r(0,0,0);
-			particle-&gt;mass			= clothMass/(Real)(width*height);
-			particle-&gt;inertia		= Vector3r(2.0/5.0*particle-&gt;mass*iSphere-&gt;radius*iSphere-&gt;radius,2.0/5.0*particle-&gt;mass*iSphere-&gt;radius*iSphere-&gt;radius,2.0/5.0*particle-&gt;mass*iSphere-&gt;radius*iSphere-&gt;radius);
-			particle-&gt;se3			= Se3r(Vector3r(i*cellSize-(cellSize*(width-1))*0.5,0,j*cellSize-(cellSize*(height-1))*0.5),q);
-			particle-&gt;young			= sphereYoungModulus;
-			particle-&gt;poisson		= spherePoissonRatio;
-			particle-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-// END HACK								
-
-			shared_ptr&lt;AABB&gt; aabb(new AABB);
-			aabb-&gt;diffuseColor	= Vector3r(0,1,0);
-
-			node-&gt;boundingVolume		= aabb;
-			//node-&gt;geometricalModel		= ??;
-			node-&gt;interactingGeometry		= iSphere;
-			node-&gt;physicalParameters= particle;
-
-			rootBody-&gt;bodies-&gt;insert(node);
-			mesh2d-&gt;vertices.push_back(particle-&gt;se3.position);
-		}
-
-	for(int i=0;i&lt;width-1;i++)
-		for(int j=0;j&lt;height-1;j++)
-		{
-			mesh2d-&gt;edges.push_back(Edge(offset(i,j),offset(i+1,j)));
-			mesh2d-&gt;edges.push_back(Edge(offset(i,j),offset(i,j+1)));
-			mesh2d-&gt;edges.push_back(Edge(offset(i,j+1),offset(i+1,j)));
-
-			rootBody-&gt;persistentInteractions-&gt;insert(createSpring(rootBody,offset(i,j),offset(i+1,j)));
-			rootBody-&gt;persistentInteractions-&gt;insert(createSpring(rootBody,offset(i,j),offset(i,j+1)));
-			rootBody-&gt;persistentInteractions-&gt;insert(createSpring(rootBody,offset(i,j+1),offset(i+1,j)));
-
-			vector&lt;int&gt; face1,face2;
-			face1.push_back(offset(i,j));
-			face1.push_back(offset(i+1,j));
-			face1.push_back(offset(i,j+1));
-
-			face2.push_back(offset(i+1,j));
-			face2.push_back(offset(i+1,j+1));
-			face2.push_back(offset(i,j+1));
-
-			mesh2d-&gt;faces.push_back(face1);
-			mesh2d-&gt;faces.push_back(face2);
-		}
-
-	for(int i=0;i&lt;width-1;i++)
-	{
-		mesh2d-&gt;edges.push_back(Edge(offset(i,height-1),offset(i+1,height-1)));
-		rootBody-&gt;persistentInteractions-&gt;insert(createSpring(rootBody,offset(i,height-1),offset(i+1,height-1)));
-
-	}
-
-	for(int j=0;j&lt;height-1;j++)
-	{
-		mesh2d-&gt;edges.push_back(Edge(offset(width-1,j),offset(width-1,j+1)));
-		rootBody-&gt;persistentInteractions-&gt;insert(createSpring(rootBody,offset(width-1,j),offset(width-1,j+1)));
-	}
-
-	if (fixPoint1)
-	{
-		Body * body = static_cast&lt;Body*&gt;((*(rootBody-&gt;bodies))[offset(0,0)].get());
-		ParticleParameters * p = static_cast&lt;ParticleParameters*&gt;(body-&gt;physicalParameters.get());
-		p-&gt;mass = 1;
-		body-&gt;interactingGeometry-&gt;diffuseColor = Vector3r(1.0,0.0,0.0);
-		body-&gt;isDynamic = false;
-	}
-
-	if (fixPoint2)
-	{
-		Body * body = static_cast&lt;Body*&gt;((*(rootBody-&gt;bodies))[offset(width-1,0)].get());
-		ParticleParameters * p = static_cast&lt;ParticleParameters*&gt;(body-&gt;physicalParameters.get());
-		p-&gt;mass = 1;
-		body-&gt;interactingGeometry-&gt;diffuseColor = Vector3r(1.0,0.0,0.0);
-		body-&gt;isDynamic = false;
-	}
-
-	if (fixPoint3)
-	{
-		Body * body = static_cast&lt;Body*&gt;((*(rootBody-&gt;bodies))[offset(0,height-1)].get());
-		ParticleParameters * p = static_cast&lt;ParticleParameters*&gt;(body-&gt;physicalParameters.get());
-		p-&gt;mass = 1;
-		body-&gt;interactingGeometry-&gt;diffuseColor = Vector3r(1.0,0.0,0.0);
-		body-&gt;isDynamic = false;
-	}
-
-	if (fixPoint4)
-	{
-		Body * body = static_cast&lt;Body*&gt;((*(rootBody-&gt;bodies))[offset(width-1,height-1)].get());
-		ParticleParameters * p = static_cast&lt;ParticleParameters*&gt;(body-&gt;physicalParameters.get());
-		p-&gt;mass = 1;
-		body-&gt;interactingGeometry-&gt;diffuseColor = Vector3r(1.0,0.0,0.0);
-		body-&gt;isDynamic = false;
-	}
-
-	
-// make ground
-
-	shared_ptr&lt;Body&gt; groundBox;
-	createBox(groundBox, Vector3r(0,-200,0), Vector3r(500,10,500));
-	if(ground)
-		rootBody-&gt;bodies-&gt;insert(groundBox);
-
-// make spheres
-	
-// 	for(int i=0;i&lt;nbSpheres[0];i++)
-// 		for(int j=0;j&lt;nbSpheres[1];j++)
-// 			for(int k=0;k&lt;nbSpheres[2];k++)
-// 			{
-// 				shared_ptr&lt;Body&gt; sphere;
-// 				createSphere(sphere,i,j,k);
-// 				rootBody-&gt;bodies-&gt;insert(sphere);
-// 			}
-
-			
-
-// make links
-
-	int linksNum=0;
-	if(linkSpheres)
-	{
-		BodyContainer::iterator bi    = rootBody-&gt;bodies-&gt;begin();
-		BodyContainer::iterator bi2;
-		BodyContainer::iterator biEnd = rootBody-&gt;bodies-&gt;end();
-		for(  ; bi!=biEnd ; ++bi )
-		{
-			shared_ptr&lt;Body&gt; bodyA = *bi;
-			bi2=bi;
-			++bi2;
-			
-			for( ; bi2!=biEnd ; ++bi2 )
-			{
-				shared_ptr&lt;Body&gt; bodyB = *bi2;
-	
-				shared_ptr&lt;BodyMacroParameters&gt; a = YADE_PTR_CAST&lt;BodyMacroParameters&gt;(bodyA-&gt;physicalParameters);
-				shared_ptr&lt;BodyMacroParameters&gt; b = YADE_PTR_CAST&lt;BodyMacroParameters&gt;(bodyB-&gt;physicalParameters);
-				shared_ptr&lt;InteractingSphere&gt;	as = YADE_PTR_CAST&lt;InteractingSphere&gt;(bodyA-&gt;interactingGeometry);
-				shared_ptr&lt;InteractingSphere&gt;	bs = YADE_PTR_CAST&lt;InteractingSphere&gt;(bodyB-&gt;interactingGeometry);
-	
-				if ( a &amp;&amp; b &amp;&amp; as &amp;&amp; bs &amp;&amp; (a-&gt;se3.position - b-&gt;se3.position).Length() &lt; (as-&gt;radius + bs-&gt;radius))  
-				{
-					shared_ptr&lt;Interaction&gt; 		link(new Interaction( bodyA-&gt;getId() , bodyB-&gt;getId() ));
-					shared_ptr&lt;SDECLinkGeometry&gt;		geometry(new SDECLinkGeometry);
-					shared_ptr&lt;SDECLinkPhysics&gt;	physics(new SDECLinkPhysics);
-					
-					geometry-&gt;radius1			= as-&gt;radius - fabs(as-&gt;radius - bs-&gt;radius)*0.5;
-					geometry-&gt;radius2			= bs-&gt;radius - fabs(as-&gt;radius - bs-&gt;radius)*0.5;
-	
-					physics-&gt;initialKn			= 500000;
-					physics-&gt;initialKs			= 50000;
-					physics-&gt;heta				= 1;
-					physics-&gt;initialEquilibriumDistance	= (a-&gt;se3.position - b-&gt;se3.position).Length();
-					physics-&gt;knMax				= 75000;
-					physics-&gt;ksMax				= 7500;
-	
-					link-&gt;interactionGeometry 		= geometry;
-					link-&gt;interactionPhysics 		= physics;
-					link-&gt;isReal 				= true;
-					link-&gt;isNew 				= false;
-					
-					rootBody-&gt;persistentInteractions-&gt;insert(link);
-					++linksNum;
-				}
-			}
-		}
-	}
-			
-	return &quot;total number of permament links created: &quot; + lexical_cast&lt;string&gt;(linksNum);
-}
-
-
-shared_ptr&lt;Interaction&gt;&amp; HangingCloth::createSpring(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,int i,int j)
-{
-	Body * b1 = static_cast&lt;Body*&gt;((*(rootBody-&gt;bodies))[i].get());
-	Body * b2 = static_cast&lt;Body*&gt;((*(rootBody-&gt;bodies))[j].get());
-
-	spring = shared_ptr&lt;Interaction&gt;(new Interaction( b1-&gt;getId() , b2-&gt;getId() ));
-	shared_ptr&lt;SpringGeometry&gt;	geometry(new SpringGeometry);
-	shared_ptr&lt;SpringPhysics&gt;	physics(new SpringPhysics);
-
-	geometry-&gt;p1			= b1-&gt;physicalParameters-&gt;se3.position;
-	geometry-&gt;p2			= b2-&gt;physicalParameters-&gt;se3.position;
-
-	physics-&gt;initialLength		= (geometry-&gt;p1-geometry-&gt;p2).Length();
-	physics-&gt;stiffness		= springStiffness;
-	physics-&gt;damping		= springDamping;
-
-	spring-&gt;interactionGeometry = geometry;
-	spring-&gt;interactionPhysics = physics;
-	spring-&gt;isReal = true;
-	spring-&gt;isNew = false;
-
-	return spring;
-}
-
-
-void HangingCloth::createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,2));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-	
-		
-	Vector3r position 		=   Vector3r(i,j,k) * spacing 
-					  - Vector3r( nbSpheres[0]/2*spacing  ,  nbSpheres[1]/2*spacing-90  ,  nbSpheres[2]/2*spacing)
-					  + Vector3r( Mathr::SymmetricRandom()*disorder ,  Mathr::SymmetricRandom()*disorder , Mathr::SymmetricRandom()*disorder );
-
-	Real radius 			= (Mathr::IntervalRandom(minRadius,maxRadius));
-	
-	body-&gt;isDynamic			= true;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 4.0/3.0*Mathr::PI*radius*radius*radius*density; // FIXME!!!!!!!!!!!!!! I had a mistake everywhre - it was 4/3*PI*radius*radius, EVERYWHERE!!!. the volume of a sphere should be calculated in ONLY one place!!!
-	physics-&gt;inertia		= Vector3r(2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-
-
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	iSphere-&gt;radius			= radius;
-	iSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-
-	body-&gt;interactingGeometry	= iSphere;
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void HangingCloth::createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,2));
-	shared_ptr&lt;BodyMacroParameters&gt; physics(new BodyMacroParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 0;
-	physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-	physics-&gt;young			= sphereYoungModulus;
-	physics-&gt;poisson		= spherePoissonRatio;
-	physics-&gt;frictionAngle		= sphereFrictionDeg * Mathr::PI/180.0;
-
-	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
-
-	gBox-&gt;extents			= extents;
-	gBox-&gt;diffuseColor		= Vector3r(1,1,1);
-	gBox-&gt;wire			= false;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= true;
-	
-	iBox-&gt;extents			= extents;
-	iBox-&gt;diffuseColor		= Vector3r(1,1,1);
-
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;physicalParameters	= physics;
-}
-

Deleted: branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth/HangingCloth.hpp
===================================================================
--- branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth/HangingCloth.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth/HangingCloth.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,72 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef HANGINGCLOTH_HPP
-#define HANGINGCLOTH_HPP
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-
-class HangingCloth : public FileGenerator
-{
-	private : 
-		shared_ptr&lt;Interaction&gt;  spring;
-
-		int		 width
-				,height
-				,cellSize;
-
-		Real		 springStiffness
-				,springDamping
-				,particleDamping
-				,clothMass
-				,dampingForce
-				,sphereYoungModulus
-				,spherePoissonRatio
-				,sphereFrictionDeg;
-
-		bool		 fixPoint1
-				,fixPoint2
-				,fixPoint3
-				,fixPoint4
-				,ground;
-// spheres
-		Vector3r	 nbSpheres
-				,gravity;
-
-		Real		 density
-				,minRadius
-				,maxRadius
-				,disorder
-				,spacing
-				,dampingMomentum;
-
-		bool		linkSpheres;
-
-	public :
-		HangingCloth ();
-		~HangingCloth ();
-		string generate();
-
-	
-	private :
-		shared_ptr&lt;Interaction&gt;&amp; createSpring(const shared_ptr&lt;MetaBody&gt;&amp; rootBody,int i,int j);
-		void createBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents);
-		void createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k);
-	
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-		void registerAttributes();
-
-	REGISTER_CLASS_NAME(HangingCloth);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-};
-
-REGISTER_SERIALIZABLE(HangingCloth,false);
-
-#endif // __HANGINGCLOTH_H__
-

Copied: branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth.cpp (from rev 1105, branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth/HangingCloth.cpp)

Copied: branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth.hpp (from rev 1105, branches/scons-layout/pkg/mass-spring/PreProcessor/HangingCloth/HangingCloth.hpp)

Modified: branches/scons-layout/pkg/mass-spring/SConscript
===================================================================
--- branches/scons-layout/pkg/mass-spring/SConscript	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/mass-spring/SConscript	2007-03-07 14:13:16 UTC (rev 1107)
@@ -2,33 +2,33 @@
 env.Install('$PREFIX/lib/yade$POSTFIX/pkg-mass-spring',[
 
 	env.SharedLibrary('ParticleSetParameters',
-		['DataClass/PhysicalParameters/ParticleSetParameters/ParticleSetParameters.cpp'],
+		['DataClass/PhysicalParameters/ParticleSetParameters.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/PhysicalParameters/ParticleSetParameters']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/PhysicalParameters']),
 
 	env.SharedLibrary('SpringGeometry',
-		['DataClass/InteractionGeometry/SpringGeometry/SpringGeometry.cpp'],
+		['DataClass/InteractionGeometry/SpringGeometry.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionGeometry/SpringGeometry']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('SpringPhysics',
-		['DataClass/InteractionPhysics/SpringPhysics/SpringPhysics.cpp'],
+		['DataClass/InteractionPhysics/SpringPhysics.cpp'],
 		LIBS=env['LIBS']+['yade-base', 'Wm3Foundation'],
-		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics/SpringPhysics', '$PREFIX/include']),
+		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics', '$PREFIX/include']),
 
 	env.SharedLibrary('ParticleSet2Mesh2D',
-		['Engine/EngineUnit/ParticleSet2Mesh2D/ParticleSet2Mesh2D.cpp'],
+		['Engine/EngineUnit/ParticleSet2Mesh2D.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'ParticleSetParameters',
 			'GeometricalModelMetaEngine',
 			'Mesh2D'],
-		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters/ParticleSetParameters',
+		CPPPATH=env['CPPPATH']+['DataClass/PhysicalParameters',
 			'$PREFIX/include',
-			'Engine/EngineUnit/ParticleSet2Mesh2D']),
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('MassSpringLaw',
-		['Engine/StandAloneEngine/MassSpringLaw/MassSpringLaw.cpp'],
+		['Engine/StandAloneEngine/MassSpringLaw.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'SpringPhysics',
@@ -41,13 +41,13 @@
 			'Force',
 			'Momentum',
 			'Mesh2D'],
-		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics/SpringPhysics',
+		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics',
 			'$PREFIX/include',
-			'Engine/StandAloneEngine/MassSpringLaw',
-			'DataClass/InteractionGeometry/SpringGeometry']),
+			'Engine/StandAloneEngine',
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('HangingCloth',
-		['PreProcessor/HangingCloth/HangingCloth.cpp'],
+		['PreProcessor/HangingCloth.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'SpringGeometry',
@@ -88,12 +88,12 @@
 			'yade-multimethods',
 			'MassSpringLaw',
 			'ElasticContactLaw'],
-		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics/SpringPhysics',
+		CPPPATH=env['CPPPATH']+['DataClass/InteractionPhysics',
 			'$PREFIX/include',
-			'Engine/StandAloneEngine/MassSpringLaw',
-			'Engine/EngineUnit/ParticleSet2Mesh2D',
-			'PreProcessor/HangingCloth',
-			'DataClass/PhysicalParameters/ParticleSetParameters',
-			'DataClass/InteractionGeometry/SpringGeometry'])
+			'Engine/StandAloneEngine',
+			'Engine/EngineUnit',
+			'PreProcessor',
+			'DataClass/PhysicalParameters',
+			'DataClass/InteractionGeometry'])
 ])
 

Deleted: branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact/ErrorTolerantContact.cpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact/ErrorTolerantContact.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact/ErrorTolerantContact.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,34 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ErrorTolerantContact.hpp&quot;
-
-
-ErrorTolerantContact::ErrorTolerantContact() : InteractionGeometry()
-{
-	createIndex();
-}
-
-
-ErrorTolerantContact::~ErrorTolerantContact ()
-{
-
-}
-
-
-void ErrorTolerantContact::postProcessAttributes(bool)
-{
-
-}
-
-
-void ErrorTolerantContact::registerAttributes()
-{
-
-}
-

Deleted: branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact/ErrorTolerantContact.hpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact/ErrorTolerantContact.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact/ErrorTolerantContact.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,48 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ERRORTOLERANTCONTACTMODEL_HPP
-#define ERRORTOLERANTCONTACTMODEL_HPP
-
-#include&lt;yade/core/InteractionGeometry.hpp&gt;
-#include &lt;Wm3Vector3.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-
-class ErrorTolerantContact : public InteractionGeometry
-{
-	public :
-		vector&lt;pair&lt;Vector3r,Vector3r&gt; &gt; closestPoints;
-		Vector3r o1p1;
-		Vector3r o2p2;
-		Vector3r normal;
-
-	//public : Vector3r t;	
-	//public : Vector3r s;
-	//public : Vector3r l;
-	//public : Real nu;
-	//public : std::pair&lt;t_Vertex,t_Vertex&gt; idVertex;
-	//public : t_ConnexionType type;
-	
-	// construction
-		ErrorTolerantContact ();
-		virtual ~ErrorTolerantContact ();
-
-	protected :
-		virtual void postProcessAttributes(bool deserializing);
-	public :
-		void registerAttributes();
-
-	REGISTER_CLASS_NAME(ErrorTolerantContact);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometry);
-	
-	REGISTER_CLASS_INDEX(ErrorTolerantContact,InteractionGeometry);
-};
-
-REGISTER_SERIALIZABLE(ErrorTolerantContact,false);
-
-#endif // ERRORTOLERANTCONTACTMODEL_HPP

Copied: branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact.cpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact/ErrorTolerantContact.cpp)

Copied: branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact.hpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/DataClass/InteractionGeometry/ErrorTolerantContact/ErrorTolerantContact.hpp)

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures/AAInteractingBox2InteractingSphere4ClosestFeatures.cpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures/AAInteractingBox2InteractingSphere4ClosestFeatures.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures/AAInteractingBox2InteractingSphere4ClosestFeatures.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,121 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;AAInteractingBox2InteractingSphere4ClosestFeatures.hpp&quot;
-
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include&lt;yade/pkg-common/ClosestFeatures.hpp&gt;
-
-bool AAInteractingBox2InteractingSphere4ClosestFeatures::go(		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	Vector3r l,t,p,q,r;
-	bool onborder = false;
-	Vector3r pt1,pt2,normal;
-	Real depth;
-	
-	shared_ptr&lt;InteractingSphere&gt; s = YADE_PTR_CAST&lt;InteractingSphere&gt;(cm2);
-	shared_ptr&lt;InteractingBox&gt;  aaBox = YADE_PTR_CAST&lt;InteractingBox&gt;(cm1);
-	
-	p = se32.position-se31.position;
-	
-	l[0] = aaBox-&gt;extents[0];
-	t[0] = p[0]; 
-	if (t[0] &lt; -l[0]) { t[0] = -l[0]; onborder = true; }
-	if (t[0] &gt;  l[0]) { t[0] =  l[0]; onborder = true; }
-
-	l[1] = aaBox-&gt;extents[1];
-	t[1] = p[1];
-	if (t[1] &lt; -l[1]) { t[1] = -l[1]; onborder = true; }
-	if (t[1] &gt;  l[1]) { t[1] =  l[1]; onborder = true; }
-
-	l[2] = aaBox-&gt;extents[2];
-	t[2] = p[2];
-	if (t[2] &lt; -l[2]) { t[2] = -l[2]; onborder = true; }
-	if (t[2] &gt;  l[2]) { t[2] =  l[2]; onborder = true; }
-
-	
-	if (!onborder) 
-	{
-		// sphere center inside box. find largest `t' value
-		Real min = l[0]-fabs(t[0]);
-		int mini = 0;
-		for (int i=1; i&lt;3; i++) 
-		{
-			Real tt = l[i]-fabs(t[i]);
-			if (tt &lt; min) 
-			{
-				min = tt;
-				mini = i;
-			}
-		}
-		
-		// contact normal aligned with box edge along largest `t' value
-		Vector3r tmp = Vector3r(0,0,0);
-
-		tmp[mini] = (t[mini] &gt; 0) ? 1.0 : -1.0;
-		
-		normal = tmp;
-		
-		normal.Normalize();
-		
-		pt1 = se32.position + normal*min;
-		pt2 = se32.position - normal*s-&gt;radius;
-	
-		shared_ptr&lt;ClosestFeatures&gt; cf = shared_ptr&lt;ClosestFeatures&gt;(new ClosestFeatures());
-		cf-&gt;closestsPoints.push_back(std::pair&lt;Vector3r,Vector3r&gt;(pt1,pt2));
-		c-&gt;interactionGeometry = cf;
-		
-		return true;
-	}
-
-	q = t;
-	
-	r = p - q;
-	
-	depth = s-&gt;radius-sqrt(r.Dot(r));
-	
-	if (depth &lt; 0)
-		return false;
-	
-	pt1 = q + se31.position;
-
-	normal = r;
-	normal.Normalize();
-
-	pt2 = se32.position - normal * s-&gt;radius;
-		
-	shared_ptr&lt;ClosestFeatures&gt; cf = shared_ptr&lt;ClosestFeatures&gt;(new ClosestFeatures());
-	cf-&gt;closestsPoints.push_back(std::pair&lt;Vector3r,Vector3r&gt;(pt1,pt2));
-	c-&gt;interactionGeometry = cf;
-	
-	return true;	
-}
-
-
-bool AAInteractingBox2InteractingSphere4ClosestFeatures::goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	bool isInteracting = go(cm2,cm1,se32,se31,c);
-	if (isInteracting)
-	{
-		shared_ptr&lt;ClosestFeatures&gt; cf = YADE_PTR_CAST&lt;ClosestFeatures&gt;(c-&gt;interactionGeometry);
-		Vector3r tmp = cf-&gt;closestsPoints[0].first;
-		cf-&gt;closestsPoints[0].first = cf-&gt;closestsPoints[0].second;		
-		cf-&gt;closestsPoints[0].second = tmp;
-	}
-	return isInteracting;
-}
-

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures/AAInteractingBox2InteractingSphere4ClosestFeatures.hpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures/AAInteractingBox2InteractingSphere4ClosestFeatures.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures/AAInteractingBox2InteractingSphere4ClosestFeatures.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,43 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-
-#ifndef AABOX2SPHERE4CLOSESTFEATURES_HPP
-#define AABOX2SPHERE4CLOSESTFEATURES_HPP
-
-
-#include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
-
-
-/*! \brief Provide interaction handling between a axis aligned box and a sphere in terms of ClosestFeatures */
-
-class AAInteractingBox2InteractingSphere4ClosestFeatures : public InteractionGeometryEngineUnit
-{
-	public : 
-		virtual bool go(		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c);
-		virtual bool goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c);
-
-	REGISTER_CLASS_NAME(AAInteractingBox2InteractingSphere4ClosestFeatures);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
-
-	DEFINE_FUNCTOR_ORDER_2D(InteractingBox,InteractingSphere);
-	
-};
-
-REGISTER_SERIALIZABLE(AAInteractingBox2InteractingSphere4ClosestFeatures,false);
-
-#endif // AABOX2SPHERE4CLOSESTFEATURES_HPP
-

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures.cpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures/AAInteractingBox2InteractingSphere4ClosestFeatures.cpp)

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures.hpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures/AAInteractingBox2InteractingSphere4ClosestFeatures.hpp)

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures/InteractingBox2InteractingBox4ClosestFeatures.cpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures/InteractingBox2InteractingBox4ClosestFeatures.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures/InteractingBox2InteractingBox4ClosestFeatures.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,463 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingBox2InteractingBox4ClosestFeatures.hpp&quot;
-
-
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/ClosestFeatures.hpp&gt;
-#include &lt;Wm3Math.h&gt;
-#include&lt;yade/lib-base/yadeWm3.hpp&gt;
-#include&lt;yade/lib-computational-geometry/Intersections2D.hpp&gt;
-#include&lt;yade/lib-computational-geometry/Intersections3D.hpp&gt;
-
-
-bool InteractingBox2InteractingBox4ClosestFeatures::go(		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	Real r11,r12,r13,r21,r22,r23,r31,r32,r33,q11,q12,q13,q21,q22,q23,q31,q32,q33;
-	
-	Matrix3r axis1,axis1T,axis2,axis2T;
-	Vector3r _normal;
-	Vector3r pt1, pt2, o1p1, o2p2;
-	Vector3r extents1,extents2;
-	
-	shared_ptr&lt;InteractingBox&gt; obb1 = shared_dynamic_cast&lt;InteractingBox&gt;(cm1);
-	shared_ptr&lt;InteractingBox&gt; obb2 = shared_dynamic_cast&lt;InteractingBox&gt;(cm2);
-
-	int nbInteractions = 0;
-	
-	se31.orientation.ToRotationMatrix(axis1T);
-	axis1 = axis1T.Transpose();
-	
-	se32.orientation.ToRotationMatrix(axis2T);
-	axis2 = axis2T.Transpose();
-		
-	extents1 = obb1-&gt;extents;
-	extents2 = obb2-&gt;extents;
-	
-	//position, in parent frame
-	Vector3r p = se32.position-se31.position;
-
-	//position of p in A's frame
-	Vector3r pp;
-	pp = axis1*p;
-
-	//calculate orientation matrix			
-	r11 = (axis1.GetRow(0)).Dot(axis2.GetRow(0)); r12 = (axis1.GetRow(0)).Dot(axis2.GetRow(1)); r13 = (axis1.GetRow(0)).Dot(axis2.GetRow(2));
-	r21 = (axis1.GetRow(1)).Dot(axis2.GetRow(0)); r22 = (axis1.GetRow(1)).Dot(axis2.GetRow(1)); r23 = (axis1.GetRow(1)).Dot(axis2.GetRow(2));
-	r31 = (axis1.GetRow(2)).Dot(axis2.GetRow(0)); r32 = (axis1.GetRow(2)).Dot(axis2.GetRow(1)); r33 = (axis1.GetRow(2)).Dot(axis2.GetRow(2));
-	/*Matrix3r R = axis1*axis2T;
-	r11 = R[0][0]; r12 = R[0][1]; r13 = R[0][2];
-	r21 = R[1][0]; r22 = R[1][1]; r23 = R[1][2];
-	r31 = R[2][0]; r32 = R[2][1]; r33 = R[2][2];*/
-		
-	q11 = fabs(r11); q12 = fabs(r12); q13 = fabs(r13);
-	q21 = fabs(r21); q22 = fabs(r22); q23 = fabs(r23);
-	q31 = fabs(r31); q32 = fabs(r32); q33 = fabs(r33);
-
-	BoxBoxInteractionInfo bbInfo;
-	
-	bbInfo.isNormalPrincipalAxis = true;
-	bbInfo.invertNormal = false;
-	bbInfo.penetrationDepth = -Mathr::MAX_REAL+1;
-	bbInfo.code = 0;
-	
-	// separating axis = u1,u2,u3
-	if (!testSeparatingAxis(pp[0],(extents1[0] + extents2[0]*q11 + extents2[1]*q12 + extents2[2]*q13),axis1.GetRow(0),1,&amp;bbInfo))
-		return false;
-		
-	if (!testSeparatingAxis(pp[1],(extents1[1] + extents2[0]*q21 + extents2[1]*q22 + extents2[2]*q23),axis1.GetRow(1),2,&amp;bbInfo))
-		return false;	
-		
-	if (!testSeparatingAxis(pp[2],(extents1[2] + extents2[0]*q31 + extents2[1]*q32 + extents2[2]*q33),axis1.GetRow(2),3,&amp;bbInfo))
-		return false;
-
-	// separating axis = v1,v2,v3
-	if (!testSeparatingAxis(axis2.GetRow(0).Dot(p),(extents1[0]*q11+extents1[1]*q21+extents1[2]*q31+extents2[0]),axis2.GetRow(0),4,&amp;bbInfo))
-		return false;	
-
-	if (!testSeparatingAxis(axis2.GetRow(1).Dot(p),(extents1[0]*q12+extents1[1]*q22+extents1[2]*q32+extents2[1]),axis2.GetRow(1),5,&amp;bbInfo))
-		return false;	
-		
-	if (!testSeparatingAxis(axis2.GetRow(2).Dot(p),(extents1[0]*q13+extents1[1]*q23+extents1[2]*q33+extents2[2]),axis2.GetRow(2),6,&amp;bbInfo))
-		return false;
-
-	// separating axis = u1 x (v1,v2,v3)
-	if (!testSeparatingAxis(pp[2]*r21-pp[1]*r31,(extents1[1]*q31+extents1[2]*q21+extents2[1]*q13+extents2[2]*q12),Vector3r(0,-r31,r21),7,&amp;bbInfo))
-		return false;		
-		
-	if (!testSeparatingAxis(pp[2]*r22-pp[1]*r32,(extents1[1]*q32+extents1[2]*q22+extents2[0]*q13+extents2[2]*q11),Vector3r(0,-r32,r22),8,&amp;bbInfo))
-		return false;		
-		
-	if (!testSeparatingAxis(pp[2]*r23-pp[1]*r33,(extents1[1]*q33+extents1[2]*q23+extents2[0]*q12+extents2[1]*q11),Vector3r(0,-r33,r23),9,&amp;bbInfo))
-		return false;
-		
-	// separating axis = u2 x (v1,v2,v3)
-	if (!testSeparatingAxis(pp[0]*r31-pp[2]*r11,(extents1[0]*q31+extents1[2]*q11+extents2[1]*q23+extents2[2]*q22),Vector3r(r31,0,-r11),10,&amp;bbInfo))
-		return false;
-		
-	if (!testSeparatingAxis(pp[0]*r32-pp[2]*r12,(extents1[0]*q32+extents1[2]*q12+extents2[0]*q23+extents2[2]*q21),Vector3r(r32,0,-r12),11,&amp;bbInfo))
-		return false;
-		
-	if (!testSeparatingAxis(pp[0]*r33-pp[2]*r13,(extents1[0]*q33+extents1[2]*q13+extents2[0]*q22+extents2[1]*q21),Vector3r(r33,0,-r13),12,&amp;bbInfo))
-		return false;	
-
-	// separating axis = u3 x (v1,v2,v3)
-	if (!testSeparatingAxis(pp[1]*r11-pp[0]*r21,(extents1[0]*q21+extents1[1]*q11+extents2[1]*q33+extents2[2]*q32),Vector3r(-r21,r11,0),13,&amp;bbInfo))
-		return false;	
-		
-	if (!testSeparatingAxis(pp[1]*r12-pp[0]*r22,(extents1[0]*q22+extents1[1]*q12+extents2[0]*q33+extents2[2]*q31),Vector3r(-r22,r12,0),14,&amp;bbInfo))
-		return false;	
-		
-	if (!testSeparatingAxis(pp[1]*r13-pp[0]*r23,(extents1[0]*q23+extents1[1]*q13+extents2[0]*q32+extents2[1]*q31),Vector3r(-r23,r13,0),15,&amp;bbInfo))
-		return false;
-
-	int code = bbInfo.code;	
-	
-	if (code==0) return false;
-
-	bool isNormalPrincipalAxis = bbInfo.isNormalPrincipalAxis;
-	bool invertNormal = bbInfo.invertNormal;
-	Real penetrationDepth = bbInfo.penetrationDepth;
-	Vector3r normal = bbInfo.normal;
-		
-	if (!isNormalPrincipalAxis)	
-		_normal = axis1T*normal;
-	else	
-		_normal = normal;
-		
-	if (invertNormal)
-		normal = -_normal;
-	else
-		normal = _normal;
-		
-	normal.Normalize(); 
-	penetrationDepth = -penetrationDepth;
-
-	if (code &gt; 6) 
-	{
-		// an edge from box 1 touches an edge from box 2.
-		// find a point pa on the intersecting edge of box 1
-		Vector3r pa,pb;
-		Vector3r sign;
-
-		pa = se31.position;
-		sign[0] = (axis1.GetRow(0).Dot(normal) &gt; 0) ? 1.0 : -1.0;
-		sign[1] = (axis1.GetRow(1).Dot(normal) &gt; 0) ? 1.0 : -1.0;
-		sign[2] = (axis1.GetRow(2).Dot(normal) &gt; 0) ? 1.0 : -1.0;
-		pa+=(sign[0]*extents1[0])*axis1.GetRow(0);
-		pa+=(sign[1]*extents1[1])*axis1.GetRow(1);
-		pa+=(sign[2]*extents1[2])*axis1.GetRow(2);
-
-		// find a point pb on the intersecting edge of box 2
-		pb = se32.position;
-		sign[0] = (axis2.GetRow(0).Dot(normal) &gt; 0) ? -1.0 : 1.0;
-		sign[1] = (axis2.GetRow(1).Dot(normal) &gt; 0) ? -1.0 : 1.0;
-		sign[2] = (axis2.GetRow(2).Dot(normal) &gt; 0) ? -1.0 : 1.0;
-		pb+=(sign[0]*extents2[0])*axis2.GetRow(0);
-		pb+=(sign[1]*extents2[1])*axis2.GetRow(1);
-		pb+=(sign[2]*extents2[2])*axis2.GetRow(2);
-
-		Real alpha,beta;
-		Vector3r ua,ub;
-		
-		//ua = axis1[(code-7)/3];
-		//ub = axis2[(code-7)%3];
-		// FIXME : I'm not sure it is getRow now maybe it is getColumn
-		ua = axis1.GetRow((code-7)/3);
-		ub = axis2.GetRow((code-7)%3);
-		
-		lineClosestApproach(pa,ua,pb,ub,alpha,beta);
-		pa+=alpha*ua;
-		pb+=beta*ub;
-
-		//pt1 = pa;//(pa+pb+normal*penetrationDepth)*0.5;
-		//pt2 = pb;//(pa+pb-normal*penetrationDepth)*0.5;
-		shared_ptr&lt;ClosestFeatures&gt; cf = shared_ptr&lt;ClosestFeatures&gt;(new ClosestFeatures());
-		cf-&gt;closestsPoints.push_back(std::pair&lt;Vector3r,Vector3r&gt;(pa,pb));
-		c-&gt;interactionGeometry = cf;
-		
-		nbInteractions++;
-
-		return true;	
-	}
-	
-	
-	Vector3r pa,pb,Sa,Sb;
-	Matrix3r Ra,Rb;
-	
-	if (code &lt;= 3) 
-	{
-		Ra = axis1;
-		Rb = axis2;
-		pa = se31.position;
-		pb = se32.position;
-		Sa = extents1;
-		Sb = extents2;
-	}
-	else 
-	{
-		Ra = axis2;
-		Rb = axis1;
-		pa = se32.position;
-		pb = se31.position;
-		Sa = extents2;
-		Sb = extents1;
-	}
-
-	// nr = normal vector of reference face dotted with axes of incident box.
-	// anr = absolute values of nr.
-	Vector3r normal2,nr,anr;
-	if (code &lt;= 3) 
-		normal2 = normal;
-	else 
-		normal2 = -normal;
-	
-	nr = Rb*normal2;
-
-	anr[0] = fabs(nr[0]);
-	anr[1] = fabs(nr[1]);
-	anr[2] = fabs(nr[2]);
-
-	// find the largest compontent of anr: this corresponds to the normal
-	// for the indident face. the other axis numbers of the indicent face
-	// are stored in a1,a2.
-	int lanr,a1,a2;
-	if (anr[1] &gt; anr[0]) 
-	{	
-		if (anr[1] &gt; anr[2]) 
-		{
-			a1 = 0;
-			lanr = 1;
-			a2 = 2;
-		}
-		else 
-		{
-			a1 = 0;
-			a2 = 1;
-			lanr = 2;
-		}
-	}
-	else 
-	{
-		if (anr[0] &gt; anr[2]) 
-		{
-			lanr = 0;
-			a1 = 1;
-			a2 = 2;
-		}
-		else 
-		{
-			a1 = 0;
-			a2 = 1;
-			lanr = 2;
-		}
-	}
-
-	// compute center point of incident face, in reference-face coordinates
-	Vector3r center;
-	if (nr[lanr] &lt; 0) 
-		center = pb - pa + Rb.GetRow(lanr)*Sb[lanr];
-	else 
-		center = pb - pa - Rb.GetRow(lanr)*Sb[lanr];
-
-	// find the normal and non-normal axis numbers of the reference box
-	int codeN,code1,code2;
-	
-	if (code &lt;= 3) 
-		codeN = code-1; 
-	else 
-		codeN = code-4;
-	
-	if (codeN==0) 
-	{
-		code1 = 1;
-		code2 = 2;
-	}
-	else if (codeN==1) 
-	{
-		code1 = 0;
-		code2 = 2;
-	}
-	else 
-	{
-		code1 = 0;
-		code2 = 1;
-	}
-
-
-	// find the four corners of the incident face, in reference-face coordinates
-	std::vector&lt;Vector3r&gt; quad;	// 2D coordinate of incident face (x,y pairs)
-	Real c1,c2,m11,m12,m21,m22;
-	//c1 = center.dot(Ra.code1]);
-	//c2 = center.dot(Ra[code2]);
-	c1 = center.Dot(Ra.GetRow(code1));
-	c2 = center.Dot(Ra.GetRow(code2));
-	
-	// optimize this? - we have already computed this data above, but it is not
-	// stored in an easy-to-index format. for now it's quicker just to recompute
-	// the four dot products.
-	m11 = Ra.GetRow(code1).Dot(Rb.GetRow(a1));
-	m12 = Ra.GetRow(code1).Dot(Rb.GetRow(a2));
-	m21 = Ra.GetRow(code2).Dot(Rb.GetRow(a1));
-	m22 = Ra.GetRow(code2).Dot(Rb.GetRow(a2));
-	
-	Real k1,k2,k3,k4;
-	
-	k1 = m11*Sb[a1];
-	k2 = m21*Sb[a1];
-	k3 = m12*Sb[a2];
-	k4 = m22*Sb[a2];
-
-	quad.push_back(Vector3r(c1 - k1 - k3, c2 - k2 - k4,0));
-	quad.push_back(Vector3r(c1 - k1 + k3, c2 - k2 + k4,0));
-	quad.push_back(Vector3r(c1 + k1 + k3, c2 + k2 + k4,0));
-	quad.push_back(Vector3r(c1 + k1 - k3, c2 + k2 - k4,0));
-
-	// find the size of the reference face
-	Vector3r rect;
-	rect = Vector3r(Sa[code1],Sa[code2],0);
-
-	// intersect the incident and reference faces
-	std::vector&lt;Vector3r&gt; ret;
-
-	int n = clipPolygon (rect,quad,ret);
-
-	if (n &lt; 1) 
-		return false;	// this should never happen
-
-	// convert the intersection points into reference-face coordinates,
-	// and compute the contact position and depth for each point. only keep
-	// those points that have a positive (penetrating) depth. delete points in
-	// the 'ret' array as necessary so that 'point' and 'ret' correspond.
-	std::vector&lt;Vector3r&gt; point;	// penetrating contact points
-	std::vector&lt;Real&gt; dep;			// depths for those points
-
-	Real det1 = 1.0/(m11*m22 - m12*m21);
-
-	m11 *= det1;
-	m12 *= det1;
-	m21 *= det1;
-	m22 *= det1;
-
-	int cnum = 0;			// number of penetrating contact points found
-
-	point.resize(8);
-	dep.resize(8);
-	int j;	
-	for (j=0; j &lt; n; j++) 
-	{
-		k1 =  m22*(ret[j][0]-c1) - m12*(ret[j][1]-c2);
-		k2 = -m21*(ret[j][0]-c1) + m11*(ret[j][1]-c2);
-		
-		point[cnum] = center + k1*Rb.GetRow(a1) + k2*Rb.GetRow(a2);
-		
-		dep[cnum] = Sa[codeN] - normal2.Dot(point[cnum]);
-		
-		if (dep[cnum] &gt;= 0) 
-		{
-			ret[cnum][0] = ret[j][0];
-			ret[cnum][1] = ret[j][1];
-			cnum++;
-		}
-	}
-	
-	if (cnum &lt; 1) 
-		return false;	// this should never happen
-	
-	shared_ptr&lt;ClosestFeatures&gt; cf = shared_ptr&lt;ClosestFeatures&gt;(new ClosestFeatures());
-	for (j=0; j &lt; cnum; j++) 
-	{
-		if (code&lt;=3)
-		{	
-			pt2	= point[j] + pa;
-			pt1 	= pt2+normal*dep[j];
-			//pt1	= point[j] + pa;
-			//pt2 	= pt1+normal*dep[j];
-			cf-&gt;closestsPoints.push_back(std::pair&lt;Vector3r,Vector3r&gt;(pt1,pt2));
-		}
-		else
-		{
-			//pt2		= point[j] + pa;
-			//pt1 	= pt2-normal*dep[j];
-			pt1		= point[j] + pa;
-			pt2 	= pt1-normal*dep[j];
-			cf-&gt;closestsPoints.push_back(std::pair&lt;Vector3r,Vector3r&gt;(pt1,pt2));
-		}
-		nbInteractions++;
-	}
-	c-&gt;interactionGeometry = cf;
-	
-	return true;
-}
-
-
-bool InteractingBox2InteractingBox4ClosestFeatures::goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	bool isInteracting = go(cm2,cm1,se32,se31,c);
-	if (isInteracting)
-	{
-		shared_ptr&lt;ClosestFeatures&gt; cf = shared_dynamic_cast&lt;ClosestFeatures&gt;(c-&gt;interactionGeometry);
-		Vector3r tmp = cf-&gt;closestsPoints[0].first;
-		cf-&gt;closestsPoints[0].first = cf-&gt;closestsPoints[0].second;		
-		cf-&gt;closestsPoints[0].second = tmp;
-	}
-	return isInteracting;
-}
-
-
-bool InteractingBox2InteractingBox4ClosestFeatures::testSeparatingAxis(Real expr1, Real expr2, Vector3r n,int c,BoxBoxInteractionInfo* bbInfo)
-{
-	Real pd,l;
-
-	pd = fabs(expr1) - (expr2); 
-
-	if (pd &gt; 0) 
-  		return false; 
-		
-	if (c&gt;6)
-	{		
-		l = n.Length();
-		
-		if (l&gt;0)
-		{
-			pd /= l;
-			if (pd &gt; bbInfo-&gt;penetrationDepth) 
-			{ 
-				bbInfo-&gt;penetrationDepth = pd;
-				bbInfo-&gt;normal = n;
-				bbInfo-&gt;invertNormal = ((expr1) &lt; 0);  
-				bbInfo-&gt;code = c; 
-				bbInfo-&gt;isNormalPrincipalAxis = false;
-			}
-		}
-	}
-	else
-	{
-		if (pd &gt; bbInfo-&gt;penetrationDepth) 
-		{ 
-			bbInfo-&gt;penetrationDepth = pd; 
-			bbInfo-&gt;normal = n;
-			bbInfo-&gt;invertNormal = ((expr1) &lt; 0);  
-			bbInfo-&gt;code = c; 
-			bbInfo-&gt;isNormalPrincipalAxis = true;
-		}
-	}
-	
-	return true;
-
-}
-

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures/InteractingBox2InteractingBox4ClosestFeatures.hpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures/InteractingBox2InteractingBox4ClosestFeatures.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures/InteractingBox2InteractingBox4ClosestFeatures.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,50 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BOX2BOX4CLOSESTFEATURES_HPP
-#define BOX2BOX4CLOSESTFEATURES_HPP
-
-#include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
-
-class InteractingBox2InteractingBox4ClosestFeatures : public InteractionGeometryEngineUnit
-{
-	private : 
-		struct BoxBoxInteractionInfo
-		{
-			bool isNormalPrincipalAxis;
-			bool invertNormal;
-			Real penetrationDepth;
-			int code;
-			Vector3r normal;
-		};
-
-	public : 
-		virtual bool go(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-		virtual bool goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-	private :
-		bool testSeparatingAxis(Real expr1, Real expr2, Vector3r n,int c,BoxBoxInteractionInfo* bbInfo);
-
-	REGISTER_CLASS_NAME(InteractingBox2InteractingBox4ClosestFeatures);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
-	DEFINE_FUNCTOR_ORDER_2D(InteractingBox,InteractingBox);
-};
-
-REGISTER_SERIALIZABLE(InteractingBox2InteractingBox4ClosestFeatures,false);
-
-#endif // BOX2BOX4CLOSESTFEATURES_HPP
-

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures.cpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures/InteractingBox2InteractingBox4ClosestFeatures.cpp)

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures.hpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures/InteractingBox2InteractingBox4ClosestFeatures.hpp)

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures/InteractingBox2InteractingSphere4ClosestFeatures.cpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures/InteractingBox2InteractingSphere4ClosestFeatures.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures/InteractingBox2InteractingSphere4ClosestFeatures.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,130 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingBox2InteractingSphere4ClosestFeatures.hpp&quot;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/ClosestFeatures.hpp&gt;
-
-
-bool InteractingBox2InteractingSphere4ClosestFeatures::go(		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; interaction)
-{
-
-	//if (se31.orientation == Quaternionr())
-	//	return collideAABoxSphere(cm1,cm2,se31,se32,interaction);
-	
-	Vector3r l,t,p,q,r;
-	bool onborder = false;
-	Vector3r pt1,pt2,normal;
-	Matrix3r axisT,axis;
-	Real depth;
-
-	shared_ptr&lt;InteractingSphere&gt; s = YADE_PTR_CAST&lt;InteractingSphere&gt;(cm2);
-	shared_ptr&lt;InteractingBox&gt; obb = YADE_PTR_CAST&lt;InteractingBox&gt;(cm1);
-	
-	Vector3r extents = obb-&gt;extents;
-
-	se31.orientation.ToRotationMatrix(axisT);
-	axis = axisT.Transpose();
-	
-	p = se32.position-se31.position;
-	
-	l[0] = extents[0];
-	t[0] = axis.GetRow(0).Dot(p); 
-	if (t[0] &lt; -l[0]) { t[0] = -l[0]; onborder = true; }
-	if (t[0] &gt;  l[0]) { t[0] =  l[0]; onborder = true; }
-
-	l[1] = extents[1];
-	t[1] = axis.GetRow(1).Dot(p);
-	if (t[1] &lt; -l[1]) { t[1] = -l[1]; onborder = true; }
-	if (t[1] &gt;  l[1]) { t[1] =  l[1]; onborder = true; }
-
-	l[2] = extents[2];
-	t[2] = axis.GetRow(2).Dot(p);
-	if (t[2] &lt; -l[2]) { t[2] = -l[2]; onborder = true; }
-	if (t[2] &gt;  l[2]) { t[2] =  l[2]; onborder = true; }
-	
-	if (!onborder) 
-	{
-		// sphere center inside box. find largest `t' value
-		Real min = l[0]-fabs(t[0]);
-		int mini = 0;
-		for (int i=1; i&lt;3; i++) 
-		{
-			Real tt = l[i]-fabs(t[i]);
-			if (tt &lt; min) 
-			{
-				min = tt;
-				mini = i;
-			}
-		}
-		
-		// contact normal aligned with box edge along largest `t' value
-		Vector3r tmp = Vector3r(0,0,0);
-
-		tmp[mini] = (t[mini] &gt; 0) ? 1.0 : -1.0;
-		
-		normal = axisT*tmp;
-		
-		normal.Normalize();
-		
-		pt1 = se32.position + normal*min;
-		pt2 = se32.position - normal*s-&gt;radius;	
-	
-		shared_ptr&lt;ClosestFeatures&gt; cf = shared_ptr&lt;ClosestFeatures&gt;(new ClosestFeatures());
-		cf-&gt;closestsPoints.push_back(std::pair&lt;Vector3r,Vector3r&gt;(pt1,pt2));
-		interaction-&gt;interactionGeometry = cf;
-		
-		return true;	
-	}
-
-	q = axisT*t;
-	r = p - q;
-	
-	depth = s-&gt;radius-sqrt(r.Dot(r));
-	
-	if (depth &lt; 0) 
-		return false;
-
-	pt1 = q + se31.position;
-
-	normal = r;
-	normal.Normalize();
-
-	pt2 = se32.position - normal * s-&gt;radius;
-	
-	shared_ptr&lt;ClosestFeatures&gt; cf = shared_ptr&lt;ClosestFeatures&gt;(new ClosestFeatures());
-	cf-&gt;closestsPoints.push_back(std::pair&lt;Vector3r,Vector3r&gt;(pt1,pt2));
-	
-	interaction-&gt;interactionGeometry = cf;
-	
-	return true;
-}
-
-
-bool InteractingBox2InteractingSphere4ClosestFeatures::goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; interaction)
-{
-	bool isInteracting = go(cm2,cm1,se32,se31,interaction);
-	if (isInteracting)
-	{
-		shared_ptr&lt;ClosestFeatures&gt; cf = YADE_PTR_CAST&lt;ClosestFeatures&gt;(interaction-&gt;interactionGeometry);
-		Vector3r tmp = cf-&gt;closestsPoints[0].first;
-		cf-&gt;closestsPoints[0].first = cf-&gt;closestsPoints[0].second;		
-		cf-&gt;closestsPoints[0].second = tmp;
-	}
-	return isInteracting;
-}
-

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures/InteractingBox2InteractingSphere4ClosestFeatures.hpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures/InteractingBox2InteractingSphere4ClosestFeatures.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures/InteractingBox2InteractingSphere4ClosestFeatures.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BOX2SPHERE4CLOSESTFEATURES_HPP
-#define BOX2SPHERE4CLOSESTFEATURES_HPP
-
-#include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
-
-class InteractingBox2InteractingSphere4ClosestFeatures : public InteractionGeometryEngineUnit
-{
-	public :
-		virtual bool go(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-		virtual bool goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-	REGISTER_CLASS_NAME(InteractingBox2InteractingSphere4ClosestFeatures);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
-	DEFINE_FUNCTOR_ORDER_2D(InteractingBox,InteractingSphere);
-};
-
-REGISTER_SERIALIZABLE(InteractingBox2InteractingSphere4ClosestFeatures,false);
-
-#endif // BOX2SPHERE4CLOSESTFEATURES_HPP
-

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures.cpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures/InteractingBox2InteractingSphere4ClosestFeatures.cpp)

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures.hpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures/InteractingBox2InteractingSphere4ClosestFeatures.hpp)

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact/InteractingBox2InteractingSphere4ErrorTolerantContact.cpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact/InteractingBox2InteractingSphere4ErrorTolerantContact.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact/InteractingBox2InteractingSphere4ErrorTolerantContact.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,143 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingBox2InteractingSphere4ErrorTolerantContact.hpp&quot;
-#include &quot;ErrorTolerantContact.hpp&quot;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/pkg-common/Box.hpp&gt;
-
-
-bool InteractingBox2InteractingSphere4ErrorTolerantContact::go(		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-
-	//if (se31.orientation == Quaternionr())
-	//	return collideAABoxSphere(cm1,cm2,se31,se32,c);
-	
-	Vector3r l,t,p,q,r;
-	bool onborder = false;
-	Vector3r pt1,pt2,normal;
-	Matrix3r axisT,axis;
-	float depth;
-
-	shared_ptr&lt;Sphere&gt; s = YADE_PTR_CAST&lt;Sphere&gt;(cm2);
-	shared_ptr&lt;Box&gt; obb = YADE_PTR_CAST&lt;Box&gt;(cm1);
-	
-	Vector3r extents = obb-&gt;extents;
-
-	se31.orientation.ToRotationMatrix(axisT);
-	axis = axisT.Transpose();
-	
-	p = se32.position-se31.position;
-	
-	l[0] = extents[0];
-	t[0] = axis.GetRow(0).Dot(p); 
-	if (t[0] &lt; -l[0]) { t[0] = -l[0]; onborder = true; }
-	if (t[0] &gt;  l[0]) { t[0] =  l[0]; onborder = true; }
-
-	l[1] = extents[1];
-	t[1] = axis.GetRow(1).Dot(p);
-	if (t[1] &lt; -l[1]) { t[1] = -l[1]; onborder = true; }
-	if (t[1] &gt;  l[1]) { t[1] =  l[1]; onborder = true; }
-
-	l[2] = extents[2];
-	t[2] = axis.GetRow(2).Dot(p);
-	if (t[2] &lt; -l[2]) { t[2] = -l[2]; onborder = true; }
-	if (t[2] &gt;  l[2]) { t[2] =  l[2]; onborder = true; }
-	
-	if (!onborder) 
-	{
-		// sphere center inside box. find largest `t' value
-		float min = l[0]-fabs(t[0]);
-		int mini = 0;
-		for (int i=1; i&lt;3; i++) 
-		{
-			float tt = l[i]-fabs(t[i]);
-			if (tt &lt; min) 
-			{
-				min = tt;
-				mini = i;
-			}
-		}
-		
-		// contact normal aligned with box edge along largest `t' value
-		Vector3r tmp = Vector3r(0,0,0);
-
-		tmp[mini] = (t[mini] &gt; 0) ? 1.0 : -1.0;
-		
-		normal = axisT*tmp;
-		
-		normal.Normalize();
-		
-		pt1 = se32.position + normal*min;
-		pt2 = se32.position - normal*s-&gt;radius;	
-	
-		shared_ptr&lt;ErrorTolerantContact&gt; cm = shared_ptr&lt;ErrorTolerantContact&gt;(new ErrorTolerantContact());
-		cm-&gt;closestPoints.push_back(std::pair&lt;Vector3r,Vector3r&gt;(pt1,pt2));
-		cm-&gt;normal = pt1-pt2;
-		cm-&gt;o1p1 = pt1-se31.position;
-		cm-&gt;o2p2 = pt2-se32.position;
-		c-&gt;interactionGeometry = cm;
-		
-		return true;	
-	}
-	//FIXME : use else instead and signle return
-	
-	q = axisT*t;
-	r = p - q;
-	
-	depth = s-&gt;radius-sqrt(r.Dot(r));
-	
-	if (depth &lt; 0) 
-		return false;
-
-	pt1 = q + se31.position;
-
-	normal = r;
-	normal.Normalize();
-
-	pt2 = se32.position - normal * s-&gt;radius;
-		
-	shared_ptr&lt;ErrorTolerantContact&gt; cm = shared_ptr&lt;ErrorTolerantContact&gt;(new ErrorTolerantContact());
-	cm-&gt;closestPoints.push_back(std::pair&lt;Vector3r,Vector3r&gt;(pt1,pt2));
-	cm-&gt;normal = pt1-pt2;
-	cm-&gt;o1p1 = pt1-se31.position;
-	cm-&gt;o2p2 = pt2-se32.position;
-	c-&gt;interactionGeometry = cm;
-
-
-	
-	return true;
-}
-
-
-bool InteractingBox2InteractingSphere4ErrorTolerantContact::goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	bool isInteracting = go(cm2,cm1,se32,se31,c);
-	if (isInteracting)
-	{
-		shared_ptr&lt;ErrorTolerantContact&gt; cm = YADE_PTR_CAST&lt;ErrorTolerantContact&gt;(c-&gt;interactionGeometry);
-
-		Vector3r tmp = cm-&gt;closestPoints[0].first;
-		cm-&gt;closestPoints[0].first = cm-&gt;closestPoints[0].second;
-		cm-&gt;closestPoints[0].second = tmp;
-		tmp = cm-&gt;o1p1;
-		cm-&gt;o1p1 = cm-&gt;o2p2;
-		cm-&gt;o2p2 = tmp;
-		cm-&gt;normal = -cm-&gt;normal;
-	}
-	return isInteracting;
-}
-

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact/InteractingBox2InteractingSphere4ErrorTolerantContact.hpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact/InteractingBox2InteractingSphere4ErrorTolerantContact.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact/InteractingBox2InteractingSphere4ErrorTolerantContact.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BOX2SPHERE4ERRORTOLERANT_HPP
-#define BOX2SPHERE4ERRORTOLERANT_HPP
-
-#include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
-
-class InteractingBox2InteractingSphere4ErrorTolerantContact : public InteractionGeometryEngineUnit
-{
-	public :
-		virtual bool go(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-		virtual bool goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-	REGISTER_CLASS_NAME(InteractingBox2InteractingSphere4ErrorTolerantContact);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
-	DEFINE_FUNCTOR_ORDER_2D(Box,Sphere);
-};
-
-REGISTER_SERIALIZABLE(InteractingBox2InteractingSphere4ErrorTolerantContact,false);
-
-#endif // __BOX2SPHERE4ERRORTOLERANT_H__
-

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact.cpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact/InteractingBox2InteractingSphere4ErrorTolerantContact.cpp)

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact.hpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact/InteractingBox2InteractingSphere4ErrorTolerantContact.hpp)

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures/InteractingSphere2InteractingSphere4ClosestFeatures.cpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures/InteractingSphere2InteractingSphere4ClosestFeatures.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures/InteractingSphere2InteractingSphere4ClosestFeatures.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,47 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingSphere2InteractingSphere4ClosestFeatures.hpp&quot;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include&lt;yade/pkg-common/ClosestFeatures.hpp&gt;
-
-
-bool InteractingSphere2InteractingSphere4ClosestFeatures::go(		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	shared_ptr&lt;InteractingSphere&gt; s1 = YADE_PTR_CAST&lt;InteractingSphere&gt;(cm1);
-	shared_ptr&lt;InteractingSphere&gt; s2 = YADE_PTR_CAST&lt;InteractingSphere&gt;(cm2);
-	
-	Vector3r v = se31.position-se32.position;
-	Real l = v.Normalize();
-	
-	if (l&lt;s1-&gt;radius+s2-&gt;radius)
-	{
-		shared_ptr&lt;ClosestFeatures&gt; cf = shared_ptr&lt;ClosestFeatures&gt;(new ClosestFeatures());
-		cf-&gt;closestsPoints.push_back(std::pair&lt;Vector3r,Vector3r&gt;(se31.position-v*s1-&gt;radius,se32.position+v*s2-&gt;radius));
-		c-&gt;interactionGeometry = cf;
-		return true;
-	}
-	else	
-		return false;
-
-}
-
-
-bool InteractingSphere2InteractingSphere4ClosestFeatures::goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	return go(cm1,cm2,se31,se32,c);
-}
-

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures/InteractingSphere2InteractingSphere4ClosestFeatures.hpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures/InteractingSphere2InteractingSphere4ClosestFeatures.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures/InteractingSphere2InteractingSphere4ClosestFeatures.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,37 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SPHERE2SPHERE4CLOSESTFEATURES_HPP
-#define SPHERE2SPHERE4CLOSESTFEATURES_HPP
-
-
-#include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
-
-class InteractingSphere2InteractingSphere4ClosestFeatures : public InteractionGeometryEngineUnit
-{
-	public :
-		virtual bool go(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-		virtual bool goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-	REGISTER_CLASS_NAME(InteractingSphere2InteractingSphere4ClosestFeatures);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
-	DEFINE_FUNCTOR_ORDER_2D(InteractingSphere,InteractingSphere);
-};
-
-REGISTER_SERIALIZABLE(InteractingSphere2InteractingSphere4ClosestFeatures,false);
-
-#endif // SPHERE2SPHERE4CLOSESTFEATURES_HPP
-

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures.cpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures/InteractingSphere2InteractingSphere4ClosestFeatures.cpp)

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures.hpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures/InteractingSphere2InteractingSphere4ClosestFeatures.hpp)

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact/InteractingSphere2InteractingSphere4ErrorTolerantContact.cpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact/InteractingSphere2InteractingSphere4ErrorTolerantContact.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact/InteractingSphere2InteractingSphere4ErrorTolerantContact.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,54 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;InteractingSphere2InteractingSphere4ErrorTolerantContact.hpp&quot;
-#include &quot;ErrorTolerantContact.hpp&quot;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-
-
-bool InteractingSphere2InteractingSphere4ErrorTolerantContact::go(		const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	shared_ptr&lt;Sphere&gt; s1 = YADE_PTR_CAST&lt;Sphere&gt;(cm1);
-	shared_ptr&lt;Sphere&gt; s2 = YADE_PTR_CAST&lt;Sphere&gt;(cm2);
-
-	Vector3r normal = se32.position-se31.position;
-	float penetrationDepth = s1-&gt;radius+s2-&gt;radius-normal.Normalize();
-
-	if (penetrationDepth&gt;0)
-	{
-		shared_ptr&lt;ErrorTolerantContact&gt; cm = shared_ptr&lt;ErrorTolerantContact&gt;(new ErrorTolerantContact());
-
-		Vector3r pt1 = se31.position+normal*s1-&gt;radius;
-		Vector3r pt2 = se32.position-normal*s2-&gt;radius;
-		cm-&gt;closestPoints.push_back(std::pair&lt;Vector3r,Vector3r&gt;(pt1,pt2));
-		cm-&gt;o1p1 = pt1-se31.position;
-		cm-&gt;o2p2 = pt2-se32.position;
-		cm-&gt;normal = normal;
-		c-&gt;interactionGeometry = cm;
-		return true;
-	}
-	else	
-		return false;
-
-}
-
-
-bool InteractingSphere2InteractingSphere4ErrorTolerantContact::goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-						const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-						const Se3r&amp; se31,
-						const Se3r&amp; se32,
-						const shared_ptr&lt;Interaction&gt;&amp; c)
-{
-	return go(cm1,cm2,se31,se32,c);
-}
-
-

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact/InteractingSphere2InteractingSphere4ErrorTolerantContact.hpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact/InteractingSphere2InteractingSphere4ErrorTolerantContact.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact/InteractingSphere2InteractingSphere4ErrorTolerantContact.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,36 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef SPHERE2SPHERE4ERRORTOLERANT_HPP
-#define SPHERE2SPHERE4ERRORTOLERANT_HPP
-
-#include&lt;yade/pkg-common/InteractionGeometryEngineUnit.hpp&gt;
-
-class InteractingSphere2InteractingSphere4ErrorTolerantContact : public InteractionGeometryEngineUnit
-{
-	public :
-		virtual bool go(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-		virtual bool goReverse(	const shared_ptr&lt;InteractingGeometry&gt;&amp; cm1,
-					const shared_ptr&lt;InteractingGeometry&gt;&amp; cm2,
-					const Se3r&amp; se31,
-					const Se3r&amp; se32,
-					const shared_ptr&lt;Interaction&gt;&amp; c);
-
-	REGISTER_CLASS_NAME(InteractingSphere2InteractingSphere4ErrorTolerantContact);
-	REGISTER_BASE_CLASS_NAME(InteractionGeometryEngineUnit);
-	DEFINE_FUNCTOR_ORDER_2D(Sphere,Sphere);
-};
-
-REGISTER_SERIALIZABLE(InteractingSphere2InteractingSphere4ErrorTolerantContact,false);
-
-#endif // SPHERE2SPHERE4ERRORTOLERANT_HPP
-

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact.cpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact/InteractingSphere2InteractingSphere4ErrorTolerantContact.cpp)

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact.hpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact/InteractingSphere2InteractingSphere4ErrorTolerantContact.hpp)

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw/ErrorTolerantLaw.cpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw/ErrorTolerantLaw.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw/ErrorTolerantLaw.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,511 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;ErrorTolerantLaw.hpp&quot;
-#include &quot;ErrorTolerantContact.hpp&quot;
-#include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-
-ErrorTolerantLaw::ErrorTolerantLaw() : InteractionSolver()
-{
-	maxReactivations = 100;
-	maxIterations    = 5;
-	threshold	 = 0.01;
-}
-
-
-ErrorTolerantLaw::~ErrorTolerantLaw()
-{
-}
-
-
-
-void ErrorTolerantLaw::postProcessAttributes(bool deserializing)
-{
-	InteractionSolver::postProcessAttributes(deserializing);
-	// PROCESS DESIRED ATTRIBUTES HERE
-}
-
-
-void ErrorTolerantLaw::registerAttributes()
-{
-	InteractionSolver::registerAttributes();
-	// REGISTER DESIRED ATTRIBUTES HERE
-}
-
-
-
-void ErrorTolerantLaw::action(Body* body)
-{
-
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt; bodies = ncb-&gt;bodies;
-
-	if (ncb-&gt;transientInteractions-&gt;size() &gt; 0)
-	{
-		// Build inverse of masses matrix and store it into a vector
-		ublas::banded_matrix&lt;float&gt; invM(6*bodies-&gt;size(),6*bodies-&gt;size(),1,1);
-
-
-		shared_ptr&lt;Body&gt; b;
-		unsigned int i=0;
-// FIXME - this loop assumes that id's of all bodies start from zero and increment by one?
-//		for(unsigned int i=0;i&lt;bodies-&gt;size();i++)
-
-		BodyContainer::iterator bi    = bodies-&gt;begin();
-		BodyContainer::iterator biEnd = bodies-&gt;end();
-		for(  ; bi!=biEnd ; ++bi,++i )
-		{
-			b = *bi;
-
-			int offset = 6*i;
-			shared_ptr&lt;RigidBodyParameters&gt; rb = YADE_PTR_CAST&lt;RigidBodyParameters&gt;(b);
-			invM(offset,offset++) = 1.0/rb-&gt;mass;
-			invM(offset,offset++) = 1.0/rb-&gt;mass;
-			invM(offset,offset++) = 1.0/rb-&gt;mass;
-			invM(offset,offset++) = 1.0/rb-&gt;inertia[0];
-			invM(offset,offset++) = 1.0/rb-&gt;inertia[1];
-			invM(offset,offset)   = 1.0/rb-&gt;inertia[2];
-		}
-
-		// Build the jacobian and transpose of jacobian
-		//
-		// I'm compiling YADE with boost 1.33, and this line is not compiling. I don't understand it, so I can't fix it.
-		// This totally kills ErrorTolerantLaw, I know - so if you start working on that - first you have to correct this line,
-		// I'm sorry, but boost 1.33 is 30% faster !
-		//                                              Janek
-		//
-		ublas::matrix&lt;float&gt; J;
-		ublas::matrix&lt;float&gt; Jt;
-		//ublas::sparse_matrix&lt;float&gt; J (6*bodies-&gt;size(), ncb-&gt;transientInteractions-&gt;size(), ncb-&gt;transientInteractions-&gt;size()*2/*6*bodies.size()*body-&gt;transientInteractions.size()*/);
-		//ublas::sparse_matrix&lt;float&gt; Jt (ncb-&gt;transientInteractions-&gt;size(), 6*bodies-&gt;size(), ncb-&gt;transientInteractions-&gt;size()*2/*6*bodies.size()*body-&gt;transientInteractions.size()*/);
-
-		static ublas::vector&lt;float&gt; penetrationDepthes;
-		static ublas::vector&lt;float&gt; penetrationVelocities;
-
-		penetrationDepthes.resize(bodies-&gt;size());
-		penetrationVelocities.resize(bodies-&gt;size());
-
-		Vector3r n,o1p1,o2p2;
-		Vector3r o1p1CrossN,o2p2CrossN;
-		int id1,id2,offset1,offset2;
-
-
-		shared_ptr&lt;Interaction&gt; contact;
-		i=0;
-
-		InteractionContainer::iterator ii = ncb-&gt;transientInteractions-&gt;begin();
-		InteractionContainer::iterator iiEnd = ncb-&gt;transientInteractions-&gt;end();
-		for( ; ii!=iiEnd; ++ii )
-		{
-			contact = *ii;
-			if (contact-&gt;isReal)
-			{
-
-				shared_ptr&lt;ErrorTolerantContact&gt; cm = YADE_PTR_CAST&lt;ErrorTolerantContact&gt;(contact-&gt;interactionGeometry);
-	
-				id1 		= contact-&gt;getId1();
-				id2 		= contact-&gt;getId2();
-				o1p1 		= cm-&gt;o1p1;
-				o2p2 		= cm-&gt;o2p2;
-				n 		= cm-&gt;normal;
-				o1p1CrossN 	= o1p1.Cross(n);
-				o2p2CrossN 	= o2p2.Cross(n);
-	
-				offset1		= 6*id1;
-				offset2		= 6*id2;
-	
-				J(offset1++,i)	= n[0];
-				J(offset1++,i)	= n[1];
-				J(offset1++,i)	= n[2];
-				J(offset1++,i)	= o1p1CrossN[0];
-				J(offset1++,i)	= o1p1CrossN[1];
-				J(offset1,i)	= o1p1CrossN[2];
-				J(offset2++,i)	= -n[0];
-				J(offset2++,i)	= -n[1];
-				J(offset2++,i)	= -n[2];
-				J(offset2++,i)	= -o2p2CrossN[0];
-				J(offset2++,i)	= -o2p2CrossN[1];
-				J(offset2,i)	= -o2p2CrossN[2];
-	
-				offset1		= 6*id1;
-				offset2		= 6*id2;
-	
-				Jt(i,offset1++)	= n[0];
-				Jt(i,offset1++)	= n[1];
-				Jt(i,offset1++)	= n[2];
-				Jt(i,offset1++)	= o1p1CrossN[0];
-				Jt(i,offset1++)	= o1p1CrossN[1];
-				Jt(i,offset1)	= o1p1CrossN[2];
-				Jt(i,offset2++)	= -n[0];
-				Jt(i,offset2++)	= -n[1];
-				Jt(i,offset2++)	= -n[2];
-				Jt(i,offset2++)	= -o2p2CrossN[0];
-				Jt(i,offset2++)	= -o2p2CrossN[1];
-				Jt(i,offset2)	= -o2p2CrossN[2];
-	
-				penetrationDepthes[i] = (cm-&gt;closestPoints[0].first-cm-&gt;closestPoints[0].second).Length();
-	
-				//penetrationVelocities[i] = ( ((*bodies)[id1]-&gt;velocity+o1p1.cross((*bodies)[id1]-&gt;angularVelocity)) - ((*bodies)[id2]-&gt;velocity+o2p2.cross((*bodies)[id2]-&gt;angularVelocity)) ).dot(n);
-			}
-		}
-
-		ublas::vector&lt;float&gt; impulses;
-		ublas::vector&lt;float&gt; displacement;
-
-		impulses.resize(bodies-&gt;size());
-		displacement.resize(bodies-&gt;size());
-
-		BCGSolve(J,invM,Jt,penetrationDepthes,displacement);
-		BCGSolve(J,invM,Jt,penetrationVelocities,impulses);
-	}
-
-
-	shared_ptr&lt;Body&gt; b;
-	unsigned int i=0;
-// FIXME - this loop assumes that id's of all bodies start from zero and increment by one?
-//	for(unsigned int i=0; i &lt; bodies-&gt;size(); i++)
-	BodyContainer::iterator bi    = bodies-&gt;begin();
-	BodyContainer::iterator biEnd = bodies-&gt;end();
-	for(  ; bi!=biEnd ; ++bi,++i )
-	{
-		b = *bi;
-
-
-		shared_ptr&lt;RigidBodyParameters&gt; rb = dynamic_pointer_cast&lt;RigidBodyParameters&gt;(b);
-		if (rb)
-		{
-			//Vector3r force = Omega::instance().getGravity()*rb-&gt;mass;
-			Vector3r force = Vector3r(0,-9.81,0)*rb-&gt;mass; // FIXME - use GravityEngine
-			int sign;
-			float f = force.Length();
-
-			for(int j=0;j&lt;3;j++)  // FIXME - use CundallNonViscousForceDamping
-			{
-				if (rb-&gt;velocity[j]==0)
-					sign=0;
-				else if (rb-&gt;velocity[j]&gt;0)
-					sign=1;
-				else
-					sign=-1;
-				force[j] -= 0.1*f*sign;
-			}
-
-			/*float m = moments[i].length();
-
-			for(int j=0;j&lt;3;j++)
-			{
-				if (rb-&gt;angularVelocity[j]==0)
-					sign=0;
-				else if (rb-&gt;angularVelocity[j]&gt;0)
-					sign=1;
-				else
-					sign=-1;
-				moments[i][j] -= 0.1*m*sign;
-			}*/
-
-			rb-&gt;acceleration += force/rb-&gt;mass;
-			//rb-&gt;angularAcceleration += moments[i].multTerm(rb-&gt;invInertia);
-		}
-        }
-
-}
-
-
-void ErrorTolerantLaw::multA(	ublas::vector&lt;float&gt;&amp; res		,
-					ublas::matrix&lt;float&gt;&amp; J		,
-					ublas::banded_matrix&lt;float&gt;&amp; invM	,
-					ublas::matrix&lt;float&gt;&amp; Jt		,
-					ublas::vector&lt;float&gt;&amp; v		)
-
-// I changed sparse_matrix to matrix, because of boost 1.33. why? Maybe there is another name for this matrix?
-// Or maybe sparse matrix is no longer necessery, because matrix is efficient when sparse?
-//
-//							Janek
-//
-//void ErrorTolerantLaw::multA(	ublas::vector&lt;float&gt;&amp; res		,
-//					ublas::sparse_matrix&lt;float&gt;&amp; J		,
-//					ublas::banded_matrix&lt;float&gt;&amp; invM	,
-//					ublas::sparse_matrix&lt;float&gt;&amp; Jt		,
-//					ublas::vector&lt;float&gt;&amp; v		)
-{
-
-	ublas::vector&lt;float&gt; Jtv = ublas::prod(Jt,v);
-	ublas::vector&lt;float&gt; invMJtv = ublas::prod(invM,Jtv);
-	res = ublas::prod(J,invMJtv);
-	//res = ublas::prod(J , ublas::prod(invM , ublas::prod(Jt,v) ) );
-}
-
-
-void ErrorTolerantLaw::initInitialGuess(ublas::vector&lt;float&gt;&amp; v)
-{
-
-	ublas::vector&lt;float&gt;::iterator vi	= v.begin();
-	ublas::vector&lt;float&gt;::iterator viEnd	= v.end();
-
-	for( ; vi != viEnd ; ++vi)
-	{
-		//(*vi) = t_Vec3((float)random()/(float)RAND_MAX,(float)random()/(float)RAND_MAX,(float)random()/(float)RAND_MAX);
-		(*vi) = 0;
-	}
-
-}
-
-
-void ErrorTolerantLaw::filter(const ublas::vector&lt;float&gt;&amp; v, ublas::vector&lt;float&gt;&amp; res)
-{
-
-	ublas::vector&lt;float&gt;::const_iterator vi		= v.begin();
-	ublas::vector&lt;float&gt;::const_iterator viEnd	= v.end();
-	ublas::vector&lt;float&gt;::iterator resi		= res.begin();
-	vector&lt;ContactState&gt;::iterator si		= contactStates.begin();
-
-	for( ; vi != viEnd ; ++vi , ++si , ++resi)
-	{
-		if ((*si) == VANISHING)
-			(*resi) = 0;
-		else
-			(*resi) = (*vi);
-	}
-}
-
-
-bool ErrorTolerantLaw::solved(const ublas::vector&lt;float&gt;&amp; v, float threshold)
-{
-	static ublas::vector&lt;float&gt; tmpVec;
-	tmpVec.resize(v.size());
-	filter(v,tmpVec);
-	return (norm(tmpVec)&lt;threshold);
-}
-
-
-float ErrorTolerantLaw::norm(const ublas::vector&lt;float&gt;&amp; v)
-{
-	return ublas::norm_1(v);
-}
-
-
-bool ErrorTolerantLaw::wrong(ublas::vector&lt;float&gt;&amp; f, const ublas::vector&lt;float&gt;&amp; a)
-{
-	bool err;
-	vector&lt;int&gt;::iterator 		ri	= nbReactivations.begin();
-	ublas::vector&lt;float&gt;::iterator	fi	= f.begin();
-	ublas::vector&lt;float&gt;::iterator	fiEnd	= f.end();
-	ublas::vector&lt;float&gt;::const_iterator ai	= a.begin();
-	vector&lt;ContactState&gt;::iterator	si	= contactStates.begin();
-
-	err = false;
-	for( ; fi != fiEnd ; ++fi , ++ai , ++si,++ri)
-	{
-		if ( (*si) == VANISHING &amp;&amp; (*ai) &lt; 0 &amp;&amp; (*ri)&lt;maxReactivations)
-		{
-			(*si) = CLAMPED;
-			err   = true;
-			(*ri)++;
-		}
-		else if ( (*si) == CLAMPED &amp;&amp; (*fi) &lt; 0 )
-		{
-			(*si) 	= VANISHING;
-			(*fi) 	= 0;
-			err   	= true;
-		}
-	}
-
-	return err;
-
-}
-
-
-void ErrorTolerantLaw::BCGSolve(	ublas::matrix&lt;float&gt;&amp; J		,
-						ublas::banded_matrix&lt;float&gt;&amp; invM	,
-						ublas::matrix&lt;float&gt;&amp; Jt		,
-						ublas::vector&lt;float&gt;&amp; constantTerm	,
-						ublas::vector&lt;float&gt;&amp; res)
-// I changed sparse_matrix to matrix, because of boost 1.33. why? Maybe there is another name for this matrix?
-// Or maybe sparse matrix is no longer necessery, because matrix is efficient when sparse?
-//
-//								Janek
-//
-//void ErrorTolerantLaw::BCGSolve(	ublas::sparse_matrix&lt;float&gt;&amp; J		,
-//						ublas::banded_matrix&lt;float&gt;&amp; invM	,
-//						ublas::sparse_matrix&lt;float&gt;&amp; Jt		,
-//						ublas::vector&lt;float&gt;&amp; constantTerm	,
-//						ublas::vector&lt;float&gt;&amp; res)
-{
-	bool modif=true;
-	float residu,oldResidu;
-	int size = J.size2(); //J.size1(); ??
-	int nbRestart;
-	float ak,akden,bk,bknum,bkden=1;
-	bool restart,solve;
-	int iter;
-
-	static ublas::vector&lt;float&gt; a, r, rr, p, pp, z, zz, tmpVec;
-
-	solve		= false;
-	iter		= 0;
-	nbRestart	= 0;
-	restart		= true;
-
-	a.resize(3*size);
-	r.resize(3*size);
-	rr.resize(3*size);
-	p.resize(3*size);
-	pp.resize(3*size);
-	z.resize(3*size);
-	zz.resize(3*size);
-	tmpVec.resize(3*size);
-	res.resize(3*size);
-
-	initInitialGuess(res);
-
-	contactStates.resize(size);
-	fill( contactStates.begin(), contactStates.end(), CLAMPED);
-
-	nbReactivations.resize(size);
-	fill( nbReactivations.begin(), nbReactivations.end(), 0);
-/// 	invDiag.resize(size);
-
-/// 	if (precond)
-/// 		buildInvDiag(jacobian,invMass) ;
-
-
-	multA(a,J,invM,Jt,res);	// a = Af 	// multA(res, a,jacobian,invMass)
-
-	a -= constantTerm;	// a = Af - b	// animal::v_meq (a, constantTerm);
-
-	a = -a;			// a = b - Af	// animal::v_eq_minus (a, a);
-
-	if (modif)
-		filter(a,r);
-	else
-		r = a;
-
-	if (solved(r,threshold))
-		solve = true;
-	else
-	{
-///		if (precond)
-///			z = invDiag*r;	// leftMultByInvDiag(z,r);
-///		else
-			z = r;
-
-		multA(rr,J,invM,Jt,r);	// multA(r,rr,jacobian,invMass);
-
-		if (modif)
-		{
-			filter(rr,tmpVec);
-			rr = tmpVec;
-	 	}
-	}
-
-	nbRestart = 0;
-	oldResidu = 0;
-	residu = norm(r);
-
-	while (iter &lt; maxIterations &amp;&amp; !solve)
-	{
-		iter ++;
-
-///		if (precond)
-///			zz = invDiag*rr;	// leftMultByInvDiag(zz,rr);
-///		else
-///			zz = rr;
-
-		bknum = ublas::inner_prod(z,rr);
-
-		if (restart)
-		{
-			p       = z;
-			pp      = zz;
-			restart = false;
-		}
-		else
-		{
-			bk = bknum/bkden;
-			p = z+bk*p;		// animal::vv_eq ( p, z, bk, p );		//p  = bk * p  + z;
-			pp = zz + bk*pp;	//animal::vv_eq ( pp, zz, bk, pp );	//pp = bk * pp + zz
-		}
-
-		bkden = bknum;
-
-		multA(z,J,invM,Jt,p);	// multA(p,z,jacobian,invMass);
-
-		if (modif)
-			filter(z,tmpVec);
-		else
-			tmpVec=z;
-
-		akden =  ublas::inner_prod(tmpVec,pp);
-
-		if (akden!=0)
-			ak = bknum/akden;
-		else
-			ak = 0;
-
-		res += ak*p;		// x = x + ak * p;
-
-
-// 		ublas::vector&lt;float&gt;::iterator ri    = res.begin();
-// 		ublas::vector&lt;float&gt;::iterator riEnd = res.end();
-// 		for( ; ri != riEnd ; ++ri)
-// 		{
-// 			if (fabs((*ri)[0])&lt;1e-3) (*ri)[0]=0;
-// 			if (fabs((*ri)[1])&lt;1e-3) (*ri)[1]=0;
-// 			if (fabs((*ri)[2])&lt;1e-3) (*ri)[2]=0;
-// 		}
-
-		filter(z,tmpVec);	// r = r - ak * filter(z);
-
-		r -= ak*tmpVec;		// animal::vv_peq ( r, -ak, tmpVec );
-		a -= ak*z;		// a = a - ak * z;	// animal::vv_peq ( a, -ak, z );
-
-		if (modif)
-			restart = wrong(res,a);
-		else
-			restart = false;
-
-		if (restart)
-		{
-			nbRestart++;
-			multA(a,J,invM,Jt,res);	// a = Af	// multA(res,a,jacobian,invMass);
-			a -= constantTerm;	//a = Af - b;	// animal::v_meq (a, constantTerm);
-			a = -a;			// animal::v_eq_minus (a, a);
-			filter(a, r);
-		}
-
-		if (solved(r,threshold))
-			solve = true;
-		else
-		{
-///			if (precond)
-///				z = invDiag*r;	// leftMultByInvDiag(z,r);
-///			else
-				z = r;
-
-			if (restart)
-			{
-				multA(rr,J,invM,Jt,r);	//multA(r,rr,jacobian,invMass);
-				filter(rr,tmpVec);
-				rr = tmpVec;
-			}
-			else
-			{
-				multA(zz,J,invM,Jt,pp);	// multA(pp,zz,jacobian,invMass);
-				if (modif)
-					filter(zz,tmpVec);
-				else
-					tmpVec = zz;
-				rr -= ak*tmpVec;	// rr = rr - ak*filter(zz); //animal::vv_peq (rr, -ak, tmpVec );
-			}
-		}
-		oldResidu = residu;
-		residu = norm(r);
-	}
-}
-

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw/ErrorTolerantLaw.hpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw/ErrorTolerantLaw.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw/ErrorTolerantLaw.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,88 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ERRORTOLERANTDYNAMICENGINE_HPP
-#define ERRORTOLERANTDYNAMICENGINE_HPP
-
-#include&lt;yade/core/InteractionSolver.hpp&gt;
-
-#include &lt;boost/numeric/ublas/vector.hpp&gt;
-#include &lt;boost/numeric/ublas/matrix_sparse.hpp&gt;
-#include &lt;boost/numeric/ublas/banded.hpp&gt;
-
-using namespace boost::numeric;
-
-class ErrorTolerantLaw : public InteractionSolver
-{
-	typedef enum{VANISHING,CLAMPED} ContactState;
-	vector&lt;ContactState&gt; contactStates;
-	vector&lt;int&gt; nbReactivations;
-	int maxReactivations;
-	int maxIterations;
-	float threshold;
-	
-	public : ErrorTolerantLaw();
-	public : ~ErrorTolerantLaw();
-
-	protected : virtual void postProcessAttributes(bool deserializing);
-	public : void registerAttributes();
-
-	public : void action(Body* body);
-
-	private : void multA(	ublas::vector&lt;float&gt;&amp; res		, 
-				ublas::matrix&lt;float&gt;&amp; J		,
-				ublas::banded_matrix&lt;float&gt;&amp; invM	,
-				ublas::matrix&lt;float&gt;&amp; Jt		,
-				ublas::vector&lt;float&gt;&amp; v	);
-
-// I changed sparse_matrix to matrix, because of boost 1.33. why? Maybe there is another name for this matrix?
-// Or maybe sparse matrix is no longer necessery, because matrix is efficient when sparse?
-//
-//								Janek
-//
-//	private : void multA(	ublas::vector&lt;float&gt;&amp; res		, 
-//				ublas::sparse_matrix&lt;float&gt;&amp; J		,
-//				ublas::banded_matrix&lt;float&gt;&amp; invM	,
-//				ublas::sparse_matrix&lt;float&gt;&amp; Jt		,
-//				ublas::vector&lt;float&gt;&amp; v	);
-	
-	private : void initInitialGuess(ublas::vector&lt;float&gt;&amp; v);
-	
-	private : void filter(const ublas::vector&lt;float&gt;&amp; v, ublas::vector&lt;float&gt;&amp; res) ;
-	
-	private : bool solved(const ublas::vector&lt;float&gt;&amp; v, float threshold) ;
-
-	private : float norm(const ublas::vector&lt;float&gt;&amp; v);
-	
-	private : bool wrong(ublas::vector&lt;float&gt;&amp; f, const ublas::vector&lt;float&gt;&amp; a) ;
-
-	private : void BCGSolve(	ublas::matrix&lt;float&gt;&amp; J		,
-					ublas::banded_matrix&lt;float&gt;&amp; invM	,
-					ublas::matrix&lt;float&gt;&amp; Jt		,
-					ublas::vector&lt;float&gt;&amp; constantTerm	,
-					ublas::vector&lt;float&gt;&amp; res);
-// I changed sparse_matrix to matrix, because of boost 1.33. why? Maybe there is another name for this matrix?
-// Or maybe sparse matrix is no longer necessery, because matrix is efficient when sparse?
-//
-//								Janek
-//
-//	private : void BCGSolve(	ublas::sparse_matrix&lt;float&gt;&amp; J		,
-//					ublas::banded_matrix&lt;float&gt;&amp; invM	,
-//					ublas::sparse_matrix&lt;float&gt;&amp; Jt		,
-//					ublas::vector&lt;float&gt;&amp; constantTerm	,
-//					ublas::vector&lt;float&gt;&amp; res);
-
-	
-	REGISTER_CLASS_NAME(ErrorTolerantLaw);
-	REGISTER_BASE_CLASS_NAME(InteractionSolver);
-};
-
-REGISTER_SERIALIZABLE(ErrorTolerantLaw,false);
-
-#endif // ERRORTOLERANTDYNAMICENGINE_HPP
-

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw.cpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw/ErrorTolerantLaw.cpp)

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw.hpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/ErrorTolerantLaw/ErrorTolerantLaw.hpp)

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw/FrictionLessElasticContactLaw.cpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw/FrictionLessElasticContactLaw.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw/FrictionLessElasticContactLaw.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,151 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*  Copyright (C) 2004 by Janek Kozicki                                   *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
-*  basen on SDEC formulas given by Frederic Donze                        *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;FrictionLessElasticContactLaw.hpp&quot;
-
-
-#include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/pkg-common/ClosestFeatures.hpp&gt;
-#include&lt;yade/core/Omega.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/pkg-common/Force.hpp&gt;
-#include&lt;yade/pkg-common/Momentum.hpp&gt;
-
-#include&lt;yade/lib-base/yadeWm3Extra.hpp&gt;
-
-
-
-FrictionLessElasticContactLaw::FrictionLessElasticContactLaw () : InteractionSolver(), actionForce(new Force) , actionMomentum(new Momentum)
-{
-}
-
-
-void FrictionLessElasticContactLaw::registerAttributes()
-{
-	InteractionSolver::registerAttributes();
-}
-
-
-void FrictionLessElasticContactLaw::action(Body * body)
-{
-	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-	shared_ptr&lt;BodyContainer&gt; bodies = ncb-&gt;bodies;
-
-	Real stiffness = 10000;
-	Real viscosity = 10;
-	
-	InteractionContainer::iterator ii = ncb-&gt;transientInteractions-&gt;begin();
-	InteractionContainer::iterator iiEnd = ncb-&gt;transientInteractions-&gt;end();
-	for( ; ii!=iiEnd; ++ii )
-	{
-		shared_ptr&lt;Interaction&gt; contact = *ii;
-		if (contact-&gt;isReal)
-		{
-			int id1 = contact-&gt;getId1();
-			int id2 = contact-&gt;getId2();
-	
-			shared_ptr&lt;RigidBodyParameters&gt; rb1 = YADE_PTR_CAST&lt;RigidBodyParameters&gt;((*bodies)[id1]-&gt;physicalParameters);
-			shared_ptr&lt;RigidBodyParameters&gt; rb2 = YADE_PTR_CAST&lt;RigidBodyParameters&gt;((*bodies)[id2]-&gt;physicalParameters);
-	
-			std::vector&lt;std::pair&lt;Vector3r,Vector3r&gt; &gt;::iterator cpi = (YADE_PTR_CAST&lt;ClosestFeatures&gt;(contact-&gt;interactionGeometry))-&gt;closestsPoints.begin();
-			std::vector&lt;std::pair&lt;Vector3r,Vector3r&gt; &gt;::iterator cpiEnd = (YADE_PTR_CAST&lt;ClosestFeatures&gt;(contact-&gt;interactionGeometry))-&gt;closestsPoints.end();
-			Real size = (YADE_PTR_CAST&lt;ClosestFeatures&gt;(contact-&gt;interactionGeometry))-&gt;closestsPoints.size();
-			for( ; cpi!=cpiEnd ; ++cpi)
-			{
-				Vector3r p1 = (*cpi).first;
-				Vector3r p2 = (*cpi).second;
-	
-				Vector3r p = 0.5*(p1+p2);
-	
-				Vector3r o1p = (p - rb1-&gt;se3.position);
-				Vector3r o2p = (p - rb2-&gt;se3.position);
-	
-				Vector3r dir = p2-p1;
-				Real l  = dir.Normalize();
-				Real elongation  = l*l;
-	
-				//Vector3r v1 = rb1-&gt;velocity+o1p.cross(rb1-&gt;angularVelocity);
-				//Vector3r v2 = rb2-&gt;velocity+o2p.cross(rb2-&gt;angularVelocity);
-				Vector3r v1 = rb1-&gt;velocity+rb1-&gt;angularVelocity.Cross(o1p);
-				Vector3r v2 = rb2-&gt;velocity+rb2-&gt;angularVelocity.Cross(o2p);
-				Real relativeVelocity = dir.Dot(v2-v1);
-				Vector3r f = (elongation*stiffness+relativeVelocity*viscosity)/size*dir;
-	
-				static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    += f;
-				static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    -= f;
-			
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += o1p.Cross(f);
-				static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= o2p.Cross(f);
-			}
-		}
-	}
-
-// 	MetaBody * ncb = YADE_CAST&lt;MetaBody*&gt;(body);
-// 	shared_ptr&lt;BodyContainer&gt;&amp; bodies = ncb-&gt;bodies;
-// 
-// 	Real dt = Omega::instance().getTimeStep();
-// 
-// 	for( ncb-&gt;transientInteractions-&gt;gotoFirst() ; ncb-&gt;transientInteractions-&gt;notAtEnd() ; ncb-&gt;transientInteractions-&gt;gotoNext() )
-// 	{
-// 		const shared_ptr&lt;Interaction&gt;&amp; contact = ncb-&gt;transientInteractions-&gt;getCurrent();
-// 		int id1 = contact-&gt;getId1();
-// 		int id2 = contact-&gt;getId2();
-// 
-// 		BodyMacroParameters* de1 				= YADE_CAST&lt;BodyMacroParameters*&gt;((*bodies)[id1]-&gt;physicalParameters.get());
-// 		BodyMacroParameters* de2 				= YADE_CAST&lt;BodyMacroParameters*&gt;((*bodies)[id2]-&gt;physicalParameters.get());
-// 		SpheresContactGeometry* currentContactGeometry 	= YADE_CAST&lt;SpheresContactGeometry*&gt;(contact-&gt;interactionGeometry.get());
-// 		ElasticContactInteraction* currentContactPhysics   	= YADE_CAST&lt;ElasticContactInteraction*&gt; (contact-&gt;interactionPhysics.get());
-// 
-// 		//Vector3r&amp; shearForce 			= currentContactPhysics-&gt;shearForce;
-// 
-// 		//if ( contact-&gt;isNew)
-// 		//	shearForce			= Vector3r(0,0,0);
-// 
-// 		Real un 				= currentContactGeometry-&gt;penetrationDepth;
-// 		currentContactPhysics-&gt;normalForce	= currentContactPhysics-&gt;kn*un*currentContactGeometry-&gt;normal;
-// 
-// 		Vector3r axis;
-// 		Real angle;
-// 
-// 
-// 		//axis	 		= currentContactPhysics-&gt;prevNormal.cross(currentContactGeometry-&gt;normal);
-// 		//shearForce 	       -= shearForce.cross(axis);
-// 		//angle 			= dt*0.5*currentContactGeometry-&gt;normal.dot(de1-&gt;angularVelocity+de2-&gt;angularVelocity);
-// 		//axis 			= angle*currentContactGeometry-&gt;normal;
-// 		//shearForce 	       -= shearForce.cross(axis);
-// 
-// 		//Vector3r x				= currentContactGeometry-&gt;contactPoint;
-// 		//Vector3r c1x				= (x - de1-&gt;se3.position);
-// 		//Vector3r c2x				= (x - de2-&gt;se3.position);
-// 		//Vector3r relativeVelocity		= (de2-&gt;velocity+de2-&gt;angularVelocity.cross(c2x)) - (de1-&gt;velocity+de1-&gt;angularVelocity.cross(c1x));
-// 		//Vector3r shearVelocity			= relativeVelocity-currentContactGeometry-&gt;normal.dot(relativeVelocity)*currentContactGeometry-&gt;normal;
-// 		//Vector3r shearDisplacement		= shearVelocity*dt;
-// 		//shearForce 			       -= currentContactPhysics-&gt;ks*shearDisplacement;
-// 
-// 		//Real maxFs = currentContactPhysics-&gt;normalForce.squaredLength() * std::pow(currentContactPhysics-&gt;tangensOfFrictionAngle,2);
-// 		//if( shearForce.squaredLength() &gt; maxFs )
-// 		//{
-// 		//	maxFs = Mathr::sqRoot(maxFs) / shearForce.length();
-// 		//	shearForce *= maxFs;
-// 		//}
-// 
-// 		Vector3r f = currentContactPhysics-&gt;normalForce;// + shearForce;
-// 
-// 		static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id1 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    -= f;
-// 		static_cast&lt;Force*&gt;   ( ncb-&gt;physicalActions-&gt;find( id2 , actionForce   -&gt;getClassIndex() ).get() )-&gt;force    += f;
-// 
-// 		static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id1 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum -= c1x.cross(f);
-// 		static_cast&lt;Momentum*&gt;( ncb-&gt;physicalActions-&gt;find( id2 , actionMomentum-&gt;getClassIndex() ).get() )-&gt;momentum += c2x.cross(f);
-// 
-// 		//currentContactPhysics-&gt;prevNormal = currentContactGeometry-&gt;normal;
-// 	}
-}
-

Deleted: branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw/FrictionLessElasticContactLaw.hpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw/FrictionLessElasticContactLaw.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw/FrictionLessElasticContactLaw.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,36 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef FRICTIONLESSELASTICCONTACTLAW_HPP
-#define FRICTIONLESSELASTICCONTACTLAW_HPP
-
-#include&lt;yade/core/InteractionSolver.hpp&gt;
-
-class PhysicalAction;
-
-class FrictionLessElasticContactLaw : public InteractionSolver
-{
-	private :
-		shared_ptr&lt;PhysicalAction&gt; actionForce;
-		shared_ptr&lt;PhysicalAction&gt; actionMomentum;
-
-	public :
-		FrictionLessElasticContactLaw ();
-		void action(Body* body);
-
-	protected :
-		 void registerAttributes();
-	REGISTER_CLASS_NAME(FrictionLessElasticContactLaw);
-	REGISTER_BASE_CLASS_NAME(InteractionSolver);
-
-};
-
-REGISTER_SERIALIZABLE(FrictionLessElasticContactLaw,false);
-
-#endif // FRICTIONLESSELASTICCONTACTLAW_HPP
-

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.cpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw/FrictionLessElasticContactLaw.cpp)

Copied: branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw.hpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/Engine/StandAloneEngine/FrictionLessElasticContactLaw/FrictionLessElasticContactLaw.hpp)

Deleted: branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack/BoxStack.cpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack/BoxStack.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack/BoxStack.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,329 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;BoxStack.hpp&quot;
-
-#include &quot;FrictionLessElasticContactLaw.hpp&quot;
-
-
-#include&lt;yade/pkg-common/Box.hpp&gt;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/SAPCollider.hpp&gt;
-#include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/pkg-common/TranslationEngine.hpp&gt;
-#include&lt;yade/lib-serialization/IOFormatManager.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-
-BoxStack::BoxStack () : FileGenerator()
-{
-	nbBoxes		= Vector3r(1,5,7);
-	boxSize		= Vector3r(6,4,8);
-	boxDensity	= 1;
-	bulletVelocity	= Vector3r(-120,0,0);
-	bulletPosition	= Vector3r(80,0,0);
-	bulletSize	= 12;
-	bulletDensity	= 2;
-	dampingForce	= 0.6;
-	dampingMomentum = 0.9;
-	kinematicBullet	= false;
-	gravity 	= Vector3r(0,-9.81,0);
-}
-
-
-BoxStack::~BoxStack ()
-{
-
-}
-
-
-void BoxStack::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	REGISTER_ATTRIBUTE(nbBoxes);
-	REGISTER_ATTRIBUTE(boxSize);
-	REGISTER_ATTRIBUTE(boxDensity);
-//	REGISTER_ATTRIBUTE(kinematicBullet);
-	REGISTER_ATTRIBUTE(bulletSize);
-	REGISTER_ATTRIBUTE(bulletDensity);
-	REGISTER_ATTRIBUTE(bulletPosition);
-	REGISTER_ATTRIBUTE(bulletVelocity);
-	REGISTER_ATTRIBUTE(gravity);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum);
-}
-
-
-string BoxStack::generate()
-{
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-
-	createActors(rootBody);
-	positionRootBody(rootBody);
-	
-	////////////////////////////////////
-
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-
-	shared_ptr&lt;Body&gt; body;
-	
-	createKinematicBox(body, Vector3r(0,  -5,  0), Vector3r(  200, 5, 200), false);
-	rootBody-&gt;bodies-&gt;insert(body);
-	
-	for(int i=0;i&lt;nbBoxes[0];i++)
-		for(int j=0;j&lt;nbBoxes[1];j++)
-			for(int k=0;k&lt;nbBoxes[2];k++)
- 			{
-				shared_ptr&lt;Body&gt; box;
-				createBox(box,i,j,k);
-				rootBody-&gt;bodies-&gt;insert(box);
- 			}
-
-	createSphere(body);
-	rootBody-&gt;bodies-&gt;insert(body);
- 			
-	return &quot;&quot;;
-}
-
-
-
-// FIXME - all the functions below, are a modified copy of functions in RotatingBox.cpp
-void BoxStack::createBox(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;RigidBodyParameters&gt; physics(new RigidBodyParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-		
-	Vector3r position		= Vector3r(i*boxSize[0],j*boxSize[1],k*boxSize[2])*2
-					  - Vector3r(0,-boxSize[1],nbBoxes[2]*boxSize[2]-boxSize[2])
-					  + Vector3r(0,0,(j%2)*boxSize[2]);
-				  
-	Vector3r size 			= boxSize;
-	body-&gt;isDynamic			= true;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= size[0]*size[1]*size[2]*boxDensity;
-	physics-&gt;inertia		= Vector3r(physics-&gt;mass*(size[1]*size[1]+size[2]*size[2])/3,physics-&gt;mass*(size[0]*size[0]+size[2]*size[2])/3,physics-&gt;mass*(size[1]*size[1]+size[0]*size[0])/3);
-	physics-&gt;se3			= Se3r(position,q);
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-	
-	gBox-&gt;extents			= size;
-	gBox-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-	gBox-&gt;wire			= false;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= true;
-	
-	iBox-&gt;extents			= size;
-	iBox-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void BoxStack::createSphere(shared_ptr&lt;Body&gt;&amp; body)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,1));
-	shared_ptr&lt;RigidBodyParameters&gt; physics(new RigidBodyParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-		
-	Vector3r position 		= Vector3r(0,nbBoxes[1]*boxSize[1],0)
-					  + bulletPosition;
-				  
-	Real radius 			= bulletSize;
-	
-	body-&gt;isDynamic			= true;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= bulletVelocity;
-	physics-&gt;mass			= 4.0/3.0*Mathr::PI*radius*radius*bulletDensity;
-	physics-&gt;inertia		= Vector3r(2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius); //
-	physics-&gt;se3			= Se3r(position,q);
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-	
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	iSphere-&gt;radius			= radius;
-	iSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-
-	body-&gt;interactingGeometry	= iSphere;
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void BoxStack::createKinematicBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents,bool wire)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,2));
-	shared_ptr&lt;RigidBodyParameters&gt; physics(new RigidBodyParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 0;
-	physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-
-	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
-
-	gBox-&gt;extents			= extents;
-	gBox-&gt;diffuseColor		= Vector3r(1,1,1);
-	gBox-&gt;wire			= wire;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= false;
-	
-	iBox-&gt;extents			= extents;
-	iBox-&gt;diffuseColor		= Vector3r(1,1,1);
-
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void BoxStack::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
-	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingSphere&quot;,&quot;InteractingSphere2InteractingSphere4ClosestFeatures&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingSphere4ClosestFeatures&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingBox4ClosestFeatures&quot;);
-
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-		
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping-&gt;damping = dampingForce;
-	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping-&gt;damping = dampingMomentum;
-	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
-	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
-	
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
- 	
-// 	shared_ptr&lt;RotationEngine&gt; kinematic = shared_ptr&lt;RotationEngine&gt;(new RotationEngine);
-// 	kinematic-&gt;angularVelocity  = rotationSpeed;
-// 	rotationAxis.normalize();
-// 	kinematic-&gt;rotationAxis  = rotationAxis;
-// 	kinematic-&gt;rotateAroundZero = true;
-// 	for(int i=0;i&lt;7;i++)
-// 		kinematic-&gt;subscribedBodies.push_back(i);
-	
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new SAPCollider));
-	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new FrictionLessElasticContactLaw));
-	rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(actionDampingDispatcher);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-	rootBody-&gt;engines.push_back(orientationIntegrator);
-//	if(isRotating)
-//		rootBody-&gt;engines.push_back(kinematic);
-	
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-	
-}
-
-
-void BoxStack::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	rootBody-&gt;isDynamic			= false;
-	Quaternionr q;	q.FromAxisAngle( Vector3r(0,0,1),0);
-	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters); // FIXME : fix indexable class PhysicalParameters
-	physics-&gt;se3				= Se3r(Vector3r(0,0,0),q);
-	physics-&gt;mass				= 0;
-	physics-&gt;velocity			= Vector3r::ZERO;
-	physics-&gt;acceleration			= Vector3r::ZERO;
-	
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	set-&gt;diffuseColor			= Vector3r(0,0,1);
-
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor			= Vector3r(0,0,1);
-	
-	rootBody-&gt;interactingGeometry		= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume		= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;physicalParameters 		= physics;
-}
-

Deleted: branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack/BoxStack.hpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack/BoxStack.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack/BoxStack.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,55 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef BOXSTACK_HPP
-#define BOXSTACK_HPP
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-
-class BoxStack : public FileGenerator
-{
-	private :
-		Vector3r	 nbBoxes
-				,boxSize
-				,bulletPosition
-				,bulletVelocity
-				,gravity;
-
-		Real		 boxDensity
-				,bulletSize
-				,bulletDensity
-				,dampingForce
-				,dampingMomentum;
-
-		bool		kinematicBullet;
-	
-	public :
-		BoxStack ();
-		virtual ~BoxStack ();
-
-		virtual void registerAttributes();
-		
-		virtual string generate();
-
-	private :
-		void createKinematicBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents,bool);
-		void createSphere(shared_ptr&lt;Body&gt;&amp; body);
-		void createBox(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k);
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-
-	REGISTER_CLASS_NAME(BoxStack);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-
-};
-
-REGISTER_SERIALIZABLE(BoxStack,false);
-
-#endif // __BOXSTACK_H__
-
-

Copied: branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack.cpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack/BoxStack.cpp)

Copied: branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack.hpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/BoxStack/BoxStack.hpp)

Deleted: branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox/RotatingBox.cpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox/RotatingBox.cpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox/RotatingBox.cpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,350 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#include &quot;RotatingBox.hpp&quot;
-#include &quot;FrictionLessElasticContactLaw.hpp&quot;
-
-#include&lt;yade/pkg-common/Box.hpp&gt;
-#include&lt;yade/pkg-common/AABB.hpp&gt;
-#include&lt;yade/pkg-common/Sphere.hpp&gt;
-#include&lt;yade/core/MetaBody.hpp&gt;
-#include&lt;yade/core/Body.hpp&gt;
-#include&lt;yade/pkg-common/SAPCollider.hpp&gt;
-#include&lt;yade/pkg-common/RigidBodyParameters.hpp&gt;
-#include&lt;yade/pkg-common/RotationEngine.hpp&gt;
-
-#include&lt;yade/lib-serialization/IOFormatManager.hpp&gt;
-#include&lt;yade/pkg-common/InteractingBox.hpp&gt;
-#include&lt;yade/pkg-common/InteractingSphere.hpp&gt;
-#include&lt;yade/pkg-common/InteractionGeometryMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousForceDamping.hpp&gt;
-#include&lt;yade/pkg-common/CundallNonViscousMomentumDamping.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerReseter.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionContainerInitializer.hpp&gt;
-
-#include&lt;yade/pkg-common/BoundingVolumeMetaEngine.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry2AABB.hpp&gt;
-#include&lt;yade/pkg-common/MetaInteractingGeometry.hpp&gt;
-#include&lt;yade/pkg-common/GravityEngine.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalParametersMetaEngine.hpp&gt;
-
-#include&lt;yade/pkg-common/BodyRedirectionVector.hpp&gt;
-#include&lt;yade/pkg-common/InteractionVecSet.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionVectorVector.hpp&gt;
-
-#include&lt;yade/pkg-common/PhysicalActionDamper.hpp&gt;
-#include&lt;yade/pkg-common/PhysicalActionApplier.hpp&gt;
-
-
-RotatingBox::RotatingBox () : FileGenerator()
-{
-	nbSpheres	= Vector3r(3,3,5);
-	nbBoxes		= Vector3r(3,3,4);
-	minSize		= 3;
-	maxSize		= 5;
-	disorder	= 1.1;
-	densityBox	= 1;
-	densitySphere	= 1;
-	dampingForce	= 0.2;
-	dampingMomentum = 0.6;
-	isRotating	= true;
-	rotationSpeed	= 0.05;
-	rotationAxis	= Vector3r(1,1,1);
-	middleWireFrame = true;
-	gravity 	= Vector3r(0,-9.81,0);
-}
-
-
-RotatingBox::~RotatingBox ()
-{
-}
-
-
-void RotatingBox::registerAttributes()
-{
-	FileGenerator::registerAttributes();
-	REGISTER_ATTRIBUTE(nbSpheres);
-	REGISTER_ATTRIBUTE(nbBoxes);
-	REGISTER_ATTRIBUTE(minSize);
-	REGISTER_ATTRIBUTE(maxSize);
-	REGISTER_ATTRIBUTE(densityBox);
-	REGISTER_ATTRIBUTE(densitySphere);
-	REGISTER_ATTRIBUTE(gravity);
-	REGISTER_ATTRIBUTE(dampingForce);
-	REGISTER_ATTRIBUTE(dampingMomentum);
-	REGISTER_ATTRIBUTE(isRotating);
-	REGISTER_ATTRIBUTE(rotationSpeed);
-	REGISTER_ATTRIBUTE(rotationAxis);
-	REGISTER_ATTRIBUTE(middleWireFrame);
-//	REGISTER_ATTRIBUTE(disorder);
-}
-
-
-string RotatingBox::generate()
-{
-	rootBody = shared_ptr&lt;MetaBody&gt;(new MetaBody);
-
-	createActors(rootBody);
-	positionRootBody(rootBody);
-	
-	rootBody-&gt;persistentInteractions	= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;transientInteractions		= shared_ptr&lt;InteractionContainer&gt;(new InteractionVecSet);
-	rootBody-&gt;physicalActions		= shared_ptr&lt;PhysicalActionContainer&gt;(new PhysicalActionVectorVector);
-	rootBody-&gt;bodies 			= shared_ptr&lt;BodyContainer&gt;(new BodyRedirectionVector);
-
-	
-	shared_ptr&lt;Body&gt; body;
-	
-	createKinematicBox(body, Vector3r(  0,  0, 10), Vector3r( 50,  5, 40),middleWireFrame);	rootBody-&gt;bodies-&gt;insert(body);
-	createKinematicBox(body, Vector3r(-55,  0,  0), Vector3r(  5, 60, 50),true );	rootBody-&gt;bodies-&gt;insert(body);
-	createKinematicBox(body, Vector3r( 55,  0,  0), Vector3r(  5, 60, 50),true );	rootBody-&gt;bodies-&gt;insert(body);
-	createKinematicBox(body, Vector3r(  0,-55,  0), Vector3r( 50,  5, 50),true );	rootBody-&gt;bodies-&gt;insert(body);
-	createKinematicBox(body, Vector3r(  0, 55,  0), Vector3r( 50,  5, 50),true );	rootBody-&gt;bodies-&gt;insert(body);
-	createKinematicBox(body, Vector3r(  0,  0,-55), Vector3r( 60, 60,  5),true );	rootBody-&gt;bodies-&gt;insert(body);
-	createKinematicBox(body, Vector3r(  0,  0, 55), Vector3r( 60, 60,  5),true );	rootBody-&gt;bodies-&gt;insert(body);
-
-	for(int i=0;i&lt;nbSpheres[0];i++)
-		for(int j=0;j&lt;nbSpheres[1];j++)
-			for(int k=0;k&lt;nbSpheres[2];k++)
-			{
-				shared_ptr&lt;Body&gt; sphere;
-				createSphere(sphere,i,j,k);
-				rootBody-&gt;bodies-&gt;insert(sphere);
-			}
-
-	for(int i=0;i&lt;nbBoxes[0];i++)
-		for(int j=0;j&lt;nbBoxes[1];j++)
-			for(int k=0;k&lt;nbBoxes[2];k++)
- 			{
-				shared_ptr&lt;Body&gt; box;
-				createBox(box,i,j,k);
-				rootBody-&gt;bodies-&gt;insert(box);
- 			}
-
-	return &quot;&quot;;
-}
-
-
-
-void RotatingBox::createBox(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,0));
-	shared_ptr&lt;RigidBodyParameters&gt; physics(new RigidBodyParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-		
-	Vector3r position		= Vector3r(i,j,k)*10
-					  - Vector3r(15,35,25)
-					  + Vector3r(Mathr::SymmetricRandom(),Mathr::SymmetricRandom(),Mathr::SymmetricRandom());
-				  
-	Vector3r size 			= Vector3r(     (Mathr::IntervalRandom(minSize,maxSize))
-							,(Mathr::IntervalRandom(minSize,maxSize))
-							,(Mathr::IntervalRandom(minSize,maxSize))
-						);
-	body-&gt;isDynamic			= true;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= size[0]*size[1]*size[2]*densityBox;
-	physics-&gt;inertia		= Vector3r(
-							  physics-&gt;mass*(size[1]*size[1]+size[2]*size[2])/3
-							, physics-&gt;mass*(size[0]*size[0]+size[2]*size[2])/3
-							, physics-&gt;mass*(size[1]*size[1]+size[0]*size[0])/3
-						);
-	physics-&gt;se3			= Se3r(position,q);
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-	
-	gBox-&gt;extents			= size;
-	gBox-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-	gBox-&gt;wire			= false;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= true;
-	
-	iBox-&gt;extents			= size;
-	iBox-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void RotatingBox::createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,0));
-	shared_ptr&lt;RigidBodyParameters&gt; physics(new RigidBodyParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Sphere&gt; gSphere(new Sphere);
-	shared_ptr&lt;InteractingSphere&gt; iSphere(new InteractingSphere);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-		
-	Vector3r position 		= Vector3r(i,j,k)*10
-					  - Vector3r(45,45,45)
-					  + Vector3r(Mathr::SymmetricRandom(),Mathr::SymmetricRandom(),Mathr::SymmetricRandom());
-				  
-	Real radius 			= (Mathr::IntervalRandom(minSize,maxSize));
-	
-	body-&gt;isDynamic			= true;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 4.0/3.0*Mathr::PI*radius*radius*radius*densitySphere;
-	physics-&gt;inertia		= Vector3r(2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius,2.0/5.0*physics-&gt;mass*radius*radius); //
-	physics-&gt;se3			= Se3r(position,q);
-
-	aabb-&gt;diffuseColor		= Vector3r(0,1,0);
-	
-	gSphere-&gt;radius			= radius;
-	gSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-	gSphere-&gt;wire			= false;
-	gSphere-&gt;visible		= true;
-	gSphere-&gt;shadowCaster		= true;
-	
-	iSphere-&gt;radius			= radius;
-	iSphere-&gt;diffuseColor		= Vector3r(Mathr::UnitRandom(),Mathr::UnitRandom(),Mathr::UnitRandom());
-
-	body-&gt;interactingGeometry	= iSphere;
-	body-&gt;geometricalModel		= gSphere;
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void RotatingBox::createKinematicBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents,bool wire)
-{
-	body = shared_ptr&lt;Body&gt;(new Body(0,0));
-	shared_ptr&lt;RigidBodyParameters&gt; physics(new RigidBodyParameters);
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	shared_ptr&lt;Box&gt; gBox(new Box);
-	shared_ptr&lt;InteractingBox&gt; iBox(new InteractingBox);
-	
-	Quaternionr q;
-	q.FromAxisAngle( Vector3r(0,0,1),0);
-
-	body-&gt;isDynamic			= false;
-	
-	physics-&gt;angularVelocity	= Vector3r(0,0,0);
-	physics-&gt;velocity		= Vector3r(0,0,0);
-	physics-&gt;mass			= 0;
-	physics-&gt;inertia		= Vector3r(0,0,0);
-	physics-&gt;se3			= Se3r(position,q);
-
-	aabb-&gt;diffuseColor		= Vector3r(1,0,0);
-
-	gBox-&gt;extents			= extents;
-	gBox-&gt;diffuseColor		= Vector3r(1,1,1);
-	gBox-&gt;wire			= wire;
-	gBox-&gt;visible			= true;
-	gBox-&gt;shadowCaster		= false;
-	
-	iBox-&gt;extents			= extents;
-	iBox-&gt;diffuseColor		= Vector3r(1,1,1);
-
-	body-&gt;boundingVolume		= aabb;
-	body-&gt;interactingGeometry	= iBox;
-	body-&gt;geometricalModel		= gBox;
-	body-&gt;physicalParameters	= physics;
-}
-
-
-void RotatingBox::createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	shared_ptr&lt;PhysicalActionContainerInitializer&gt; physicalActionInitializer(new PhysicalActionContainerInitializer);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Force&quot;);
-	physicalActionInitializer-&gt;physicalActionNames.push_back(&quot;Momentum&quot;);
-	
-	shared_ptr&lt;InteractionGeometryMetaEngine&gt; interactionGeometryDispatcher(new InteractionGeometryMetaEngine);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingSphere&quot;,&quot;InteractingSphere2InteractingSphere4ClosestFeatures&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingSphere4ClosestFeatures&quot;);
-	interactionGeometryDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;InteractingBox&quot;,&quot;InteractingBox2InteractingBox4ClosestFeatures&quot;);
-
-	shared_ptr&lt;BoundingVolumeMetaEngine&gt; boundingVolumeDispatcher	= shared_ptr&lt;BoundingVolumeMetaEngine&gt;(new BoundingVolumeMetaEngine);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingSphere&quot;,&quot;AABB&quot;,&quot;InteractingSphere2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;InteractingBox&quot;,&quot;AABB&quot;,&quot;InteractingBox2AABB&quot;);
-	boundingVolumeDispatcher-&gt;add(&quot;MetaInteractingGeometry&quot;,&quot;AABB&quot;,&quot;MetaInteractingGeometry2AABB&quot;);
-		
-	shared_ptr&lt;GravityEngine&gt; gravityCondition(new GravityEngine);
-	gravityCondition-&gt;gravity = gravity;
-	
-	shared_ptr&lt;CundallNonViscousForceDamping&gt; actionForceDamping(new CundallNonViscousForceDamping);
-	actionForceDamping-&gt;damping = dampingForce;
-	shared_ptr&lt;CundallNonViscousMomentumDamping&gt; actionMomentumDamping(new CundallNonViscousMomentumDamping);
-	actionMomentumDamping-&gt;damping = dampingMomentum;
-	shared_ptr&lt;PhysicalActionDamper&gt; actionDampingDispatcher(new PhysicalActionDamper);
-	actionDampingDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;CundallNonViscousForceDamping&quot;,actionForceDamping);
-	actionDampingDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;CundallNonViscousMomentumDamping&quot;,actionMomentumDamping);
-	
-	shared_ptr&lt;PhysicalActionApplier&gt; applyActionDispatcher(new PhysicalActionApplier);
-	applyActionDispatcher-&gt;add(&quot;Force&quot;,&quot;ParticleParameters&quot;,&quot;NewtonsForceLaw&quot;);
-	applyActionDispatcher-&gt;add(&quot;Momentum&quot;,&quot;RigidBodyParameters&quot;,&quot;NewtonsMomentumLaw&quot;);
-	
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; positionIntegrator(new PhysicalParametersMetaEngine);
-	positionIntegrator-&gt;add(&quot;ParticleParameters&quot;,&quot;LeapFrogPositionIntegrator&quot;);
-	shared_ptr&lt;PhysicalParametersMetaEngine&gt; orientationIntegrator(new PhysicalParametersMetaEngine);
-	orientationIntegrator-&gt;add(&quot;RigidBodyParameters&quot;,&quot;LeapFrogOrientationIntegrator&quot;);
- 	
-	shared_ptr&lt;RotationEngine&gt; kinematic = shared_ptr&lt;RotationEngine&gt;(new RotationEngine);
- 	kinematic-&gt;angularVelocity  = rotationSpeed;
-	rotationAxis.Normalize();
- 	kinematic-&gt;rotationAxis  = rotationAxis;
- 	kinematic-&gt;rotateAroundZero = true;
-	
- 	for(int i=0;i&lt;7;i++)
- 		kinematic-&gt;subscribedBodies.push_back(i);
-	
-	rootBody-&gt;engines.clear();
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new PhysicalActionContainerReseter));
-	rootBody-&gt;engines.push_back(boundingVolumeDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new SAPCollider));
-	rootBody-&gt;engines.push_back(interactionGeometryDispatcher);
-	rootBody-&gt;engines.push_back(shared_ptr&lt;Engine&gt;(new FrictionLessElasticContactLaw));
-	rootBody-&gt;engines.push_back(gravityCondition);
-	rootBody-&gt;engines.push_back(actionDampingDispatcher);
-	rootBody-&gt;engines.push_back(applyActionDispatcher);
-	rootBody-&gt;engines.push_back(positionIntegrator);
-	rootBody-&gt;engines.push_back(orientationIntegrator);
-	if(isRotating)
-		rootBody-&gt;engines.push_back(kinematic);
-		
-	rootBody-&gt;initializers.clear();
-	rootBody-&gt;initializers.push_back(physicalActionInitializer);
-	rootBody-&gt;initializers.push_back(boundingVolumeDispatcher);
-}
-
-
-
-void RotatingBox::positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody)
-{
-	rootBody-&gt;isDynamic			= false;
-	Quaternionr q;	q.FromAxisAngle( Vector3r(0,0,1),0);
-	shared_ptr&lt;ParticleParameters&gt; physics(new ParticleParameters); // FIXME : fix indexable class PhysicalParameters
-	physics-&gt;se3				= Se3r(Vector3r(0,0,0),q);
-	physics-&gt;mass				= 0;
-	physics-&gt;velocity			= Vector3r::ZERO;
-	physics-&gt;acceleration			= Vector3r::ZERO;
-	
-	shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-	set-&gt;diffuseColor			= Vector3r(0,0,1);
-
-	shared_ptr&lt;AABB&gt; aabb(new AABB);
-	aabb-&gt;diffuseColor			= Vector3r(0,0,1);
-	
-	rootBody-&gt;interactingGeometry		= YADE_PTR_CAST&lt;InteractingGeometry&gt;(set);	
-	rootBody-&gt;boundingVolume		= YADE_PTR_CAST&lt;BoundingVolume&gt;(aabb);
-	rootBody-&gt;physicalParameters 		= physics;
-}
-
-

Deleted: branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox/RotatingBox.hpp
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox/RotatingBox.hpp	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox/RotatingBox.hpp	2007-03-07 14:13:16 UTC (rev 1107)
@@ -1,54 +0,0 @@
-/*************************************************************************
-*  Copyright (C) 2004 by Olivier Galizzi                                 *
-*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">olivier.galizzi at imag.fr</A>                                               *
-*                                                                        *
-*  This program is free software; it is licensed under the terms of the  *
-*  GNU General Public License v2 or later. See file LICENSE for details. *
-*************************************************************************/
-
-#ifndef ROTATINGBOX_HPP
-#define ROTATINGBOX_HPP
-
-#include&lt;yade/core/FileGenerator.hpp&gt;
-
-class RotatingBox : public FileGenerator
-{
-	private :
-		Vector3r	 nbSpheres
-				,nbBoxes
-				,rotationAxis
-				,gravity;
-
-		Real		 minSize
-				,maxSize
-				,disorder
-				,dampingForce
-				,dampingMomentum
-				,densityBox
-				,densitySphere
-				,rotationSpeed;
-
-		bool		 isRotating
-				,middleWireFrame;
-	
-		void createKinematicBox(shared_ptr&lt;Body&gt;&amp; body, Vector3r position, Vector3r extents,bool);
-		void createSphere(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k);
-		void createBox(shared_ptr&lt;Body&gt;&amp; body, int i, int j, int k);
-		void createActors(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-		void positionRootBody(shared_ptr&lt;MetaBody&gt;&amp; rootBody);
-	
-	public :
-		RotatingBox ();
-		~RotatingBox ();
-		virtual string generate();
-	
-	protected :
-		virtual void registerAttributes();
-	REGISTER_CLASS_NAME(RotatingBox);
-	REGISTER_BASE_CLASS_NAME(FileGenerator);
-};
-
-REGISTER_SERIALIZABLE(RotatingBox,false);
-
-#endif // ROTATINGBOX_HPP
-

Copied: branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox.cpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox/RotatingBox.cpp)

Copied: branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox.hpp (from rev 1105, branches/scons-layout/pkg/realtime-rigidbody/PreProcessor/RotatingBox/RotatingBox.hpp)

Modified: branches/scons-layout/pkg/realtime-rigidbody/SConscript
===================================================================
--- branches/scons-layout/pkg/realtime-rigidbody/SConscript	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/pkg/realtime-rigidbody/SConscript	2007-03-07 14:13:16 UTC (rev 1107)
@@ -2,17 +2,17 @@
 env.Install('$PREFIX/lib/yade$POSTFIX/pkg-realtime-rigidbody',[
 
 	env.SharedLibrary('ErrorTolerantContact',
-		['DataClass/InteractionGeometry/ErrorTolerantContact/ErrorTolerantContact.cpp'],
+		['DataClass/InteractionGeometry/ErrorTolerantContact.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-base',
 			'Wm3Foundation',
 			'yade-serialization',
 			'yade-factory'],
-		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionGeometry/ErrorTolerantContact']),
+		CPPPATH=env['CPPPATH']+['$PREFIX/include', 'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('AAInteractingBox2InteractingSphere4ClosestFeatures',
-		['Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures/AAInteractingBox2InteractingSphere4ClosestFeatures.cpp'],
+		['Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'InteractionGeometryMetaEngine',
@@ -25,10 +25,10 @@
 			'Sphere',
 			'ClosestFeatures'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Engine/EngineUnit/AAInteractingBox2InteractingSphere4ClosestFeatures']),
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('InteractingBox2InteractingBox4ClosestFeatures',
-		['Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures/InteractingBox2InteractingBox4ClosestFeatures.cpp'],
+		['Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'InteractionGeometryMetaEngine',
@@ -39,11 +39,11 @@
 			'InteractingBox',
 			'Box',
 			'ClosestFeatures'],
-		CPPPATH=env['CPPPATH']+['Engine/EngineUnit/InteractingBox2InteractingBox4ClosestFeatures',
+		CPPPATH=env['CPPPATH']+['Engine/EngineUnit',
 			'$PREFIX/include']),
 
 	env.SharedLibrary('InteractingBox2InteractingSphere4ClosestFeatures',
-		['Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures/InteractingBox2InteractingSphere4ClosestFeatures.cpp'],
+		['Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'InteractionGeometryMetaEngine',
@@ -55,11 +55,11 @@
 			'Box',
 			'Sphere',
 			'ClosestFeatures'],
-		CPPPATH=env['CPPPATH']+['Engine/EngineUnit/InteractingBox2InteractingSphere4ClosestFeatures',
+		CPPPATH=env['CPPPATH']+['Engine/EngineUnit',
 			'$PREFIX/include']),
 
 	env.SharedLibrary('InteractingBox2InteractingSphere4ErrorTolerantContact',
-		['Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact/InteractingBox2InteractingSphere4ErrorTolerantContact.cpp'],
+		['Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'ErrorTolerantContact',
@@ -70,12 +70,12 @@
 			'yade-multimethods',
 			'Box',
 			'Sphere'],
-		CPPPATH=env['CPPPATH']+['Engine/EngineUnit/InteractingBox2InteractingSphere4ErrorTolerantContact',
+		CPPPATH=env['CPPPATH']+['Engine/EngineUnit',
 			'$PREFIX/include',
-			'DataClass/InteractionGeometry/ErrorTolerantContact']),
+			'DataClass/InteractionGeometry']),
 
 	env.SharedLibrary('InteractingSphere2InteractingSphere4ClosestFeatures',
-		['Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures/InteractingSphere2InteractingSphere4ClosestFeatures.cpp'],
+		['Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'InteractionGeometryMetaEngine',
@@ -85,11 +85,11 @@
 			'InteractingSphere',
 			'Sphere',
 			'ClosestFeatures'],
-		CPPPATH=env['CPPPATH']+['Engine/EngineUnit/InteractingSphere2InteractingSphere4ClosestFeatures',
+		CPPPATH=env['CPPPATH']+['Engine/EngineUnit',
 			'$PREFIX/include']),
 
 	env.SharedLibrary('InteractingSphere2InteractingSphere4ErrorTolerantContact',
-		['Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact/InteractingSphere2InteractingSphere4ErrorTolerantContact.cpp'],
+		['Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'ErrorTolerantContact',
@@ -100,11 +100,11 @@
 			'Wm3Foundation',
 			'Sphere'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionGeometry/ErrorTolerantContact',
-			'Engine/EngineUnit/InteractingSphere2InteractingSphere4ErrorTolerantContact']),
+			'DataClass/InteractionGeometry',
+			'Engine/EngineUnit']),
 
 	env.SharedLibrary('ErrorTolerantLaw',
-		['Engine/StandAloneEngine/ErrorTolerantLaw/ErrorTolerantLaw.cpp'],
+		['Engine/StandAloneEngine/ErrorTolerantLaw.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'ErrorTolerantContact',
@@ -115,11 +115,11 @@
 			'yade-factory',
 			'yade-multimethods'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'DataClass/InteractionGeometry/ErrorTolerantContact',
-			'Engine/StandAloneEngine/ErrorTolerantLaw']),
+			'DataClass/InteractionGeometry',
+			'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('FrictionLessElasticContactLaw',
-		['Engine/StandAloneEngine/FrictionLessElasticContactLaw/FrictionLessElasticContactLaw.cpp'],
+		['Engine/StandAloneEngine/FrictionLessElasticContactLaw.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'yade-serialization',
@@ -131,10 +131,10 @@
 			'ClosestFeatures',
 			'RigidBodyParameters'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Engine/StandAloneEngine/FrictionLessElasticContactLaw']),
+			'Engine/StandAloneEngine']),
 
 	env.SharedLibrary('BoxStack',
-		['PreProcessor/BoxStack/BoxStack.cpp'],
+		['PreProcessor/BoxStack.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'FrictionLessElasticContactLaw',
@@ -164,11 +164,11 @@
 			'TranslationEngine',
 			'yade-multimethods'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Engine/StandAloneEngine/FrictionLessElasticContactLaw',
-			'PreProcessor/BoxStack']),
+			'Engine/StandAloneEngine',
+			'PreProcessor']),
 
 	env.SharedLibrary('RotatingBox',
-		['PreProcessor/RotatingBox/RotatingBox.cpp'],
+		['PreProcessor/RotatingBox.cpp'],
 		LIBS=env['LIBS']+['yade-base',
 			'Wm3Foundation',
 			'FrictionLessElasticContactLaw',
@@ -199,7 +199,7 @@
 			'RotationEngine',
 			'yade-multimethods'],
 		CPPPATH=env['CPPPATH']+['$PREFIX/include',
-			'Engine/StandAloneEngine/FrictionLessElasticContactLaw',
-			'PreProcessor/RotatingBox'])
+			'Engine/StandAloneEngine',
+			'PreProcessor'])
 ])
 

Modified: branches/scons-layout/scripts/ysl1.py
===================================================================
--- branches/scons-layout/scripts/ysl1.py	2007-03-07 13:16:01 UTC (rev 1106)
+++ branches/scons-layout/scripts/ysl1.py	2007-03-07 14:13:16 UTC (rev 1107)
@@ -44,34 +44,36 @@
 			# target structure:
 			# {DataClass,Engine}/*/*.?pp
 			# {RenderingEngine,PreProcessor,Container}/*.?pp
-			deep2=re.match(r'(.*)/pkg/([^/]+)/(Engine|DataClass|RenderingEngine)/([^/]*)/([^/]*)/?(.*)$',rootf)
-			deep1=re.match(r'(.*)/pkg/([^/]+)/(PreProcessor|Container)/([^/]*)/([^/]*)/?(.*)$',rootf)
+			if os.path.isdir(rootf): continue # skip dirs here
+			m=re.match(r'(.*)/pkg/([^/]+)/(Engine|DataClass|RenderingEngine|PreProcessor|Container)/([^/]*)/([^/]*/)?(.+\..pp)$',rootf)
+			#deep1=re.match(r'(.*)/pkg/([^/]+)/(PreProcessor|Container)/([^/]*)/([^/]*)/?(.*)$',rootf)
 			cmd=None
-			if deep2:
-				gg=deep2.groups()
+			if m:
+				gg=m.groups()
 				## gg[4] will be skipped
-				if len(gg[5])==0: # directory
-					# replace any references to it in SConscript files
-					f=&quot;%s/pkg/%s/SConscript&quot;%(gg[0],gg[1])
-					cmd=&quot;perl -pi~ -e's@(%s/%s)/%s([^.])@\\1\\2@' %s&quot;%(gg[2],gg[3],gg[4],f)
-				else:
+				# replace any references to it in SConscript files
+				script=&quot;%s/pkg/%s/SConscript&quot;%(gg[0],gg[1])
+				if gg[2] in ['Engine','DataClass','RenderingEngine']:
+					skipped=''
+					if gg[4]: skipped+=&quot;/%s&quot;%gg[4][:-1] ## gg[4] has trailing /
+					if len(skipped)==0: continue
+					cmd=[&quot;perl -pi~ -e's@(%s/%s)%s([^.])@\\1\\2@' %s&quot;%(gg[2],gg[3],skipped,script)]
 					newFile=&quot;%s/pkg/%s/%s/%s/%s&quot;%(gg[0],gg[1],gg[2],gg[3],gg[5])
-					cmd=&quot;svn move %s %s&quot;%(rootf,newFile)
-			elif deep1:
-				gg=deep1.groups()
-				## gg[3] and gg[4] will be skipped
-				if len(gg[5])==0: #dir
-					f=&quot;%s/pkg/%s/SConscript&quot;%(gg[0],gg[1])
-					cmd=&quot;perl -pi~ -e's@(%s)/%s/%s([^.])@\\1\\2@' %s&quot;%(gg[2],gg[3],gg[4],f)
-				else:
+				elif gg[2] in ['PreProcessor','Container']:
+					skipped='/%s'%gg[3]
+					if gg[4]: skipped+=&quot;/%s&quot;%gg[4][:-1]
+					cmd=[&quot;perl -pi~ -e's@(%s)%s([^.])@\\1\\2@' %s&quot;%(gg[2],skipped,script)]
 					newFile=&quot;%s/pkg/%s/%s/%s&quot;%(gg[0],gg[1],gg[2],gg[5])
-					cmd=&quot;svn move %s %s&quot;%(rootf,newFile)
-			if cmd:
-				if deep2 and cmd[0]=='p': print cmd
+				else: raise RuntimeError
+				cmd+=[&quot;svn move %s %s&quot;%(rootf,newFile)]
+				dd.write(root+'\n')
+				#print cmd[0]
+				#print cmd[1]
+				for cc in cmd: os.system(cc)
 				#os.system(cmd)
 			#	print cmd
 
+dd.close()
 
 
 
-


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000067.html">[Yade-commits] r1106 - branches/scons-layout/scripts
</A></li>
	<LI>Next message: <A HREF="000068.html">[Yade-commits] r1108 - in branches/scons-layout/pkg: common/Container/BodyContainer common/Container/InteractionContainer common/Container/PhysicalActionContainer common/DataClass/BoundingVolume common/DataClass/GeometricalModel common/DataClass/InteractingGeometry common/DataClass/InteractionGeometry common/DataClass/InteractionPhysics common/DataClass/PhysicalAction common/DataClass/PhysicalParameters common/Engine/DeusExMachina common/Engine/EngineUnit common/Engine/MetaEngine common/Engine/StandAloneEngine common/RenderingEngine/GLDrawBoundingVolume common/RenderingEngine/GLDrawGeometricalModel common/RenderingEngine/GLDrawInteractingGeometry common/RenderingEngine/GLDrawInteractionGeometry common/RenderingEngine/GLDrawInteractionPhysics common/RenderingEngine/GLDrawShadowVolume common/RenderingEngine/GLDrawState dem/DataClass/InteractingGeometry dem/DataClass/InteractionGeometry dem/DataClass/InteractionPhysics dem/DataClass/PhysicalAction dem/DataClass/PhysicalParameters dem! /Engine/DeusExMachina dem/Engine/EngineUnit dem/Engine/StandAloneEngine dem/PreProcessor fem/DataClass/GeometricalModel fem/DataClass/PhysicalParameters fem/Engine/EngineUnit fem/Engine/StandAloneEngine fem/PreProcessor lattice/DataClass/GeometricalModel lattice/DataClass/InteractingGeometry lattice/DataClass/InteractionPhysics lattice/DataClass/PhysicalParameters lattice/Engine/EngineUnit lattice/Engine/StandAloneEngine lattice/PreProcessor mass-spring/DataClass/InteractionGeometry mass-spring/DataClass/InteractionPhysics mass-spring/DataClass/PhysicalParameters mass-spring/Engine/EngineUnit mass-spring/Engine/StandAloneEngine mass-spring/PreProcessor realtime-rigidbody/DataClass/InteractionGeometry realtime-rigidbody/Engine/EngineUnit realtime-rigidbody/Engine/StandAloneEngine realtime-rigidbody/PreProcessor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73">[ date ]</a>
              <a href="thread.html#73">[ thread ]</a>
              <a href="subject.html#73">[ subject ]</a>
              <a href="author.html#73">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/yade-commits">More information about the Yade-commits
mailing list</a><br>
</body></html>
