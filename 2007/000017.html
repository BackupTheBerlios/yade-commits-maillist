<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Yade-commits] r1052 - in trunk/yade-packages:	yade-package-dem/src/Engine/StandAloneEngine	yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer	yade-package-lattice/src/RenderingEngine/GLDrawLatticeBeamState
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/yade-commits/2007/index.html" >
   <LINK REL="made" HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1052%20-%20in%20trunk/yade-packages%3A%0A%09yade-package-dem/src/Engine/StandAloneEngine%0A%09yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer%0A%09yade-package-lattice/src/RenderingEngine/GLDrawLatticeBeamState&In-Reply-To=%3C200701301738.l0UHcrpC012610%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000016.html">
   <LINK REL="Next"  HREF="000018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Yade-commits] r1052 - in trunk/yade-packages:	yade-package-dem/src/Engine/StandAloneEngine	yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer	yade-package-lattice/src/RenderingEngine/GLDrawLatticeBeamState</H1>
    <B>cosurgi at BerliOS</B> 
    <A HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1052%20-%20in%20trunk/yade-packages%3A%0A%09yade-package-dem/src/Engine/StandAloneEngine%0A%09yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer%0A%09yade-package-lattice/src/RenderingEngine/GLDrawLatticeBeamState&In-Reply-To=%3C200701301738.l0UHcrpC012610%40sheep.berlios.de%3E"
       TITLE="[Yade-commits] r1052 - in trunk/yade-packages:	yade-package-dem/src/Engine/StandAloneEngine	yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer	yade-package-lattice/src/RenderingEngine/GLDrawLatticeBeamState">cosurgi at mail.berlios.de
       </A><BR>
    <I>Tue Jan 30 18:38:53 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000016.html">[Yade-commits] r1051 -	trunk/yade-packages/yade-package-dem/src/PreProcessor
</A></li>
        <LI>Next message: <A HREF="000018.html">[Yade-commits] r1053 - in trunk: yade-core/src/yade yade-packages/yade-package-common/src/Container/InteractionContainer/InteractionHashMap yade-packages/yade-package-common/src/Container/InteractionContainer/InteractionVecSet yade-packages/yade-package-common/src/DataClass/InteractionGeometry/ClosestFeatures yade-packages/yade-package-common/src/DataClass/InteractionPhysics/SimpleElasticInteraction yade-packages/yade-package-common/src/Engine/DeusExMachina/DisplacementEngine yade-packages/yade-package-common/src/RenderingEngine yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionGeometry yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionPhysics yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction! yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/InteractionOfMyTetrahedron yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/SDECLinkGeometry yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/SpheresContactGeometry yade-packages/yade-package-dem/src/DataClass/InteractionPhysics/ElasticContactInteraction yade-packages/yade-package-dem/src/DataClass/InteractionPhysics/SDECLinkPhysics yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer yade-packages/yade-package-dem/src/RenderingEngine yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry yade-packages/yade-package-lattice/src/DataClass/InteractionPhysics/LatticeBeamAngularSpring yade-packages/yade-package-lattice/src/DataClass/InteractionPhysics/NonLocalDependency yade-packages/yade-package-mass-spring/src/DataClass/InteractionGeometry/Sprin! gGeometry yade-packages/yade-package-mass-spring/src/DataClass! /Interac
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17">[ date ]</a>
              <a href="thread.html#17">[ thread ]</a>
              <a href="subject.html#17">[ subject ]</a>
              <a href="author.html#17">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: cosurgi
Date: 2007-01-30 18:38:52 +0100 (Tue, 30 Jan 2007)
New Revision: 1052

Added:
   trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/
   trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp
   trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.hpp
   trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.pro
Modified:
   trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/StandAloneEngine.pro
   trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeBeamState/GLDrawLatticeBeamState.cpp
Log:

- I added GeometricalModelForceColorizer. It is another hacky Engine that I
  have added (along with Quadrilaterals). I did it, because I wanted to see
  spheres colored according to force acting on them. This is a hack because the
  GLDraw mechanism is currently very limited, and has to be extended to allow
  things like this. So currently it works, but not in a way it should be done.
  GLDraw* changes are coming ... soon :)

  BTW: it could be done better, currently looking at those colors can give you apoplexy



Added: trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp	2007-01-30 14:53:40 UTC (rev 1051)
+++ trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.cpp	2007-01-30 17:38:52 UTC (rev 1052)
@@ -0,0 +1,71 @@
+/*************************************************************************
+*  Copyright (C) 2004 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include &quot;GeometricalModelForceColorizer.hpp&quot;
+#include &lt;yade/yade-package-common/RigidBodyParameters.hpp&gt;
+#include &lt;yade/yade-core/Omega.hpp&gt;
+#include &lt;yade/yade-core/MetaBody.hpp&gt;
+#include &lt;yade/yade-package-common/Force.hpp&gt;
+#include &lt;boost/lexical_cast.hpp&gt;
+
+
+GeometricalModelForceColorizer::GeometricalModelForceColorizer () : StandAloneEngine(), actionForce(new Force)
+{
+}
+
+
+bool GeometricalModelForceColorizer::isActivated()
+{
+	return true;
+//	return ((Omega::instance().getCurrentIteration() % interval == 0) &amp;&amp; (ofile));
+}
+
+
+void GeometricalModelForceColorizer::action(Body * body)
+{
+	// FIXME the same in GLDrawLatticeBeamState.cpp
+
+	MetaBody * ncb = dynamic_cast&lt;MetaBody*&gt;(body);
+	BodyContainer* bodies = ncb-&gt;bodies.get();
+	
+	Real min=10000,max=-10000;
+
+	BodyContainer::iterator bi    = bodies-&gt;begin();
+	BodyContainer::iterator biEnd = bodies-&gt;end();
+	for( ; bi!=biEnd ; ++bi ) // first loop to calculate min/max
+	{
+		Body* body = (*bi).get();
+		if(body-&gt;isDynamic)
+		{
+			unsigned int i = body -&gt; getId();
+			Vector3r force = dynamic_cast&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find( i , actionForce-&gt;getClassIndex() ) . get() )-&gt;force;
+			min = std::min( force[0] , std::min( force[1] , std::min( force[2], min ) ) );
+			max = std::max( force[0] , std::max( force[1] , std::max( force[2], max ) ) );
+		}
+
+	}
+	
+	bi    = bodies-&gt;begin();
+	biEnd = bodies-&gt;end();
+	for( ; bi!=biEnd ; ++bi ) // second loop to assign correct color
+	{
+		Body* body = (*bi).get();
+		if(body-&gt;isDynamic)
+		{
+			GeometricalModel* gm = body-&gt;geometricalModel.get();
+			unsigned int i = body -&gt; getId();
+			Vector3r force = dynamic_cast&lt;Force*&gt;(ncb-&gt;physicalActions-&gt;find( i , actionForce-&gt;getClassIndex() ) . get() )-&gt;force;
+			gm-&gt;diffuseColor[0] = (force[0]-min)/(max-min);
+			gm-&gt;diffuseColor[1] = (force[1]-min)/(max-min);
+			gm-&gt;diffuseColor[2] = (force[2]-min)/(max-min);
+		}
+
+	}
+		
+}
+

Added: trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.hpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.hpp	2007-01-30 14:53:40 UTC (rev 1051)
+++ trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.hpp	2007-01-30 17:38:52 UTC (rev 1052)
@@ -0,0 +1,34 @@
+/*************************************************************************
+*  Copyright (C) 2004 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef GEOMETRICAL_MODEL_FORCE_COLORIZER_HPP
+#define GEOMETRICAL_MODEL_FORCE_COLORIZER_HPP
+
+#include &lt;yade/yade-core/StandAloneEngine.hpp&gt;
+
+class PhysicalAction;
+
+class GeometricalModelForceColorizer : public StandAloneEngine
+{
+	private :
+		shared_ptr&lt;PhysicalAction&gt; actionForce;
+	
+	public :
+		GeometricalModelForceColorizer ();
+
+		virtual void action(Body* b);
+		virtual bool isActivated();
+
+	REGISTER_CLASS_NAME(GeometricalModelForceColorizer);
+	REGISTER_BASE_CLASS_NAME(StandAloneEngine);
+};
+
+REGISTER_SERIALIZABLE(GeometricalModelForceColorizer,false);
+
+#endif // FORCE_RECORDER_HPP
+

Added: trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.pro
===================================================================
--- trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.pro	2007-01-30 14:53:40 UTC (rev 1051)
+++ trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer/GeometricalModelForceColorizer.pro	2007-01-30 17:38:52 UTC (rev 1052)
@@ -0,0 +1,25 @@
+isEmpty ( YADE_QMAKE_PATH ) {
+error( &quot;YADE_QMAKE_PATH internal qmake variable is not set, you should run for example qmake YADE_QMAKE_PATH=/usr/local, this will not work from inside kdevelop (when they will fix it?)&quot; )
+}
+
+
+LIBS += -lRigidBodyParameters \
+        -lForce \
+        -rdynamic 
+QMAKE_LIBDIR = $${YADE_QMAKE_PATH}/lib/yade/yade-package-common/ \
+               $${YADE_QMAKE_PATH}/lib/yade/yade-libs/ 
+QMAKE_CXXFLAGS_RELEASE += -lpthread \
+                          -pthread 
+QMAKE_CXXFLAGS_DEBUG += -lpthread \
+                        -pthread 
+DESTDIR = ../../../../bin 
+CONFIG += debug \
+          thread \
+          warn_on \
+          dll 
+TEMPLATE = lib 
+HEADERS += GeometricalModelForceColorizer.hpp 
+SOURCES += GeometricalModelForceColorizer.cpp 
+INCLUDEPATH += $${YADE_QMAKE_PATH}/include
+
+QMAKE_RUN_CXX_IMP = $(CXX) -c $(CXXFLAGS) $(INCPATH) -o $@ $(shell pwd)/$&lt;

Modified: trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/StandAloneEngine.pro
===================================================================
--- trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/StandAloneEngine.pro	2007-01-30 14:53:40 UTC (rev 1051)
+++ trunk/yade-packages/yade-package-dem/src/Engine/StandAloneEngine/StandAloneEngine.pro	2007-01-30 17:38:52 UTC (rev 1052)
@@ -12,7 +12,8 @@
            PositionOrientationRecorder \
            VelocityRecorder \
 	   GlobalStiffnessCounter \
-	   GlobalStiffnessTimeStepper
+	   GlobalStiffnessTimeStepper \
+	   GeometricalModelForceColorizer
 
 CONFIG += debug \
           thread \

Modified: trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeBeamState/GLDrawLatticeBeamState.cpp
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeBeamState/GLDrawLatticeBeamState.cpp	2007-01-30 14:53:40 UTC (rev 1051)
+++ trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeBeamState/GLDrawLatticeBeamState.cpp	2007-01-30 17:38:52 UTC (rev 1052)
@@ -12,6 +12,7 @@
 
 void GLDrawLatticeBeamState::go(const shared_ptr&lt;PhysicalParameters&gt;&amp; pp)
 {
+	// FIXME the same in  GeometricalModelForceColorizer.cpp 
 	static Real maxTensileFactor = 0.0; // FIXME - thread unsafe
 	static Real maxCompressFactor = 0.0; // FIXME - thread unsafe
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000016.html">[Yade-commits] r1051 -	trunk/yade-packages/yade-package-dem/src/PreProcessor
</A></li>
	<LI>Next message: <A HREF="000018.html">[Yade-commits] r1053 - in trunk: yade-core/src/yade yade-packages/yade-package-common/src/Container/InteractionContainer/InteractionHashMap yade-packages/yade-package-common/src/Container/InteractionContainer/InteractionVecSet yade-packages/yade-package-common/src/DataClass/InteractionGeometry/ClosestFeatures yade-packages/yade-package-common/src/DataClass/InteractionPhysics/SimpleElasticInteraction yade-packages/yade-package-common/src/Engine/DeusExMachina/DisplacementEngine yade-packages/yade-package-common/src/RenderingEngine yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionGeometry yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionGeometry/GLDrawClosestFeatures yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionPhysics yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractionPhysics/GLDrawSimpleElasticInteraction! yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/InteractionOfMyTetrahedron yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/SDECLinkGeometry yade-packages/yade-package-dem/src/DataClass/InteractionGeometry/SpheresContactGeometry yade-packages/yade-package-dem/src/DataClass/InteractionPhysics/ElasticContactInteraction yade-packages/yade-package-dem/src/DataClass/InteractionPhysics/SDECLinkPhysics yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GeometricalModelForceColorizer yade-packages/yade-package-dem/src/RenderingEngine yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry yade-packages/yade-package-lattice/src/DataClass/InteractionPhysics/LatticeBeamAngularSpring yade-packages/yade-package-lattice/src/DataClass/InteractionPhysics/NonLocalDependency yade-packages/yade-package-mass-spring/src/DataClass/InteractionGeometry/Sprin! gGeometry yade-packages/yade-package-mass-spring/src/DataClass! /Interac
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17">[ date ]</a>
              <a href="thread.html#17">[ thread ]</a>
              <a href="subject.html#17">[ subject ]</a>
              <a href="author.html#17">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/yade-commits">More information about the Yade-commits
mailing list</a><br>
</body></html>
