<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Yade-commits] r1058 - in trunk: . yade-core/src/yade yade-doc	yade-extra yade-extra/clump	yade-packages/yade-package-common/src/Engine/DeusExMachina/ForceEngine	yade-packages/yade-package-common/src/Engine/DeusExMachina/GravityEngine	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw	yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider	yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider	yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere	yade-scripts
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/yade-commits/2007/index.html" >
   <LINK REL="made" HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1058%20-%20in%20trunk%3A%20.%20yade-core/src/yade%20yade-doc%0A%09yade-extra%20yade-extra/clump%0A%09yade-packages/yade-package-common/src/Engine/DeusExMachina/ForceEngine%0A%09yade-packages/yade-package-common/src/Engine/DeusExMachina/GravityEngine%0A%09yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator%0A%09yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator%0A%09yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw%0A%09yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw%0A%09yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider%0A%09yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider%0A%09yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere%0A%09yade-scripts&In-Reply-To=%3C200702091454.l19EsM4D029996%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000022.html">
   <LINK REL="Next"  HREF="000024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Yade-commits] r1058 - in trunk: . yade-core/src/yade yade-doc	yade-extra yade-extra/clump	yade-packages/yade-package-common/src/Engine/DeusExMachina/ForceEngine	yade-packages/yade-package-common/src/Engine/DeusExMachina/GravityEngine	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw	yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider	yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider	yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere	yade-scripts</H1>
    <B>eudoxos at BerliOS</B> 
    <A HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1058%20-%20in%20trunk%3A%20.%20yade-core/src/yade%20yade-doc%0A%09yade-extra%20yade-extra/clump%0A%09yade-packages/yade-package-common/src/Engine/DeusExMachina/ForceEngine%0A%09yade-packages/yade-package-common/src/Engine/DeusExMachina/GravityEngine%0A%09yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator%0A%09yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator%0A%09yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw%0A%09yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw%0A%09yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider%0A%09yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider%0A%09yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere%0A%09yade-scripts&In-Reply-To=%3C200702091454.l19EsM4D029996%40sheep.berlios.de%3E"
       TITLE="[Yade-commits] r1058 - in trunk: . yade-core/src/yade yade-doc	yade-extra yade-extra/clump	yade-packages/yade-package-common/src/Engine/DeusExMachina/ForceEngine	yade-packages/yade-package-common/src/Engine/DeusExMachina/GravityEngine	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw	yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider	yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider	yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere	yade-scripts">eudoxos at mail.berlios.de
       </A><BR>
    <I>Fri Feb  9 15:54:22 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000022.html">[Yade-commits] r1057 - in trunk: yade-core/src/yade	yade-libs/yade-lib-serialization/src/yade-lib-serialization	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw	yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider	yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider	yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GlobalStiffnessTimeStepper
</A></li>
        <LI>Next message: <A HREF="000024.html">[Yade-commits] r1059 - in trunk: yade-core/src/yade	yade-packages/yade-package-common/src/Engine/DeusExMachina/DisplacementEngine	yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending	yade-packages/yade-package-lattice/src/DataClass/PhysicalParameters/LatticeBeamParameters	yade-packages/yade-package-lattice/src/Engine/StandAloneEngine/BeamRecorder	yade-packages/yade-package-lattice/src/Engine/StandAloneEngine/LatticeLaw	yade-packages/yade-package-lattice/src/Engine/StandAloneEngine/MeasurePoisson	yade-packages/yade-package-lattice/src/Engine/StandAloneEngine/NodeRecorder	yade-packages/yade-package-lattice/src/Engine/StandAloneEngine/StrainRecorder	yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample	yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeBeamState
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23">[ date ]</a>
              <a href="thread.html#23">[ thread ]</a>
              <a href="subject.html#23">[ subject ]</a>
              <a href="author.html#23">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: eudoxos
Date: 2007-02-09 15:54:21 +0100 (Fri, 09 Feb 2007)
New Revision: 1058

Added:
   trunk/yade-doc/Doxyfile
   trunk/yade-extra/clump/
   trunk/yade-extra/clump/Clump.cpp
   trunk/yade-extra/clump/Clump.hpp
   trunk/yade-extra/clump/SConscript
Modified:
   trunk/SConstruct
   trunk/yade-core/src/yade/Body.cpp
   trunk/yade-core/src/yade/Body.hpp
   trunk/yade-core/src/yade/MetaBody.hpp
   trunk/yade-core/src/yade/Omega.hpp
   trunk/yade-packages/yade-package-common/src/Engine/DeusExMachina/ForceEngine/ForceEngine.cpp
   trunk/yade-packages/yade-package-common/src/Engine/DeusExMachina/GravityEngine/GravityEngine.cpp
   trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.cpp
   trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.cpp
   trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.cpp
   trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.pro
   trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.cpp
   trunk/yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.cpp
   trunk/yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider/SAPCollider.cpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp
   trunk/yade-scripts/erskine3-apply.sh
   trunk/yade-scripts/erskine3.py
Log:
1. provide Doxyfile, running &quot;cd yade-doc; doxygen&quot; will produce html reference documentation
2. initial (non-functional) implementation of high-level clumps, along with some cleanup of the changes done elsewhere
3. erskine now can be given scons variables (namely, $PREFIX) that will be unexpanded in generated SConscript's
4. SConscruct #defines HIGHLEVEL_CLUMPS, since other people probably don't use scons (yet)
5. New method Body::byId, new typedef Body::id_t, new constant Body::ID_NONE (jailed in HIGHLEVEL_CLUMPS for now, that will be removed sooner or later)



Modified: trunk/SConstruct
===================================================================
--- trunk/SConstruct	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/SConstruct	2007-02-09 14:54:21 UTC (rev 1058)
@@ -48,6 +48,7 @@
 	BoolOption('profile','Enable profiling information',0),
 	BoolOption('optimize','Turn on heavy optimizations (generates SSE2 instructions)',0),
 	ListOption('exclude','Components that will not be built','none',names=['extra','common','dem','fem','lattice','mass-spring','realtime-rigidbody']),
+	('extraModules', 'Extra directories with their own SConscript files (must be in-tree) (whitespace separated)',None,None,Split),
 	('CPPPATH', 'Additional paths for the C preprocessor (whitespace separated)',['/usr/include/wm3'],None,Split),
 	('LIBPATH','Additional paths for the linker (whitespace separated)',None,None,Split),
 	('QTDIR','Directories where to look for qt3',['/usr/share/qt3','/usr/lib/qt'],None,Split),
@@ -136,6 +137,7 @@
 ### PREPROCESSOR
 env.Append(CPPPATH=['#/include'])
 env.Append(CPPDEFINES=[('POSTFIX',r'$POSTFIX'),('PREFIX',r'$PREFIX')])
+env.Append(CPPDEFINES=['HIGHLEVEL_CLUMPS'])
 
 ### COMPILER
 if env['debug']: env.Append(CXXFLAGS='-ggdb3',CPPDEFINES=['DEBUG'])
@@ -155,6 +157,7 @@
 	env.Append(CXXFLAGS=archFlags,LINKFLAGS=archFlags,SHLINKFLAGS=archFlags)
 if env['profile']: env.Append(CXXFLAGS=['-pg'],LINKFLAGS=['-pg'],SHLINKFLAGS=['-pg'])
 env.Append(CXXFLAGS=['-pipe','-Wall'])
+#env.Append(CXXFLAGS=['-save-temps'])
 
 ### LINKER
 env.Append(LIBS=[]) # ensure existence of the flag
@@ -234,7 +237,8 @@
 
 # read all SConscript files
 env.Export('env');
-SConscript([os.path.join(x,'SConscript') for x in libDirs+['yade-core']])
+SConscript(dirs=libDirs+['yade-core'])
+if env.has_key('extraModules'): SConscript(dirs=env['extraModules'])
 
 
 ##########################################################################################
@@ -268,13 +272,16 @@
 	# iterate over .so nodes we got previously and call Install for each of them
 	for n in installableNodes:
 		f=str(n)
-		m=re.match(r'(^|.*/)(yade-(extra|guis|libs|package-[^/]+))/[^/]+$',f)
-		if not m: # older scons version have e.g. qt libs in nodes, we just skip them here
+		# the last (/.*) is meant got extraModules, again...
+		m=re.match(r'(^|.*/)(yade-(extra|guis|libs|package-[^/]+))(/.*)?/[^/]+$',f)
+		if m: instDir=m.group(2)
+		else: # older scons version have e.g. qt libs in nodes, we just skip them here
 			# TODO: exclude system libs in node enumerator, that is much safer
 			if major=='0' and int(minor)&lt;=96 and int(micro)&lt;90: continue
-			else: assert(m)
-		assert(m)
-		instDir=m.group(2)
+			# nodes not found will be installed in yade-extra; this is meant specifically for extraModules
+			# FIXME: should be done in a clean way.
+			instDir='yade-extra'
+		if f.find('Clump')&gt;=0: print f,instDir
 		env.Install('$PREFIX/lib/yade$POSTFIX/'+instDir,n)
 	# for the one and only binary, we do it by hand
 	env.InstallAs('$PREFIX/bin/yade$POSTFIX','yade-core/yade')

Modified: trunk/yade-core/src/yade/Body.cpp
===================================================================
--- trunk/yade-core/src/yade/Body.cpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-core/src/yade/Body.cpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -10,14 +10,23 @@
 
 #include &quot;Body.hpp&quot;
 
+#include &lt;limits&gt;
+#include &quot;MetaBody.hpp&quot;
+#include &quot;Omega.hpp&quot;
 
+#ifdef HIGHLEVEL_CLUMPS
+	const id_t Body::ID_NONE=UINT_MAX;
+	/*! the definition will change once Omega disappears, but the interface should be the same. */
+	shared_ptr&lt;Body&gt; Body::byId(Body::id_t _id){return (*(Omega::instance().getRootBody()-&gt;bodies))[_id];}
+#endif
+
 // we must initialize id = 0, otherwise BodyContainer will crash.
 Body::Body () : 
 	  Serializable()
 	, id(0)
 	, groupMask(1)
 	#ifdef HIGHLEVEL_CLUMPS
-	,clumpId(-1)
+	,clumpId(ID_NONE)
 	#endif
 {
 }
@@ -26,6 +35,9 @@
 	  Serializable()
 	, id(newId)
 	, groupMask(newGroup)
+	#ifdef HIGHLEVEL_CLUMPS
+	,clumpId(ID_NONE)
+	#endif
 	, physicalParameters(shared_ptr&lt;PhysicalParameters&gt;())
 	, geometricalModel(shared_ptr&lt;GeometricalModel&gt;())
 	, interactingGeometry(shared_ptr&lt;InteractingGeometry&gt;())
@@ -45,5 +57,8 @@
 	REGISTER_ATTRIBUTE(geometricalModel);
 	REGISTER_ATTRIBUTE(interactingGeometry);
 	REGISTER_ATTRIBUTE(boundingVolume);
+	#ifdef HIGHLEVEL_CLUMPS
+	REGISTER_ATTRIBUTE(clumpId);
+	#endif
 }
 

Modified: trunk/yade-core/src/yade/Body.hpp
===================================================================
--- trunk/yade-core/src/yade/Body.hpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-core/src/yade/Body.hpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -21,6 +21,7 @@
 #include &quot;Interaction.hpp&quot;
 #include &quot;PhysicalActionContainer.hpp&quot;
 
+
 #include &lt;yade/yade-lib-base/yadeWm3Extra.hpp&gt;
 #include &lt;yade/yade-lib-serialization/Serializable.hpp&gt;
 #include &lt;yade/yade-lib-multimethods/Indexable.hpp&gt;
@@ -39,7 +40,15 @@
 		int groupMask;
 	public	:
 		#ifdef HIGHLEVEL_CLUMPS
-		int clumpId;
+			/*! \brief Numerical type for ::Body::id.
+			 * \bug  Current code mixes singed and unsigned int, this might be a way to enforce consistence. */
+			typedef unsigned int id_t;
+			//! Clump of which this body makes part. If it is not part of a clump, set to Body::ID_NONE.
+			id_t clumpId;
+			//! symbolic constant for body that doesn't exist.
+			static const id_t ID_NONE;
+			//! get Body pointer given its id. 
+			static shared_ptr&lt;Body&gt; byId(id_t _id);
 		#endif
 		unsigned int getId() const {return id;};
 

Modified: trunk/yade-core/src/yade/MetaBody.hpp
===================================================================
--- trunk/yade-core/src/yade/MetaBody.hpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-core/src/yade/MetaBody.hpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -24,11 +24,6 @@
 		shared_ptr&lt;InteractionContainer&gt;	persistentInteractions; // disappear, reappear according to physical (or any other non-spatial) criterion
 		shared_ptr&lt;InteractionContainer&gt;	transientInteractions;	// disappear, reappear according to spatial criterion
 		shared_ptr&lt;PhysicalActionContainer&gt;	physicalActions;
-		#ifdef HIGHLEVEL_CLUMPS
-			// body Id's are unsigned ints (shouldn't be typedef'ed somewhere?)
-			vector&lt;vector&lt;unsigned int&gt; &gt; clumpMembers; // clumpMembers[i] contains bodyId's of all members of clump #i (i&gt;=0); they need not to be sorted (this may change, though)
-			vector&lt;unsigned int&gt; clumpParameterBodies; // clumpParameterBodies[i] is ID of body in this-&gt;bodies that has physical information for clump #i; the body has isDynamic==false, it serves only as convenient parameter storage
-		#endif
 	
 		MetaBody ();
 

Modified: trunk/yade-core/src/yade/Omega.hpp
===================================================================
--- trunk/yade-core/src/yade/Omega.hpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-core/src/yade/Omega.hpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -34,6 +34,9 @@
 using namespace boost::posix_time;
 using namespace std;
 
+//! &quot;return&quot; Body* given the body id. After Omega disappears, only change the definition
+#define BODY_BY_ID(id) ((*(Omega::instance().rootBody()-&gt;bodies))[id].get())
+
 struct DynlibDescriptor
 {
 	set&lt;string&gt;	 baseClasses;

Added: trunk/yade-doc/Doxyfile
===================================================================
--- trunk/yade-doc/Doxyfile	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-doc/Doxyfile	2007-02-09 14:54:21 UTC (rev 1058)
@@ -0,0 +1,277 @@
+# Doxyfile 1.4.7
+
+#---------------------------------------------------------------------------
+# Project related configuration options
+#---------------------------------------------------------------------------
+PROJECT_NAME           = Yade
+PROJECT_NUMBER         = r1057
+OUTPUT_DIRECTORY       = ./doxygen/
+CREATE_SUBDIRS         = NO
+OUTPUT_LANGUAGE        = English
+USE_WINDOWS_ENCODING   = NO
+BRIEF_MEMBER_DESC      = YES
+REPEAT_BRIEF           = YES
+ABBREVIATE_BRIEF       = &quot;The $name class&quot; \
+                         &quot;The $name widget&quot; \
+                         &quot;The $name file&quot; \
+                         is \
+                         provides \
+                         specifies \
+                         contains \
+                         represents \
+                         a \
+                         an \
+                         the
+ALWAYS_DETAILED_SEC    = NO
+INLINE_INHERITED_MEMB  = NO
+FULL_PATH_NAMES        = YES
+STRIP_FROM_PATH        = ../
+STRIP_FROM_INC_PATH    = 
+SHORT_NAMES            = NO
+JAVADOC_AUTOBRIEF      = NO
+MULTILINE_CPP_IS_BRIEF = NO
+DETAILS_AT_TOP         = NO
+INHERIT_DOCS           = YES
+SEPARATE_MEMBER_PAGES  = NO
+TAB_SIZE               = 8
+ALIASES                = 
+OPTIMIZE_OUTPUT_FOR_C  = NO
+OPTIMIZE_OUTPUT_JAVA   = NO
+BUILTIN_STL_SUPPORT    = NO
+DISTRIBUTE_GROUP_DOC   = NO
+SUBGROUPING            = YES
+#---------------------------------------------------------------------------
+# Build related configuration options
+#---------------------------------------------------------------------------
+EXTRACT_ALL            = NO
+EXTRACT_PRIVATE        = YES
+EXTRACT_STATIC         = YES
+EXTRACT_LOCAL_CLASSES  = YES
+EXTRACT_LOCAL_METHODS  = YES
+HIDE_UNDOC_MEMBERS     = YES
+HIDE_UNDOC_CLASSES     = YES
+HIDE_FRIEND_COMPOUNDS  = NO
+HIDE_IN_BODY_DOCS      = NO
+INTERNAL_DOCS          = NO
+CASE_SENSE_NAMES       = YES
+HIDE_SCOPE_NAMES       = NO
+SHOW_INCLUDE_FILES     = YES
+INLINE_INFO            = YES
+SORT_MEMBER_DOCS       = YES
+SORT_BRIEF_DOCS        = NO
+SORT_BY_SCOPE_NAME     = NO
+GENERATE_TODOLIST      = YES
+GENERATE_TESTLIST      = YES
+GENERATE_BUGLIST       = YES
+GENERATE_DEPRECATEDLIST= YES
+ENABLED_SECTIONS       = 
+MAX_INITIALIZER_LINES  = 30
+SHOW_USED_FILES        = YES
+SHOW_DIRECTORIES       = NO
+FILE_VERSION_FILTER    = 
+#---------------------------------------------------------------------------
+# configuration options related to warning and progress messages
+#---------------------------------------------------------------------------
+QUIET                  = NO
+WARNINGS               = YES
+WARN_IF_UNDOCUMENTED   = YES
+WARN_IF_DOC_ERROR      = YES
+WARN_NO_PARAMDOC       = NO
+WARN_FORMAT            = &quot;$file:$line: $text&quot;
+WARN_LOGFILE           = 
+#---------------------------------------------------------------------------
+# configuration options related to the input files
+#---------------------------------------------------------------------------
+INPUT                  = ../
+FILE_PATTERNS          = *.c \
+                         *.cc \
+                         *.cxx \
+                         *.cpp \
+                         *.c++ \
+                         *.d \
+                         *.java \
+                         *.ii \
+                         *.ixx \
+                         *.ipp \
+                         *.i++ \
+                         *.inl \
+                         *.h \
+                         *.hh \
+                         *.hxx \
+                         *.hpp \
+                         *.h++ \
+                         *.idl \
+                         *.odl \
+                         *.cs \
+                         *.php \
+                         *.php3 \
+                         *.inc \
+                         *.m \
+                         *.mm \
+                         *.dox \
+                         *.py \
+                         *.C \
+                         *.CC \
+                         *.C++ \
+                         *.II \
+                         *.I++ \
+                         *.H \
+                         *.HH \
+                         *.H++ \
+                         *.CS \
+                         *.PHP \
+                         *.PHP3 \
+                         *.M \
+                         *.MM \
+                         *.PY
+RECURSIVE              = YES
+EXCLUDE                =
+EXCLUDE_SYMLINKS       = NO
+EXCLUDE_PATTERNS       = */yade-flat/* \
+									*/include/* \
+									*/.*
+EXAMPLE_PATH           = 
+EXAMPLE_PATTERNS       = *
+EXAMPLE_RECURSIVE      = NO
+IMAGE_PATH             = 
+INPUT_FILTER           = 
+FILTER_PATTERNS        = 
+FILTER_SOURCE_FILES    = NO
+#---------------------------------------------------------------------------
+# configuration options related to source browsing
+#---------------------------------------------------------------------------
+SOURCE_BROWSER         = NO
+INLINE_SOURCES         = NO
+STRIP_CODE_COMMENTS    = YES
+REFERENCED_BY_RELATION = NO
+REFERENCES_RELATION    = NO
+REFERENCES_LINK_SOURCE = YES
+USE_HTAGS              = NO
+VERBATIM_HEADERS       = NO
+#---------------------------------------------------------------------------
+# configuration options related to the alphabetical class index
+#---------------------------------------------------------------------------
+ALPHABETICAL_INDEX     = NO
+COLS_IN_ALPHA_INDEX    = 5
+IGNORE_PREFIX          = 
+#---------------------------------------------------------------------------
+# configuration options related to the HTML output
+#---------------------------------------------------------------------------
+GENERATE_HTML          = YES
+HTML_OUTPUT            = html
+HTML_FILE_EXTENSION    = .html
+HTML_HEADER            = 
+HTML_FOOTER            = 
+HTML_STYLESHEET        = 
+HTML_ALIGN_MEMBERS     = YES
+GENERATE_HTMLHELP      = NO
+CHM_FILE               = 
+HHC_LOCATION           = 
+GENERATE_CHI           = NO
+BINARY_TOC             = NO
+TOC_EXPAND             = NO
+DISABLE_INDEX          = NO
+ENUM_VALUES_PER_LINE   = 4
+GENERATE_TREEVIEW      = YES
+TREEVIEW_WIDTH         = 250
+#---------------------------------------------------------------------------
+# configuration options related to the LaTeX output
+#---------------------------------------------------------------------------
+GENERATE_LATEX         = NO
+LATEX_OUTPUT           = latex
+LATEX_CMD_NAME         = latex
+MAKEINDEX_CMD_NAME     = makeindex
+COMPACT_LATEX          = NO
+PAPER_TYPE             = a4wide
+EXTRA_PACKAGES         = 
+LATEX_HEADER           = 
+PDF_HYPERLINKS         = NO
+USE_PDFLATEX           = NO
+LATEX_BATCHMODE        = NO
+LATEX_HIDE_INDICES     = NO
+#---------------------------------------------------------------------------
+# configuration options related to the RTF output
+#---------------------------------------------------------------------------
+GENERATE_RTF           = NO
+RTF_OUTPUT             = rtf
+COMPACT_RTF            = NO
+RTF_HYPERLINKS         = NO
+RTF_STYLESHEET_FILE    = 
+RTF_EXTENSIONS_FILE    = 
+#---------------------------------------------------------------------------
+# configuration options related to the man page output
+#---------------------------------------------------------------------------
+GENERATE_MAN           = NO
+MAN_OUTPUT             = man
+MAN_EXTENSION          = .3
+MAN_LINKS              = NO
+#---------------------------------------------------------------------------
+# configuration options related to the XML output
+#---------------------------------------------------------------------------
+GENERATE_XML           = NO
+XML_OUTPUT             = xml
+XML_SCHEMA             = 
+XML_DTD                = 
+XML_PROGRAMLISTING     = YES
+#---------------------------------------------------------------------------
+# configuration options for the AutoGen Definitions output
+#---------------------------------------------------------------------------
+GENERATE_AUTOGEN_DEF   = NO
+#---------------------------------------------------------------------------
+# configuration options related to the Perl module output
+#---------------------------------------------------------------------------
+GENERATE_PERLMOD       = NO
+PERLMOD_LATEX          = NO
+PERLMOD_PRETTY         = YES
+PERLMOD_MAKEVAR_PREFIX = 
+#---------------------------------------------------------------------------
+# Configuration options related to the preprocessor   
+#---------------------------------------------------------------------------
+ENABLE_PREPROCESSING   = YES
+MACRO_EXPANSION        = NO
+EXPAND_ONLY_PREDEF     = NO
+SEARCH_INCLUDES        = YES
+INCLUDE_PATH           = 
+INCLUDE_FILE_PATTERNS  = 
+PREDEFINED             = HIGHLEVEL_CLUMPS 
+EXPAND_AS_DEFINED      = 
+SKIP_FUNCTION_MACROS   = YES
+#---------------------------------------------------------------------------
+# Configuration::additions related to external references   
+#---------------------------------------------------------------------------
+TAGFILES               = 
+GENERATE_TAGFILE       = 
+ALLEXTERNALS           = NO
+EXTERNAL_GROUPS        = YES
+PERL_PATH              = /usr/bin/perl
+#---------------------------------------------------------------------------
+# Configuration options related to the dot tool   
+#---------------------------------------------------------------------------
+CLASS_DIAGRAMS         = YES
+HIDE_UNDOC_RELATIONS   = YES
+HAVE_DOT               = NO
+CLASS_GRAPH            = YES
+COLLABORATION_GRAPH    = YES
+GROUP_GRAPHS           = YES
+UML_LOOK               = NO
+TEMPLATE_RELATIONS     = NO
+INCLUDE_GRAPH          = YES
+INCLUDED_BY_GRAPH      = YES
+CALL_GRAPH             = NO
+CALLER_GRAPH           = NO
+GRAPHICAL_HIERARCHY    = YES
+DIRECTORY_GRAPH        = YES
+DOT_IMAGE_FORMAT       = png
+DOT_PATH               = 
+DOTFILE_DIRS           = 
+MAX_DOT_GRAPH_WIDTH    = 1024
+MAX_DOT_GRAPH_HEIGHT   = 1024
+MAX_DOT_GRAPH_DEPTH    = 1000
+DOT_TRANSPARENT        = NO
+DOT_MULTI_TARGETS      = NO
+GENERATE_LEGEND        = YES
+DOT_CLEANUP            = YES
+#---------------------------------------------------------------------------
+# Configuration::additions related to the search engine   
+#---------------------------------------------------------------------------
+SEARCHENGINE           = NO

Added: trunk/yade-extra/clump/Clump.cpp
===================================================================
--- trunk/yade-extra/clump/Clump.cpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-extra/clump/Clump.cpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -0,0 +1,84 @@
+// (c) 2007 Vaclav Smilauer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">eudoxos at arcig.cz</A>&gt; 
+
+#include&quot;Clump.hpp&quot;
+
+#include&lt;algorithm&gt;
+
+char* yadePluginClasses[]={
+	&quot;Clump&quot;,
+	&quot;ClumpLeapFrogPositionAndOrientationIntegrator&quot;,
+	NULL /*sentinel*/
+};
+
+CREATE_LOGGER(Clump);
+CREATE_LOGGER(ClumpLeapFrogPositionAndOrientationIntegrator);
+
+/*! @pre Body must be dynamic.
+ * @pre Body must not be part or this clump already.
+ * @todo se3 calculation is not tested yet
+ */
+
+void Clump::add(Body::id_t subId){
+	Body* subBody=Body::byId(subId);
+
+	// preconditions
+	assert(subBody-&gt;isDynamic);
+	assert(find(SubBodies.begin(),subBodies.end(),subId)==subBodies.end());
+
+	// begin actual setup
+	subBody-&gt;clumpId=id;
+	subBody-&gt;isDynamic=false;
+	subBodies.push_back(subId);
+	//FIXME: should be this way or the other way around? Will have to try!
+	//FIXME: should assert validity of this-&gt;physicalParameters?! How to do that with shared_ptr?
+	Se3r rel(subBody-&gt;physicalParameters-&gt;se3,physicalParameters-&gt;se3);
+	subSe3s.push_back(rel);
+	LOG_DEBUG(&quot;Added body #&quot;&lt;&lt;subId&lt;&lt;&quot; to clump #&quot;&lt;&lt;id);
+}
+
+/*! @pre Body with given id must be in the clump.
+ */
+void Clump::del(Body::id_t subId){
+	// find position of the body in vector
+	std::vector&lt;Body::id_t&gt;::iterator subBodiesIter=find(subBodies.begin(),subBodies.end(),subId);
+	// removing body that is not part of the clump is error
+	assert(subBodiesIter!=subBodies.end());
+	// se3 is at the same position
+	size_t idx=distance(subBodies.being(),subBodiesIter);
+	std::vector&lt;Se3&gt;::iterator subSe3sIter=subSe3s.begin()+idx;
+	// erase these elements;
+	subBodies.erase(subBodiesIter);
+	subSe3s.erase(subSe3sIter);
+	// restore body's internal parameters;
+	Body* subBody=Body::byId(subId);
+	subBody-&gt;clumpId=Body::ID_NONE;
+	subBody-&gt;isDynamic=true;
+	LOG_DEBUG(&quot;Removed body #&quot;&lt;&lt;subId&lt;&lt;&quot; from clump #&quot;&lt;&lt;id);
+}
+
+/*! Clump's se3 will be updated (origin at centroid and axes coincident with principal inertia axes) and subSe3 modified in such a way that subBodies positions in world coordinates will not change.
+
+	The algorithm is as follows:
+	-# Clump::subBodiesSe3s and Clump::physicalParameters::se3 are invalid from this point
+	-# M=0; S=vector3r(0,0,0); I=zero tensor; (ALL calculations are in world coordinates!)
+	-# loop over Clump::subBodies (position x_i, mass m_i, inertia at subBody's centroid I_i)
+		- M+=m_i
+		- S+=m_i*x_i (local static moments are zero (centroid)
+		- get inertia tensor of subBody in world coordinates, by rotating the principal (local) tensor against subBody-&gt;se3-&gt;orientation; then translate it to world origin (parallel axes theorem), then I+=I_i_world
+	-# clumpPos=S/M
+	-# translate aggregate's inertia tensor; parallel axes on I (R=clumpPos): I^c_jk=I'_jk-M*(delta_jk R.R - R_j*R_k) [<A HREF="http://en.wikipedia.org/wiki/Moments_of_inertia#Parallel_axes_theorem">http://en.wikipedia.org/wiki/Moments_of_inertia#Parallel_axes_theorem</A>]
+	-# eigen decomposition of I, get principal inertia and rotation matrix of the clump
+	-# se3-&gt;orientation=quaternion(rotation_matrix); se3-&gt;position=clumpPos
+	-#	update subBodiesSe3s
+
+	@note User is responsible for calling this function when appropriate (after adding/removing bodies and before any subsequent simulation). This function can be rather slow by virtue of numerical integration.
+	@todo Needs to be implemented and tested.
+	@param intersecting if true, evaluate mass and inertia numerically; otherwise, use analytical methods (parallel axes theorem) which disregard any intersections, but are much faster. */
+void Clump::update(bool intersecting){
+	LOG_DEBUG(&quot;Updating clump #&quot;&lt;&lt;id&lt;&lt;&quot; parameters&quot;);
+	assert(subBodies.size()&gt;0);
+	// maybe handle the case of only one clump subBody specially?!
+}
+
+
+

Added: trunk/yade-extra/clump/Clump.hpp
===================================================================
--- trunk/yade-extra/clump/Clump.hpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-extra/clump/Clump.hpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -0,0 +1,101 @@
+// (c) 2007 Vaclav Smilauer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">eudoxos at arcig.cz</A>&gt;
+ 
+/*	To compile this class, you MUST
+		1. use recent version of scons
+		2. say extraModules=yade-extra/clump (this will cause SConscript in this directory to be processed)
+	Any further documentation is in doxygen comments.
+*/
+
+#ifndef CLUMP_HPP
+#define CLUMP_HPP
+
+#include&lt;vector&gt;
+#include&lt;yade/yade-core/Body.hpp&gt;
+#include&lt;yade/yade-lib-factory/Factorable.hpp&gt;
+#include &lt;boost/shared_ptr.hpp&gt;
+#include&lt;yade/yade-package-common/PhysicalParametersEngineUnit.hpp&gt;
+#include&lt;yade/yade-lib-base/Logging.hpp&gt;
+#include&lt;yade/yade-lib-base/yadeWm3Extra.hpp&gt;
+
+
+#ifndef HIGHLEVEL_CLUMPS
+	#error HIGHLEVEL_CLUMPS must be defined if clumps are to work!
+#endif
+
+/*! \brief Body representing clump (aggregate) composed by other existing bodies.
+
+	When an existing body is added to ::Clump, it's ::Body::isDynamic flag is set to false
+	(it is still subscribed to all its engines, to make it possible to remove it from the clump again).
+	All forces acting on |subBodies| are made to act on the clump itself, which will ensure that they
+	 influence all |subBodies| as if the clump were a rigid particle.
+ 
+	What are clump requirements so that they function?
+	-# Given any body, tell
+		- if it is a clump member \code Body::clumpId!=Body::ID_NONE \endcode
+		- what is it's clump id (Body::clumpId)
+	 	- if it is a clump (is instance of ::Clump)
+		- could be `Body::clumpId==Body::id`, but we can't guarantee consistency here; `id`s are assigned automatically by `BodyContainer` and it would have to be conscient of the body being clump... or not? This will probably be used not very often (engines use templates, not RTTI (?))
+	-# given the root body, tell
+		- what clumps it contains (enumerate all bodies and filter clumps, see above)
+	-#	given a clump, tell
+		- what bodies it contains (::Clump::subBodies)
+		- what are se3 of these bodies (::Clump::subSe3s)
+	-# add/delete bodies from/to clump (::Clump::add, ::Clump::del)
+		- This includes saving se3 of the subBody: it \em must be in clump's local coordinates so that it is constant. The transformation from global to local is given by clump's se3 at the moment of addition. Clump's se3 is initially (origin,identity)
+	-# Update clump's physical properties (Clump::update: will be copied from the Slum code)
+		- This \em must reposition subBodies so that they have the same se3 globally
+	-# Apply forces acting on subBodies to the clump instead (done in NewtonsForceLaw, NewtonsMomentumLaw) - uses world coordinates to calculate effect on the clump's centroid
+	-# Integrate position and orientation of the clump (ClumpLeapFrogPositionAndOrientationIntegrator: copy code from LeapFrogPositionIntegrator, LeapFrogOrientationIntegrator)
+		- LeapFrogPositionIntegrator and LeapFrogOrientationIntegrator skip clump subBodies automatically, since they have Body::isDynamic==false.
+	-# Recalculate ::subBodies position and orientation (same class as previously will handle that automatically)
+
+	Some more information can be found <A HREF="http://beta.arcig.cz/~eudoxos/phd/index.cgi/YaDe/HighLevelClumps">http://beta.arcig.cz/~eudoxos/phd/index.cgi/YaDe/HighLevelClumps</A>
+ 
+ */
+
+class Clump: public Body {
+		//! ID's of bodies that make part of this clump.
+		std::vector&lt;Body::id_t&gt; subBodies;
+		//! se3 of respective subBodies in local coordinates
+		std::vector&lt;Se3r&gt; subSe3s;
+	public:
+		Clump(): Body() { /*createIndex();*/ isDynamic=false; };
+		virtual ~Clump(){};
+		//! \brief add Body to the Clump
+		void add(Body::id_t);
+		//! \brief remove Body from the Clump
+		void del(Body::id_t);
+		//! Recalculate physical properties of clump.
+		void update(bool intersecting);
+
+	void registerAttributes(){Body::registerAttributes(); REGISTER_ATTRIBUTE(subBodies); REGISTER_ATTRIBUTE(subSe3s);}
+	REGISTER_CLASS_NAME(Clump);
+	REGISTER_BASE_CLASS_NAME(Body);
+	// REGISTER_CLASS_INDEX(Clump,Body);
+	DECLARE_LOGGER;
+};
+
+REGISTER_SERIALIZABLE(Clump,false);
+
+/*! \brief  Engine that calculate position and orientation of the clump in next timestep.
+
+This engine is responsible for updating ::Clump::subBodies positions as well so that the clump behaves as a rigid body.
+*/
+
+class ClumpLeapFrogPositionAndOrientationIntegrator: public PhysicalParametersEngineUnit {
+	public:
+		/*! \todo Needs to be implemented */
+		virtual void go(const shared_ptr&lt;PhysicalParameters&gt;&amp;, Body*);
+		ClumpLeapFrogPositionAndOrientationIntegrator(): PhysicalParametersEngineUnit() {/*createIndex();*/ }
+		virtual ~ClumpLeapFrogPositionAndOrientationIntegrator(){};
+
+	REGISTER_CLASS_NAME(ClumpLeapFrogPositionAndOrientationIntegrator);
+	REGISTER_BASE_CLASS_NAME(PhysicalParametersEngineUnit);
+	// REGISTER_CLASS_INDEX(ClumpLeapFrogPositionAndOrientationIntegrator,PhysicalParametersEngineUnit);
+	DECLARE_LOGGER;
+};
+
+REGISTER_SERIALIZABLE(ClumpLeapFrogPositionAndOrientationIntegrator,false);
+
+
+#endif /* CLUMP_HPP */

Added: trunk/yade-extra/clump/SConscript
===================================================================
--- trunk/yade-extra/clump/SConscript	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-extra/clump/SConscript	2007-02-09 14:54:21 UTC (rev 1058)
@@ -0,0 +1,12 @@
+Import('*')
+env.SharedLibrary('Clump',
+	['Clump.cpp'],
+	LIBS=env['LIBS']+['PhysicalParametersEngineUnit',
+		'Body',
+		'yade-lib-multimethods',
+		'yade-lib-factory',
+		'yade-lib-serialization',
+		'yade-lib-base',
+		'Wm3Foundation'],
+	CPPPATH=env['CPPPATH']+['$PREFIX/include'])
+

Modified: trunk/yade-packages/yade-package-common/src/Engine/DeusExMachina/ForceEngine/ForceEngine.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/Engine/DeusExMachina/ForceEngine/ForceEngine.cpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-packages/yade-package-common/src/Engine/DeusExMachina/ForceEngine/ForceEngine.cpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -14,7 +14,7 @@
 #include &lt;yade/yade-core/MetaBody.hpp&gt;
 
 
-ForceEngine::ForceEngine() : force(Vector3r::ZERO) , actionParameterForce(new Force)
+ForceEngine::ForceEngine() : actionParameterForce(new Force), force(Vector3r::ZERO)
 {
 }
 

Modified: trunk/yade-packages/yade-package-common/src/Engine/DeusExMachina/GravityEngine/GravityEngine.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/Engine/DeusExMachina/GravityEngine/GravityEngine.cpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-packages/yade-package-common/src/Engine/DeusExMachina/GravityEngine/GravityEngine.cpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -11,7 +11,7 @@
 #include &quot;Force.hpp&quot;
 #include &lt;yade/yade-core/MetaBody.hpp&gt;
 
-GravityEngine::GravityEngine() : gravity(Vector3r::ZERO) , actionParameterForce(new Force)
+GravityEngine::GravityEngine() : actionParameterForce(new Force), gravity(Vector3r::ZERO)
 {
 }
 

Modified: trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.cpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator/LeapFrogOrientationIntegrator.cpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -15,11 +15,7 @@
 void LeapFrogOrientationIntegrator::go(	  const shared_ptr&lt;PhysicalParameters&gt;&amp; b
 						, Body* body)
 {
-	#ifdef HIGHLEVEL_CLUMPS
-		if(!body-&gt;isDynamic || body-&gt;clumpId&gt;=0) return; // if clump member, integration will be done in clump's integrator and orientation of this body modified directly
-	#else
 	if(!body-&gt;isDynamic) return;
-	#endif
 		
 	unsigned int id = body-&gt;getId();
 	

Modified: trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.cpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator/LeapFrogPositionIntegrator.cpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -15,11 +15,7 @@
 void LeapFrogPositionIntegrator::go(       const shared_ptr&lt;PhysicalParameters&gt;&amp; b
 						, Body* body)
 {
-	#ifdef HIGHLEVEL_CLUMPS
-		if(!body-&gt;isDynamic || body-&gt;clumpId&gt;=0) return; // if clump member, integration will be done in clump's integrator and position of this body modified directly
-	#else
 	if(!body-&gt;isDynamic) return;
-	#endif
 
 	unsigned int id = body-&gt;getId();
 	

Modified: trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.cpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.cpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -10,6 +10,7 @@
 
 #include &quot;NewtonsForceLaw.hpp&quot;
 #include &quot;ParticleParameters.hpp&quot;
+#include &quot;RigidBodyParameters.hpp&quot;
 #include &quot;Force.hpp&quot;
 
 
@@ -36,12 +37,13 @@
 //	std::cin &gt;&gt; ch;
 
 	#ifdef HIGHLEVEL_CLUMPS
-	if (bb-&gt;clumpId&lt;0) p-&gt;acceleration = af-&gt;force/p-&gt;mass; // normal behavior of a standalone particle
+	if (bb-&gt;clumpId==Body::ID_NONE) p-&gt;acceleration = af-&gt;force/p-&gt;mass; // normal behavior of a standalone particle
 	else{
-		/* TODO: get the particle's clump's ParticleParameters, then something like
+		shared_ptr&lt;Body&gt; clump=Body::byId(bb-&gt;clumpId);
+		RigidBodyParameters* clumpPP=dynamic_cast&lt;RigidBodyParameters*&gt;(clump-&gt;physicalParameters.get());
+		/* TODO: the FIXME above still applies!!! */
 		clumpPP-&gt;acceleration+=af-&gt;force/clumpPP-&gt;mass;
-		clumpPP-&gt;angularAcceleration+= momentum generated by the force WRT particle centroid on clump centroid
-		*/
+		clumpPP-&gt;angularAcceleration+=(b-&gt;se3.position-clumpPP-&gt;se3.position).Cross(af-&gt;force); //momentum generated by the force WRT particle centroid on the clump centroid
 	}
 	#else
 		p-&gt;acceleration = af-&gt;force/p-&gt;mass;

Modified: trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.pro
===================================================================
--- trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.pro	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw/NewtonsForceLaw.pro	2007-02-09 14:54:21 UTC (rev 1058)
@@ -10,6 +10,7 @@
         -rdynamic 
 INCLUDEPATH += $${YADE_QMAKE_PATH}/include/ \
                ../../../DataClass/PhysicalAction/Force \
+               ../../../DataClass/PhysicalParameters/RigidBodyParameters \					
                ../../../DataClass/PhysicalParameters/ParticleParameters \
                ../../../Engine/MetaEngine/PhysicalActionApplier 
 QMAKE_LIBDIR = ../../../../bin \

Modified: trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.cpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw/NewtonsMomentumLaw.cpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -22,14 +22,13 @@
 	RigidBodyParameters * rb = static_cast&lt;RigidBodyParameters*&gt;(b.get());
 	
 	//FIXME : should be += and we should add an Engine that reset acceleration at the beginning
-	#ifdef HIGHLEVE_CLUMPS
-	if(bb-&gt;clumpId&lt;0) rb-&gt;angularAcceleration = diagDiv(am-&gt;momentum,rb-&gt;inertia);
+	#ifdef HIGHLEVEL_CLUMPS
+	if(bb-&gt;clumpId==Body::ID_NONE) rb-&gt;angularAcceleration = diagDiv(am-&gt;momentum,rb-&gt;inertia);
 	else{
-		/* TODO: get respective clump RigidBodyParameters, then something like
-		 * clumpRBP-&gt;angularAcceleration+=diagDiv(am-&gt;momentum,clumpRBP-&gt;inertia);
-		 * The FIXME above is critical for this to work!
-		 * */
-
+		shared_ptr&lt;Body&gt; clump=Body::byId(bb-&gt;clumpId);
+		RigidBodyParameters* clumpRBP=dynamic_cast&lt;RigidBodyParameters*&gt;(clump-&gt;physicalParameters.get());
+		/* TODO: the FIXME above still applies!!! */
+		clumpRBP-&gt;angularAcceleration+=diagDiv(am-&gt;momentum,clumpRBP-&gt;inertia);
 	}
 	#else
 	rb-&gt;angularAcceleration = diagDiv(am-&gt;momentum,rb-&gt;inertia);

Modified: trunk/yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.cpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider/PersistentSAPCollider.cpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -183,12 +183,11 @@
 	int offset1 = 3*id1;
 	int offset2 = 3*id2;
 	#ifdef HIGHLEVEL_CLUMPS
-		unsigned int clumpId1=(*(Omega::instance().rootBody()-&gt;bodies))[id1]-&gt;clumpId;
-		unsigned int clumpId2=(*(Omega::instance().rootBody()-&gt;bodies))[id2]-&gt;clumpId;
+		Body::id_t clumpId1=Body::byId(id1)-&gt;clumpId, clumpId2=Body::byId(id2)-&gt;clumpId;
 	#endif
 	bool overlapp =
 	#ifdef HIGHLEVEL_CLUMPS
-		(clumpId1&lt;0 || clumpId2&lt;0 || clumpId1!=clumpId2) &amp;&amp; // only collide if at least one particle is non-clump or belong to different clumps
+		(clumpId1==Body::ID_NONE || clumpId2&lt;Body::ID_NONE || clumpId1!=clumpId2) &amp;&amp; // only collide if at least one particle is non-clump or belong to different clumps
 	#endif
 		!(maximums[offset1]&lt;minimums[offset2] || maximums[offset2]&lt;minimums[offset1] || 
 		maximums[offset1+1]&lt;minimums[offset2+1] || maximums[offset2+1]&lt;minimums[offset1+1] || 

Modified: trunk/yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider/SAPCollider.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider/SAPCollider.cpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider/SAPCollider.cpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -118,7 +118,7 @@
 //			if (!(bodies-&gt;find(i)-&gt;isDynamic==false &amp;&amp; bodies-&gt;find(*it)-&gt;isDynamic==false))
 			#ifdef HIGHLEVEL_CLUMPS
 				if( (*bodies)[i]-&gt;isDynamic &amp;&amp; (*bodies)[*it]-&gt;isDynamic &amp;&amp; // old stuff: both bodies must be dynamic
-					( (*bodies)[i]-&gt;clumpId&lt;0 || (*bodies)[*it]-&gt;clumpId&lt;0 || ( (*bodies)[i]-&gt;clumpId != (*bodies)[*it]-&gt;clumpId )) // either (at least) one of them is not within a clump or they are not part of the same clump
+					( (*bodies)[i]-&gt;clumpId==Body::ID_NONE || (*bodies)[*it]-&gt;clumpId==Body::ID_NONE || ( (*bodies)[i]-&gt;clumpId != (*bodies)[*it]-&gt;clumpId )) // either (at least) one of them is not within a clump or they are not part of the same clump
 					)
 			#else
 			if (!((*bodies)[i]-&gt;isDynamic==false &amp;&amp; (*bodies)[*it]-&gt;isDynamic==false))

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp	2007-02-09 14:54:21 UTC (rev 1058)
@@ -27,7 +27,7 @@
 //      glPopMatrix();
 //}
 
-GLDrawSphere::GLDrawSphere() : first(true), glSphereList(-1), glWiredSphereList(-1)
+GLDrawSphere::GLDrawSphere() : first(true), glWiredSphereList(-1), glSphereList(-1)
 {
 };
 

Modified: trunk/yade-scripts/erskine3-apply.sh
===================================================================
--- trunk/yade-scripts/erskine3-apply.sh	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-scripts/erskine3-apply.sh	2007-02-09 14:54:21 UTC (rev 1058)
@@ -4,7 +4,8 @@
 
 ERSKINE=./erskine3.py
 YADE=../
-export YADE_QMAKE_PATH=/usr/local YADECOMPILATIONPATH=$YADE
+# erskine3 accepts scons variables smuggled as @VARIABLE and resulting in $VARIABLE in generated scripts; do that for $PREFIX (ac scons var)
+export YADE_QMAKE_PATH=@PREFIX YADECOMPILATIONPATH=$YADE
 ENGINE=--scons; SCRIPT=SConscript
 #ENGINE=--waf; SCRIPT=wscript_build
 

Modified: trunk/yade-scripts/erskine3.py
===================================================================
--- trunk/yade-scripts/erskine3.py	2007-02-07 10:01:44 UTC (rev 1057)
+++ trunk/yade-scripts/erskine3.py	2007-02-09 14:54:21 UTC (rev 1058)
@@ -2,13 +2,13 @@
 # -*- Encoding: utf-8 -*-
 
 &quot;&quot;&quot;
-This program should really be run by the erskine2-apply.sh script
+This program should really be run by the erskine3-apply.sh script
 
 Erskine is Watt's colleague in the house of Mr. Nutting.
 
 &quot;&quot;&quot;
 
-import sys,pprint,string,os#,os.path
+import sys,pprint,string,os
 from logging import *
 from os.path import *
 from re import *
@@ -22,7 +22,7 @@
 # variables that do not propagate to sub-builds
 localVars=['TEMPLATE','SUBDIRS','HEADERS','SOURCES','FORMS','LEXSOURCES','YACCSOURCES','TARGET','DESTDIR','PROJECT']
 # variables / function that are ignored if undefined (replaced by ''); for all other, a warning is printed (and are ignored anyway)
-undefOK=['CXXPATH','CXX','CXXFLAGS','YADE_QQMAKE_PATH','INCPATH','IDL_COMPILER']
+undefOK=['CXXPATH','CXX','CXXFLAGS','INCPATH','IDL_COMPILER']
 # internal qmake variables that may be replace with the environment ones without warning
 replaceOK=['YADECOMPILATIONPATH'] 
 discardedStatements=['^isEmpty\s*\(\s*YADE_QMAKE_PATH\s*\).*$']
@@ -118,6 +118,9 @@
 					else: repl=''
 			stat=stat[:m.start()]+repl+stat[m.end():]
 
+		# scons variables (namely, $PREFIX, were smuggled unexpanded by using @PREFIX instead. Change it to what it should be now.
+		stat=stat.replace('@','$')
+
 		conditional=match(r'^\s*(!?[a-zA-Z0-9_]+)\s*{(.*)}$',stat) # this is a (possibly negated) conditional; nothing complicated, please; specifically, nested conditionals do not work
 		if conditional:
 			cond,then=conditional.group(1,2)
@@ -249,18 +252,20 @@
 	#print &quot;relPath=%s,INCLUDEPATH=%s&quot;%(relPath,includePath)
 	def prependDirFileIfRelative(d,f):
 		def prepIf(ff):
-			if not isabs(ff): return join(d,ff)
+			if not isabs(ff) and ff[0]!='$': return join(d,ff)
 			return ff
 		return map(prepIf,f)
 	includePath=prependDirFileIfRelative(relPath,includePath)
 	# filter out non-existent paths; without warning, it could be a short lambda...
 	def DelAndWarnNonexistentPath(x):
-		if not exists(normpath(join(dirAbsPath,x))):
+		if not exists(normpath(join(dirAbsPath,x))) and x[0]!='$':
 			warning2(&quot;Include path `%s' is invalid, removed!&quot;%(normpath(join(dirAbsPath,x))))
 			return False
 		return True
 	includePath=filter(DelAndWarnNonexistentPath,includePath)
 	includePath=[normpath(p) for p in includePath]
+	# remove duplicates... <A HREF="http://stinkpot.afraid.org:8080/tricks/index.php/2006/05/find-all-the-unique-elements-in-a-python-list/">http://stinkpot.afraid.org:8080/tricks/index.php/2006/05/find-all-the-unique-elements-in-a-python-list/</A>
+	includePath=dict([(i,1) for i in includePath]).keys()
 
 
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000022.html">[Yade-commits] r1057 - in trunk: yade-core/src/yade	yade-libs/yade-lib-serialization/src/yade-lib-serialization	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw	yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider	yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider	yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GlobalStiffnessTimeStepper
</A></li>
	<LI>Next message: <A HREF="000024.html">[Yade-commits] r1059 - in trunk: yade-core/src/yade	yade-packages/yade-package-common/src/Engine/DeusExMachina/DisplacementEngine	yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending	yade-packages/yade-package-lattice/src/DataClass/PhysicalParameters/LatticeBeamParameters	yade-packages/yade-package-lattice/src/Engine/StandAloneEngine/BeamRecorder	yade-packages/yade-package-lattice/src/Engine/StandAloneEngine/LatticeLaw	yade-packages/yade-package-lattice/src/Engine/StandAloneEngine/MeasurePoisson	yade-packages/yade-package-lattice/src/Engine/StandAloneEngine/NodeRecorder	yade-packages/yade-package-lattice/src/Engine/StandAloneEngine/StrainRecorder	yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample	yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeBeamState
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23">[ date ]</a>
              <a href="thread.html#23">[ thread ]</a>
              <a href="subject.html#23">[ subject ]</a>
              <a href="author.html#23">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/yade-commits">More information about the Yade-commits
mailing list</a><br>
</body></html>
