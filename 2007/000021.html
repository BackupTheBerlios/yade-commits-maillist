<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Yade-commits] r1056 - in trunk: yade-guis/yade-gui-qt/src/QtGUI yade-libs/yade-lib-multimethods/src/yade-lib-multimethods yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry yade-packages/yade-p! ackage-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample yade-packages/yade-package-lattice/src/RenderingEngine yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/yade-commits/2007/index.html" >
   <LINK REL="made" HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1056%20-%20in%20trunk%3A%20yade-guis/yade-gui-qt/src/QtGUI%0A%20yade-libs/yade-lib-multimethods/src/yade-lib-multimethods%0A%20yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere%0A%20yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox%0A%20yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere%0A%20yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry%0A%20yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine%0A%20yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending%0A%20yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron%0A%20yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry%0A%20yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry%0A%20yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry%0A%20yade-packages/yade-p%21%0A%20ackage-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry%0A%20yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample%0A%20yade-packages/yade-package-lattice/src/RenderingEngine%0A%20yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry%0A%20yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment&In-Reply-To=%3C200702051946.l15JkoaC004074%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000020.html">
   <LINK REL="Next"  HREF="000022.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Yade-commits] r1056 - in trunk: yade-guis/yade-gui-qt/src/QtGUI yade-libs/yade-lib-multimethods/src/yade-lib-multimethods yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry yade-packages/yade-p! ackage-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample yade-packages/yade-package-lattice/src/RenderingEngine yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment</H1>
    <B>cosurgi at BerliOS</B> 
    <A HREF="mailto:yade-commits%40lists.berlios.de?Subject=Re%3A%20%5BYade-commits%5D%20r1056%20-%20in%20trunk%3A%20yade-guis/yade-gui-qt/src/QtGUI%0A%20yade-libs/yade-lib-multimethods/src/yade-lib-multimethods%0A%20yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere%0A%20yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox%0A%20yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere%0A%20yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry%0A%20yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine%0A%20yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending%0A%20yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron%0A%20yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry%0A%20yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry%0A%20yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry%0A%20yade-packages/yade-p%21%0A%20ackage-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry%0A%20yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample%0A%20yade-packages/yade-package-lattice/src/RenderingEngine%0A%20yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry%0A%20yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment&In-Reply-To=%3C200702051946.l15JkoaC004074%40sheep.berlios.de%3E"
       TITLE="[Yade-commits] r1056 - in trunk: yade-guis/yade-gui-qt/src/QtGUI yade-libs/yade-lib-multimethods/src/yade-lib-multimethods yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry yade-packages/yade-p! ackage-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample yade-packages/yade-package-lattice/src/RenderingEngine yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment">cosurgi at mail.berlios.de
       </A><BR>
    <I>Mon Feb  5 20:46:50 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000020.html">[Yade-commits] r1055 - trunk/yade-guis/yade-gui-qt/src/QtGUI
</A></li>
        <LI>Next message: <A HREF="000022.html">[Yade-commits] r1057 - in trunk: yade-core/src/yade	yade-libs/yade-lib-serialization/src/yade-lib-serialization	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw	yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider	yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider	yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GlobalStiffnessTimeStepper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21">[ date ]</a>
              <a href="thread.html#21">[ thread ]</a>
              <a href="subject.html#21">[ subject ]</a>
              <a href="author.html#21">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: cosurgi
Date: 2007-02-05 20:46:48 +0100 (Mon, 05 Feb 2007)
New Revision: 1056

Added:
   trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/
   trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.cpp
   trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.hpp
   trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.pro
   trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/
   trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.cpp
   trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.hpp
   trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.pro
Modified:
   trunk/yade-guis/yade-gui-qt/src/QtGUI/GLViewer.cpp
   trunk/yade-libs/yade-lib-multimethods/src/yade-lib-multimethods/FunctorWrapper.hpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.cpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.hpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.cpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.hpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.cpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.hpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractingGeometryFunctor.hpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp
   trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp
   trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.cpp
   trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.cpp
   trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.hpp
   trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp
   trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
   trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/InteractingGeometry.pro
   trunk/yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample/LatticeExample.cpp
   trunk/yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample/LatticeExample.pro
   trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.cpp
   trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.hpp
   trunk/yade-packages/yade-package-lattice/src/RenderingEngine/RenderingEngine.pro
Log:

  IMPORTANT: In this sommit I have added a third parameter to
     GLDrawInteractingGeometryFunctor, which means that all GLDrawInteracting*
     classes had to be changed. If you have your own classes that draw interacting
     geometry you must modify them as well. The extra paramater added is 'bool
     wireFrame'. I think it will be useful :)

  - also I made two separate 'bool' flags in the display settings to set wireframe for body and for interactions.

  - the interaction for linked spheres is drawn in two colors: red for compression, blue for tension.

  - some lattice improvements, like drawing of fracture surface in 3D.



Modified: trunk/yade-guis/yade-gui-qt/src/QtGUI/GLViewer.cpp
===================================================================
--- trunk/yade-guis/yade-gui-qt/src/QtGUI/GLViewer.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-guis/yade-gui-qt/src/QtGUI/GLViewer.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -95,7 +95,7 @@
 		Omega::instance().isoThick+=0.05, updateGL();
 
 	else if( e-&gt;key()==Qt::Key_End )
-		Omega::instance().isoSec=std::max(4, Omega::instance().isoSec-1), updateGL();
+		Omega::instance().isoSec=std::max(1, Omega::instance().isoSec-1), updateGL();
 	else if( e-&gt;key()==Qt::Key_Home )
 		Omega::instance().isoSec+=1, updateGL();
 // FIXME END

Modified: trunk/yade-libs/yade-lib-multimethods/src/yade-lib-multimethods/FunctorWrapper.hpp
===================================================================
--- trunk/yade-libs/yade-lib-multimethods/src/yade-lib-multimethods/FunctorWrapper.hpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-libs/yade-lib-multimethods/src/yade-lib-multimethods/FunctorWrapper.hpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -125,7 +125,7 @@
 			+ &quot;8. &quot; + typeid(Parm4).name() + &quot;\n&quot;
 			+ &quot;9. &quot; + typeid(Parm4).name() + &quot;\n&quot;
 			+ &quot;10. &quot; + typeid(Parm4).name() + &quot;\n&quot;
-			+ &quot;number of types used in the call: &quot; + boost::lexical_cast&lt;string&gt;(n);
+			+ &quot;number of types used in the call: &quot; + boost::lexical_cast&lt;string&gt;(n) + &quot;\n\n&quot;;
 			cerr &lt;&lt; err.c_str();
 			throw MultiMethodsBadVirtualCall(err.c_str());
 		}

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawGeometricalModel/GLDrawSphere/GLDrawSphere.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -101,6 +101,7 @@
 		// draw a circle from a bunch of short lines
 		//
 		// FACING the camera !!
+		// FIXME: this can be done faster, by storing the circle in the buffer (similarly as the sphere)
 		///////////////////////
 		//
 			glPushMatrix();

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -10,7 +10,7 @@
 #include &quot;InteractingBox.hpp&quot;
 #include &lt;yade/yade-lib-opengl/OpenGLWrapper.hpp&gt;
 
-void GLDrawInteractingBox::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; cg, const shared_ptr&lt;PhysicalParameters&gt;&amp;)
+void GLDrawInteractingBox::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; cg, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool)
 {
 	// FIXME : check that : one of those 2 lines are useless
   	glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, cg-&gt;diffuseColor);

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.hpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.hpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingBox/GLDrawInteractingBox.hpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -14,7 +14,7 @@
 class GLDrawInteractingBox : public GLDrawInteractingGeometryFunctor
 {
 	public :
-		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;);
+		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
 
 	RENDERS(InteractingBox);
 	REGISTER_CLASS_NAME(GLDrawInteractingBox);

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -18,7 +18,7 @@
 vector&lt;Vector3r&gt; GLDrawInteractingSphere::faces;
 
 
-void GLDrawInteractingSphere::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; cm, const shared_ptr&lt;PhysicalParameters&gt;&amp; )
+void GLDrawInteractingSphere::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; cm, const shared_ptr&lt;PhysicalParameters&gt;&amp; ,bool)
 {
 	static bool first=true;
 	

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.hpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.hpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawInteractingSphere/GLDrawInteractingSphere.hpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -22,7 +22,7 @@
 		void drawSphere(int depth);
 	
 	public :
-		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;);
+		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
 
 	RENDERS(InteractingSphere);
 	REGISTER_CLASS_NAME(GLDrawInteractingSphere);

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -9,7 +9,7 @@
 #include &quot;GLDrawMetaInteractingGeometry.hpp&quot;
 
 
-void GLDrawMetaInteractingGeometry::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; , const shared_ptr&lt;PhysicalParameters&gt;&amp;)
+void GLDrawMetaInteractingGeometry::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; , const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool)
 {
 
 

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.hpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.hpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/GLDrawInteractingGeometry/GLDrawMetaInteractingGeometry/GLDrawMetaInteractingGeometry.hpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -14,7 +14,7 @@
 class GLDrawMetaInteractingGeometry : public GLDrawInteractingGeometryFunctor
 {
 	public :
-		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;);
+		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
 
 	RENDERS(MetaInteractingGeometry);
 	REGISTER_CLASS_NAME(GLDrawMetaInteractingGeometry);

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractingGeometryFunctor.hpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractingGeometryFunctor.hpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/GLDrawInteractingGeometryFunctor.hpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -20,7 +20,7 @@
 class GLDrawInteractingGeometryFunctor :	public EngineUnit1D
 						&lt;
 		 					void ,
-		 					TYPELIST_2(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;) 
+		 					TYPELIST_3(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool) 
 						&gt;
 {
 	public :

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -546,13 +546,13 @@
 		glTranslatef(se3.position[0],se3.position[1],se3.position[2]);
 		glRotatef(angle*Mathr::RAD_TO_DEG,axis[0],axis[1],axis[2]);
 		if((*bi)-&gt;interactingGeometry &amp;&amp; ( ((*bi)-&gt;getGroupMask() &amp; Draw_mask) || (*bi)-&gt;getGroupMask()==0 ))
-			interactingGeometryDispatcher((*bi)-&gt;interactingGeometry,(*bi)-&gt;physicalParameters);
+			interactingGeometryDispatcher((*bi)-&gt;interactingGeometry,(*bi)-&gt;physicalParameters,Body_wire);
 		glPopMatrix();
 	}
 	
 	glPushMatrix();
 	if(rootBody-&gt;interactingGeometry)
-		interactingGeometryDispatcher(rootBody-&gt;interactingGeometry,rootBody-&gt;physicalParameters);
+		interactingGeometryDispatcher(rootBody-&gt;interactingGeometry,rootBody-&gt;physicalParameters,Body_wire);
 	glPopMatrix();
 }
 

Modified: trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp
===================================================================
--- trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-common/src/RenderingEngine/OpenGLRenderingEngine/OpenGLRenderingEngine.hpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -50,7 +50,7 @@
 
 		DynLibDispatcher&lt; PhysicalParameters  , GLDrawStateFunctor,               void , TYPELIST_1(const shared_ptr&lt;PhysicalParameters&gt;&amp;) &gt; stateDispatcher;
 		DynLibDispatcher&lt; BoundingVolume      , GLDrawBoundingVolumeFunctor,      void , TYPELIST_1(const shared_ptr&lt;BoundingVolume&gt;&amp;) &gt; boundingVolumeDispatcher;
-		DynLibDispatcher&lt; InteractingGeometry , GLDrawInteractingGeometryFunctor, void , TYPELIST_2(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;) &gt; interactingGeometryDispatcher;
+		DynLibDispatcher&lt; InteractingGeometry , GLDrawInteractingGeometryFunctor, void , TYPELIST_3(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool) &gt; interactingGeometryDispatcher;
 		// FIXME - in fact it is a 1D dispatcher
 		DynLibDispatcher&lt; GeometricalModel    , GLDrawGeometricalModelFunctor,    void , TYPELIST_3(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;, bool) &gt; geometricalModelDispatcher;
 		DynLibDispatcher&lt; GeometricalModel    , GLDrawShadowVolumeFunctor,        void , TYPELIST_3(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;, const Vector3r&amp; ) &gt; shadowVolumeDispatcher;

Modified: trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.cpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-dem/src/PreProcessor/ThreePointBending/ThreePointBending.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -188,6 +188,7 @@
 				bm-&gt;young		= sphereYoungModulus;
 				bm-&gt;poisson		= spherePoissonRatio;
 				bm-&gt;frictionAngle	= sphereFrictionDeg * Mathr::PI/180.0;
+				bm-&gt;mass		/= 1000.0; // FIXME !!!
 			}
 		}
 	}

Modified: trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.cpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -9,7 +9,7 @@
 #include &quot;InteractingMyTetrahedron.hpp&quot;
 #include &lt;yade/yade-lib-opengl/OpenGLWrapper.hpp&gt;
 
-void GLDrawInteractingMyTetrahedron::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; cm, const shared_ptr&lt;PhysicalParameters&gt;&amp; )
+void GLDrawInteractingMyTetrahedron::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; cm, const shared_ptr&lt;PhysicalParameters&gt;&amp; ,bool)
 {
 	glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, cm-&gt;diffuseColor);
 	glColor3v(cm-&gt;diffuseColor);

Modified: trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.hpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.hpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawInteractingMyTetrahedron/GLDrawInteractingMyTetrahedron.hpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -17,7 +17,7 @@
 class GLDrawInteractingMyTetrahedron : public GLDrawInteractingGeometryFunctor
 {	
 	public :
-		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;);
+		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
 
 	RENDERS(InteractingMyTetrahedron);
 	REGISTER_CLASS_NAME(GLDrawInteractingMyTetrahedron);

Modified: trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSDECLinkGeometry/GLDrawSDECLinkGeometry.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -69,7 +69,10 @@
 		}
 		else
 			glScalef(mid,mid*0.05,mid*0.05);
-		glColor3(0.2,0.2,0.7);
+		if( sc-&gt;normal.Dot(el-&gt;normalForce) &lt; 0 )
+			glColor3(0.5,0.5,0.9);
+		else
+			glColor3(0.9,0.5,0.5);
 	// ///////////
 
 		glEnable(GL_LIGHTING);

Modified: trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp
===================================================================
--- trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-dem/src/RenderingEngine/GLDrawSpheresContactGeometry/GLDrawSpheresContactGeometry.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -71,6 +71,7 @@
 		glColor3(0.5,0.5,0.5);
 	// ///////////
 
+//		glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, gm-&gt;diffuseColor);
 		glEnable(GL_LIGHTING);
 		glutSolidCube(1.0);
 

Modified: trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/InteractingGeometry.pro
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/InteractingGeometry.pro	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/InteractingGeometry.pro	2007-02-05 19:46:48 UTC (rev 1056)
@@ -2,6 +2,7 @@
 error( &quot;YADE_QMAKE_PATH internal qmake variable is not set, you should run for example qmake YADE_QMAKE_PATH=/usr/local, this will not work from inside kdevelop (when they will fix it?)&quot; )
 }
 
+SUBDIRS += LatticeInteractingGeometry
 
 CONFIG += debug \
           thread \

Added: trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.cpp
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -0,0 +1,21 @@
+/*************************************************************************
+*  Copyright (C) 2007 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include &quot;LatticeInteractingGeometry.hpp&quot;
+
+
+LatticeInteractingGeometry::LatticeInteractingGeometry () : MetaInteractingGeometry()
+{
+	createIndex();
+}
+
+LatticeInteractingGeometry::~LatticeInteractingGeometry ()
+{
+}
+
+

Added: trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.hpp
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.hpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.hpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -0,0 +1,31 @@
+/*************************************************************************
+*  Copyright (C) 2007 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef LATTICE_INTERACTINGGEOMETRY_HPP
+#define LATTICE_INTERACTINGGEOMETRY_HPP
+
+#include &lt;yade/yade-package-common/MetaInteractingGeometry.hpp&gt;
+
+class LatticeInteractingGeometry : public MetaInteractingGeometry
+{
+	public :
+		LatticeInteractingGeometry ();
+		virtual ~LatticeInteractingGeometry ();
+
+/// Serialization
+	REGISTER_CLASS_NAME(LatticeInteractingGeometry);
+	REGISTER_BASE_CLASS_NAME(MetaInteractingGeometry);
+	
+/// Indexable
+	REGISTER_CLASS_INDEX(LatticeInteractingGeometry,MetaInteractingGeometry);
+};
+
+REGISTER_SERIALIZABLE(LatticeInteractingGeometry,false);
+
+#endif // METAINTERACTINGGEOMETRY_HPP
+

Added: trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.pro
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.pro	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/DataClass/InteractingGeometry/LatticeInteractingGeometry/LatticeInteractingGeometry.pro	2007-02-05 19:46:48 UTC (rev 1056)
@@ -0,0 +1,25 @@
+isEmpty ( YADE_QMAKE_PATH ) {
+error( &quot;YADE_QMAKE_PATH internal qmake variable is not set, you should run for example qmake YADE_QMAKE_PATH=/usr/local, this will not work from inside kdevelop (when they will fix it?)&quot; )
+}
+
+
+HEADERS += LatticeInteractingGeometry.hpp 
+SOURCES += LatticeInteractingGeometry.cpp 
+LIBS += -lMetaInteractingGeometry \
+        -rdynamic 
+QMAKE_LIBDIR = ../../../bin \
+               $${YADE_QMAKE_PATH}/lib/yade/yade-package-common/ \
+               $${YADE_QMAKE_PATH}/lib/yade/yade-libs/ 
+QMAKE_CXXFLAGS_RELEASE += -lpthread \
+                          -pthread 
+QMAKE_CXXFLAGS_DEBUG += -lpthread \
+                        -pthread 
+DESTDIR = ../../../../bin 
+CONFIG += debug \
+          thread \
+          warn_on \
+          dll 
+TEMPLATE = lib 
+INCLUDEPATH += $${YADE_QMAKE_PATH}/include
+
+QMAKE_RUN_CXX_IMP = $(CXX) -c $(CXXFLAGS) $(INCPATH) -o $@ $(shell pwd)/$&lt;

Modified: trunk/yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample/LatticeExample.cpp
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample/LatticeExample.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample/LatticeExample.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -23,6 +23,7 @@
 #include &quot;NonLocalInitializer.hpp&quot;
 #include &lt;yade/yade-lib-base/yadeWm3Extra.hpp&gt;
 
+#include &quot;LatticeInteractingGeometry.hpp&quot;
 
 #include &lt;yade/yade-package-common/Sphere.hpp&gt;
 
@@ -826,11 +827,11 @@
 //static int zzzzz=0;
 //switch(zzzzz%5)
 //{
-//      case 0  : physics-&gt;se3.position=Vector3r(0,0.4,1.5); break;
-//      case 1  : physics-&gt;se3.position=Vector3r(0,0.8,0.6); break;
-//      case 2  : physics-&gt;se3.position=Vector3r(0,0  ,0  ); break;
-//      case 3  : physics-&gt;se3.position=Vector3r(0,1.6,0.5); break;
-//      case 4  : physics-&gt;se3.position=Vector3r(0,2.0,0  ); break;
+//      case 0  : physics-&gt;se3.position=Vector3r(0.4,1.5,0); break;
+//      case 1  : physics-&gt;se3.position=Vector3r(0.8,0.6,0); break;
+//      case 2  : physics-&gt;se3.position=Vector3r(0  ,0  ,0); break;
+//      case 3  : physics-&gt;se3.position=Vector3r(1.6,0.5,0); break;
+//      case 4  : physics-&gt;se3.position=Vector3r(2.0,0  ,0); break;
 //};
 //zzzzz++;
 //
@@ -1077,8 +1078,9 @@
         physics-&gt;useBendTensileSoftening= useBendTensileSoftening;
         physics-&gt;useStiffnessSoftening  = useStiffnessSoftening;
         
-        shared_ptr&lt;MetaInteractingGeometry&gt; set(new MetaInteractingGeometry());
-        
+        shared_ptr&lt;LatticeInteractingGeometry&gt; set(new LatticeInteractingGeometry());
+       
+
 	set-&gt;diffuseColor		= Vector3f(0,0,1);
 
 	shared_ptr&lt;AABB&gt; aabb(new AABB);

Modified: trunk/yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample/LatticeExample.pro
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample/LatticeExample.pro	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/PreProcessor/LatticeExample/LatticeExample.pro	2007-02-05 19:46:48 UTC (rev 1056)
@@ -19,6 +19,7 @@
         -lInteractionVecSet \
         -lBodyRedirectionVector \
         -lMetaInteractingGeometry \
+        -lLatticeInteractingGeometry \
         -lGeometricalModelMetaEngine \
         -lInteractionPhysicsMetaEngine \
         -lBoundingVolumeMetaEngine \
@@ -44,6 +45,7 @@
                ../../Engine/StandAloneEngine/MeasurePoisson \
                ../../Engine/StandAloneEngine/NonLocalInitializer \
                ../../DataClass/PhysicalParameters/LatticeSetParameters \
+               ../../DataClass/InteractingGeometry/LatticeInteractingGeometry \
                ../../DataClass/PhysicalParameters/LatticeNodeParameters \
                ../../DataClass/PhysicalParameters/LatticeBeamParameters \
                ../../DataClass/InteractionPhysics/LatticeBeamAngularSpring \

Added: trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.cpp
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -0,0 +1,201 @@
+/*************************************************************************
+*  Copyright (C) 2007 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#include &quot;GLDrawLatticeInteractingGeometry.hpp&quot;
+#include &quot;LatticeSetGeometry.hpp&quot;
+#include &quot;LatticeSetParameters.hpp&quot;
+#include &quot;LatticeBeamParameters.hpp&quot;
+#include &quot;LatticeNodeParameters.hpp&quot;
+#include &quot;LatticeInteractingGeometry.hpp&quot;
+#include &lt;yade/yade-lib-opengl/OpenGLWrapper.hpp&gt;
+#include &lt;yade/yade-core/MetaBody.hpp&gt;
+#include &lt;yade/yade-core/Omega.hpp&gt;
+#include &lt;yade/yade-lib-base/yadeWm3Extra.hpp&gt;
+
+GLDrawLatticeInteractingGeometry::GLDrawLatticeInteractingGeometry() : maxLen(0)
+{
+};
+
+bool GLDrawLatticeInteractingGeometry::drawn(unsigned int A,unsigned int B,unsigned int C)
+{
+/*	
+	unsigned int a = std::max(A,std::max(B,C));
+	unsigned int c = std::min(A,std::min(B,C));
+	unsigned int b;
+	     if( A &lt; a &amp;&amp; A &gt; c ) b=A;
+	else if( B &lt; a &amp;&amp; B &gt; c ) b=B;
+	else if( C &lt; a &amp;&amp; C &gt; c ) b=C;
+	else exit(1);
+
+//	std::cerr &lt;&lt; a &lt;&lt;&quot; &quot; &lt;&lt; b &lt;&lt; &quot; &quot; &lt;&lt; c &lt;&lt; &quot;\n&quot;;
+
+	if(done.size()&lt;=a) done.resize(a+1);
+	if(done[a].size()&lt;=b) done[a].resize(b+1);
+	if(done[a][b].size()&lt;=c) done[a][b].resize(c+1,0);
+
+	if(done[a][b][c] == 1)
+		return true;
+	else
+		done[a][b][c]=1;
+	return false;
+*/
+	std::set&lt;unsigned int&gt; nodes;
+	nodes.insert(A);
+	nodes.insert(B);
+	nodes.insert(C);
+	return !done.insert(nodes).second;
+
+};
+
+void GLDrawLatticeInteractingGeometry::zeroDrawn()
+{
+	done.clear();
+/*	
+	std::vector&lt;std::vector&lt;std::vector&lt;unsigned char&gt; &gt; &gt;::iterator a=done.begin();
+	std::vector&lt;std::vector&lt;std::vector&lt;unsigned char&gt; &gt; &gt;::iterator A=done.end();
+	for( ; a!=A ; ++a)
+	{
+		std::vector&lt;std::vector&lt;unsigned char&gt; &gt;::iterator b=a-&gt;begin();
+		std::vector&lt;std::vector&lt;unsigned char&gt; &gt;::iterator B=a-&gt;end();
+		for( ; b!=B ; ++b)
+		{
+			std::vector&lt;unsigned char&gt;::iterator c=b-&gt;begin();
+			std::vector&lt;unsigned char&gt;::iterator C=b-&gt;end();
+			for( ; c!=C ; ++c)
+				*c=0;
+		}
+	}
+*/
+};
+
+void GLDrawLatticeInteractingGeometry::damagedNeighbor(unsigned int a)
+{
+	if(damaged.size()&lt;=a) damaged.resize(a+1,0);
+	++damaged[a];
+
+	//(*(bodies))[A]-&gt;geometricalModel-&gt;diffuseColor = Vector3f(0.0,0.0,((float)section)/2.0);
+};
+
+void GLDrawLatticeInteractingGeometry::go(const shared_ptr&lt;InteractingGeometry&gt;&amp; gm, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool wire)
+{
+//	return;
+
+	static bool first=true;
+	if(first)
+	{
+		first=false;
+		Omega::instance().isoSec=1;
+	}
+	int limit = Omega::instance().isoSec;
+
+	InteractionContainer* interactions = Omega::instance().getRootBody()-&gt;persistentInteractions.get();
+	BodyContainer* bodies = Omega::instance().getRootBody()-&gt;bodies.get();
+
+	InteractionContainer::iterator angles     = interactions-&gt;begin();
+	InteractionContainer::iterator angles_end = interactions-&gt;end();
+
+	if(wire)
+	{
+		damaged.clear();
+		for(  ; angles != angles_end; ++angles )
+		{
+			if(        (!(bodies-&gt;exists( (*angles)-&gt;getId1())) )  
+				&amp;&amp;    bodies-&gt;exists( (*angles)-&gt;getId2() ) )
+			{
+				LatticeBeamParameters* b2 = static_cast&lt;LatticeBeamParameters*&gt;(((*(bodies))[(*angles)-&gt;getId2()])-&gt;physicalParameters.get());
+				unsigned int A = b2-&gt;id1,
+					     B = b2-&gt;id2;
+				Vector3f c1 = (*(bodies))[A]-&gt;geometricalModel-&gt;diffuseColor;
+				Vector3f c2 = (*(bodies))[B]-&gt;geometricalModel-&gt;diffuseColor;
+				// beams that have nodes with red=0 and green=0 in geometrical model are used by MovingSupport, so I want to exclude them...
+				if( !((c1[0]==0 &amp;&amp; c1[1]==0) || (c2[0]==0 &amp;&amp; c2[1]==0)) )
+					damagedNeighbor((*angles)-&gt;getId2());
+			}
+			else
+			if(        (!(bodies-&gt;exists( (*angles)-&gt;getId2())) )  
+				&amp;&amp;    bodies-&gt;exists( (*angles)-&gt;getId1() ) )
+			{
+				LatticeBeamParameters* b1 = static_cast&lt;LatticeBeamParameters*&gt;(((*(bodies))[(*angles)-&gt;getId1()])-&gt;physicalParameters.get());
+				unsigned int A = b1-&gt;id1,
+					     B = b1-&gt;id2;
+				Vector3f c1 = (*(bodies))[A]-&gt;geometricalModel-&gt;diffuseColor;
+				Vector3f c2 = (*(bodies))[B]-&gt;geometricalModel-&gt;diffuseColor;
+				if( !((c1[0]==0 &amp;&amp; c1[1]==0) || (c2[0]==0 &amp;&amp; c2[1]==0)) )
+					damagedNeighbor((*angles)-&gt;getId1());
+			}
+		}
+		angles     = interactions-&gt;begin();
+		angles_end = interactions-&gt;end();
+	}
+
+  	glMaterialv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, gm-&gt;diffuseColor);
+	glColor3(0.5,0.5,0.9);
+	glDisable(GL_CULL_FACE);
+	glEnable(GL_LIGHTING);
+	glEnable(GL_NORMALIZE); // GLDrawTetrahedron
+	glBegin(GL_TRIANGLES);
+
+		zeroDrawn();
+		for(  ; angles != angles_end; ++angles )
+		{
+			if(        bodies-&gt;exists( (*angles)-&gt;getId1() )  
+				&amp;&amp; bodies-&gt;exists( (*angles)-&gt;getId2() ) )
+			{
+				bool red=false;
+
+				LatticeBeamParameters* b1 = static_cast&lt;LatticeBeamParameters*&gt;(((*(bodies))[(*angles)-&gt;getId1()])-&gt;physicalParameters.get());
+				LatticeBeamParameters* b2 = static_cast&lt;LatticeBeamParameters*&gt;(((*(bodies))[(*angles)-&gt;getId2()])-&gt;physicalParameters.get());
+				maxLen = std::max(b1-&gt;length,maxLen);
+				maxLen = std::max(b2-&gt;length,maxLen);
+			
+				Vector3r p1,p2,p3;
+				unsigned int A=b1-&gt;id1,
+					     B=b1-&gt;id2,
+					     C=b2-&gt;id1,
+					     D=b2-&gt;id2;
+				if( !(A!=B &amp;&amp; A!=C &amp;&amp; B!=C) )
+					if( A==B )	A=D;
+					else if(A==C)	A=D;
+					else if(B==C)	B=D;
+
+				if(wire &amp;&amp; (damaged.size()&gt;std::max((*angles)-&gt;getId1(),(*angles)-&gt;getId2())) &amp;&amp; (damaged[(*angles)-&gt;getId1()]&gt;=limit &amp;&amp; damaged[(*angles)-&gt;getId2()]&gt;=limit))
+				{
+					glColor3(0.9,0.2,0.2);
+					red=true;
+				}
+
+
+				if((wire &amp;&amp; red) || !wire)
+				if(drawn(A,B,C))
+				{
+					p1 = static_cast&lt;LatticeNodeParameters*&gt;(((*(bodies))[A])-&gt;physicalParameters.get())-&gt;se3.position;
+					p2 = static_cast&lt;LatticeNodeParameters*&gt;(((*(bodies))[B])-&gt;physicalParameters.get())-&gt;se3.position;
+					p3 = static_cast&lt;LatticeNodeParameters*&gt;(((*(bodies))[C])-&gt;physicalParameters.get())-&gt;se3.position;
+	
+					Vector3r normal = (p2 - p1).UnitCross(p3 - p1);
+					glNormal3dv(normal);
+					glVertex3dv(p1+normal*maxLen*0.01);
+					glVertex3dv(p2+normal*maxLen*0.01);
+					glVertex3dv(p3+normal*maxLen*0.01);
+	
+					normal*=-1.0;
+					glNormal3dv(normal);
+					glVertex3dv(p1+normal*maxLen*0.01);
+					glVertex3dv(p2+normal*maxLen*0.01);
+					glVertex3dv(p3+normal*maxLen*0.01);
+				}
+			}
+			else
+			{ // deleted nearby....
+			}
+		}
+
+	glEnd();
+
+}
+

Added: trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.hpp
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.hpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.hpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -0,0 +1,41 @@
+/*************************************************************************
+*  Copyright (C) 2007 by Janek Kozicki                                   *
+*  <A HREF="https://lists.berlios.de/mailman/listinfo/yade-commits">cosurgi at berlios.de</A>                                                    *
+*                                                                        *
+*  This program is free software; it is licensed under the terms of the  *
+*  GNU General Public License v2 or later. See file LICENSE for details. *
+*************************************************************************/
+
+#ifndef GLDRAW_LATTICE_INTERACTING_GEOMETRY_HPP
+#define GLDRAW_LATTICE_INTERACTING_GEOMETRY_HPP
+
+#include &lt;yade/yade-package-common/GLDrawInteractingGeometryFunctor.hpp&gt;
+#include &lt;vector&gt;
+
+class GLDrawLatticeInteractingGeometry : public GLDrawInteractingGeometryFunctor
+{
+	private :
+		Real maxLen;
+		//std::vector&lt;std::vector&lt;std::vector&lt;bool&gt; &gt; &gt; done;
+		//std::vector&lt;std::vector&lt;std::vector&lt;unsigned char&gt; &gt; &gt; done;
+		std::set&lt;std::set&lt;unsigned int&gt; &gt; done;
+		bool drawn(unsigned int A,unsigned int B,unsigned int C);
+		void zeroDrawn();
+		
+		std::vector&lt;unsigned char&gt; damaged;
+		void damagedNeighbor(unsigned int a);
+
+	public :
+		GLDrawLatticeInteractingGeometry();
+		virtual void go(const shared_ptr&lt;InteractingGeometry&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
+
+	RENDERS(LatticeInteractingGeometry);
+	REGISTER_CLASS_NAME(GLDrawLatticeInteractingGeometry);
+	REGISTER_BASE_CLASS_NAME(GLDrawInteractingGeometryFunctor);
+
+};
+
+REGISTER_SERIALIZABLE(GLDrawLatticeInteractingGeometry,false);
+
+#endif
+

Added: trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.pro
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.pro	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLatticeInteractingGeometry/GLDrawLatticeInteractingGeometry.pro	2007-02-05 19:46:48 UTC (rev 1056)
@@ -0,0 +1,35 @@
+isEmpty ( YADE_QMAKE_PATH ) {
+error( &quot;YADE_QMAKE_PATH internal qmake variable is not set, you should run for example qmake YADE_QMAKE_PATH=/usr/local, this will not work from inside kdevelop (when they will fix it?)&quot; )
+}
+
+
+LIBS += -lLatticeSetGeometry \
+	-lLatticeSetParameters \
+	-lLatticeBeamParameters \
+	-lLatticeNodeParameters \
+	-lLatticeInteractingGeometry \
+        -lyade-lib-opengl \
+	-lyade-lib-computational-geometry \
+        -rdynamic 
+INCLUDEPATH += $${YADE_QMAKE_PATH}/include/ \
+               ../../DataClass/PhysicalParameters/LatticeSetParameters \
+               ../../DataClass/PhysicalParameters/LatticeBeamParameters \
+               ../../DataClass/PhysicalParameters/LatticeNodeParameters \
+               ../../DataClass/InteractingGeometry/LatticeInteractingGeometry \
+               ../../DataClass/GeometricalModel/LatticeSetGeometry 
+QMAKE_LIBDIR = ../../../bin \
+               $${YADE_QMAKE_PATH}/lib/yade/yade-package-common/ \
+               $${YADE_QMAKE_PATH}/lib/yade/yade-libs/ 
+QMAKE_CXXFLAGS_RELEASE += -lpthread \
+                          -pthread 
+QMAKE_CXXFLAGS_DEBUG += -lpthread \
+                        -pthread 
+DESTDIR = ../../../bin 
+CONFIG += debug \
+          thread \
+          warn_on \
+          dll 
+TEMPLATE = lib 
+HEADERS += GLDrawLatticeInteractingGeometry.hpp 
+SOURCES += GLDrawLatticeInteractingGeometry.cpp 
+QMAKE_RUN_CXX_IMP = $(CXX) -c $(CXXFLAGS) $(INCPATH) -o $@ $(shell pwd)/$&lt;

Modified: trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.cpp
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.cpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.cpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -10,6 +10,10 @@
 #include &quot;LineSegment.hpp&quot;
 #include &lt;yade/yade-lib-opengl/OpenGLWrapper.hpp&gt;
 
+GLDrawLineSegment::GLDrawLineSegment() : maxLen(0)
+{
+};
+
 void GLDrawLineSegment::go(const shared_ptr&lt;GeometricalModel&gt;&amp; gm, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool wire)
 {
 	// FIXME : check that : one of those 2 lines are useless
@@ -17,15 +21,19 @@
 	glColor3v(gm-&gt;diffuseColor);
 	
 	Real len = (static_cast&lt;LineSegment*&gt;(gm.get()))-&gt;length;
+	maxLen = std::max(len,maxLen);
 
 	// FIXME - there must be a way to tell this from outside
 //	glScalef(len,0.030,0.030); // it's a box, not a line. looks better :)
 //	glScalef(len,0.010,0.010); // it's a box, not a line. looks better :)
 //	glScalef(len,0.001,0.001); // it's a box, not a line. looks better :)
-	glScalef(len,0.00007,0.00007); // it's a box, not a line. looks better :)
+//	glScalef(len,0.00007,0.00007); // it's a box, not a line. looks better :)
+	glScalef(len,maxLen*0.07,maxLen*0.07); // it's a box, not a line. looks better :)
 
 	if (gm-&gt;wire || wire)
 	{
+		maxLen = 0;
+
 		glBegin(GL_LINES);
 		glDisable(GL_LIGHTING);
 

Modified: trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.hpp
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.hpp	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/RenderingEngine/GLDrawLineSegment/GLDrawLineSegment.hpp	2007-02-05 19:46:48 UTC (rev 1056)
@@ -13,7 +13,10 @@
 
 class GLDrawLineSegment : public GLDrawGeometricalModelFunctor
 {
+	private :
+		Real maxLen;
 	public :
+		GLDrawLineSegment();
 		virtual void go(const shared_ptr&lt;GeometricalModel&gt;&amp;, const shared_ptr&lt;PhysicalParameters&gt;&amp;,bool);
 
 	RENDERS(LineSegment);

Modified: trunk/yade-packages/yade-package-lattice/src/RenderingEngine/RenderingEngine.pro
===================================================================
--- trunk/yade-packages/yade-package-lattice/src/RenderingEngine/RenderingEngine.pro	2007-02-03 19:46:28 UTC (rev 1055)
+++ trunk/yade-packages/yade-package-lattice/src/RenderingEngine/RenderingEngine.pro	2007-02-05 19:46:48 UTC (rev 1056)
@@ -5,7 +5,8 @@
 
 SUBDIRS += GLDrawLineSegment \
            GLDrawLatticeBeamState \
-	   GLDrawLatticeSetGeometry
+	   GLDrawLatticeSetGeometry \
+	   GLDrawLatticeInteractingGeometry
 CONFIG += debug \
           thread \
 warn_on


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000020.html">[Yade-commits] r1055 - trunk/yade-guis/yade-gui-qt/src/QtGUI
</A></li>
	<LI>Next message: <A HREF="000022.html">[Yade-commits] r1057 - in trunk: yade-core/src/yade	yade-libs/yade-lib-serialization/src/yade-lib-serialization	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogOrientationIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/LeapFrogPositionIntegrator	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsForceLaw	yade-packages/yade-package-common/src/Engine/EngineUnit/NewtonsMomentumLaw	yade-packages/yade-package-common/src/Engine/StandAloneEngine/PersistentSAPCollider	yade-packages/yade-package-common/src/Engine/StandAloneEngine/SAPCollider	yade-packages/yade-package-dem/src/Engine/StandAloneEngine/GlobalStiffnessTimeStepper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21">[ date ]</a>
              <a href="thread.html#21">[ thread ]</a>
              <a href="subject.html#21">[ subject ]</a>
              <a href="author.html#21">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/yade-commits">More information about the Yade-commits
mailing list</a><br>
</body></html>
